var ENV={platform:"classic",mode:"production"};var SC=SC||{BUNDLE_INFO:{},LAZY_INSTANTIATION:{}};SC.json=JSON;SC.browser=(function(){var c=navigator.userAgent.toLowerCase();var a=(c.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1];var b={version:a,safari:(/webkit/).test(c)?a:0,opera:(/opera/).test(c)?a:0,msie:(/msie/).test(c)&&!(/opera/).test(c)?a:0,mozilla:(/mozilla/).test(c)&&!(/(compatible|webkit)/).test(c)?a:0,mobileSafari:(/apple.*mobile.*safari/).test(c)?a:0,windows:!!(/(windows)/).test(c),mac:!!((/(macintosh)/).test(c)||(/(mac os x)/).test(c)),language:(navigator.language||navigator.browserLanguage).split("-",1)[0]};b.current=b.msie?"msie":b.mozilla?"mozilla":b.safari?"safari":b.opera?"opera":"unknown";return b})();SC.bundleDidLoad=function(a){var b=this.BUNDLE_INFO[a];if(!b){b=this.BUNDLE_INFO[a]={}}b.loaded=true};SC.bundleIsLoaded=function(a){var b=this.BUNDLE_INFO[a];return b?!!b.loaded:false};SC.loadBundle=function(){throw"SC.loadBundle(): SproutCore is not loaded."};SC.setupBodyClassNames=function(){var e=document.body;if(!e){return}var c,a,f,b,g,d;c=SC.browser.current;a=SC.browser.windows?"windows":SC.browser.mac?"mac":"other-platform";d=document.documentElement.style;f=(d.MozBoxShadow!==undefined)||(d.webkitBoxShadow!==undefined)||(d.oBoxShadow!==undefined)||(d.boxShadow!==undefined);b=(d.MozBorderRadius!==undefined)||(d.webkitBorderRadius!==undefined)||(d.oBorderRadius!==undefined)||(d.borderRadius!==undefined);g=e.className?e.className.split(" "):[];if(f){g.push("box-shadow")}if(b){g.push("border-rad")}g.push(c);g.push(a);if(SC.browser.mobileSafari){g.push("mobile-safari")}e.className=g.join(" ")};
/* @license
==========================================================================
Tiki 1.0 - CommonJS Runtime
copyright 2009-2010, Apple Inc., Sprout Systems Inc., and contributors.

Permission is hereby granted, free of charge, to any person obtaining a 
copy of this software and associated documentation files (the "Software"), 
to deal in the Software without restriction, including without limitation 
the rights to use, copy, modify, merge, publish, distribute, sublicense, 
and/or sell copies of the Software, and to permit persons to whom the 
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in 
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
DEALINGS IN THE SOFTWARE.

Tiki is part of the SproutCore project.

SproutCore and the SproutCore logo are trademarks of Sprout Systems, Inc.

For more information visit http://www.sproutcore.com/tiki

==========================================================================
@license */
"use modules false";"use loader false";if("undefined"===typeof tiki){var tiki=function(){var UNDEFINED="undefined",queue=[],factories={},modules={};function _record(method,args){queue.push({m:method,a:args})}var tiki={_modules:modules,_factories:factories,isBootstrap:true,queue:queue,register:function(packageId,opts){if((packageId==="tiki")&&(UNDEFINED!==typeof ENV)){if((ENV.app==="tiki")&&(ENV.mode==="test")){if(!opts.depends){opts.depends=[]}opts.depends.push("core_test")}}_record("register",arguments);return this},script:function(){_record("script",arguments);return this},stylesheet:function(){_record("stylesheet",arguments);return this},module:function(moduleId,factory){factories[moduleId]=factory;_record("module",arguments);return this},require:function(moduleId){var ret,factory,info,idx,packagePart,modulePart;if(moduleId.indexOf(":")<0){moduleId="tiki:"+moduleId}ret=modules[moduleId];if(!ret){ret={};info=modules[moduleId]={id:moduleId,exports:ret,boot:this};factory=factories[moduleId];if(typeof factory!=="function"){throw (moduleId+" is not function")}var tikiMod=factories["tiki:index"]?tiki.require("tiki:index"):null;factory.call(ret,tiki.require,ret,info,tikiMod);ret=info.exports}else{ret=ret.exports}return ret},destroy:function(){if(this.isDestroyed){return this}this.isDestroyed=true;modules=factories=queue=this.queue=null;return this}};tiki.require.loader=tiki;tiki.ENV=(typeof ENV!==UNDEFINED)?ENV:undefined;tiki.ARGV=(typeof ARGV!==UNDEFINED)?ARGV:undefined;return tiki}()}tiki.register("tiki",{scripts:[{url:"/static/tiki/en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js",id:"tiki:en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js"}]});tiki.module("tiki:index",function(require,exports,module,tiki){var T_ERROR="error",T_OBJECT="object",T_NULL="null",T_CLASS="class",T_HASH="hash",T_FUNCTION="function",T_UNDEFINED="undefined",T_NUMBER="number",T_BOOL="boolean",T_ARRAY="array",T_STRING="string",T_BOOLEAN="boolean",YES=true,NO=false,K=function(){};exports.T_ERROR=T_ERROR;exports.T_OBJECT=T_OBJECT;exports.T_NULL=T_NULL;exports.T_CLASS=T_CLASS;exports.T_HASH=T_HASH;exports.T_FUNCTION=T_FUNCTION;exports.T_UNDEFINED=T_UNDEFINED;exports.T_NUMBER=T_NUMBER;exports.T_BOOL=T_BOOL;exports.T_ARRAY=T_ARRAY;exports.T_STRING=T_STRING;exports.T_BOOLEAN=T_BOOLEAN;exports.YES=YES;exports.NO=NO;var TMP_ARY=[];var isArray=function(obj){if(obj&&obj.isArray){return true}if(!obj){return false}if(T_UNDEFINED!==typeof obj.length){if((typeof obj!==T_FUNCTION)&&(typeof obj!==T_STRING)&&(obj.constructor!==String)){return true}}return false};exports.isArray=isArray;Array.prototype.isArray=true;exports.$A=function A(obj){if((obj===null)||(obj===undefined)){return[]}if(obj.slice instanceof Function){if(typeof(obj)==="string"){return[obj]}else{return obj.slice()}}if(obj.toArray){return obj.toArray()}if(!isArray(obj)){return[obj]}var ret=[],len=obj.length;while(--len>=0){ret[len]=obj[len]}return ret};exports.typeOf=function typeOf(item){if(item===undefined){return T_UNDEFINED}if(item===null){return T_NULL}var ret=typeof(item);if(ret=="object"){if(isArray(item)){ret=T_ARRAY}else{if(item instanceof Function){ret=item.isClass?T_CLASS:T_FUNCTION}else{if((item instanceof Error)||item.isError){ret=T_ERROR}else{if(item.isObject){ret=T_OBJECT}else{if(item.isClass){ret=T_CLASS}else{if(item.constructor===Object){ret=T_HASH}else{if(item.constructor===Number){ret=T_NUMBER}else{if(item.constructor===String){ret=T_STRING}else{ret=T_OBJECT}}}}}}}}}else{if(ret===T_FUNCTION){ret=item.isClass?T_CLASS:T_FUNCTION}}return ret};var guidKey="_tk_guid_"+new Date().getTime();var _nextGUID=0,_numberGuids=[],_stringGuids=[];var generateGuid=function generateGuid(obj){var ret=("tk"+(_nextGUID++));if(obj){obj[guidKey]=ret}return ret};exports.generateGuid=generateGuid;exports.guidFor=function guidFor(obj){if(obj===undefined){return"(undefined)"}if(obj===null){return"(null)"}if(obj===Object){return"(Object)"}if(obj===Array){return"(Array)"}if(obj[guidKey]){return obj[guidKey]}switch(typeof obj){case T_NUMBER:return(_numberGuids[obj]=_numberGuids[obj]||("nu"+obj));case T_STRING:return(_stringGuids[obj]=_stringGuids[obj]||("st"+obj));case T_BOOL:return obj?"(true)":"(false)";default:return generateGuid(obj)}};function _mixin(t,items,skip){var len=items.length,target=t||{},idx,options,key,src,copy;for(idx=skip;idx<len;idx++){if(!(options=items[idx])){continue}for(key in options){if(!options.hasOwnProperty(key)){continue}src=target[key];copy=options[key];if(target===copy){continue}if(copy!==undefined){target[key]=copy}}}return target}exports.mixin=function(t){return _mixin(t,arguments,1)};var K_=function(){},Kproto_=K_.prototype;var beget=function(t){var ret;if(T_OBJECT!==typeof(t)){return t}K_.prototype=t;ret=new K_();K_.prototype=Kproto_;return _mixin(ret,arguments,1)};exports.beget=beget;var __init=function(args){var init;if(init=this.init){init.apply(this,args)}};function _const(){return function(){this.__init(arguments);return this}}exports.extend=function(F){var Ret=_const(),prot;if(T_FUNCTION===typeof F){prot=Ret.prototype=beget(F.prototype);if(!prot.__init){prot.__init=__init}_mixin(prot,arguments,1)}else{prot=Ret.prototype=_mixin({__init:__init},arguments,0)}prot.constructor=Ret;return Ret};var setupDisplayNames=function(obj,root){var a=TMP_ARY;a[0]=root;var k,v;for(k in obj){if(!obj.hasOwnProperty(k)){continue}v=obj[k];if("function"===typeof v){a[1]=k;v.displayName=a.join(".")}}a.length=0;return obj};exports.setupDisplayNames=setupDisplayNames;setupDisplayNames(exports,"tiki");exports.Retainable=require("retainable");exports.Invocation=require("invocation");exports.Promise=require("promise");var Invocation=require("invocation"),handlers={},ready,unload;function queueListener(src,status,queueName,target,method,args){var inv;if(src[status]){if(target&&target.isInvocation){target.invoke()}else{Invocation.invoke(target,method,args,2)}}else{if(target&&target.isInvocation){inv=target.retain()}else{inv=Invocation.create(target,method,args,2)}if(!src[queueName]){src[queueName]=[]}src[queueName].push(inv);src.schedule()}}function flushQueue(src,queueName){var q=src[queueName],len=q?q.length:0,idx,inv;for(idx=0;idx<len;idx++){inv=q[idx];inv.invoke();inv.release()}src[queueName]=null}ready=function(target,method,args){queueListener(ready,"isReady","queue",target,method,arguments)};exports.ready=ready;ready.main=function(target,method,args){queueListener(ready,"isReady","mqueue",target,method,arguments)};ready.isReady=false;ready.fire=function(){if(ready.isReady){return}ready.isReady=true;if(require.loader){require.loader.isReady=true}if(ready.cleanup){ready.cleanup()}ready.cleanup=null;flushQueue(ready,"queue");flushQueue(ready,"mqueue");var nextReady=require.loader?require.loader.nextReady:null;if(nextReady&&(nextReady!==ready)){nextReady.fire()}};ready.fire.displayName="ready.fire()";ready.schedule=K;if(T_UNDEFINED===typeof document){}else{if(document.addEventListener){ready.cleanup=function(){document.removeEventListener("DOMContentLoaded",ready.fire,false);document.removeEventListener("load",ready.fire,false)};document.addEventListener("DOMContentLoaded",ready.fire,false);document.addEventListener("load",ready.fire,false)}else{if(document.attachEvent){ready.cleanup=function(){document.detachEvent("onreadystatechange",ready.fire);document.detachEvent("onload",ready.fire);ready.ieHandler=null};document.attachEvent("onreadystatechange",ready.fire);document.attachEvent("onload",ready.fire);if(document.documentElement.doScroll&&window==window.top){ready.ieHandler=function(){if(ready.ieHandler&&!ready.isReady){try{document.documentElement.doScroll("left")}catch(error){setTimeout(ready.ieHandler,0);return}}ready.fire()};ready.ieHandler()}}}}if(require.loader&&require.loader.previousLoader){if(require.loader.previousLoader.isReady){ready.fire()}else{require.loader.previousLoader.nextReady=ready}require.loader.previousLoder=null}unload=function(target,method,args){queueListener(unload,"isUnloading","queue",target,method,arguments)};exports.unload=unload;unload.isUnloading=false;unload.fire=function(){if(unload.isUnloading){return}unload.isUnloading=true;if(unload.cleanup){unload.cleanup()}unload.cleanup=null;var q=unload.queue,len=q?q.length:0,idx,inv;for(idx=0;idx<len;idx++){inv=q[idx];inv.invoke();inv.release()}unload.queue=null};unload.schedule=function(){if(unload.isScheduled){return}unload.isScheduled=true;if(T_UNDEFINED===typeof document){}else{if(document.addEventListener){unload.cleanup=function(){document.removeEventListener("unload",unload.fire)};document.addEventListener("unload",unload.fire,false)}else{if(document.attachEvent){unload.cleanup=function(){document.detachEvent("onunload",unload.fire)};document.attachEvent("unload",unload.fire)}}}}});tiki.module("tiki:invocation",function(require,exports,module,tiki){var Retainable=require("retainable"),Invocation;var slice=Array.prototype.slice,pool=[];Invocation=tiki.extend(Retainable,{init:function(target,method,args,ignore){if(args&&(ignore!==undefined)){if(args.length>ignore){args=slice.call(args,ignore)}else{args=null}}this.recycled++;this.isDestroyed=false;this.inPool=false;this.target=target;this.method=method;this.args=args;return this},destroy:function(){this.isDestroyed=true;this.retainCount=1;this.inPool=true;this.target=this.method=this.args=null;pool.push(this);return this},invoke:function(){return Invocation.invoke(this.target,this.method,this.args,undefined,arguments)},isInvocation:true,recycled:0});Invocation.create=function(target,method,args,ignore){if(pool.length>0){return pool.pop().init(target,method,args,ignore)}else{return new Invocation(target,method,args,ignore)}};Invocation.invoke=function(target,method,args,ignore,extra){if(!method&&tiki.typeOf(target)===tiki.T_FUNCTION){method=target}if(tiki.typeOf(method)===tiki.T_STRING){method=target[method]}if(!method){throw ("Invocation: method "+this.method+" not defined")}if((ignore!==undefined)&&args){if(args.length>ignore){args=slice.call(args,ignore)}else{args=null}}if(extra&&extra.length>0){args=args?args.concat(extra):extra}return args?method.apply(target,args):method.call(target)};exports=module.exports=Invocation;exports.Invocation=Invocation});tiki.module("tiki:loader",function(require,exports,module,tiki){var Promise=require("promise"),Sandbox=require("sandbox");var Loader;var SCRIPTS="scripts",CATALOG="catalog",MODULES="modules",STYLESHEETS="stylesheets",LOADS="loads";var MODULE_WRAPPER=["(function(require, exports, module, tiki) {",null,"\n});\n//@ sourceURL=",null,"\n"];var TIKI_ARY=["tiki/",null];var STRING="string";var globals={};var PROMISE_NAME=[];function promiseName(type,key){PROMISE_NAME[0]=type;PROMISE_NAME[1]=key;return PROMISE_NAME.join("::")}var object_keys=Object.keys;if(!object_keys){object_keys=function(obj){var k,ret=[];for(k in obj){if(obj.hasOwnProperty(k)){ret.push(k)}}return ret}}var inTikiCache={};function inTiki(key){var ret=inTikiCache[key];if(ret){return ret}return(inTikiCache[key]="tiki/"+key)}var joinPackageCache={};function joinPackageId(packageId,moduleId){var moduleIds=joinPackageCache[packageId],ret;if(!moduleIds){moduleIds=joinPackageCache[packageId]={}}ret=moduleIds[moduleId];if(!ret){ret=moduleIds[moduleId]=(packageId+":"+moduleId)}return ret}Loader=function Loader(id,queue,env){this.id=id;this.scripts=[];this.packages=[];this.stylesheets=[];this.modules=[];this.ENV=env;this.sandbox=Sandbox.create(id,this);this.register("default",{});this.register("tiki",{});var len=queue?queue.length:0,idx,action;for(idx=0;idx<len;idx++){action=queue[idx];this[action.m].apply(this,action.a)}return this};Loader.prototype={scripts:null,stylesheets:null,packages:null,sandbox:null,modules:null,destroy:function(){},resolve:function resolve(moduleId,baseId,packageId){var path,len,idx,part,parts;if(moduleId.match(/(^\.\.?\/)|(\/\.\.?\/)|(\/\.\.?\/?$)/)){if((idx=moduleId.indexOf(":"))>=0){packageId=moduleId.slice(0,idx);moduleId=moduleId.slice(idx+1);path=[]}else{if(moduleId.match(/^\.\.?\//)){if(!baseId){throw ("base required to resolve relative: "+moduleId)}idx=baseId.indexOf(":");if(!packageId){packageId=baseId.slice(0,idx)}if(idx>=0){baseId=baseId.slice(idx+1)}path=baseId.split("/");path.pop()}else{path=[]}}parts=moduleId.split("/");len=parts.length;for(idx=0;idx<len;idx++){part=parts[idx];if(part===".."){if(path.length<1){throw"invalid path: "+moduleId}path.pop()}else{if(part!=="."){path.push(part)}}}moduleId=path.join("/");if(packageId){moduleId=joinPackageId(packageId,moduleId)}}return moduleId},canonical:function canonical(moduleId,baseId,packageId){var ret=this.resolve(moduleId,baseId,packageId),factories=this._factories,catalog=this._catalog,idx;if((idx=ret.indexOf(":"))<0){if(!packageId&&baseId&&(idx=baseId.indexOf(":"))){packageId=baseId.slice(0,idx)}if(packageId==="default"){packageId="tiki"}moduleId=joinPackageId(packageId,ret);if(!catalog||(factories&&factories[moduleId])){ret=moduleId}else{if(catalog[ret]){ret=joinPackageId(ret,"index")}else{if(catalog[inTiki(ret)]){ret=joinPackageId(inTiki(ret),"index")}else{ret=moduleId}}}}else{packageId=ret.slice(0,idx);if((packageId==="default")){ret=joinPackageId("tiki",ret.slice(idx+1))}else{if(catalog&&!catalog[packageId]&&catalog[inTiki(packageId)]){ret=inTiki(ret)}}}return ret},evaluate:function evaluate(moduleText,moduleId){var ret;MODULE_WRAPPER[1]=moduleText;MODULE_WRAPPER[3]=moduleId||"(unknown module)";ret=MODULE_WRAPPER.join("");ret=eval(ret);MODULE_WRAPPER[1]=MODULE_WRAPPER[3]=null;return ret},load:function load(moduleId,baseId){var factories=this._factories,factory,packagePart,idx,info,tmp;moduleId=this.canonical(moduleId,baseId);if(!this.ready(moduleId)){throw (moduleId+" is not ready")}factory=factories[moduleId];if(factory&&(STRING===typeof factory)){factory=this.evaluate(factory,moduleId);factories[moduleId]=factory}if(!factory.displayName){factory.displayName=moduleId}return factory},global:function(moduleId){var depends,info,len,idx,factories,exports,key,packageId,ARY,keys;moduleId=this.canonical(moduleId);if((idx=moduleId.indexOf(":"))<0){throw"package not found: "+moduleId}packageId=moduleId.slice(0,idx);ARY=moduleId.split(":");info=this._catalog[packageId];if(!info){throw (packageId+" is not registered")}depends=info.depends;len=depends?depends.length:0;if(len<=0){return this}factories=this._factories;if(!factories){return this}for(idx=0;idx<len;idx++){packageId=depends[idx];if(globals[packageId]){continue}globals[packageId]=true;if(!this.ready(packageId)){throw ("cannot make "+packageId+" global because it is not ready")}moduleId=this.canonical(packageId);if(!factories[moduleId]){continue}exports=this.require(moduleId);if(!exports){throw"require "+moduleId+" failed"}if(keys=exports.__globals__){len=keys.length;for(idx=0;idx<len;idx++){key=keys[idx];window[key]=exports[key]}}else{for(key in exports){if(!exports.hasOwnProperty(key)){continue}window[key]=exports[key]}}}},register:function(name,desc){if(name.indexOf(":")>0){return this.module(name,desc)}var catalog=this._catalog,key;if(!catalog){catalog=this._catalog={}}catalog[name]=desc;var info=desc?desc.packages:null;if(info){for(key in info){if(!info.hasOwnProperty(key)||catalog[key]){continue}catalog[key]=info[key]}}if(!this._resolved(CATALOG,name)){this.packages.push(name)}this._promiseFor(CATALOG,name).resolve(name)},script:function script(id){if(!this._resolved(SCRIPTS,id)){this.scripts.push(id)}this._promiseFor(SCRIPTS,id).resolve(id);return this},stylesheet:function stylesheet(id){if(!this._resolved(STYLESHEETS,id)){this.stylesheets.push(id)}this._promiseFor(STYLESHEETS,id).resolve(id);return this},module:function module(moduleId,factory){var factories=this._factories;if(!factories){factories=this._factories={}}factories[moduleId]=factory;if(!this._resolved(MODULES,moduleId)){this.modules.push(moduleId)}this._promiseFor(MODULES,moduleId).resolve(moduleId)},async:function(packageId){return this._async(packageId,null)},_async:function(packageId,seen){var ret=this._promiseFor(LOADS,packageId);if(ret.isPending){if(this.ready(packageId)){ret.resolve()}else{var loader=this;ret.action(function(pr){loader._promiseFor(CATALOG,packageId).then(pr,function(){loader._loadPackage(packageId,pr,seen||{});pr.resolve()},function(reason){pr.cancel(reason)});loader._loadPackage(packageId,pr,seen||{})}).run()}}return ret},require:function require(moduleId,packageId){return this.sandbox.require(moduleId,packageId)},ready:function ready(moduleId){return this._ready(moduleId,null)},_ready:function(moduleId,seen){if(seen){if(seen[moduleId]){return true}else{seen[moduleId]=true}}var idx,packageId,info,items,loc,scriptId,styleId,item;idx=moduleId.indexOf(":");if(idx>=0){packageId=moduleId.slice(0,idx)}else{packageId=moduleId}if(!this._resolved(CATALOG,packageId)){return false}info=this._catalog[packageId];items=info.depends;loc=items?items.length:0;while(--loc>=0){if(!seen){seen={}}item=items[loc];if(!this._ready(item,seen)){return false}}items=info.stylesheets;loc=items?items.length:0;while(--loc>=0){styleId=items[loc];if(STRING!==typeof styleId){styleId=styleId.id}if(!this._resolved(STYLESHEETS,styleId)){return false}}items=info.scripts;loc=items?items.length:0;while(--loc>=0){scriptId=items[loc];if(STRING!==typeof scriptId){scriptId=scriptId.id}if(!this._resolved(SCRIPTS,scriptId)){return false}}if(moduleId!==packageId){if(!this._resolved(MODULES,moduleId)){return false}}return true},main:function(moduleId,method){var r=this.require("index","tiki").ready;if(!r){throw ("cannot register main because system.ready does not exist")}r.main(this,function(){this.async(moduleId).then(this,function(){this.require(moduleId)[method]()})});return this},_loadScript:function(scriptId){var id,url,pr;if(STRING!==typeof(scriptId)){id=scriptId.id;url=scriptId.url}else{id=url=scriptId}pr=this._promiseFor(SCRIPTS,id);if(pr.isPending){var loader=this;pr.action(function(pr){var body=document.body,el;if(!body){promise.cancel("no document to append script")}el=document.createElement("script");el.setAttribute("src",url);body.appendChild(el);body=el=null})}return pr},_loadStylesheet:function(styleId){var id,url,pr;if(STRING!==typeof(styleId)){id=styleId.id;url=styleId.url}else{id=url=styleId}pr=this._promiseFor(STYLESHEETS,id);if(pr.isPending){var loader=this;pr.action(function(pr){var body=document.body,el;if(!body){pr.cancel("no document to append stylesheet")}el=document.createElement("link");el.setAttribute("rel","stylesheet");el.setAttribute("href",url);body.appendChild(el);body=el=null;loader.stylesheet(id)})}return pr},_loadPackage:function(packageId,pr,seen){if(seen){if(seen[packageId]){if(console&&console.warn){console.warn("detected cyclical reference to "+packageId+" seen="+object_keys(seen).join(", "))}return}else{seen[packageId]=true}}var info=this._catalog?this._catalog[packageId]:null,items,loc,item,ordered,next,prDepends;if(!info){return this}items=info.depends;loc=items?items.length:0;prDepends=Promise.create(promiseName("load-package",packageId));while(--loc>=0){item=items[loc];if(item!=="tiki"){prDepends.depends(this._async(item,seen))}}item=null;pr.depends(prDepends);prDepends.resolve();items=info.scripts;loc=items?items.length:0;next=null;ordered=info.ordered!==false;while(--loc>=0){item=this._loadScript(items[loc]);pr.depends(item);if(ordered){if(next){item.then(next,next.run,next.cancel)}}else{item.run()}next=item}if(next&&ordered){prDepends.then(next,next.run,next.cancel)}items=info.stylesheets;loc=items?items.length:0;next=null;while(--loc>=0){item=this._loadStylesheet(items[loc]);pr.depends(item);if(next){item.then(next,next.run,next.cancel)}next=item}if(next){prDepends.then(next,next.run,next.cancel)}},_promiseFor:function(promiseType,name1,name2){var promises=this._promises,sub1,sub2,ret,Q;if(!promises){promises=this._promises={}}sub1=promises[promiseType];if(!sub1){sub1=promises[promiseType]={}}if(name2===undefined){sub2=sub1;name2=name1}else{sub2=sub1[name1];if(!sub2){sub2=sub1[name1]={}}}ret=sub2[name2];if(!ret){ret=sub2[name2]=Promise.create(promiseName(promiseType,name1))}return ret},_discoveredStylesheets:false,discoverStylesheets:function(){this._discoveredStylesheets=true;if("undefined"===typeof document){return this}var links=document.getElementsByTagName("link"),loc=links?links.length:0,link,attr;while(--loc>=0){link=links[loc];if(!link||(link.rel!=="stylesheet")){continue}attr=link.getAttribute("loadid")||link.getAttribute("LOADID");if(attr){this.stylesheet(attr.toString())}attr=link.href;if(attr){this.stylesheet(attr.toString())}}link=link=loc=null;return this},_resolved:function(promiseType,name1,name2){if((promiseType===STYLESHEETS)&&!this._discoveredStylesheets){this.discoverStylesheets()}var ret=this._promises;if(ret){ret=ret[promiseType]}if(ret){ret=ret[name1]}if(ret&&name2){ret=ret[name2]}return ret?ret.isResolved:false},_inspectLoader:function(){var lines=[],modules=this.modules,key,names,len,idx,emitted=false;lines.push("Loader<id="+this.id+">:");if(this.packages.length>0){lines.push("  packages: "+this.packages.join(","));lines.push("")}if(this.scripts.length>0){lines.push("  scripts:");len=this.scripts.length;for(idx=0;idx<len;idx++){lines.push("    "+this.scripts[idx])}lines.push("")}if(this.stylesheets.length>0){lines.push("  stylesheets:");len=this.scripts.length;for(idx=0;idx<len;idx++){lines.push("    "+this.scripts[idx])}lines.push("")}if(this.modules.length>0){lines.push("  modules: ");len=this.modules.length;for(idx=0;idx<len;idx++){lines.push("    "+this.modules[idx])}lines.push("")}return lines.join("\n")},_inspectModule:function(moduleId){var lines=[],packageId=moduleId.slice(0,moduleId.indexOf(":")),tmp;if(this._catalog&&!this._catalog[packageId]){tmp="tiki/"+packageId;if(this._catalog[tmp]){packageId=tmp;moduleId="tiki/"+moduleId}}lines.push(moduleId+" ("+(this.ready(moduleId)?"READY":"NOT READY")+"):");lines.push(this._inspectPackage(packageId));return lines.join("\n")},_inspectPackage:function(packageId){if(this._catalog&&!this._catalog[packageId]){var tmp="tiki/"+packageId;if(this._catalog[tmp]){packageId=tmp}}var lines=[],info=this._catalog?this._catalog[packageId]:null,idx,len,item,parts;lines.push(packageId+" ("+(this.ready(packageId)?"READY":"NOT READY")+"): "+(info?"":"Not in Catalog!"));if(!info){return lines.join("\n")}len=info.depends?info.depends.length:0;if(len>0){parts=[];for(idx=0;idx<len;idx++){item=info.depends[idx];parts.push(item+" ("+(this.ready(item)?"READY":"NOT READY")+")")}lines.push("  depends: "+parts.join(", "))}len=info.scripts?info.scripts.length:0;if(len>0){lines.push("\n  scripts:");for(idx=0;idx<len;idx++){item=info.scripts[idx];if(STRING!==typeof item){item=item.id}lines.push("    "+item+" ("+(this._resolved(SCRIPTS,item)?"READY":"NOT READY")+")")}}len=info.stylesheets?info.stylesheets.length:0;if(len>0){lines.push("\n  stylesheets:");for(idx=0;idx<len;idx++){item=info.stylesheets[idx];if(STRING!==typeof item){item=item.id}lines.push("    "+item+"("+(this._resolved(STYLESHEETS,item)?"READY":"NOT READY")+")")}}return lines.join("\n")},inspect:function(id){if(arguments.length===0){return this._inspectLoader()}else{if(id.indexOf(":")<0){return this._inspectPackage(id)}else{return this._inspectModule(id)}}},toString:function(){return"Loader<id="+this.id+">"}};tiki.setupDisplayNames(Loader.prototype,"Loader");Loader.setup=function setup(curLoader,env){if(curLoader&&!curLoader.isBootstrap){return curLoader}var queue=curLoader?curLoader.queue:null,id=curLoader?curLoader.id:"default",ret=new Loader(id,queue,env);ret.previousLoader=curLoader;if(curLoader&&curLoader.destroy){curLoader.destroy()}return ret};exports=module.exports=Loader;exports.Loader=Loader;exports.setup=Loader.setup});tiki.module("tiki:promise",function(require,exports,module,tiki){var Retainable=require("retainable"),Invocation=require("invocation"),Promise;var READY=4096,PENDING=4097,BLOCKED=12288,BLOCKED_PENDING=12289,BLOCKED_RESOLVED=12290,RESOLVED=16386,CANCELLED=16388,ACTION_PENDING=256,NO_ACTION=257,HAS_ACTION=258,ACTION_RUNNING=512,ACTION_COMPLETE=768,RESOLVE_METHOD="__resolved",CANCEL_METHOD="__cancel",PROGRESS_METHOD="__progress";var pool=[];var state_map={4097:"PENDING",12289:"BLOCKED_PENDING",12290:"BLOCKED_RESOLVED",16386:"RESOLVED",16388:"CANCELLED"};function logPromise(promise,state,otherPromise){var str=tiki.guidFor(promise)+":"+promise.id+"."+state+"() dep="+promise.holds+" status="+state_map[promise._status]+" handlers="+(promise._handlers?promise._handlers.length:"null");if(otherPromise){str+=" pr="+otherPromise.toString()}if(console&&console.log){console.log(str)}}Promise=tiki.extend(Retainable,{init:function(id){this.inPool=false;this.id=id;this._status=PENDING;this._actionStatus=NO_ACTION;this.holds=0;this.retain();return this},destroy:function(){this.isDestroyed=false;this.retainCount=1;this.inPool=true;this.target=this.method=this._actions=null;pool.push(this);return this},value:null,isPending:true,isResolved:false,isCancelled:false,hasAction:false,_status:PENDING,_actionStatus:NO_ACTION,resolve:function(val){if(Promise.LOG_PROMISES){logPromise(this,"resolve")}switch(this._status){case PENDING:this.value=val;this._makeResolved();break;case BLOCKED_PENDING:this.value=val;this._status=BLOCKED_RESOLVED;break}return this},_makeResolved:function(){this.isPending=false;this.isResolved=true;this._status=RESOLVED;this._didResolve();this._invoke(RESOLVE_METHOD,this.value,true);this.release()},cancel:function(reason){if(Promise.LOG_PROMISES){logPromise(this,"cancel")}switch(this._status){case PENDING:case BLOCKED_PENDING:this.value=reason;this._makeCancelled()}return this},_makeCancelled:function(){this._status=CANCELLED;this.isPending=false;this.isCancelled=true;this._didCancel();this._invoke(CANCEL_METHOD,this.value,true);this.release()},update:function(reason){if(Promise.LOG_PROMISES){logPromise(this,"update")}switch(this._status){case PENDING:case BLOCKED_PENDING:this._invoke(PROGRESS_METHOD,reason,false);break}return this},then:function(target,resolveMethod,cancelMethod,progressMethod){var targetType=typeof target,val=this.values,ret;if(arguments.length<4&&(("function"===targetType)||("string"===targetType))){progressMethod=cancelMethod;cancelMethod=resolveMethod;resolveMethod=target;target=this}ret=Promise.create();switch(this._status){case RESOLVED:if(resolveMethod){val=resolveMethod.call(target,this.value,this)}ret.resolve(val);break;case CANCELLED:if(cancelMethod){val=cancelMethod.call(target,this.value,this)}ret.cancel(val);break;default:ret[RESOLVE_METHOD]=resolveMethod;ret[CANCEL_METHOD]=cancelMethod;ret[PROGRESS_METHOD]=progressMethod;ret.__target=target;if(!this._handlers){this._handlers=[]}this._handlers.push(ret)}return ret},_invoke:function(methodName,value,flush){var handlers=this._handlers,len=handlers?handlers.length:0,idx,pr,method,res;if(len<=0){return this}for(idx=0;idx<len;idx++){pr=handlers[idx];method=pr[methodName];res=method?method.call(pr.__target,value,this):null;if(flush){if(methodName===CANCEL_METHOD){pr.cancel(res)}else{pr.resolve(res)}pr.__resolve=pr.__cancel=pr.__progress=pr.__target=null}}if(flush){this._handlers=null}},depends:function(pr){if(Promise.LOG_PROMISES){logPromise(this,"depends",pr)}switch(this._status){case PENDING:this._status=BLOCKED_PENDING;this.holds=1;if(!this._depends){this._depends={}}this._depends[tiki.guidFor(pr)]=pr;pr.then(this,this._resolveHold,this._cancelHold);break;case BLOCKED_PENDING:case BLOCKED_RESOLVED:this.holds++;this._depends[tiki.guidFor(pr)]=pr;pr.then(this,this._resolveHold,this._cancelHold);break}return this},_resolveHold:function(value,pr){if(Promise.LOG_PROMISES){logPromise(this,"resolveHold",pr)}if(this._depends){delete this._depends[tiki.guidFor(pr)]}switch(this._status){case BLOCKED_PENDING:if(this.holds<=1){this._status=PENDING;this.holds=null}else{this.holds--}break;case BLOCKED_RESOLVED:if(this.holds<=1){this.holds=null;this._makeResolved()}else{this.holds--}break}},_cancelHold:function(value,pr){if(Promise.LOG_PROMISES){logPromise(this,"cancelHold",pr)}if(this._depends){delete this._depends[tiki.guidFor(pr)]}if(this._status&BLOCKED){this.holds=null;this.value=new Error("hold cancelled");this._makeCancelled()}},action:function(target,method){if(this._actionStatus===NO_ACTION){if(arguments.length===1){method=target;target=this}this.hasAction=true;this.actionTarget=target;this.actionMethod=method;this._actionStatus=HAS_ACTION}return this},run:function(){if(this._actionStatus===HAS_ACTION){this._actionStatus=ACTION_RUNNING;this.actionMethod.call(this.actionTarget,this);this._actionStatus=ACTION_COMPLETE}return this},_didResolve:function(){this._actionStatus=ACTION_COMPLETE},_didCancel:function(){this._actionStatus=ACTION_COMPLETE},toString:function(){return"Promise<guid="+tiki.guidFor(this)+" id="+this.id+" status="+state_map[this._status]+">"}});Promise.create=function(id){if(pool.length>0){return pool.pop().init(id)}else{return new Promise(id)}};Promise.create.displayName="Promise.create";Promise.LOG_PROMISES=false;tiki.setupDisplayNames(Promise.prototype,"Promise");exports=module.exports=Promise;exports.Promise=Promise});tiki.module("tiki:retainable",function(require,exports,module,tiki){var Retainable={retainCount:1,isDestroyed:false,retain:function(){this.retainCount++;return this},release:function(){if(--this.retainCount<=0){this.__destroy()}return this},__destroy:function(){if(!this.isDestroyed){this.isDestroyed=true;if(this.destroy){this.destroy()}}}};exports=module.exports=Retainable;exports.Retainable=Retainable});tiki.module("tiki:sandbox",function(require,exports,module,tiki){var Sandbox;Sandbox=function Sandbox(id,loader){var allModules={},usedModules={},modules=[],HASH={},sandbox=this;this.id=id;this.modules=modules;this.loader=loader;function _clear(){var loc=arguments.length,moduleId;if(loc>0){while(--loc>=0){moduleId=arguments[loc];if(moduleId&&allModules[moduleId]){delete allModules[moduleId];delete usedModules[moduleId];modules.splice(modules.indexOf(moduleId),1)}}}else{allModules={};usedModules={};modules.length=0}}_clear.displayName="Sandbox.clear";this.clear=_clear;function _require(moduleId,packageId,curModuleId){var req,exports,moduleInfo,factory,idx,exp,func,tiki;if(packageId){idx=moduleId.indexOf(":");if(idx>=0){moduleId=moduleId.slice(0,idx)}moduleId=packageId+":"+moduleId}moduleId=loader.canonical(moduleId,curModuleId);if(exp=allModules[moduleId]){exp=exp.exports;if(!usedModules[moduleId]){usedModules[moduleId]=exp}return exp||{}}modules.push(moduleId);exports={};allModules[moduleId]=moduleInfo={id:moduleId,exports:exports};req=function(m,p){return _require(m,p,moduleId)};req.displayName="Sandbox.require";req.loader=loader;req.clear=_clear;req.sandbox=this;func=loader.load(moduleId);tiki=_require("tiki:index");if(!func){throw"could not load function for "+moduleId}func.call(exports,req,exports,moduleInfo,tiki);exports=moduleInfo.exports;exp=usedModules[moduleId];if(exp&&exp!==exports){throw"circular require in "+moduleId}usedModules[moduleId]=exports;return exports}this.require=function(moduleId,packageId){return _require(moduleId,packageId)};this.require.displayName="Sandbox.require"};Sandbox.create=function(id,loader){return new Sandbox(id,loader)};Sandbox.create.displayName="Sandbox.create";Sandbox.prototype={};exports=module.exports=Sandbox;exports.Sandbox=Sandbox});tiki.module("tiki:system",function(require,exports,module,tiki){if(require.loader){exports.env=require.loader.ENV;exports.args=require.loader.ARGV}var print=function(msg){if(tiki.console&&tiki.console.log){tiki.console.log(msg)}};exports.print=print;var K=function(){return null};exports.stdin={read:K,readLine:K};exports.stdout=exports.stderr={write:print,writeLine:print,print:print};exports.platform="tiki";exports.global=window;tiki.unload(function(){exports.global={}})});tiki.module("tiki:timer",function(require,exports,module,tiki){var Invocation=require("invocation");var timeouts={};var intervals={};function cleanUpTimeout(inv){if(!inv){return}delete timeouts[inv.timerKey];delete inv.timerKey;inv.release()}function createCallback(inv,cleanUp){return function(){inv.invoke();if(cleanUp){cleanUpTimeout(inv)}}}exports.setTimeout=function(callback,delay,target,params){var ret,inv;if(arguments.length>2){inv=Invocation.create(target,callback,arguments,3);callback=createCallback(inv,true)}ret=setTimeout(callback,delay);if(inv){inv.timerKey=ret;timeouts[ret]=inv}return ret};exports.clearTimeout=function(timerKey){cleanUpTimeout(timeouts[timerKey]);clearTimeout(timerKey)};exports.setInterval=function(callback,delay,target,params){var ret,inv;if(arguments.length>2){inv=Invocation.create(target,callback,arguments,3);callback=createCallback(inv,false)}ret=setInterval(callback,delay);if(inv){intervals[ret]=inv}return ret};exports.clearInterval=function(timerKey){var inv=intervals[timerKey];if(inv){inv.release();delete intervals[timerKey]}clearInterval(timerKey)}});"use modules false";"use loader false";tiki=tiki.require("tiki:loader").setup(tiki,("undefined"===typeof ENV?null:ENV),("undefined"===typeof ARGV?null:ARGV));tiki.script("tiki:en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js");tiki.stylesheet("sproutcore/desktop:en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/stylesheet.css");tiki.stylesheet("sproutcore/foundation:en/a04970954a917ede9918ca06897bc0e1406986d5/stylesheet.css");tiki.register("sproutcore/runtime",{packages:{tiki:{scripts:[{url:"/static/tiki/en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js",id:"tiki:en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js"}]}},depends:["tiki"],scripts:[{url:"/static/sproutcore/runtime/en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js",id:"sproutcore/runtime:en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js"}]});tiki.module("sproutcore/runtime:core",function(require,exports,module,tiki){var system=require("system","default");var SC,SproutCore,YES,NO;YES=true;NO=false;var UNDEFINED="undefined";if(system.platform==="tiki"){if(UNDEFINED===typeof console){console=system.console}if(UNDEFINED===typeof sc_require){sc_require=function(){}}if(UNDEFINED===typeof sc_resource){sc_resource=function(){}}}if(window.SC==undefined){SC=SproutCore={}}else{SC=window.SC}SC.global=function(key,value){system.global[key]=value;return SC};SC.global.remove=function(key){delete system.global[key];return SC};SC.global("SC",SC);SC.mixin=function(){var target=arguments[0]||{},idx=1,length=arguments.length,options,copy,key;if(length===1){target=this||{};idx=0}for(;idx<length;idx++){if(!(options=arguments[idx])){continue}for(key in options){if(!options.hasOwnProperty(key)){continue}copy=options[key];if(target===copy){continue}if(copy!==undefined){target[key]=copy}}}return target};SC.supplement=function(){var target=arguments[0]||{};var idx=1;var length=arguments.length;var options;if(length===1){target=this||{};idx=0}for(;idx<length;idx++){if(!(options=arguments[idx])){continue}for(var key in options){if(!options.hasOwnProperty(key)){continue}var src=target[key];var copy=options[key];if(target===copy){continue}if(copy!==undefined&&src===undefined){target[key]=copy}}}return target};SC.extend=SC.mixin;SC.mixin({T_ERROR:"error",T_OBJECT:"object",T_NULL:"null",T_CLASS:"class",T_HASH:"hash",T_FUNCTION:"function",T_UNDEFINED:"undefined",T_NUMBER:"number",T_BOOL:"boolean",T_ARRAY:"array",T_STRING:"string",typeOf:function(item){if(item===undefined){return SC.T_UNDEFINED}if(item===null){return SC.T_NULL}var ret=typeof(item);if(ret=="object"){if(item instanceof Array){ret=SC.T_ARRAY}else{if(item instanceof Function){ret=item.isClass?SC.T_CLASS:SC.T_FUNCTION}else{if(SC.Error&&(item instanceof SC.Error)){ret=SC.T_ERROR}else{if(item.isObject===true){ret=SC.T_OBJECT}else{ret=SC.T_HASH}}}}}else{if(ret===SC.T_FUNCTION){ret=(item.isClass)?SC.T_CLASS:SC.T_FUNCTION}}return ret},none:function(obj){return obj===null||obj===undefined},empty:function(obj){return obj===null||obj===undefined||obj===""},isArray:function(obj){if(obj&&obj.objectAt){return YES}var len=(obj?obj.length:null),type=SC.typeOf(obj);return !(SC.none(len)||(type===SC.T_FUNCTION)||(type===SC.T_STRING)||obj.setInterval)},makeArray:function(obj){return SC.isArray(obj)?obj:SC.A(obj)},A:function(obj){if(SC.none(obj)){return[]}if(obj.slice instanceof Function){if(typeof(obj)==="string"){return[obj]}else{return obj.slice()}}if(obj.toArray){return obj.toArray()}if(!SC.isArray(obj)){return[obj]}var ret=[],len=obj.length;while(--len>=0){ret[len]=obj[len]}return ret},guidKey:"_sc_guid_"+new Date().getTime(),_nextGUID:0,_numberGuids:[],_stringGuids:{},_keyCache:{},guidFor:function(obj){if(obj===undefined){return"(undefined)"}if(obj===null){return"(null)"}if(obj===Object){return"(Object)"}if(obj===Array){return"(Array)"}var guidKey=this.guidKey;if(obj[guidKey]){return obj[guidKey]}switch(typeof obj){case SC.T_NUMBER:return(this._numberGuids[obj]=this._numberGuids[obj]||("nu"+obj));case SC.T_STRING:return(this._stringGuids[obj]=this._stringGuids[obj]||("st"+obj));case SC.T_BOOL:return(obj)?"(true)":"(false)";default:return SC.generateGuid(obj)}},keyFor:function(prefix,key){var ret,pcache=this._keyCache[prefix];if(!pcache){pcache=this._keyCache[prefix]={}}ret=pcache[key];if(!ret){ret=pcache[key]=prefix+"_"+key}return ret},generateGuid:function(obj){var ret=("sc"+(this._nextGUID++));if(obj){obj[this.guidKey]=ret}return ret},hashFor:function(obj){return(obj&&obj.hash&&(typeof obj.hash===SC.T_FUNCTION))?obj.hash():this.guidFor(obj)},isEqual:function(a,b){if(a===null){return b===null}else{if(a===undefined){return b===undefined}else{return this.hashFor(a)===this.hashFor(b)}}},compare:function(v,w){if(v===w){return 0}var type1=SC.typeOf(v);var type2=SC.typeOf(w);var mapping=SC.ORDER_DEFINITION_MAPPING;if(!mapping){var order=SC.ORDER_DEFINITION;mapping=SC.ORDER_DEFINITION_MAPPING={};var idx,len;for(idx=0,len=order.length;idx<len;++idx){mapping[order[idx]]=idx}delete SC.ORDER_DEFINITION}var type1Index=mapping[type1];var type2Index=mapping[type2];if(type1Index<type2Index){return -1}if(type1Index>type2Index){return 1}switch(type1){case SC.T_BOOL:case SC.T_NUMBER:if(v<w){return -1}if(v>w){return 1}return 0;case SC.T_STRING:var comp=v.localeCompare(w);if(comp<0){return -1}if(comp>0){return 1}return 0;case SC.T_ARRAY:var vLen=v.length;var wLen=w.length;var l=Math.min(vLen,wLen);var r=0;var i=0;var thisFunc=arguments.callee;while(r===0&&i<l){r=thisFunc(v[i],w[i]);i++}if(r!==0){return r}if(vLen<wLen){return -1}if(vLen>wLen){return 1}return 0;case SC.T_OBJECT:if(v.constructor.isComparable===YES){return v.constructor.compare(v,w)}return 0;default:return 0}},K:function(){return this},EMPTY_ARRAY:[],EMPTY_HASH:{},EMPTY_RANGE:{start:0,length:0},beget:function(obj){if(SC.none(obj)){return null}var K=SC.K;K.prototype=obj;var ret=new K();K.prototype=null;if(SC.typeOf(obj.didBeget)===SC.T_FUNCTION){ret=obj.didBeget(ret)}return ret},copy:function(object){var ret=object;if(object&&object.isCopyable){return object.copy()}switch(SC.typeOf(object)){case SC.T_ARRAY:if(object.clone&&SC.typeOf(object.clone)===SC.T_FUNCTION){ret=object.clone()}else{ret=object.slice()}break;case SC.T_HASH:case SC.T_OBJECT:if(object.clone&&SC.typeOf(object.clone)===SC.T_FUNCTION){ret=object.clone()}else{ret={};for(var key in object){ret[key]=object[key]}}}return ret},merge:function(){var ret={},len=arguments.length,idx;for(idx=0;idx<len;idx++){SC.mixin(ret,arguments[idx])}return ret},keys:function(obj){var ret=[];for(var key in obj){ret.push(key)}return ret},inspect:function(obj){var v,ret=[];for(var key in obj){v=obj[key];if(v==="toString"){continue}if(SC.typeOf(v)===SC.T_FUNCTION){v="function() { ... }"}ret.push(key+": "+v)}return"{"+ret.join(" , ")+"}"},tupleForPropertyPath:function(path,root){if(SC.typeOf(path)===SC.T_ARRAY){return path}var key;var stopAt=path.indexOf("*");if(stopAt<0){stopAt=path.lastIndexOf(".")}key=(stopAt>=0)?path.slice(stopAt+1):path;var obj=this.objectForPropertyPath(path,root,stopAt);return(obj&&key)?[obj,key]:null},objectForPropertyPath:function(path,root,stopAt){var loc,nextDotAt,key,max;if(!root){root=system.global}if(SC.typeOf(path)===SC.T_STRING){if(stopAt===undefined){stopAt=path.length}loc=0;while((root)&&(loc<stopAt)){nextDotAt=path.indexOf(".",loc);if((nextDotAt<0)||(nextDotAt>stopAt)){nextDotAt=stopAt}key=path.slice(loc,nextDotAt);root=root.get?root.get(key):root[key];loc=nextDotAt+1}if(loc<stopAt){root=undefined}}else{loc=0;max=path.length;key=null;while((loc<max)&&root){key=path[loc++];if(key){root=(root.get)?root.get(key):root[key]}}if(loc<max){root=undefined}}return root},STRINGS:{},stringsFor:function(lang,strings){SC.mixin(SC.STRINGS,strings);return this}});SC.clone=SC.copy;SC.$A=SC.A;SC.didLoad=SC.K;SC.ORDER_DEFINITION=[SC.T_ERROR,SC.T_UNDEFINED,SC.T_NULL,SC.T_BOOL,SC.T_NUMBER,SC.T_STRING,SC.T_ARRAY,SC.T_HASH,SC.T_OBJECT,SC.T_FUNCTION,SC.T_CLASS];SC.mixin(Function.prototype,{property:function(){this.dependentKeys=SC.$A(arguments);var guid=SC.guidFor(this);this.cacheKey="__cache__"+guid;this.lastSetValueKey="__lastValue__"+guid;this.isProperty=YES;return this},cacheable:function(aFlag){this.isProperty=YES;if(!this.dependentKeys){this.dependentKeys=[]}this.isCacheable=(aFlag===undefined)?YES:aFlag;return this},idempotent:function(aFlag){this.isProperty=YES;if(!this.dependentKeys){this.dependentKeys=[]}this.isVolatile=(aFlag===undefined)?YES:aFlag;return this},observes:function(propertyPaths){var loc=arguments.length,local=null,paths=null;while(--loc>=0){var path=arguments[loc];if((path.indexOf(".")<0)&&(path.indexOf("*")<0)){if(!local){local=this.localPropertyPaths=[]}local.push(path)}else{if(!paths){paths=this.propertyPaths=[]}paths.push(path)}}return this}});String.prototype.fmt=function(){var args=arguments,idx=0;return this.replace(/%@([0-9]+)?/g,function(s,argIndex){argIndex=(argIndex)?parseInt(argIndex,0)-1:idx++;s=args[argIndex];return((s===null)?"(null)":(s===undefined)?"":s).toString()})};String.prototype.loc=function(){var str=SC.STRINGS[this]||this;return str.fmt.apply(str,arguments)};String.prototype.w=function(){var ary=[],ary2=this.split(" "),len=ary2.length,str,idx=0;for(idx=0;idx<len;++idx){str=ary2[idx];if(str.length!==0){ary.push(str)}}return ary};module.exports=SC;SC.SC=SC;SC.SproutCore=SproutCore;SC.YES=YES;SC.NO=NO});
/* @license
==========================================================================
SproutCore Costello -- Property Observing Library
Copyright ©2006-2009, Sprout Systems, Inc. and contributors.
Portions copyright ©2008-2009 Apple Inc. All rights reserved.

Permission is hereby granted, free of charge, to any person obtaining a 
copy of this software and associated documentation files (the "Software"), 
to deal in the Software without restriction, including without limitation 
the rights to use, copy, modify, merge, publish, distribute, sublicense, 
and/or sell copies of the Software, and to permit persons to whom the 
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in 
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN false EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
DEALINGS IN THE SOFTWARE.

For more information about SproutCore, visit http://www.sproutcore.com

==========================================================================
@license */
"use modules false";tiki.module("sproutcore/runtime:index",function(require,exports,module,tiki){"use exports SC SproutCore YES NO";exports=module.exports=require("core");require("mixins/array");require("mixins/comparable");require("mixins/copyable");require("mixins/delegate_support");require("mixins/enumerable");require("mixins/freezable");require("mixins/observable");require("system/binding");require("system/cookie");require("system/enumerator");require("system/error");require("system/index_set");require("system/logger");require("system/object");require("system/range_observer");require("system/run_loop");require("system/selection_set");require("system/set");require("system/sparse_array");exports.__globals__=["SC","SproutCore","YES","NO"]});tiki.module("sproutcore/runtime:mixins/array",function(require,exports,module,tiki){var SC=require("core");require("mixins/observable");require("mixins/enumerable");require("system/range_observer");SC.OUT_OF_RANGE_EXCEPTION="Index out of range";SC.Array={isSCArray:true,replace:function(idx,amt,objects){throw"replace() must be implemented to support SC.Array"},objectAt:function(idx){if(idx<0){return undefined}if(idx>=this.get("length")){return undefined}return this.get(idx)},"[]":function(key,value){if(value!==undefined){this.replace(0,this.get("length"),value)}return this}.property(),insertAt:function(idx,object){if(idx>this.get("length")){throw SC.OUT_OF_RANGE_EXCEPTION}this.replace(idx,0,[object]);return this},removeAt:function(start,length){var delta=0,empty=[];if(typeof start===SC.T_NUMBER){if((start<0)||(start>=this.get("length"))){throw SC.OUT_OF_RANGE_EXCEPTION}if(length===undefined){this.replace(start,1,empty);return this}else{start=SC.IndexSet.create(start,length)}}this.beginPropertyChanges();start.forEachRange(function(start,length){start-=delta;delta+=length;this.replace(start,length,empty)},this);this.endPropertyChanges();return this},removeObject:function(obj){var loc=this.get("length")||0;while(--loc>=0){var curObject=this.objectAt(loc);if(curObject==obj){this.removeAt(loc)}}return this},removeObjects:function(objects){this.beginPropertyChanges();objects.forEach(function(obj){this.removeObject(obj)},this);this.endPropertyChanges();return this},pushObject:function(obj){this.insertAt(this.get("length"),obj);return obj},pushObjects:function(objects){this.beginPropertyChanges();objects.forEach(function(obj){this.pushObject(obj)},this);this.endPropertyChanges();return this},popObject:function(){var len=this.get("length");if(len===0){return undefined}var ret=this.objectAt(len-1);this.removeAt(len-1);return ret},shiftObject:function(){if(this.get("length")===0){return undefined}var ret=this.objectAt(0);this.removeAt(0);return ret},unshiftObject:function(obj){this.insertAt(0,obj);return obj},unshiftObjects:function(objects){this.beginPropertyChanges();objects.forEach(function(obj){this.unshiftObject(obj)},this);this.endPropertyChanges();return this},isEqual:function(ary){if(!ary){return false}if(ary==this){return true}var loc=ary.get("length");if(loc!=this.get("length")){return false}while(--loc>=0){if(!SC.isEqual(ary.objectAt(loc),this.objectAt(loc))){return false}}return true},compact:function(){return this.without(null)},without:function(value){if(this.indexOf(value)<0){return this}var ret=[];this.forEach(function(k){if(k!==value){ret[ret.length]=k}});return ret},uniq:function(){var ret=[];this.forEach(function(k){if(ret.indexOf(k)<0){ret[ret.length]=k}});return ret},rangeObserverClass:SC.RangeObserver,addRangeObserver:function(indexes,target,method,context){var rangeob=this._array_rangeObservers;if(!rangeob){rangeob=this._array_rangeObservers=SC.CoreSet.create()}if(this._array_oldLength===undefined){this._array_oldLength=this.get("length")}var C=this.rangeObserverClass;var isDeep=false;var ret=C.create(this,indexes,target,method,context,isDeep);rangeob.add(ret);if(!this._array_isNotifyingRangeObservers){this._array_isNotifyingRangeObservers=true;this.addObserver("[]",this,this._array_notifyRangeObservers)}return ret},updateRangeObserver:function(rangeObserver,indexes){return rangeObserver.update(this,indexes)},removeRangeObserver:function(rangeObserver){var ret=rangeObserver.destroy(this);var rangeob=this._array_rangeObservers;if(rangeob){rangeob.remove(rangeObserver)}return ret},enumerableContentDidChange:function(start,amt,delta){var rangeob=this._array_rangeObservers,oldlen=this._array_oldLength,newlen,length,changes;this.beginPropertyChanges();this.notifyPropertyChange("length");if(rangeob&&rangeob.length>0){if(oldlen===undefined){oldlen=0}this._array_oldLength=newlen=this.get("length");if(start===undefined){start=0}if(delta===undefined){delta=newlen-oldlen}if(delta!==0||amt===undefined){length=newlen-start;if(delta<0){length-=delta}}else{length=amt}changes=this._array_rangeChanges;if(!changes){changes=this._array_rangeChanges=SC.IndexSet.create()}changes.add(start,length)}this.notifyPropertyChange("[]");this.endPropertyChanges();return this},_array_notifyRangeObservers:function(){var rangeob=this._array_rangeObservers,changes=this._array_rangeChanges,len=rangeob?rangeob.length:0,idx,cur;if(len>0&&changes&&changes.length>0){for(idx=0;idx<len;idx++){rangeob[idx].rangeDidChange(changes)}changes.clear()}}};SC.mixin(Array.prototype,SC.Array);SC.Array=SC.mixin({},SC.Enumerable,SC.Array);SC.Array.slice=function(beginIndex,endIndex){var ret=[];var length=this.get("length");if(SC.none(beginIndex)){beginIndex=0}if(SC.none(endIndex)||(endIndex>length)){endIndex=length}while(beginIndex<endIndex){ret[ret.length]=this.objectAt(beginIndex++)}return ret};SC.Array.indexOf=function(object,startAt){var idx,len=this.get("length");if(startAt===undefined){startAt=0}else{startAt=(startAt<0)?Math.ceil(startAt):Math.floor(startAt)}if(startAt<0){startAt+=len}for(idx=startAt;idx<len;idx++){if(this.objectAt(idx)===object){return idx}}return -1};if(!Array.prototype.indexOf){Array.prototype.indexOf=SC.Array.indexOf}SC.Array.lastIndexOf=function(object,startAt){var idx,len=this.get("length");if(startAt===undefined){startAt=len-1}else{startAt=(startAt<0)?Math.ceil(startAt):Math.floor(startAt)}if(startAt<0){startAt+=len}for(idx=startAt;idx>=0;idx--){if(this.objectAt(idx)===object){return idx}}return -1};if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=SC.Array.lastIndexOf}(function(){SC.mixin(Array.prototype,{replace:function(idx,amt,objects){if(this.isFrozen){throw SC.FROZEN_ERROR}if(!objects||objects.length===0){this.splice(idx,amt)}else{var args=[idx,amt].concat(objects);this.splice.apply(this,args)}var len=objects?(objects.get?objects.get("length"):objects.length):0;this.enumerableContentDidChange(idx,amt,len-amt);return this},unknownProperty:function(key,value){var ret=this.reducedProperty(key,value);if((value!==undefined)&&ret===undefined){ret=this[key]=value}return ret}});var indexOf=Array.prototype.indexOf;if(!indexOf||(indexOf===SC.Array.indexOf)){Array.prototype.indexOf=function(object,startAt){var idx,len=this.length;if(startAt===undefined){startAt=0}else{startAt=(startAt<0)?Math.ceil(startAt):Math.floor(startAt)}if(startAt<0){startAt+=len}for(idx=startAt;idx<len;idx++){if(this[idx]===object){return idx}}return -1}}var lastIndexOf=Array.prototype.lastIndexOf;if(!lastIndexOf||(lastIndexOf===SC.Array.lastIndexOf)){Array.prototype.lastIndexOf=function(object,startAt){var idx,len=this.length;if(startAt===undefined){startAt=len-1}else{startAt=(startAt<0)?Math.ceil(startAt):Math.floor(startAt)}if(startAt<0){startAt+=len}for(idx=startAt;idx>=0;idx--){if(this[idx]===object){return idx}}return -1}}})()});tiki.module("sproutcore/runtime:mixins/comparable",function(require,exports,module,tiki){var SC=require("core");SC.Comparable={isComparable:true,compare:function(a,b){throw"%@.compare() is not implemented".fmt(this.toString())}}});tiki.module("sproutcore/runtime:mixins/copyable",function(require,exports,module,tiki){var SC=require("core");SC.Copyable={isCopyable:true,copy:function(){throw"%@.copy() is not implemented"},frozenCopy:function(){var isFrozen=this.get?this.get("isFrozen"):this.isFrozen;if(isFrozen===true){return this}else{if(isFrozen===undefined){throw"%@ does not support freezing".fmt(this)}else{return this.copy().freeze()}}}};SC.mixin(Array.prototype,SC.Copyable);Array.prototype.copy=Array.prototype.slice});tiki.module("sproutcore/runtime:mixins/delegate_support",function(require,exports,module,tiki){var SC=require("core");SC.DelegateSupport={delegateFor:function(methodName){var idx=1,len=arguments.length,ret;while(idx<len){ret=arguments[idx];if(ret&&ret[methodName]!==undefined){return ret}idx++}return(this[methodName]!==undefined)?this:null},invokeDelegateMethod:function(delegate,methodName,args){args=SC.A(arguments);args=args.slice(2,args.length);if(!delegate||!delegate[methodName]){delegate=this}var method=delegate[methodName];return method?method.apply(delegate,args):null},getDelegateProperty:function(key,delegate){var idx=1,len=arguments.length,ret;while(idx<len){ret=arguments[idx++];if(ret&&ret[key]!==undefined){return ret.get?ret.get(key):ret[key]}}return(this[key]!==undefined)?this.get(key):undefined}}});tiki.module("sproutcore/runtime:mixins/enumerable",function(require,exports,module,tiki){var SC=require("core");require("system/enumerator");SC.Enumerable={isEnumerable:true,nextObject:function(index,previousObject,context){return this.objectAt?this.objectAt(index):this[index]},firstObject:function(){if(this.get("length")===0){return undefined}if(this.objectAt){return this.objectAt(0)}var context=SC.Enumerator._popContext(),ret;ret=this.nextObject(0,null,context);context=SC.Enumerator._pushContext(context);return ret}.property(),enumerator:function(){return SC.Enumerator.create(this)},forEach:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.get?this.get("length"):this.length;if(target===undefined){target=null}var last=null;var context=SC.Enumerator._popContext();for(var idx=0;idx<len;idx++){var next=this.nextObject(idx,last,context);callback.call(target,next,idx,this);last=next}last=null;context=SC.Enumerator._pushContext(context);return this},getEach:function(key){return this.map(function(next){return next?(next.get?next.get(key):next[key]):null},this)},setEach:function(key,value){this.forEach(function(next){if(next){if(next.set){next.set(key,value)}else{next[key]=value}}},this);return this},map:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.get?this.get("length"):this.length;if(target===undefined){target=null}var ret=[];var last=null;var context=SC.Enumerator._popContext();for(var idx=0;idx<len;idx++){var next=this.nextObject(idx,last,context);ret[idx]=callback.call(target,next,idx,this);last=next}last=null;context=SC.Enumerator._pushContext(context);return ret},mapProperty:function(key){return this.map(function(next){return next?(next.get?next.get(key):next[key]):null})},filter:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.get?this.get("length"):this.length;if(target===undefined){target=null}var ret=[];var last=null;var context=SC.Enumerator._popContext();for(var idx=0;idx<len;idx++){var next=this.nextObject(idx,last,context);if(callback.call(target,next,idx,this)){ret.push(next)}last=next}last=null;context=SC.Enumerator._pushContext(context);return ret},sortProperty:function(key){var keys=(typeof key===SC.T_STRING)?arguments:key,len=keys.length,src;if(this instanceof Array){src=this}else{src=[];this.forEach(function(i){src.push(i)})}if(!src){return[]}return src.sort(function(a,b){var idx,key,aValue,bValue,ret=0;for(idx=0;ret===0&&idx<len;idx++){key=keys[idx];aValue=a?(a.get?a.get(key):a[key]):null;bValue=b?(b.get?b.get(key):b[key]):null;ret=SC.compare(aValue,bValue)}return ret})},filterProperty:function(key,value){var len=this.get?this.get("length"):this.length;var ret=[];var last=null;var context=SC.Enumerator._popContext();for(var idx=0;idx<len;idx++){var next=this.nextObject(idx,last,context);var cur=next?(next.get?next.get(key):next[key]):null;var matched=(value===undefined)?!!cur:SC.isEqual(cur,value);if(matched){ret.push(next)}last=next}last=null;context=SC.Enumerator._pushContext(context);return ret},find:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.get?this.get("length"):this.length;if(target===undefined){target=null}var last=null,next,found=false,ret=null;var context=SC.Enumerator._popContext();for(var idx=0;idx<len&&!found;idx++){next=this.nextObject(idx,last,context);if(found=callback.call(target,next,idx,this)){ret=next}last=next}next=last=null;context=SC.Enumerator._pushContext(context);return ret},findProperty:function(key,value){var len=this.get?this.get("length"):this.length;var found=false,ret=null,last=null,next,cur;var context=SC.Enumerator._popContext();for(var idx=0;idx<len&&!found;idx++){next=this.nextObject(idx,last,context);cur=next?(next.get?next.get(key):next[key]):null;found=(value===undefined)?!!cur:SC.isEqual(cur,value);if(found){ret=next}last=next}last=next=null;context=SC.Enumerator._pushContext(context);return ret},every:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.get?this.get("length"):this.length;if(target===undefined){target=null}var ret=true;var last=null;var context=SC.Enumerator._popContext();for(var idx=0;ret&&(idx<len);idx++){var next=this.nextObject(idx,last,context);if(!callback.call(target,next,idx,this)){ret=false}last=next}last=null;context=SC.Enumerator._pushContext(context);return ret},everyProperty:function(key,value){var len=this.get?this.get("length"):this.length;var ret=true;var last=null;var context=SC.Enumerator._popContext();for(var idx=0;ret&&(idx<len);idx++){var next=this.nextObject(idx,last,context);var cur=next?(next.get?next.get(key):next[key]):null;ret=(value===undefined)?!!cur:SC.isEqual(cur,value);last=next}last=null;context=SC.Enumerator._pushContext(context);return ret},some:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.get?this.get("length"):this.length;if(target===undefined){target=null}var ret=false;var last=null;var context=SC.Enumerator._popContext();for(var idx=0;(!ret)&&(idx<len);idx++){var next=this.nextObject(idx,last,context);if(callback.call(target,next,idx,this)){ret=true}last=next}last=null;context=SC.Enumerator._pushContext(context);return ret},someProperty:function(key,value){var len=this.get?this.get("length"):this.length;var ret=false;var last=null;var context=SC.Enumerator._popContext();for(var idx=0;!ret&&(idx<len);idx++){var next=this.nextObject(idx,last,context);var cur=next?(next.get?next.get(key):next[key]):null;ret=(value===undefined)?!!cur:SC.isEqual(cur,value);last=next}last=null;context=SC.Enumerator._pushContext(context);return ret},reduce:function(callback,initialValue,reducerProperty){if(typeof callback!=="function"){throw new TypeError()}var len=this.get?this.get("length"):this.length;if(len===0&&initialValue===undefined){throw new TypeError()}var ret=initialValue;var last=null;var context=SC.Enumerator._popContext();for(var idx=0;idx<len;idx++){var next=this.nextObject(idx,last,context);if(next!==null){if(ret===undefined){ret=next}else{ret=callback.call(null,ret,next,idx,this,reducerProperty)}}last=next}last=null;context=SC.Enumerator._pushContext(context);if(ret===undefined){throw new TypeError()}return ret},invoke:function(methodName){var len=this.get?this.get("length"):this.length;if(len<=0){return[]}var idx;var args=[];var alen=arguments.length;if(alen>1){for(idx=1;idx<alen;idx++){args.push(arguments[idx])}}var ret=[];var last=null;var context=SC.Enumerator._popContext();for(idx=0;idx<len;idx++){var next=this.nextObject(idx,last,context);var method=next?next[methodName]:null;if(method){ret[idx]=method.apply(next,args)}last=next}last=null;context=SC.Enumerator._pushContext(context);return ret},invokeWhile:function(targetValue,methodName){var len=this.get?this.get("length"):this.length;if(len<=0){return null}var idx;var args=[];var alen=arguments.length;if(alen>2){for(idx=2;idx<alen;idx++){args.push(arguments[idx])}}var ret=targetValue;var last=null;var context=SC.Enumerator._popContext();for(idx=0;(ret===targetValue)&&(idx<len);idx++){var next=this.nextObject(idx,last,context);var method=next?next[methodName]:null;if(method){ret=method.apply(next,args)}last=next}last=null;context=SC.Enumerator._pushContext(context);return ret},toArray:function(){var ret=[];this.forEach(function(o){ret.push(o)},this);return ret},groupBy:function(key){var len=this.get?this.get("length"):this.length,ret=[],last=null,context=SC.Enumerator._popContext(),grouped=[],keyValues=[];for(var idx=0;idx<len;idx++){var next=this.nextObject(idx,last,context);var cur=next?(next.get?next.get(key):next[key]):null;if(SC.none(grouped[cur])){grouped[cur]=[];keyValues.push(cur)}grouped[cur].push(next);last=next}last=null;context=SC.Enumerator._pushContext(context);for(var idx=0,len2=keyValues.length;idx<len2;idx++){ret.push(grouped[keyValues[idx]])}return ret}};SC._buildReducerFor=function(reducerKey,reducerProperty){return function(key,value){var reducer=this[reducerKey];if(SC.typeOf(reducer)!==SC.T_FUNCTION){return this.unknownProperty?this.unknownProperty(key,value):null}else{var ret=SC.Enumerable.reduce.call(this,reducer,null,reducerProperty);return ret}}.property("[]")};SC.Reducers={"[]":function(key,value){return this}.property(),enumerableContentDidChange:function(start,length){this.notifyPropertyChange("[]");return this},reducedProperty:function(key,value,generateProperty){if(!key||key.charAt(0)!=="@"){return undefined}var matches=key.match(/^@([^(]*)(\(([^)]*)\))?$/);if(!matches||matches.length<2){return undefined}var reducerKey=matches[1];var reducerProperty=matches[3];reducerKey="reduce"+reducerKey.slice(0,1).toUpperCase()+reducerKey.slice(1);var reducer=this[reducerKey];if(SC.typeOf(reducer)!==SC.T_FUNCTION){return undefined}if(generateProperty===false){return SC.Enumerable.reduce.call(this,reducer,null,reducerProperty)}var func=SC._buildReducerFor(reducerKey,reducerProperty);var p=this.constructor.prototype;if(p){p[key]=func;var props=p._properties||[];props.push(key);p._properties=props;this.registerDependentKey(key,"[]")}return SC.Enumerable.reduce.call(this,reducer,null,reducerProperty)},reduceMax:function(previousValue,item,index,e,reducerProperty){if(reducerProperty&&item){item=item.get?item.get(reducerProperty):item[reducerProperty]}if(previousValue===null){return item}return(item>previousValue)?item:previousValue},reduceMaxObject:function(previousItem,item,index,e,reducerProperty){var previousValue=previousItem,itemValue=item;if(reducerProperty){if(item){itemValue=item.get?item.get(reducerProperty):item[reducerProperty]}if(previousItem){previousValue=previousItem.get?previousItem.get(reducerProperty):previousItem[reducerProperty]}}if(previousValue===null){return item}return(itemValue>previousValue)?item:previousItem},reduceMin:function(previousValue,item,index,e,reducerProperty){if(reducerProperty&&item){item=item.get?item.get(reducerProperty):item[reducerProperty]}if(previousValue===null){return item}return(item<previousValue)?item:previousValue},reduceMinObject:function(previousItem,item,index,e,reducerProperty){var previousValue=previousItem,itemValue=item;if(reducerProperty){if(item){itemValue=item.get?item.get(reducerProperty):item[reducerProperty]}if(previousItem){previousValue=previousItem.get?previousItem.get(reducerProperty):previousItem[reducerProperty]}}if(previousValue===null){return item}return(itemValue<previousValue)?item:previousItem},reduceAverage:function(previousValue,item,index,e,reducerProperty){if(reducerProperty&&item){item=item.get?item.get(reducerProperty):item[reducerProperty]}var ret=(previousValue||0)+item;var len=e.get?e.get("length"):e.length;if(index>=len-1){ret=ret/len}return ret},reduceSum:function(previousValue,item,index,e,reducerProperty){if(reducerProperty&&item){item=item.get?item.get(reducerProperty):item[reducerProperty]}return(previousValue===null)?item:previousValue+item}};SC.mixin(SC.Enumerable,SC.Reducers);SC.mixin(Array.prototype,SC.Reducers);Array.prototype.isEnumerable=true;(function(){var alwaysMixin={nextObject:SC.Enumerable.nextObject,enumerator:SC.Enumerable.enumerator,firstObject:SC.Enumerable.firstObject,sortProperty:SC.Enumerable.sortProperty,mapProperty:function(key){var len=this.length;var ret=[];for(var idx=0;idx<len;idx++){var next=this[idx];ret[idx]=next?(next.get?next.get(key):next[key]):null}return ret},filterProperty:function(key,value){var len=this.length;var ret=[];for(var idx=0;idx<len;idx++){var next=this[idx];var cur=next?(next.get?next.get(key):next[key]):null;var matched=(value===undefined)?!!cur:SC.isEqual(cur,value);if(matched){ret.push(next)}}return ret},groupBy:function(key){var len=this.length,ret=[],grouped=[],keyValues=[];for(var idx=0;idx<len;idx++){var next=this[idx];var cur=next?(next.get?next.get(key):next[key]):null;if(SC.none(grouped[cur])){grouped[cur]=[];keyValues.push(cur)}grouped[cur].push(next)}for(var idx=0,len2=keyValues.length;idx<len2;idx++){ret.push(grouped[keyValues[idx]])}return ret},find:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.length;if(target===undefined){target=null}var next,ret=null,found=false;for(var idx=0;idx<len&&!found;idx++){next=this[idx];if(found=callback.call(target,next,idx,this)){ret=next}}next=null;return ret},findProperty:function(key,value){var len=this.length;var next,cur,found=false,ret=null;for(var idx=0;idx<len&&!found;idx++){cur=(next=this[idx])?(next.get?next.get(key):next[key]):null;found=(value===undefined)?!!cur:SC.isEqual(cur,value);if(found){ret=next}}next=null;return ret},everyProperty:function(key,value){var len=this.length;var ret=true;for(var idx=0;ret&&(idx<len);idx++){var next=this[idx];var cur=next?(next.get?next.get(key):next[key]):null;ret=(value===undefined)?!!cur:SC.isEqual(cur,value)}return ret},someProperty:function(key,value){var len=this.length;var ret=false;for(var idx=0;!ret&&(idx<len);idx++){var next=this[idx];var cur=next?(next.get?next.get(key):next[key]):null;ret=(value===undefined)?!!cur:SC.isEqual(cur,value)}return ret},invoke:function(methodName){var len=this.length;if(len<=0){return[]}var idx;var args=[];var alen=arguments.length;if(alen>1){for(idx=1;idx<alen;idx++){args.push(arguments[idx])}}var ret=[];for(idx=0;idx<len;idx++){var next=this[idx];var method=next?next[methodName]:null;if(method){ret[idx]=method.apply(next,args)}}return ret},invokeWhile:function(targetValue,methodName){var len=this.length;if(len<=0){return null}var idx;var args=[];var alen=arguments.length;if(alen>2){for(idx=2;idx<alen;idx++){args.push(arguments[idx])}}var ret=targetValue;for(idx=0;(ret===targetValue)&&(idx<len);idx++){var next=this[idx];var method=next?next[methodName]:null;if(method){ret=method.apply(next,args)}}return ret},toArray:function(){var len=this.length;if(len<=0){return[]}var ret=[];for(var idx=0;idx<len;idx++){var next=this[idx];ret.push(next)}return ret},getEach:function(key){var ret=[];var len=this.length;for(var idx=0;idx<len;idx++){var obj=this[idx];ret[idx]=obj?(obj.get?obj.get(key):obj[key]):null}return ret},setEach:function(key,value){var len=this.length;for(var idx=0;idx<len;idx++){var obj=this[idx];if(obj){if(obj.set){obj.set(key,value)}else{obj[key]=value}}}return this}};var mixinIfMissing={forEach:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.length;if(target===undefined){target=null}for(var idx=0;idx<len;idx++){var next=this[idx];callback.call(target,next,idx,this)}return this},map:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.length;if(target===undefined){target=null}var ret=[];for(var idx=0;idx<len;idx++){var next=this[idx];ret[idx]=callback.call(target,next,idx,this)}return ret},filter:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.length;if(target===undefined){target=null}var ret=[];for(var idx=0;idx<len;idx++){var next=this[idx];if(callback.call(target,next,idx,this)){ret.push(next)}}return ret},every:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.length;if(target===undefined){target=null}var ret=true;for(var idx=0;ret&&(idx<len);idx++){var next=this[idx];if(!callback.call(target,next,idx,this)){ret=false}}return ret},some:function(callback,target){if(typeof callback!=="function"){throw new TypeError()}var len=this.length;if(target===undefined){target=null}var ret=false;for(var idx=0;(!ret)&&(idx<len);idx++){var next=this[idx];if(callback.call(target,next,idx,this)){ret=true}}return ret},reduce:function(callback,initialValue,reducerProperty){if(typeof callback!=="function"){throw new TypeError()}var len=this.length;if(len===0&&initialValue===undefined){throw new TypeError()}var ret=initialValue;for(var idx=0;idx<len;idx++){var next=this[idx];if(next!==null){if(ret===undefined){ret=next}else{ret=callback.call(null,ret,next,idx,this,reducerProperty)}}}if(ret===undefined){throw new TypeError()}return ret}};for(var key in mixinIfMissing){if(!mixinIfMissing.hasOwnProperty(key)){continue}if(!Array.prototype[key]||((typeof Prototype==="object")&&Prototype.Version.match(/^1\.6/))){Array.prototype[key]=mixinIfMissing[key]}}SC.mixin(Array.prototype,alwaysMixin)})()});tiki.module("sproutcore/runtime:mixins/freezable",function(require,exports,module,tiki){var SC=require("core");SC.FROZEN_ERROR=new Error("Cannot modify a frozen object");SC.Freezable={isFreezable:true,isFrozen:false,freeze:function(){if(this.set){this.set("isFrozen",true)}else{this.isFrozen=true}return this}};SC.mixin(Array.prototype,SC.Freezable)});tiki.module("sproutcore/runtime:mixins/observable",function(require,exports,module,tiki){var SC=require("core");require("private/observer_set");require("private/chain_observer");SC.LOG_OBSERVERS=false;SC.Observable={isObservable:true,automaticallyNotifiesObserversFor:function(key){return true},get:function(key){var ret=this[key],cache;if(ret===undefined){return this.unknownProperty(key)}else{if(ret&&ret.isProperty){if(ret.isCacheable){cache=this._kvo_cache;if(!cache){cache=this._kvo_cache={}}return(cache[ret.cacheKey]!==undefined)?cache[ret.cacheKey]:(cache[ret.cacheKey]=ret.call(this,key))}else{return ret.call(this,key)}}else{return ret}}},set:function(key,value){var func=this[key],notify=this.automaticallyNotifiesObserversFor(key),ret=value,cachedep,cache,idx,dfunc;if(!notify&&this._kvo_cacheable&&(cache=this._kvo_cache)){cachedep=this._kvo_cachedep;if(!cachedep||(cachedep=cachedep[key])===undefined){cachedep=this._kvo_computeCachedDependentsFor(key)}if(cachedep){idx=cachedep.length;while(--idx>=0){dfunc=cachedep[idx];cache[dfunc.cacheKey]=cache[dfunc.lastSetValueKey]=undefined}}}if(func&&func.isProperty){cache=this._kvo_cache;if(func.isVolatile||!cache||(cache[func.lastSetValueKey]!==value)){if(!cache){cache=this._kvo_cache={}}cache[func.lastSetValueKey]=value;if(notify){this.propertyWillChange(key)}ret=func.call(this,key,value);if(func.isCacheable){cache[func.cacheKey]=ret}if(notify){this.propertyDidChange(key,ret,true)}}}else{if(func===undefined){if(notify){this.propertyWillChange(key)}this.unknownProperty(key,value);if(notify){this.propertyDidChange(key,ret)}}else{if(this[key]!==value){if(notify){this.propertyWillChange(key)}ret=this[key]=value;if(notify){this.propertyDidChange(key,ret)}}}}return this},unknownProperty:function(key,value){if(!(value===undefined)){this[key]=value}return value},beginPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;return this},endPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;var level=this._kvo_changeLevel,changes=this._kvo_changes;if((level<=0)&&changes&&(changes.length>0)&&!SC.Observers.isObservingSuspended){this._notifyPropertyObservers()}return this},propertyWillChange:function(key){return this},propertyDidChange:function(key,value,_keepCache){this._kvo_revision=(this._kvo_revision||0)+1;var level=this._kvo_changeLevel||0,cachedep,idx,dfunc,cache,func,log=SC.LOG_OBSERVERS&&!(this.LOG_OBSERVING===false);if(cache=this._kvo_cache){if(!_keepCache){func=this[key];if(func&&func.isProperty){cache[func.cacheKey]=cache[func.lastSetValueKey]=undefined}}if(this._kvo_cacheable){cachedep=this._kvo_cachedep;if(!cachedep||(cachedep=cachedep[key])===undefined){cachedep=this._kvo_computeCachedDependentsFor(key)}if(cachedep){idx=cachedep.length;while(--idx>=0){dfunc=cachedep[idx];cache[dfunc.cacheKey]=cache[dfunc.lastSetValueKey]=undefined}}}}var suspended=SC.Observers.isObservingSuspended;if((level>0)||suspended){var changes=this._kvo_changes;if(!changes){changes=this._kvo_changes=SC.CoreSet.create()}changes.add(key);if(suspended){if(log){SC.Logger.log("%@%@: will not notify observers because observing is suspended".fmt(SC.KVO_SPACES,this))}SC.Observers.objectHasPendingChanges(this)}}else{this._notifyPropertyObservers(key)}return this},registerDependentKey:function(key,dependentKeys){var dependents=this._kvo_dependents,func=this[key],keys,idx,lim,dep,queue;if(SC.typeOf(dependentKeys)===SC.T_ARRAY){keys=dependentKeys;lim=0}else{keys=arguments;lim=1}idx=keys.length;if(!dependents){this._kvo_dependents=dependents={}}while(--idx>=lim){dep=keys[idx];queue=dependents[dep];if(!queue){queue=dependents[dep]=[]}queue.push(key)}},_kvo_addCachedDependents:function(queue,keys,dependents,seen){var idx=keys.length,func,key,deps;while(--idx>=0){key=keys[idx];seen.add(key);func=this[key];if(func&&(func instanceof Function)&&func.isProperty){if(func.isCacheable){queue.push(func)}if((deps=dependents[key])&&deps.length>0){this._kvo_addCachedDependents(queue,deps,dependents,seen)}}}},_kvo_computeCachedDependentsFor:function(key){var cached=this._kvo_cachedep,dependents=this._kvo_dependents,keys=dependents?dependents[key]:null,queue,seen;if(!cached){cached=this._kvo_cachedep={}}if(!keys||keys.length===0){return cached[key]=null}queue=cached[key]=[];seen=SC._TMP_SEEN_SET=(SC._TMP_SEEN_SET||SC.CoreSet.create());seen.add(key);this._kvo_addCachedDependents(queue,keys,dependents,seen);seen.clear();if(queue.length===0){queue=cached[key]=null}return queue},_kvo_for:function(kvoKey,type){var ret=this[kvoKey];if(!this._kvo_cloned){this._kvo_cloned={}}if(!ret){ret=this[kvoKey]=(type===undefined)?[]:type.create();this._kvo_cloned[kvoKey]=true}else{if(!this._kvo_cloned[kvoKey]){ret=this[kvoKey]=ret.copy();this._kvo_cloned[kvoKey]=true}}return ret},addObserver:function(key,target,method,context){var kvoKey,chain,chains,observers;if(method===undefined){method=target;target=this}if(!target){target=this}if(SC.typeOf(method)===SC.T_STRING){method=target[method]}if(!method){throw"You must pass a method to addObserver()"}key=key.toString();if(key.indexOf(".")>=0){chain=SC._ChainObserver.createChain(this,key,target,method,context);chain.masterTarget=target;chain.masterMethod=method;this._kvo_for(SC.keyFor("_kvo_chains",key)).push(chain)}else{if((this[key]===undefined)&&(key.indexOf("@")===0)){this.get(key)}if(target===this){target=null}kvoKey=SC.keyFor("_kvo_observers",key);this._kvo_for(kvoKey,SC.ObserverSet).add(target,method,context);this._kvo_for("_kvo_observed_keys",SC.CoreSet).add(key)}if(this.didAddObserver){this.didAddObserver(key,target,method)}return this},removeObserver:function(key,target,method){var kvoKey,chains,chain,observers,idx;if(method===undefined){method=target;target=this}if(!target){target=this}if(SC.typeOf(method)===SC.T_STRING){method=target[method]}if(!method){throw"You must pass a method to removeObserver()"}key=key.toString();if(key.indexOf(".")>=0){kvoKey=SC.keyFor("_kvo_chains",key);if(chains=this[kvoKey]){chains=this._kvo_for(kvoKey);idx=chains.length;while(--idx>=0){chain=chains[idx];if(chain&&(chain.masterTarget===target)&&(chain.masterMethod===method)){chains[idx]=chain.destroyChain()}}}}else{if(target===this){target=null}kvoKey=SC.keyFor("_kvo_observers",key);if(observers=this[kvoKey]){observers=this._kvo_for(kvoKey);observers.remove(target,method);if(observers.targets<=0){this._kvo_for("_kvo_observed_keys",SC.CoreSet).remove(key)}}}if(this.didRemoveObserver){this.didRemoveObserver(key,target,method)}return this},hasObserverFor:function(key){SC.Observers.flush(this);var observers=this[SC.keyFor("_kvo_observers",key)],locals=this[SC.keyFor("_kvo_local",key)],members;if(locals&&locals.length>0){return true}if(observers&&observers.getMembers().length>0){return true}return false},initObservable:function(){if(this._observableInited){return}this._observableInited=true;var loc,keys,key,value,observer,propertyPaths,propertyPathsLength,len,ploc,path,dotIndex,root,propertyKey,keysLen;if(keys=this._observers){len=keys.length;for(loc=0;loc<len;loc++){key=keys[loc];observer=this[key];propertyPaths=observer.propertyPaths;propertyPathsLength=(propertyPaths)?propertyPaths.length:0;for(ploc=0;ploc<propertyPathsLength;ploc++){path=propertyPaths[ploc];dotIndex=path.indexOf(".");if(dotIndex<0){this.addObserver(path,this,observer)}else{if(path.indexOf("*")===0){this.addObserver(path.slice(1),this,observer)}else{root=null;if(dotIndex===0){root=this;path=path.slice(1)}else{if(dotIndex===4&&path.slice(0,5)==="this."){root=this;path=path.slice(5)}else{if(dotIndex<0&&path.length===4&&path==="this"){root=this;path=""}}}SC.Observers.addObserver(path,this,observer,root)}}}}}this.bindings=[];if(keys=this._bindings){for(loc=0,keysLen=keys.length;loc<keysLen;loc++){key=keys[loc];value=this[key];propertyKey=key.slice(0,-7);this[key]=this.bind(propertyKey,value)}}if(keys=this._properties){for(loc=0,keysLen=keys.length;loc<keysLen;loc++){key=keys[loc];if(value=this[key]){if(value.isCacheable){this._kvo_cacheable=true}if(value.dependentKeys&&(value.dependentKeys.length>0)){this.registerDependentKey(key,value.dependentKeys)}}}}},observersForKey:function(key){var observers=this._kvo_for("_kvo_observers",key);return observers.getMembers()||[]},_notifyPropertyObservers:function(key){if(!this._observableInited){this.initObservable()}SC.Observers.flush(this);var log=SC.LOG_OBSERVERS&&!(this.LOG_OBSERVING===false),observers,changes,dependents,starObservers,idx,keys,rev,members,membersLength,member,memberLoc,target,method,loc,func,context,spaces,cache;if(log){spaces=SC.KVO_SPACES=(SC.KVO_SPACES||"")+"  ";SC.Logger.log('%@%@: notifying observers after change to key "%@"'.fmt(spaces,this,key))}starObservers=this["_kvo_observers_*"];this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;while(((changes=this._kvo_changes)&&(changes.length>0))||key){rev=++this.propertyRevision;if(!changes){changes=SC.CoreSet.create()}this._kvo_changes=null;if(key==="*"){changes.add("*");changes.addEach(this._kvo_for("_kvo_observed_keys",SC.CoreSet))}else{if(key){changes.add(key)}}if(dependents=this._kvo_dependents){for(idx=0;idx<changes.length;idx++){key=changes[idx];keys=dependents[key];if(keys&&(loc=keys.length)){if(log){SC.Logger.log("%@...including dependent keys for %@: %@".fmt(spaces,key,keys))}cache=this._kvo_cache;if(!cache){cache=this._kvo_cache={}}while(--loc>=0){changes.add(key=keys[loc]);if(func=this[key]){this[func.cacheKey]=undefined;cache[func.cacheKey]=cache[func.lastSetValueKey]=undefined}}}}}while(changes.length>0){key=changes.pop();observers=this[SC.keyFor("_kvo_observers",key)];if(observers){members=observers.getMembers();membersLength=members.length;for(memberLoc=0;memberLoc<membersLength;memberLoc++){member=members[memberLoc];if(member[3]===rev){continue}target=member[0]||this;method=member[1];context=member[2];member[3]=rev;if(log){SC.Logger.log('%@...firing observer on %@ for key "%@"'.fmt(spaces,target,key))}if(context!==undefined){method.call(target,this,key,null,context,rev)}else{method.call(target,this,key,null,rev)}}}members=this[SC.keyFor("_kvo_local",key)];if(members){membersLength=members.length;for(memberLoc=0;memberLoc<membersLength;memberLoc++){member=members[memberLoc];method=this[member];if(method){if(log){SC.Logger.log('%@...firing local observer %@.%@ for key "%@"'.fmt(spaces,this,member,key))}method.call(this,this,key,null,rev)}}}if(starObservers&&key!=="*"){members=starObservers.getMembers();membersLength=members.length;for(memberLoc=0;memberLoc<membersLength;memberLoc++){member=members[memberLoc];target=member[0]||this;method=member[1];context=member[2];if(log){SC.Logger.log('%@...firing * observer on %@ for key "%@"'.fmt(spaces,target,key))}if(context!==undefined){method.call(target,this,key,null,context,rev)}else{method.call(target,this,key,null,rev)}}}if(this.propertyObserver){if(log){SC.Logger.log('%@...firing %@.propertyObserver for key "%@"'.fmt(spaces,this,key))}this.propertyObserver(this,key,null,rev)}}if(changes){changes.destroy()}key=null}this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;if(log){SC.KVO_SPACES=spaces.slice(0,-2)}return true},bind:function(toKey,target,method){var binding,pathType;if(method!==undefined){target=[target,method]}pathType=SC.typeOf(target);if(pathType===SC.T_STRING||pathType===SC.T_ARRAY){binding=this[toKey+"BindingDefault"]||SC.Binding;binding=binding.beget().from(target)}else{binding=target}binding=binding.to(toKey,this).connect();this.bindings.push(binding);return binding},didChangeFor:function(context){var valueCache,revisionCache,seenValues,seenRevisions,ret,currentRevision,idx,key,value;context=SC.hashFor(context);valueCache=this._kvo_didChange_valueCache;if(!valueCache){valueCache=this._kvo_didChange_valueCache={}}revisionCache=this._kvo_didChange_revisionCache;if(!revisionCache){revisionCache=this._kvo_didChange_revisionCache={}}seenValues=valueCache[context]||{};seenRevisions=revisionCache[context]||{};ret=false;currentRevision=this._kvo_revision||0;idx=arguments.length;while(--idx>=1){key=arguments[idx];if(seenRevisions[key]!=currentRevision){value=this.get(key);if(seenValues[key]!==value){ret=true;seenValues[key]=value}}seenRevisions[key]=currentRevision}valueCache[context]=seenValues;revisionCache[context]=seenRevisions;return ret},setIfChanged:function(key,value){return(this.get(key)!==value)?this.set(key,value):this},getPath:function(path){var tuple=SC.tupleForPropertyPath(path,this);if(tuple===null||tuple[0]===null){return undefined}return tuple[0].get(tuple[1])},setPath:function(path,value){if(path.indexOf(".")>=0){var tuple=SC.tupleForPropertyPath(path,this);if(!tuple||!tuple[0]){return null}tuple[0].set(tuple[1],value)}else{this.set(path,value)}return this},setPathIfChanged:function(path,value){if(path.indexOf(".")>=0){var tuple=SC.tupleForPropertyPath(path,this);if(!tuple||!tuple[0]){return null}if(tuple[0].get(tuple[1])!==value){tuple[0].set(tuple[1],value)}}else{this.setIfChanged(path,value)}return this},getEach:function(){var keys=SC.A(arguments),ret=[],idx,idxLen;for(idx=0,idxLen=keys.length;idx<idxLen;idx++){ret[ret.length]=this.getPath(keys[idx])}return ret},incrementProperty:function(key,increment){if(!increment){increment=1}this.set(key,(this.get(key)||0)+increment);return this.get(key)},decrementProperty:function(key,increment){if(!increment){increment=1}this.set(key,(this.get(key)||0)-increment);return this.get(key)},toggleProperty:function(key,value,alt){if(value===undefined){value=true}if(alt===undefined){alt=false}value=(this.get(key)==value)?alt:value;this.set(key,value);return this.get(key)},notifyPropertyChange:function(key,value){this.propertyWillChange(key);this.propertyDidChange(key,value);return this},allPropertiesDidChange:function(){this._kvo_cache=null;this._notifyPropertyObservers("*");return this},addProbe:function(key){this.addObserver(key,SC.logChange)},removeProbe:function(key){this.removeObserver(key,SC.logChange)},logProperty:function(){var props=SC.$A(arguments),prop,propsLen,idx;for(idx=0,propsLen=props.length;idx<propsLen;idx++){prop=props[idx];SC.Logger.log("%@:%@: ".fmt(SC.guidFor(this),prop),this.get(prop))}},propertyRevision:1};SC.logChange=function logChange(target,key,value){SC.Logger.log("CHANGE: %@[%@] => %@".fmt(target,key,target.get(key)))};SC.mixin(SC,{get:function(object,key){if(!object){return undefined}if(key===undefined){return this[object]}if(object.get){return object.get(key)}return object[key]}});SC.mixin(Array.prototype,SC.Observable);require("system/binding");require("private/observer_queue")});tiki.module("sproutcore/runtime:private/chain_observer",function(require,exports,module,tiki){var SC=require("core");SC._ChainObserver=function(property){this.property=property};SC._ChainObserver.createChain=function(rootObject,path,target,method,context){var parts=path.split("."),root=new SC._ChainObserver(parts[0]),tail=root,len=parts.length;for(var idx=1;idx<len;idx++){tail=tail.next=new SC._ChainObserver(parts[idx])}root.objectDidChange(rootObject);tail.target=target;tail.method=method;tail.context=context;return root};SC._ChainObserver.prototype={isChainObserver:true,object:null,property:null,next:null,target:null,method:null,objectDidChange:function(newObject){if(newObject===this.object){return}if(this.object&&this.object.removeObserver){this.object.removeObserver(this.property,this,this.propertyDidChange)}this.object=newObject;if(this.object&&this.object.addObserver){this.object.addObserver(this.property,this,this.propertyDidChange)}this.propertyDidChange()},propertyDidChange:function(){var object=this.object;var property=this.property;var value=(object&&object.get)?object.get(property):null;if(this.next){this.next.objectDidChange(value)}var target=this.target,method=this.method,context=this.context;if(target&&method){var rev=object?object.propertyRevision:null;if(context){method.call(target,object,property,value,context,rev)}else{method.call(target,object,property,value,rev)}}},destroyChain:function(){var obj=this.object;if(obj&&obj.removeObserver){obj.removeObserver(this.property,this,this.propertyDidChange)}if(this.next){this.next.destroyChain()}this.next=this.target=this.method=this.object=this.context=null;return null}}});tiki.module("sproutcore/runtime:private/observer_queue",function(require,exports,module,tiki){var SC=require("core");require("system/set");SC.Observers={queue:[],addObserver:function(propertyPath,target,method,pathRoot){var tuple;if(SC.typeOf(propertyPath)===SC.T_STRING){tuple=SC.tupleForPropertyPath(propertyPath,pathRoot)}else{tuple=propertyPath}if(tuple){tuple[0].addObserver(tuple[1],target,method)}else{this.queue.push([propertyPath,target,method,pathRoot])}},removeObserver:function(propertyPath,target,method,pathRoot){var idx,queue,tuple,item;tuple=SC.tupleForPropertyPath(propertyPath,pathRoot);if(tuple){tuple[0].removeObserver(tuple[1],target,method)}idx=this.queue.length;queue=this.queue;while(--idx>=0){item=queue[idx];if((item[0]===propertyPath)&&(item[1]===target)&&(item[2]==method)&&(item[3]===pathRoot)){queue[idx]=null}}},addPendingRangeObserver:function(observer){var ro=this.rangeObservers;if(!ro){ro=this.rangeObservers=SC.CoreSet.create()}ro.add(observer);return this},_TMP_OUT:[],flush:function(object){var oldQueue=this.queue;if(oldQueue&&oldQueue.length>0){var newQueue=(this.queue=[]);var idx=oldQueue.length;while(--idx>=0){var item=oldQueue[idx];if(!item){continue}var tuple=SC.tupleForPropertyPath(item[0],item[3]);if(tuple){tuple[0].addObserver(tuple[1],item[1],item[2])}else{newQueue.push(item)}}}if(object._kvo_needsRangeObserver){var set=this.rangeObservers,len=set?set.get("length"):0,out=this._TMP_OUT,ro;for(idx=0;idx<len;idx++){ro=set[idx];if(ro.setupPending(object)){out.push(ro)}}if(out.length>0){set.removeEach(out)}out.length=0;object._kvo_needsRangeObserver=false}},isObservingSuspended:0,_pending:SC.CoreSet.create(),objectHasPendingChanges:function(obj){this._pending.add(obj)},suspendPropertyObserving:function(){this.isObservingSuspended++},resumePropertyObserving:function(){var pending;if(--this.isObservingSuspended<=0){pending=this._pending;this._pending=SC.CoreSet.create();var idx,len=pending.length;for(idx=0;idx<len;idx++){pending[idx]._notifyPropertyObservers()}pending.clear();pending=null}}}});tiki.module("sproutcore/runtime:private/observer_set",function(require,exports,module,tiki){var SC=require("core");SC.ObserverSet={targets:0,_membersCacheIsValid:false,add:function(target,method,context){var targetGuid=(target)?SC.guidFor(target):"__this__";var methods=this[targetGuid];if(!methods){methods=this[targetGuid]=SC.CoreSet.create();methods.target=target;methods.isTargetSet=true;this.targets++}methods.add(method);if(context!==undefined){var contexts=methods.contexts;if(!context){context=methods.contexts={}}contexts[SC.guidFor(method)]=context}this._membersCacheIsValid=false},remove:function(target,method){var targetGuid=(target)?SC.guidFor(target):"__this__";var methods=this[targetGuid];if(!methods){return false}methods.remove(method);if(methods.length<=0){methods.target=null;methods.isTargetSet=false;methods.contexts=null;delete this[targetGuid];this.targets--}else{if(methods.contexts){delete methods.contexts[SC.guidFor(method)]}}this._membersCacheIsValid=false;return true},invokeMethods:function(){var key,value,idx,target,val;for(key in this){if(!this.hasOwnProperty(key)){continue}value=this[key];if(value&&value.isTargetSet){idx=value.length;target=value.target;while(--idx>=0){val=value[idx];if(val){val.call(target)}}}}},getMembers:function(){if(this._membersCacheIsValid){return this._members}if(!this._members){this._members=[]}else{this._members.length=0}var ret=this._members;for(var key in this){if(!this.hasOwnProperty(key)){continue}var value=this[key];if(value&&value.isTargetSet){var idx=value.length;var target=value.target;var contexts=value.contexts;if(contexts){while(--idx>=0){var method=value[idx];ret.push([target,method,contexts[SC.guidFor(method)]])}}else{while(--idx>=0){ret.push([target,value[idx]])}}}}this._membersCacheIsValid=true;return ret},clone:function(){var oldSet,newSet,key,ret=SC.ObserverSet.create();for(key in this){if(!this.hasOwnProperty(key)){continue}oldSet=this[key];if(oldSet&&oldSet.isTargetSet){newSet=oldSet.clone();newSet.target=oldSet.target;if(oldSet.contexts){newSet.contexts=SC.clone(oldSet.contexts)}ret[key]=newSet}}ret.targets=this.targets;ret._membersCacheIsValid=false;return ret},create:function(){return SC.beget(this)}};SC.ObserverSet.slice=SC.ObserverSet.clone});tiki.module("sproutcore/runtime:system/binding",function(require,exports,module,tiki){var SC=require("core");require("system/set");SC.LOG_BINDINGS=false;SC.BENCHMARK_BINDING_NOTIFICATIONS=false;SC.BENCHMARK_BINDING_SETUP=false;SC.MULTIPLE_PLACEHOLDER="@@MULT@@";SC.NULL_PLACEHOLDER="@@NULL@@";SC.EMPTY_PLACEHOLDER="@@EMPTY@@";SC.Binding={beget:function(fromPath){var ret=SC.beget(this);ret.parentBinding=this;if(fromPath!==undefined){ret=ret.from(fromPath)}return ret},builder:function(){var binding=this,ret=function(fromProperty){return binding.beget().from(fromProperty)};ret.beget=function(){return binding.beget()};return ret},from:function(propertyPath,root){if(!propertyPath){return this}var binding=(this===SC.Binding)?this.beget():this;binding._fromPropertyPath=propertyPath;binding._fromRoot=root;binding._fromTuple=null;return binding},to:function(propertyPath,root){var binding=(this===SC.Binding)?this.beget():this;binding._toPropertyPath=propertyPath;binding._toRoot=root;binding._toTuple=null;return binding},connect:function(){if(this.isConnected){return this}this.isConnected=true;this._connectionPending=true;this._syncOnConnect=true;SC.Binding._connectQueue.add(this);return this},_connect:function(){if(!this._connectionPending){return}this._connectionPending=false;var path,root,bench=SC.BENCHMARK_BINDING_SETUP;if(bench){SC.Benchmark.start("SC.Binding.connect()")}path=this._fromPropertyPath;root=this._fromRoot;if(SC.typeOf(path)===SC.T_STRING){if(path.indexOf(".")===0){path=path.slice(1);if(!root){root=this._toRoot}}else{if(path.indexOf("*")===0){path=[this._fromRoot||this._toRoot,path.slice(1)];root=null}}}SC.Observers.addObserver(path,this,this.fromPropertyDidChange,root);if(!this._oneWay){path=this._toPropertyPath;root=this._toRoot;SC.Observers.addObserver(path,this,this.toPropertyDidChange,root)}if(bench){SC.Benchmark.end("SC.Binding.connect()")}if(this._syncOnConnect){this._syncOnConnect=false;if(bench){SC.Benchmark.start("SC.Binding.connect().sync")}this.sync();if(bench){SC.Benchmark.end("SC.Binding.connect().sync")}}},disconnect:function(){if(!this.isConnected){return this}if(this._connectionPending){this._connectionPending=false}else{SC.Observers.removeObserver(this._fromPropertyPath,this,this.fromPropertyDidChange,(this._fromRoot||this._toRoot));if(!this._oneWay){SC.Observers.removeObserver(this._toPropertyPath,this,this.toPropertyDidChange,this._toRoot)}}this.isConnected=false;return this},fromPropertyDidChange:function(target,key){var v=target?target.get(key):null;if(v!==this._bindingValue){this._setBindingValue(target,key);this._changePending=true;SC.Binding._changeQueue.add(this)}},toPropertyDidChange:function(target,key){if(this._oneWay){return}var v=target.get(key);if(v!==this._transformedBindingValue){this._setBindingValue(target,key);this._changePending=true;SC.Binding._changeQueue.add(this)}},_setBindingValue:function(source,key){this._bindingSource=source;this._bindingKey=key},_computeBindingValue:function(){var source=this._bindingSource,key=this._bindingKey,v,idx;this._bindingValue=v=(source?source.getPath(key):null);var transforms=this._transforms;if(transforms){var len=transforms.length,transform;for(idx=0;idx<len;idx++){transform=transforms[idx];v=transform(v,this)}}if(this._noError&&SC.typeOf(v)===SC.T_ERROR){v=null}this._transformedBindingValue=v},_connectQueue:SC.CoreSet.create(),_alternateConnectQueue:SC.CoreSet.create(),_changeQueue:SC.CoreSet.create(),_alternateChangeQueue:SC.CoreSet.create(),_changePending:false,flushPendingChanges:function(){if(this._isFlushing){return false}this._isFlushing=true;SC.Observers.suspendPropertyObserving();var didFlush=false,log=SC.LOG_BINDINGS,queue,binding;while((queue=this._connectQueue).length>0){this._connectQueue=this._alternateConnectQueue;this._alternateConnectQueue=queue;while(binding=queue.pop()){binding._connect()}}while((queue=this._changeQueue).length>0){if(log){SC.Logger.log("Begin: Trigger changed bindings")}didFlush=true;this._changeQueue=this._alternateChangeQueue;this._alternateChangeQueue=queue;while(binding=queue.pop()){binding.applyBindingValue()}if(log){SC.Logger.log("End: Trigger changed bindings")}}this._isFlushing=false;SC.Observers.resumePropertyObserving();return didFlush},applyBindingValue:function(){this._changePending=false;this._computeBindingTargets();this._computeBindingValue();var v=this._bindingValue,tv=this._transformedBindingValue,bench=SC.BENCHMARK_BINDING_NOTIFICATIONS,log=SC.LOG_BINDINGS;if(!this._oneWay&&this._fromTarget){if(log){SC.Logger.log("%@: %@ -> %@".fmt(this,v,tv))}if(bench){SC.Benchmark.start(this.toString()+"->")}this._fromTarget.setPathIfChanged(this._fromPropertyKey,v);if(bench){SC.Benchmark.end(this.toString()+"->")}}if(this._toTarget){if(log){SC.Logger.log("%@: %@ <- %@".fmt(this,v,tv))}if(bench){SC.Benchmark.start(this.toString()+"<-")}this._toTarget.setPathIfChanged(this._toPropertyKey,tv);if(bench){SC.Benchmark.start(this.toString()+"<-")}}},sync:function(){if(!this.isConnected){return this}if(this._connectionPending){this._syncOnConnect=true}else{this._computeBindingTargets();var target=this._fromTarget,key=this._fromPropertyKey;if(!target||!key){return this}var v=target.getPath(key);if(v!==this._bindingValue){this._setBindingValue(target,key);this._changePending=true;SC.Binding._changeQueue.add(this)}}return this},_syncOnConnect:false,_computeBindingTargets:function(){if(!this._fromTarget){var path,root,tuple;path=this._fromPropertyPath;root=this._fromRoot;if(SC.typeOf(path)===SC.T_STRING){if(path.indexOf(".")===0){path=path.slice(1);if(!root){root=this._toRoot}}else{if(path.indexOf("*")===0){path=[root||this._toRoot,path.slice(1)];root=null}}}tuple=SC.tupleForPropertyPath(path,root);if(tuple){this._fromTarget=tuple[0];this._fromPropertyKey=tuple[1]}}if(!this._toTarget){path=this._toPropertyPath;root=this._toRoot;tuple=SC.tupleForPropertyPath(path,root);if(tuple){this._toTarget=tuple[0];this._toPropertyKey=tuple[1]}}},oneWay:function(fromPath,aFlag){if((aFlag===undefined)&&(SC.typeOf(fromPath)===SC.T_BOOL)){aFlag=fromPath;fromPath=null}var binding=this.from(fromPath);if(binding===SC.Binding){binding=binding.beget()}binding._oneWay=(aFlag===undefined)?true:aFlag;return binding},transform:function(transformFunc){var binding=(this===SC.Binding)?this.beget():this;var t=binding._transforms;if(t&&(t===binding.parentBinding._transform)){t=binding._transforms=t.slice()}if(!t){t=binding._transforms=[]}t.push(transformFunc);return binding},resetTransforms:function(){var binding=(this===SC.Binding)?this.beget():this;binding._transforms=null;return binding},noError:function(fromPath,aFlag){if((aFlag===undefined)&&(SC.typeOf(fromPath)===SC.T_BOOL)){aFlag=fromPath;fromPath=null}var binding=this.from(fromPath);if(binding===SC.Binding){binding=binding.beget()}binding._noError=(aFlag===undefined)?true:aFlag;return binding},single:function(fromPath,placeholder){if(placeholder===undefined){placeholder=SC.MULTIPLE_PLACEHOLDER}return this.from(fromPath).transform(function(value,isForward){if(value&&value.isEnumerable){var len=value.get("length");value=(len>1)?placeholder:(len<=0)?null:value.firstObject()}return value})},notEmpty:function(fromPath,placeholder){if(placeholder===undefined){placeholder=SC.EMPTY_PLACEHOLDER}return this.from(fromPath).transform(function(value,isForward){if(SC.none(value)||(value==="")||(SC.isArray(value)&&value.length===0)){value=placeholder}return value})},notNull:function(fromPath,placeholder){if(placeholder===undefined){placeholder=SC.EMPTY_PLACEHOLDER}return this.from(fromPath).transform(function(value,isForward){if(SC.none(value)){value=placeholder}return value})},multiple:function(fromPath){return this.from(fromPath).transform(function(value){if(!SC.isArray(value)){value=(value==null)?[]:[value]}return value})},bool:function(fromPath){return this.from(fromPath).transform(function(v){var t=SC.typeOf(v);if(t===SC.T_ERROR){return v}return(t==SC.T_ARRAY)?(v.length>0):(v==="")?false:!!v})},and:function(pathA,pathB){var gate=SC.Object.create({valueABinding:pathA,valueBBinding:pathB,and:function(){return(this.get("valueA")&&this.get("valueB"))}.property("valueA","valueB").cacheable()});return this.from("and",gate).oneWay()},or:function(pathA,pathB){var gate=SC.Object.create({valueABinding:pathA,valueBBinding:pathB,or:function(){return(this.get("valueA")||this.get("valueB"))}.property("valueA","valueB").cacheable()});return this.from("or",gate).oneWay()},not:function(fromPath){return this.from(fromPath).transform(function(v){var t=SC.typeOf(v);if(t===SC.T_ERROR){return v}return !((t==SC.T_ARRAY)?(v.length>0):(v==="")?false:!!v)})},isNull:function(fromPath){return this.from(fromPath).transform(function(v){var t=SC.typeOf(v);return(t===SC.T_ERROR)?v:SC.none(v)})},toString:function(){var from=this._fromRoot?"<%@>:%@".fmt(this._fromRoot,this._fromPropertyPath):this._fromPropertyPath;var to=this._toRoot?"<%@>:%@".fmt(this._toRoot,this._toPropertyPath):this._toPropertyPath;var oneWay=this._oneWay?"[oneWay]":"";return"SC.Binding%@(%@ -> %@)%@".fmt(SC.guidFor(this),from,to,oneWay)}};SC.binding=function(path,root){return SC.Binding.from(path,root)}});tiki.module("sproutcore/runtime:system/cookie",function(require,exports,module,tiki){var SC=require("core");require("system/object");SC.Cookie=SC.Object.extend({name:null,value:"",expires:null,path:null,domain:null,secure:false,isCookie:true,destroy:function(){this.set("expires",-1);this.write();arguments.callee.base.apply(this,arguments)},write:function(){var name=this.get("name"),value=this.get("value"),expires=this.get("expires"),path=this.get("path"),domain=this.get("domain"),secure=this.get("secure");var expiresOutput="";if(expires&&(SC.typeOf(expires)===SC.T_NUMBER||(SC.DateTime&&expires.get&&expires.get("milliseconds"))||SC.typeOf(expires.toUTCString)===SC.T_FUNCTION)){var date;if(SC.typeOf(expires)===SC.T_NUMBER){date=new Date();date.setTime(date.getTime()+(expires*24*60*60*1000))}else{if(SC.DateTime&&expires.get&&expires.get("milliseconds")){date=new Date(expires.get("milliseconds"))}else{if(SC.typeOf(expires.toUTCString)===SC.T_FUNCTION){date=expires}}}if(date){expiresOutput="; expires="+date.toUTCString()}}var pathOutput=path?"; path="+path:"";var domainOutput=domain?"; domain="+domain:"";var secureOutput=secure?"; secure":"";document.cookie=[name,"=",encodeURIComponent(value),expiresOutput,pathOutput,domainOutput,secureOutput].join("");return this}});SC.Cookie.mixin({find:function(name){if(document.cookie&&(document.cookie!=="")){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=String(cookies[i]).trim();if(cookie.substring(0,name.length+1)===(name+"=")){return SC.Cookie.create({name:name,value:decodeURIComponent(cookie.substring(name.length+1))})}}}return null}})});tiki.module("sproutcore/runtime:system/enumerator",function(require,exports,module,tiki){var SC=require("core");SC.Enumerator=function(enumerableObject){this.enumerable=enumerableObject;this.reset();return this};SC.Enumerator.prototype={nextObject:function(){var index=this._index;var len=this._length;if(index>=len){return undefined}var ret=this.enumerable.nextObject(index,this._previousObject,this._context);this._previousObject=ret;this._index=index+1;if(index>=len){this._context=SC.Enumerator._pushContext(this._context)}return ret},reset:function(){var e=this.enumerable;if(!e){throw SC.$error("Enumerator has been destroyed")}this._length=e.get?e.get("length"):e.length;var len=this._length;this._index=0;this._previousObject=null;this._context=(len>0)?SC.Enumerator._popContext():null},destroy:function(){this.enumerable=this._length=this._index=this._previousObject=this._context=null}};SC.Enumerator.create=function(enumerableObject){return new SC.Enumerator(enumerableObject)};SC.Enumerator._popContext=function(){var ret=this._contextCache?this._contextCache.pop():null;return ret||{}};SC.Enumerator._pushContext=function(context){this._contextCache=this._contextCache||[];var cache=this._contextCache;cache.push(context);return null}});tiki.module("sproutcore/runtime:system/error",function(require,exports,module,tiki){var SC=require("core");SC.Error=SC.Object.extend({code:-1,message:"",errorValue:null,errorObject:function(){return this}.property().cacheable(),label:null,toString:function(){return"SC.Error:%@:%@ (%@)".fmt(SC.guidFor(this),this.get("message"),this.get("code"))},isError:true});SC.Error.desc=function(description,label,value,code){var opts={message:description};if(label!==undefined){opts.label=label}if(code!==undefined){opts.code=code}if(value!==undefined){opts.errorValue=value}return this.create(opts)};SC.$error=function(description,label,value,c){return SC.Error.desc(description,label,value,c)};SC.ok=function(ret){return(ret!==false)&&!(ret&&ret.isError)};SC.$ok=SC.ok;SC.val=function(obj){if(obj&&obj.isError){return obj.get?obj.get("errorValue"):null}else{return obj}};SC.$val=SC.val;SC.Error.HAS_MULTIPLE_VALUES=-100});tiki.module("sproutcore/runtime:system/index_set",function(require,exports,module,tiki){var SC=require("core");require("mixins/enumerable");require("mixins/observable");require("mixins/freezable");require("mixins/copyable");SC.IndexSet=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,SC.Copyable,{_sc_sliceContent:function(c){if(c.length<1000){return c.slice()}var cur=0,ret=[],next=c[0];while(next!==0){ret[cur]=next;cur=(next<0)?(0-next):next;next=c[cur]}ret[cur]=0;this._hint(0,cur,ret);return ret},create:function(start,length){var ret=SC.beget(this);ret.initObservable();if(start&&start.isIndexSet){ret._content=this._sc_sliceContent(start._content);ret.max=start.max;ret.length=start.length;ret.source=start.source}else{ret._content=[0];if(start!==undefined){ret.add(start,length)}}return ret},isIndexSet:true,HINT_SIZE:256,length:0,max:0,min:function(){var content=this._content,cur=content[0];return(cur===0)?-1:(cur>0)?0:Math.abs(cur)}.property("[]").cacheable(),firstObject:function(){return(this.get("length")>0)?this.get("min"):undefined}.property(),rangeStartForIndex:function(index){var content=this._content,max=this.get("max"),ret,next,accel;if(index>=max){return max}if(Math.abs(content[index])>index){return index}accel=index-(index%SC.IndexSet.HINT_SIZE);ret=content[accel];if(ret<0||ret>index){ret=accel}next=Math.abs(content[ret]);while(next<index){ret=next;next=Math.abs(content[ret])}return ret},isEqual:function(obj){if(obj===this){return true}if(!obj||!obj.isIndexSet||(obj.max!==this.max)||(obj.length!==this.length)){return false}var lcontent=this._content,rcontent=obj._content,cur=0,next=lcontent[cur];do{if(rcontent[cur]!==next){return false}cur=Math.abs(next);next=lcontent[cur]}while(cur!==0);return true},indexBefore:function(index){if(index===0){return -1}index--;var content=this._content,max=this.get("max"),start=this.rangeStartForIndex(index);if(!content){return null}while((start===max)||(content[start]<0)){if(start===0){return -1}index=start-1;start=this.rangeStartForIndex(index)}return index},indexAfter:function(index){var content=this._content,max=this.get("max"),start,next;if(!content||(index>=max)){return -1}index++;start=this.rangeStartForIndex(index);next=content[start];while(next<0){if(next===0){return -1}index=start=Math.abs(next);next=content[start]}return index},contains:function(start,length){var content,cur,next,rstart,rnext;if(length===undefined){if(start===null||start===undefined){return false}if(typeof start===SC.T_NUMBER){length=1}else{if(start&&start.isIndexSet){if(start===this){return true}content=start._content;cur=0;next=content[cur];while(next!==0){if((next>0)&&!this.contains(cur,next-cur)){return false}cur=Math.abs(next);next=content[cur]}return true}else{length=start.length;start=start.start}}}rstart=this.rangeStartForIndex(start);rnext=this._content[rstart];return(rnext>0)&&(rstart<=start)&&(rnext>=(start+length))},intersects:function(start,length){var content,cur,next,lim;if(length===undefined){if(typeof start===SC.T_NUMBER){length=1}else{if(start&&start.isIndexSet){if(start===this){return true}content=start._content;cur=0;next=content[cur];while(next!==0){if((next>0)&&this.intersects(cur,next-cur)){return true}cur=Math.abs(next);next=content[cur]}return false}else{length=start.length;start=start.start}}}cur=this.rangeStartForIndex(start);content=this._content;next=content[cur];lim=start+length;while(cur<lim){if(next===0){return false}if((next>0)&&(next>start)){return true}cur=Math.abs(next);next=content[cur]}return false},without:function(start,length){if(start===this){return SC.IndexSet.create()}return this.clone().remove(start,length)},replace:function(start,length){if(length===undefined){if(typeof start===SC.T_NUMBER){length=1}else{if(start&&start.isIndexSet){this._content=this._sc_sliceContent(start._content);this.beginPropertyChanges().set("max",start.max).set("length",start.length).set("source",start.source).enumerableContentDidChange().endPropertyChanges();return this}else{length=start.length;start=start.start}}}var oldlen=this.length;this._content.length=1;this._content[0]=0;this.length=this.max=0;return this.add(start,length)},add:function(start,length){if(this.isFrozen){throw SC.FROZEN_ERROR}var content,cur,next;if(start&&start.isIndexSet){content=start._content;if(!content){return this}cur=0;next=content[0];while(next!==0){if(next>0){this.add(cur,next-cur)}cur=next<0?0-next:next;next=content[cur]}return this}else{if(length===undefined){if(start===null||start===undefined){return this}else{if(typeof start===SC.T_NUMBER){length=1}else{length=start.length;start=start.start}}}else{if(length===null){length=1}}}if(length<=0){return this}var max=this.get("max"),oldmax=max,delta,value;content=this._content;if(start===max){if(start>0){cur=this.rangeStartForIndex(start-1);next=content[cur];if(next>0){delete content[max];content[cur]=max=start+length;start=cur}else{content[max]=max=start+length}}else{content[start]=max=length}content[max]=0;this.set("max",max);this.set("length",this.length+length);length=max-start}else{if(start>max){content[max]=0-start;content[start]=start+length;content[start+length]=0;this.set("max",start+length);this.set("length",this.length+length);length=start+length-max;start=max}else{cur=this.rangeStartForIndex(start);next=content[cur];max=start+length;delta=0;if((start>0)&&(cur===start)&&(next<=0)){cur=this.rangeStartForIndex(start-1);next=content[cur]}if(next<0){content[cur]=0-start;if(Math.abs(next)>max){content[start]=0-max;content[max]=next}else{content[start]=next}}else{start=cur;if(next>max){max=next}}cur=start;while(cur<max){value=content[cur];if(value===0){content[max]=0;next=max;delta+=max-cur}else{next=Math.abs(value);if(next>max){content[max]=value;next=max}if(value<0){delta+=next-cur}}delete content[cur];cur=next}if((cur=content[max])>0){delete content[max];max=cur}content[start]=max;if(max>oldmax){this.set("max",max)}this.set("length",this.get("length")+delta);length=max-start}}this._hint(start,length);if(delta!==0){this.enumerableContentDidChange()}return this},remove:function(start,length){if(this.isFrozen){throw SC.FROZEN_ERROR}if(length===undefined){if(start===null||start===undefined){return this}else{if(typeof start===SC.T_NUMBER){length=1}else{if(start.isIndexSet){start.forEachRange(this.remove,this);return this}else{length=start.length;start=start.start}}}}if(length<=0){return this}var max=this.get("max"),oldmax=max,content=this._content,cur,next,delta,value,last;if(start>=max){return this}cur=this.rangeStartForIndex(start);next=content[cur];last=start+length;delta=0;if((start>0)&&(cur===start)&&(next>0)){cur=this.rangeStartForIndex(start-1);next=content[cur]}if(next>0){content[cur]=start;if(next>last){content[start]=last;content[last]=next}else{content[start]=next}}else{start=cur;next=Math.abs(next);if(next>last){last=next}}cur=start;while(cur<last){value=content[cur];if(value===0){content[last]=0;next=last}else{next=Math.abs(value);if(next>last){content[last]=value;next=last}if(value>0){delta+=next-cur}}delete content[cur];cur=next}if((cur=content[last])<0){delete content[last];last=Math.abs(cur)}if(content[last]===0){delete content[last];content[start]=0;this.set("max",start)}else{content[start]=0-last}this.set("length",this.get("length")-delta);length=last-start;this._hint(start,length);if(delta!==0){this.enumerableContentDidChange()}return this},_hint:function(start,length,content){if(content===undefined){content=this._content}var skip=SC.IndexSet.HINT_SIZE,next=Math.abs(content[start]),loc=start-(start%skip)+skip,lim=start+length;while(loc<lim){while((next!==0)&&(next<=loc)){start=next;next=Math.abs(content[start])}if(next===0){delete content[loc]}else{if(loc!==start){content[loc]=start}}loc+=skip}},clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}var oldlen=this.length;this._content.length=1;this._content[0]=0;this.set("length",0).set("max",0);if(oldlen>0){this.enumerableContentDidChange()}},addEach:function(objects){if(this.isFrozen){throw SC.FROZEN_ERROR}this.beginPropertyChanges();var idx=objects.get("length");if(objects.isSCArray){while(--idx>=0){this.add(objects.objectAt(idx))}}else{if(objects.isEnumerable){objects.forEach(function(idx){this.add(idx)},this)}}this.endPropertyChanges();return this},removeEach:function(objects){if(this.isFrozen){throw SC.FROZEN_ERROR}this.beginPropertyChanges();var idx=objects.get("length");if(objects.isSCArray){while(--idx>=0){this.remove(objects.objectAt(idx))}}else{if(objects.isEnumerable){objects.forEach(function(idx){this.remove(idx)},this)}}this.endPropertyChanges();return this},clone:function(){return SC.IndexSet.create(this)},inspect:function(){var content=this._content,len=content.length,idx=0,ret=[],item;for(idx=0;idx<len;idx++){item=content[idx];if(item!==undefined){ret.push("%@:%@".fmt(idx,item))}}return"SC.IndexSet<%@>".fmt(ret.join(" , "))},forEachRange:function(callback,target){var content=this._content,cur=0,next=content[cur],source=this.source;if(target===undefined){target=null}while(next!==0){if(next>0){callback.call(target,cur,next-cur,this,source)}cur=Math.abs(next);next=content[cur]}return this},forEachIn:function(start,length,callback,target){var content=this._content,cur=0,idx=0,lim=start+length,source=this.source,next=content[cur];if(target===undefined){target=null}while(next!==0){if(cur<start){cur=start}while((cur<next)&&(cur<lim)){callback.call(target,cur++,idx++,this,source)}if(cur>=lim){cur=next=0}else{cur=Math.abs(next);next=content[cur]}}return this},lengthIn:function(start,length){var ret=0;if(length===undefined){if(start===null||start===undefined){return 0}else{if(typeof start===SC.T_NUMBER){length=1}else{if(start.isIndexSet){start.forEachRange(function(start,length){ret+=this.lengthIn(start,length)},this);return ret}else{length=start.length;start=start.start}}}}if(this.get("length")===0){return 0}var content=this._content,cur=0,next=content[cur],lim=start+length;while(cur<lim&&next!==0){if(next>0){ret+=(next>lim)?lim-cur:next-cur}cur=Math.abs(next);next=content[cur]}return ret},source:null,indexOf:function(object,startAt){var source=this.source;if(!source){throw"%@.indexOf() requires source".fmt(this)}var len=source.get("length"),content=this._content,cur=content[0]<0?Math.abs(content[0]):0,idx;while(cur>=0&&cur<len){idx=source.indexOf(object,cur);if(idx<0){return -1}if(this.contains(idx)){return idx}cur=idx+1}return -1},lastIndexOf:function(object,startAt){var source=this.source;if(!source){throw"%@.lastIndexOf() requires source".fmt(this)}var len=source.get("length"),cur=this.max-1,idx;if(cur>=len){cur=len-1}while(cur>=0){idx=source.lastIndexOf(object,cur);if(idx<0){return -1}if(this.contains(idx)){return idx}cur=idx+1}return -1},forEachObject:function(callback,target){var source=this.source;if(!source){throw"%@.forEachObject() requires source".fmt(this)}var content=this._content,cur=0,idx=0,next=content[cur];if(target===undefined){target=null}while(next!==0){while(cur<next){callback.call(target,source.objectAt(cur),cur,source,this);cur++}cur=Math.abs(next);next=content[cur]}return this},addObject:function(object,firstOnly){var source=this.source;if(!source){throw"%@.addObject() requires source".fmt(this)}var len=source.get("length"),cur=0,idx;while(cur>=0&&cur<len){idx=source.indexOf(object,cur);if(idx>=0){this.add(idx);if(firstOnly){return this}cur=idx++}else{return this}}return this},addObjects:function(objects,firstOnly){objects.forEach(function(object){this.addObject(object,firstOnly)},this);return this},removeObject:function(object,firstOnly){var source=this.source;if(!source){throw"%@.removeObject() requires source".fmt(this)}var len=source.get("length"),cur=0,idx;while(cur>=0&&cur<len){idx=source.indexOf(object,cur);if(idx>=0){this.remove(idx);if(firstOnly){return this}cur=idx+1}else{return this}}return this},removeObjects:function(objects,firstOnly){objects.forEach(function(object){this.removeObject(object,firstOnly)},this);return this},LOG_OBSERVING:false,forEach:function(callback,target){var content=this._content,cur=0,idx=0,source=this.source,next=content[cur];if(target===undefined){target=null}while(next!==0){while(cur<next){callback.call(target,cur++,idx++,this,source)}cur=Math.abs(next);next=content[cur]}return this},nextObject:function(ignore,idx,context){var content=this._content,next=context.next,max=this.get("max");if(idx===null){idx=next=0}else{if(idx>=max){delete context.next;return null}else{idx++}}if(idx===next){do{idx=Math.abs(next);next=content[idx]}while(next<0);context.next=next}return idx},toString:function(){var str=[];this.forEachRange(function(start,length){str.push(length===1?start:"%@..%@".fmt(start,start+length-1))},this);return"SC.IndexSet<%@>".fmt(str.join(","))},max:0});SC.IndexSet.slice=SC.IndexSet.copy=SC.IndexSet.clone;SC.IndexSet.EMPTY=SC.IndexSet.create().freeze()});tiki.module("sproutcore/runtime:system/logger",function(require,exports,module,tiki){SC.LOGGER_LOG_DELIMITER=", ";SC.LOGGER_LOG_ERROR="ERROR: ";SC.LOGGER_LOG_INFO="INFO: ";SC.LOGGER_LOG_WARN="WARNING: ";SC.LOGGER_LOG_DEBUG="DEBUG: ";SC.Logger=SC.Object.create({debugEnabled:false,exists:function(){return typeof(this.get("reporter"))!=="undefined"&&this.get("reporter")!=null}.property("reporter").cacheable(),fallBackOnAlert:false,fallBackOnLog:true,format:true,reporter:console,log:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.log)==="function"){if(this.get("format")){reporter.log(this._argumentsToString.apply(this,arguments))}else{reporter.log.apply(reporter,arguments)}return true}else{if(this.fallBackOnAlert){var s=this.get("format")?this._argumentsToString.apply(this,arguments):arguments;if(this.get("exists")&&typeof(reporter.alert)==="function"){reporter.alert(s)}else{alert(s)}return true}}return false},debug:function(){var reporter=this.get("reporter");if(this.get("debugEnabled")!==true){return false}if(this.get("exists")&&(typeof reporter.debug==="function")){reporter.debug.apply(reporter,arguments);return true}else{if(this.fallBackOnLog){var a=this._argumentsToArray(arguments);if(typeof(a.unshift)==="function"){a.unshift(SC.LOGGER_LOG_DEBUG)}return this.log.apply(this,a)}}return false},dir:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.dir)==="function"){reporter.dir.apply(reporter,arguments);return true}return(this.fallBackOnLog)?this.log.apply(this,arguments):false},dirxml:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.dirxml)==="function"){reporter.dirxml.apply(reporter,arguments);return true}return(this.fallBackOnLog)?this.log.apply(this,arguments):false},error:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.error)==="function"){reporter.error.apply(reporter,arguments);return true}else{if(this.fallBackOnLog){var a=this._argumentsToArray(arguments);if(typeof(a.unshift)==="function"){a.unshift(SC.LOGGER_LOG_ERROR)}return this.log.apply(this,a)}}return false},group:function(s){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.group)==="function"){reporter.group(s);return true}return false},groupEnd:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.groupEnd)==="function"){reporter.groupEnd();return true}return false},info:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.info)==="function"){reporter.info.apply(reporter,arguments);return true}else{if(this.fallBackOnLog){var a=this._argumentsToArray(arguments);if(typeof(a.unshift)==="function"){a.unshift(SC.LOGGER_LOG_INFO)}return this.log.apply(this,a)}}return false},profile:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.profile)==="function"){reporter.profile();return true}return false},profileEnd:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.profileEnd)==="function"){reporter.profileEnd();return true}return false},time:function(name){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.time)==="function"){reporter.time(name);return true}return false},timeEnd:function(name){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.timeEnd)==="function"){reporter.timeEnd(name);return true}return false},trace:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.trace)==="function"){reporter.trace();return true}return false},warn:function(){var reporter=this.get("reporter");if(this.get("exists")&&typeof(reporter.warn)==="function"){reporter.warn.apply(reporter,arguments);return true}else{if(this.fallBackOnLog){var a=this._argumentsToArray(arguments);if(typeof(a.unshift)==="function"){a.unshift(SC.LOGGER_LOG_WARN)}return this.log.apply(this,a)}}return false},_argumentsToArray:function(arguments){if(!arguments){return[]}var a=[];for(var i=0;i<arguments.length;i++){a[i]=arguments[i]}return a},_argumentsToString:function(){var s="";for(var i=0;i<arguments.length-1;i++){s+=arguments[i]+SC.LOGGER_LOG_DELIMITER}s+=arguments[arguments.length-1];return s}})});tiki.module("sproutcore/runtime:system/object",function(require,exports,module,tiki){var SC=require("core");require("mixins/observable");require("system/set");SC.BENCHMARK_OBJECTS=false;SC._object_extend=function _object_extend(base,ext){if(!ext){throw"SC.Object.extend expects a non-null value.  Did you forget to 'sc_require' something?  Or were you passing a Protocol to extend() as if it were a mixin?"}base._kvo_cloned=null;var key,idx,len,cur,cprops=base.concatenatedProperties,K=SC.K;var p1,p2;idx=(cprops)?cprops.length:0;var concats=(idx>0)?{}:null;while(--idx>=0){key=cprops[idx];p1=base[key];p2=ext[key];if(p1){if(!(p1 instanceof Array)){p1=SC.$A(p1)}concats[key]=(p2)?p1.concat(p2):p2}else{if(!(p2 instanceof Array)){p2=SC.$A(p2)}concats[key]=p2}}var bindings=base._bindings,clonedBindings=false;var observers=base._observers,clonedObservers=false;var properties=base._properties,clonedProperties=false;var paths,pathLoc,local;var outlets=base.outlets,clonedOutlets=false;if(ext.outlets){outlets=(outlets||SC.EMPTY_ARRAY).concat(ext.outlets);clonedOutlets=true}for(key in ext){if(key==="_kvo_cloned"){continue}if(!ext.hasOwnProperty(key)){continue}var value=(concats.hasOwnProperty(key)?concats[key]:null)||ext[key];if(key.slice(-7)==="Binding"){if(!clonedBindings){bindings=(bindings||SC.EMPTY_ARRAY).slice();clonedBindings=true}if(bindings===null){bindings=(base._bindings||SC.EMPTY_ARRAY).slice()}bindings[bindings.length]=key}else{if(value&&(value instanceof Function)){if(!value.superclass&&(value!==(cur=base[key]))){value.superclass=value.base=cur||K}if(value.propertyPaths){if(!clonedObservers){observers=(observers||SC.EMPTY_ARRAY).slice();clonedObservers=true}observers[observers.length]=key}else{if(paths=value.localPropertyPaths){pathLoc=paths.length;while(--pathLoc>=0){local=base._kvo_for(SC.keyFor("_kvo_local",paths[pathLoc]),SC.Set);local.add(key);base._kvo_for("_kvo_observed_keys",SC.CoreSet).add(paths[pathLoc])}}else{if(value.dependentKeys){if(!clonedProperties){properties=(properties||SC.EMPTY_ARRAY).slice();clonedProperties=true}properties[properties.length]=key}else{if(value.autoconfiguredOutlet){if(!clonedOutlets){outlets=(outlets||SC.EMPTY_ARRAY).slice();clonedOutlets=true}outlets[outlets.length]=key}}}}}}base[key]=value}if(ext.hasOwnProperty("toString")){key="toString";value=(concats.hasOwnProperty(key)?concats[key]:null)||ext[key];if(!value.superclass&&(value!==(cur=base[key]))){value.superclass=value.base=cur||K}base[key]=value}base._bindings=bindings||[];base._observers=observers||[];base._properties=properties||[];base.outlets=outlets||[];return base};SC.Object=function(props){return this._object_init(props)};SC.mixin(SC.Object,{mixin:function(props){var len=arguments.length,loc;for(loc=0;loc<len;loc++){SC.mixin(this,arguments[loc])}return this},superclass:null,extend:function(props){var bench=SC.BENCHMARK_OBJECTS;if(bench){SC.Benchmark.start("SC.Object.extend")}var prop,ret=function(props){return this._object_init(props)};for(prop in this){if(!this.hasOwnProperty(prop)){continue}ret[prop]=this[prop]}if(this.hasOwnProperty("toString")){ret.toString=this.toString}ret.superclass=this;SC.generateGuid(ret);ret.subclasses=SC.Set.create();this.subclasses.add(ret);var base=(ret.prototype=SC.beget(this.prototype));var idx,len=arguments.length;for(idx=0;idx<len;idx++){SC._object_extend(base,arguments[idx])}base.constructor=ret;if(bench){SC.Benchmark.end("SC.Object.extend")}return ret},create:function(props){var C=this;return new C(arguments)},isClass:true,subclasses:SC.Set.create(),toString:function(){return SC._object_className(this)},subclassOf:function(scClass){if(this===scClass){return false}var t=this;while(t=t.superclass){if(t===scClass){return true}}return false},hasSubclass:function(scClass){return(scClass&&scClass.subclassOf)?scClass.subclassOf(this):false},kindOf:function(scClass){return(this===scClass)||this.subclassOf(scClass)}});SC.Object.prototype={_kvo_enabled:true,_object_init:function(extensions){var idx,len=(extensions)?extensions.length:0;for(idx=0;idx<len;idx++){SC._object_extend(this,extensions[idx])}SC.generateGuid(this);this.init();var inits=this.initMixin;len=(inits)?inits.length:0;for(idx=0;idx<len;idx++){inits[idx].call(this)}return this},mixin:function(){var idx,len=arguments.length;for(idx=0;idx<len;idx++){SC.mixin(this,arguments[idx])}for(idx=0;idx<len;idx++){var init=arguments[idx].initMixin;if(init){init.call(this)}}return this},init:function(){this.initObservable();return this},isDestroyed:false,destroy:function(){if(this.get("isDestroyed")){return this}this.set("isDestroyed",true);var idx,inits=this.destroyMixin,len=(inits)?inits.length:0;for(idx=0;idx<len;idx++){inits[idx].call(this)}return this},isObject:true,respondsTo:function(methodName){return !!(SC.typeOf(this[methodName])===SC.T_FUNCTION)},tryToPerform:function(methodName,arg1,arg2){return this.respondsTo(methodName)&&(this[methodName](arg1,arg2)!==false)},superclass:function(args){var caller=arguments.callee.caller;if(!caller){throw"superclass cannot determine the caller method"}return caller.superclass?caller.superclass.apply(this,arguments):null},instanceOf:function(scClass){return this.constructor===scClass},kindOf:function(scClass){return this.constructor.kindOf(scClass)},toString:function(){if(!this._object_toString){var klassName=SC._object_className(this.constructor);var string="%@:%@".fmt(klassName,SC.guidFor(this));if(klassName){this._object_toString=string}else{return string}}return this._object_toString},awake:function(key){this.outlets.forEach(function(key){this.get(key)},this);this.bindings.invoke("sync")},invokeOnce:function(method){SC.RunLoop.currentRunLoop.invokeOnce(this,method);return this},invokeLast:function(method){SC.RunLoop.currentRunLoop.invokeLast(this,method);return this},concatenatedProperties:["concatenatedProperties","initMixin","destroyMixin"]};SC.Object.prototype.constructor=SC.Object;SC.mixin(SC.Object.prototype,SC.Observable);function findClassNames(){if(SC._object_foundObjectClassNames){return}SC._object_foundObjectClassNames=true;var seen=[];var searchObject=function(root,object,levels){levels--;if(seen.indexOf(object)>=0){return}seen.push(object);for(var key in object){if(key=="__scope__"){continue}if(key=="superclass"){continue}if(!key.match(/^[A-Z0-9]/)){continue}var path=(root)?[root,key].join("."):key;var value=object[key];switch(SC.typeOf(value)){case SC.T_CLASS:if(!value._object_className){value._object_className=path}if(levels>=0){searchObject(path,value,levels)}break;case SC.T_OBJECT:if(levels>=0){searchObject(path,value,levels)}break;case SC.T_HASH:if(((root)||(path==="SC"))&&(levels>=0)){searchObject(path,value,levels)}break;default:break}}};searchObject(null,require("system","default").global,2)}SC.instanceOf=function(scObject,scClass){return !!(scObject&&scObject.constructor===scClass)};SC.kindOf=function(scObject,scClass){if(scObject&&!scObject.isClass){scObject=scObject.constructor}return !!(scObject&&scObject.kindOf&&scObject.kindOf(scClass))};SC._object_className=function(obj){if(!SC.isReady){return""}if(!obj._object_className){findClassNames()}if(obj._object_className){return obj._object_className}var ret=obj;while(ret&&!ret._object_className){ret=ret.superclass}return(ret&&ret._object_className)?ret._object_className:"Anonymous"}});tiki.module("sproutcore/runtime:system/range_observer",function(require,exports,module,tiki){var SC=require("core");require("private/observer_queue");require("system/index_set");SC.RangeObserver={isRangeObserver:true,toString:function(){var base=this.indexes?this.indexes.toString():"SC.IndexSet<..>";return base.replace("IndexSet","RangeObserver(%@)".fmt(SC.guidFor(this)))},create:function(source,indexSet,target,method,context,isDeep){var ret=SC.beget(this);ret.source=source;ret.indexes=indexSet?indexSet.frozenCopy():null;ret.target=target;ret.method=method;ret.context=context;ret.isDeep=isDeep||false;ret.beginObserving();return ret},extend:function(attrs){var ret=SC.beget(this),args=arguments,len=args.length,idx;for(idx=0;idx<len;idx++){SC.mixin(ret,args[idx])}return ret},destroy:function(source){this.endObserving();return this},update:function(source,indexSet){if(this.indexes&&this.indexes.isEqual(indexSet)){return this}this.indexes=indexSet?indexSet.frozenCopy():null;this.endObserving().beginObserving();return this},beginObserving:function(){if(!this.isDeep){return this}var observing=this.observing;if(!observing){observing=this.observing=SC.CoreSet.create()}var func=this._beginObservingForEach;if(!func){func=this._beginObservingForEach=function(idx){var obj=this.source.objectAt(idx);if(obj&&obj.addObserver){observing.push(obj);obj._kvo_needsRangeObserver=true}}}this.indexes.forEach(func,this);this.isObserving=false;SC.Observers.addPendingRangeObserver(this);return this},setupPending:function(object){var observing=this.observing;if(this.isObserving||!observing||(observing.get("length")===0)){return true}if(observing.contains(object)){this.isObserving=true;var func=this._setupPendingForEach;if(!func){var source=this.source,method=this.objectPropertyDidChange;func=this._setupPendingForEach=function(idx){var obj=this.source.objectAt(idx),guid=SC.guidFor(obj),key;if(obj&&obj.addObserver){observing.push(obj);obj.addObserver("*",this,method);key=this[guid];if(key===undefined||key===null){this[guid]=idx}else{if(key.isIndexSet){key.add(idx)}else{key=this[guid]=SC.IndexSet.create(key).add(idx)}}}}}this.indexes.forEach(func,this);return true}else{return false}},endObserving:function(){if(!this.isDeep){return this}var observing=this.observing;if(this.isObserving){var meth=this.objectPropertyDidChange,source=this.source,idx,lim,obj;if(observing){lim=observing.length;for(idx=0;idx<lim;idx++){obj=observing[idx];obj.removeObserver("*",this,meth);this[SC.guidFor(obj)]=null}observing.length=0}this.isObserving=false}if(observing){observing.clear()}return this},rangeDidChange:function(changes){var indexes=this.indexes;if(!changes||!indexes||indexes.intersects(changes)){this.endObserving();this.method.call(this.target,this.source,null,"[]",changes,this.context);this.beginObserving()}return this},objectPropertyDidChange:function(object,key,value,rev){var context=this.context,method=this.method,guid=SC.guidFor(object),index=this[guid];if(index&&!index.isIndexSet){index=this[guid]=SC.IndexSet.create(index).freeze()}if(context){method.call(this.target,this.source,object,key,index,context,rev)}else{method.call(this.target,this.source,object,key,index,rev)}}}});tiki.module("sproutcore/runtime:system/run_loop",function(require,exports,module,tiki){var SC=require("core");require("private/observer_set");require("system/object");SC.RunLoop=SC.Object.extend({beginRunLoop:function(){this._start=new Date().getTime();if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){SC.Logger.log("-- SC.RunLoop.beginRunLoop at %@".fmt(this._start))}return this},endRunLoop:function(){var didChange;if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){SC.Logger.log("-- SC.RunLoop.endRunLoop ~ flushing application queues")}do{didChange=this.flushApplicationQueues();if(!didChange){didChange=this._flushinvokeLastQueue()}}while(didChange);this._start=null;if(SC.LOG_BINDINGS||SC.LOG_OBSERVERS){SC.Logger.log("-- SC.RunLoop.endRunLoop ~ End")}return this},invokeOnce:function(target,method){if(method===undefined){method=target;target=this}if(SC.typeOf(method)===SC.T_STRING){method=target[method]}if(!this._invokeQueue){this._invokeQueue=SC.ObserverSet.create()}this._invokeQueue.add(target,method);return this},invokeLast:function(target,method){if(method===undefined){method=target;target=this}if(SC.typeOf(method)===SC.T_STRING){method=target[method]}if(!this._invokeLastQueue){this._invokeLastQueue=SC.ObserverSet.create()}this._invokeLastQueue.add(target,method);return this},flushApplicationQueues:function(){var hadContent=NO,queue=this._invokeQueue;if(queue&&queue.targets>0){this._invokeQueue=null;hadContent=true;queue.invokeMethods()}return SC.Binding.flushPendingChanges()||hadContent},_flushinvokeLastQueue:function(){var queue=this._invokeLastQueue,hadContent=false;if(queue&&queue.targets>0){this._invokeLastQueue=null;hadContent=true;if(hadContent){queue.invokeMethods()}}return hadContent}});SC.RunLoop.currentRunLoop=null;SC.RunLoop.runLoopClass=SC.RunLoop;SC.RunLoop.begin=function(){var runLoop=this.currentRunLoop;if(!runLoop){runLoop=this.currentRunLoop=this.runLoopClass.create()}runLoop.beginRunLoop();return this};SC.RunLoop.end=function(){var runLoop=this.currentRunLoop;if(!runLoop){throw"SC.RunLoop.end() called outside of a runloop!"}runLoop.endRunLoop();return this};SC.run=function(callback,target){SC.RunLoop.begin();callback.call(target);SC.RunLoop.end()}});tiki.module("sproutcore/runtime:system/selection_set",function(require,exports,module,tiki){var SC=require("core");require("system/object");require("mixins/enumerable");require("mixins/copyable");require("mixins/freezable");require("system/set");require("system/index_set");SC.SelectionSet=SC.Object.extend(SC.Enumerable,SC.Freezable,SC.Copyable,{isSelectionSet:true,length:function(){var ret=0,sets=this._sets,objects=this._objects;if(objects){ret+=objects.get("length")}if(sets){sets.forEach(function(s){ret+=s.get("length")})}return ret}.property().cacheable(),sources:function(){var ret=[],sets=this._sets,len=sets?sets.length:0,idx,set,source;for(idx=0;idx<len;idx++){set=sets[idx];if(set&&set.get("length")>0&&set.source){ret.push(set.source)}}return ret}.property().cacheable(),indexSetForSource:function(source){if(!source||!source.isSCArray){return null}var cache=this._indexSetCache,objects=this._objects,ret,idx;if(!cache){cache=this._indexSetCache={}}ret=cache[SC.guidFor(source)];if(ret&&ret._sourceRevision&&(ret._sourceRevision!==source.propertyRevision)){ret=null}if(!ret){ret=this._indexSetForSource(source,false);if(ret&&ret.get("length")===0){ret=null}if(objects){if(ret){ret=ret.copy()}objects.forEach(function(o){if((idx=source.indexOf(o))>=0){if(!ret){ret=SC.IndexSet.create()}ret.add(idx)}},this)}if(ret){ret=cache[SC.guidFor(source)]=ret.frozenCopy();ret._sourceRevision=source.propertyRevision}}return ret},_indexSetForSource:function(source,canCreate){if(canCreate===undefined){canCreate=true}var guid=SC.guidFor(source),index=this[guid],sets=this._sets,len=sets?sets.length:0,ret=null;if(index>=len){index=null}if(SC.none(index)){if(canCreate&&!this.isFrozen){this.propertyWillChange("sources");if(!sets){sets=this._sets=[]}ret=sets[len]=SC.IndexSet.create();ret.source=source;this[guid]=len;this.propertyDidChange("sources")}}else{ret=sets?sets[index]:null}return ret},add:function(source,start,length){if(this.isFrozen){throw SC.FROZEN_ERROR}var sets,len,idx,set,oldlen,newlen,setlen,objects;if(start===undefined&&length===undefined){if(!source){throw"Must pass params to SC.SelectionSet.add()"}if(source.isIndexSet){return this.add(source.source,source)}if(source.isSelectionSet){sets=source._sets;objects=source._objects;len=sets?sets.length:0;this.beginPropertyChanges();for(idx=0;idx<len;idx++){set=sets[idx];if(set&&set.get("length")>0){this.add(set.source,set)}}if(objects){this.addObjects(objects)}this.endPropertyChanges();return this}}set=this._indexSetForSource(source,true);oldlen=this.get("length");setlen=set.get("length");newlen=oldlen-setlen;set.add(start,length);this._indexSetCache=null;newlen+=set.get("length");if(newlen!==oldlen){this.propertyDidChange("length");this.enumerableContentDidChange();if(setlen===0){this.notifyPropertyChange("sources")}}return this},remove:function(source,start,length){if(this.isFrozen){throw SC.FROZEN_ERROR}var sets,len,idx,set,oldlen,newlen,setlen,objects;if(start===undefined&&length===undefined){if(!source){throw"Must pass params to SC.SelectionSet.remove()"}if(source.isIndexSet){return this.remove(source.source,source)}if(source.isSelectionSet){sets=source._sets;objects=source._objects;len=sets?sets.length:0;this.beginPropertyChanges();for(idx=0;idx<len;idx++){set=sets[idx];if(set&&set.get("length")>0){this.remove(set.source,set)}}if(objects){this.removeObjects(objects)}this.endPropertyChanges();return this}}set=this._indexSetForSource(source,true);oldlen=this.get("length");newlen=oldlen-set.get("length");if(set&&(objects=this._objects)){if(length!==undefined){start=SC.IndexSet.create(start,length);length=undefined}objects.forEach(function(object){idx=source.indexOf(object);if(start.contains(idx)){objects.remove(object);newlen--}},this)}set.remove(start,length);setlen=set.get("length");newlen+=setlen;this._indexSetCache=null;if(newlen!==oldlen){this.propertyDidChange("length");this.enumerableContentDidChange();if(setlen===0){this.notifyPropertyChange("sources")}}return this},contains:function(source,start,length){if(start===undefined&&length===undefined){return this.containsObject(source)}var set=this.indexSetForSource(source);if(!set){return false}return set.contains(start,length)},intersects:function(source,start,length){var set=this.indexSetForSource(source,false);if(!set){return false}return set.intersects(start,length)},_TMP_ARY:[],addObject:function(object){var ary=this._TMP_ARY,ret;ary[0]=object;ret=this.addObjects(ary);ary.length=0;return ret},addObjects:function(objects){var cur=this._objects,oldlen,newlen;if(!cur){cur=this._objects=SC.CoreSet.create()}oldlen=cur.get("length");cur.addEach(objects);newlen=cur.get("length");this._indexSetCache=null;if(newlen!==oldlen){this.propertyDidChange("length");this.enumerableContentDidChange()}return this},removeObject:function(object){var ary=this._TMP_ARY,ret;ary[0]=object;ret=this.removeObjects(ary);ary.length=0;return ret},removeObjects:function(objects){var cur=this._objects,oldlen,newlen,sets;if(!cur){return this}oldlen=cur.get("length");cur.removeEach(objects);newlen=cur.get("length");if(sets=this._sets){sets.forEach(function(set){oldlen+=set.get("length");set.removeObjects(objects);newlen+=set.get("length")},this)}this._indexSetCache=null;if(newlen!==oldlen){this.propertyDidChange("length");this.enumerableContentDidChange()}return this},containsObject:function(object){var objects=this._objects;if(objects&&objects.contains(object)){return true}var sets=this._sets,len=sets?sets.length:0,idx,set;for(idx=0;idx<len;idx++){set=sets[idx];if(set&&set.indexOf(object)>=0){return true}}return false},constrain:function(source){var set,len,max,objects;this.beginPropertyChanges();this.get("sources").forEach(function(cur){if(cur===source){return}var set=this._indexSetForSource(source,false);if(set){this.remove(source,set)}},this);set=this._indexSetForSource(source,false);if(set&&((max=set.get("max"))>(len=source.get("length")))){this.remove(source,len,max-len)}if(objects=this._objects){objects.forEach(function(cur){if(source.indexOf(cur)<0){this.removeObject(cur)}},this)}this.endPropertyChanges();return this},isEqual:function(obj){var left,right,idx,len,sources,source;if(!obj||!obj.isSelectionSet){return false}if(obj===this){return true}if((this._sets===obj._sets)&&(this._objects===obj._objects)){return true}if(this.get("length")!==obj.get("length")){return false}left=this._objects;right=obj._objects;if(left||right){if((left?left.get("length"):0)!==(right?right.get("length"):0)){return false}if(left&&!left.isEqual(right)){return false}}sources=this.get("sources");len=sources.get("length");for(idx=0;idx<len;idx++){source=sources.objectAt(idx);left=this._indexSetForSource(source,false);right=this._indexSetForSource(source,false);if(!!right!==!!left){return false}if(left&&!left.isEqual(right)){return false}}return true},clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}if(this._sets){this._sets.length=0}if(this._objects){this._objects=null}this._indexSetCache=null;this.propertyDidChange("length");this.enumerableContentDidChange();this.notifyPropertyChange("sources");return this},copy:function(){var ret=this.constructor.create(),sets=this._sets,len=sets?sets.length:0,idx,set;if(sets&&len>0){sets=ret._sets=sets.slice();for(idx=0;idx<len;idx++){if(!(set=sets[idx])){continue}set=sets[idx]=set.copy();ret[SC.guidFor(set.source)]=idx}}if(this._objects){ret._objects=this._objects.copy()}return ret},freeze:function(){if(this.isFrozen){return this}var sets=this._sets,loc=sets?sets.length:0,set;while(--loc>=0){if(set=sets[loc]){set.freeze()}}if(this._objects){this._objects.freeze()}return arguments.callee.base.apply(this,arguments)},toString:function(){var sets=this._sets||[];sets=sets.map(function(set){return set.toString().replace("SC.IndexSet",SC.guidFor(set.source))},this);if(this._objects){sets.push(this._objects.toString())}return"SC.SelectionSet:%@<%@>".fmt(SC.guidFor(this),sets.join(","))},firstObject:function(){var sets=this._sets,objects=this._objects;if(sets&&sets.get("length")>0){var set=sets?sets[0]:null,src=set?set.source:null,idx=set?set.firstObject():-1;if(src&&idx>=0){return src.objectAt(idx)}}return objects?objects.firstObject():undefined}.property(),nextObject:function(count,lastObject,context){var objects,ret;if(count===0){objects=context.objects=[];this.forEach(function(o){objects.push(o)},this);context.max=objects.length}objects=context.objects;ret=objects[count];if(count+1>=context.max){context.objects=context.max=null}return ret},forEach:function(callback,target){var sets=this._sets,objects=this._objects,len=sets?sets.length:0,set,idx;for(idx=0;idx<len;idx++){set=sets[idx];if(set){set.forEachObject(callback,target)}}if(objects){objects.forEach(callback,target)}return this}});SC.SelectionSet.prototype.clone=SC.SelectionSet.prototype.copy;SC.SelectionSet.EMPTY=SC.SelectionSet.create().freeze()});tiki.module("sproutcore/runtime:system/set",function(require,exports,module,tiki){var SC=require("core");require("mixins/enumerable");require("mixins/copyable");require("mixins/freezable");require("mixins/observable");SC.Set=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,{create:function(items){var ret,idx,pool=SC.Set._pool,isObservable=this.isObservable;if(!isObservable&&items===undefined&&pool.length>0){ret=pool.pop()}else{ret=SC.beget(this);if(isObservable){ret.initObservable()}if(items&&items.isEnumerable&&items.get("length")>0){ret.isObservable=false;if(items.isSCArray){idx=items.get?items.get("length"):items.length;while(--idx>=0){ret.add(items.objectAt(idx))}}else{if(items.isSet){idx=items.length;while(--idx>=0){ret.add(items[idx])}}else{items.forEach(function(i){ret.add(i)},this)}}ret.isObservable=isObservable}}return ret},isSet:true,length:0,firstObject:function(){return(this.length>0)?this[0]:undefined}.property(),clear:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}this.length=0;return this},contains:function(obj){if(obj===null){return false}var idx=this[SC.hashFor(obj)];return(!SC.none(idx)&&(idx<this.length)&&(this[idx]===obj))},isEqual:function(obj){if(!obj||!obj.isSet||(obj.get("length")!==this.get("length"))){return false}var loc=this.get("length");while(--loc>=0){if(!obj.contains(this[loc])){return false}}return true},add:function(obj){if(this.isFrozen){throw SC.FROZEN_ERROR}if(obj===null||obj===undefined){return this}var guid=SC.hashFor(obj);var idx=this[guid];var len=this.length;if((idx===null||idx===undefined)||(idx>=len)||(this[idx]!==obj)){this[len]=obj;this[guid]=len;this.length=len+1}if(this.isObservable){this.enumerableContentDidChange()}return this},addEach:function(objects){if(this.isFrozen){throw SC.FROZEN_ERROR}if(!objects||!objects.isEnumerable){throw"%@.addEach must pass enumerable".fmt(this)}var idx,isObservable=this.isObservable;if(isObservable){this.beginPropertyChanges()}if(objects.isSCArray){idx=objects.get("length");while(--idx>=0){this.add(objects.objectAt(idx))}}else{if(objects.isSet){idx=objects.length;while(--idx>=0){this.add(objects[idx])}}else{objects.forEach(function(i){this.add(i)},this)}}if(isObservable){this.endPropertyChanges()}return this},remove:function(obj){if(this.isFrozen){throw SC.FROZEN_ERROR}if(SC.none(obj)){return this}var guid=SC.hashFor(obj);var idx=this[guid];var len=this.length;if(SC.none(idx)||(idx>=len)||(this[idx]!==obj)){return this}delete this[guid];if(idx<(len-1)){obj=this[idx]=this[len-1];this[SC.hashFor(obj)]=idx}this.length=len-1;if(this.isObservable){this.enumerableContentDidChange()}return this},pop:function(){if(this.isFrozen){throw SC.FROZEN_ERROR}var obj=(this.length>0)?this[this.length-1]:null;if(obj){this.remove(obj)}return obj},removeEach:function(objects){if(this.isFrozen){throw SC.FROZEN_ERROR}if(!objects||!objects.isEnumerable){throw"%@.addEach must pass enumerable".fmt(this)}var idx,isObservable=this.isObservable;if(isObservable){this.beginPropertyChanges()}if(objects.isSCArray){idx=objects.get("length");while(--idx>=0){this.remove(objects.objectAt(idx))}}else{if(objects.isSet){idx=objects.length;while(--idx>=0){this.remove(objects[idx])}}else{objects.forEach(function(i){this.remove(i)},this)}}if(isObservable){this.endPropertyChanges()}return this},copy:function(){return this.constructor.create(this)},destroy:function(){this.isFrozen=false;if(!this.isObservable){SC.Set._pool.push(this.clear())}return this},forEach:function(iterator,target){var len=this.length;if(!target){target=this}for(var idx=0;idx<len;idx++){iterator.call(target,this[idx],idx,this)}return this},toString:function(){var len=this.length,idx,ary=[];for(idx=0;idx<len;idx++){ary[idx]=this[idx]}return"SC.Set<%@>".fmt(ary.join(","))},_pool:[],isObservable:true});SC.Set.constructor=SC.Set;SC.Set.clone=SC.Set.copy;SC.Set.push=SC.Set.unshift=SC.Set.add;SC.Set.shift=SC.Set.pop;SC.Set.addObject=SC.Set.add;SC.Set.removeObject=SC.Set.remove;SC.Set._pool=[];SC.CoreSet=SC.beget(SC.Set);SC.CoreSet.isObservable=false;SC.CoreSet.constructor=SC.CoreSet});tiki.module("sproutcore/runtime:system/sparse_array",function(require,exports,module,tiki){var SC=require("core");require("system/index_set");require("system/object");require("mixins/enumerable");require("mixins/array");require("mixins/delegate_support");SC.SparseArray=SC.Object.extend(SC.Enumerable,SC.Array,SC.DelegateSupport,{_requestingLength:0,_requestingIndex:0,length:function(){var del=this.delegate;if(del&&SC.none(this._length)&&del.sparseArrayDidRequestLength){this._requestingLength++;del.sparseArrayDidRequestLength(this);this._requestingLength--}return this._length||0}.property().cacheable(),provideLength:function(length){if(SC.none(length)){this._sa_content=null}if(length!==this._length){this._length=length;if(this._requestingLength<=0){this.enumerableContentDidChange()}}return this},rangeWindowSize:1,requestedRangeIndex:[],objectAt:function(idx){var content=this._sa_content,ret;if(!content){content=this._sa_content=[]}if((ret=content[idx])===undefined){this.requestIndex(idx);ret=content[idx]}return ret},definedIndexes:function(indexes){var ret=SC.IndexSet.create(),content=this._sa_content,idx,len;if(!content){return ret.freeze()}if(indexes){indexes.forEach(function(idx){if(content[idx]!==undefined){ret.add(idx)}})}else{len=content.length;for(idx=0;idx<len;idx++){if(content[idx]!==undefined){ret.add(idx)}}}return ret.freeze()},_TMP_RANGE:{},requestIndex:function(idx){var del=this.delegate;if(!del){return this}var len=this.get("rangeWindowSize"),start=idx;if(len>1){start=start-Math.floor(start%len)}if(len<1){len=1}this._requestingIndex++;if(del.sparseArrayDidRequestRange){var range=this._TMP_RANGE;if(this.wasRangeRequested(start)===-1){range.start=start;range.length=len;del.sparseArrayDidRequestRange(this,range);this.requestedRangeIndex.push(start)}}else{if(del.sparseArrayDidRequestIndex){while(--len>=0){del.sparseArrayDidRequestIndex(this,start+len)}}}this._requestingIndex--;return this},wasRangeRequested:function(rangeStart){var i,ilen;for(i=0,ilen=this.requestedRangeIndex.length;i<ilen;i++){if(this.requestedRangeIndex[i]===rangeStart){return i}}return -1},rangeRequestCompleted:function(start){var i=this.wasRangeRequested(start);if(i>=0){this.requestedRangeIndex.removeAt(i,1);return true}return false},provideObjectsInRange:function(range,array){var content=this._sa_content;if(!content){content=this._sa_content=[]}var start=range.start,len=range.length;while(--len>=0){content[start+len]=array[len]}if(this._requestingIndex<=0){this.enumerableContentDidChange()}return this},_TMP_PROVIDE_ARRAY:[],_TMP_PROVIDE_RANGE:{length:1},provideObjectAtIndex:function(index,object){var array=this._TMP_PROVIDE_ARRAY,range=this._TMP_PROVIDE_RANGE;array[0]=object;range.start=index;return this.provideObjectsInRange(range,array)},objectsDidChangeInRange:function(range){var content=this._sa_content;if(content){if(range.start===0&&SC.maxRange(range)>=content.length){this._sa_content=null}else{var start=range.start,loc=Math.min(start+range.length,content.length);while(--loc>=start){content[loc]=undefined}}}this.enumerableContentDidChange(range);return this},indexOf:function(obj){var del=this.delegate;if(del&&del.sparseArrayDidRequestIndexOf){return del.sparseArrayDidRequestIndexOf(this,obj)}else{var content=this._sa_content;if(!content){content=this._sa_content=[]}return content.indexOf(obj)}},replace:function(idx,amt,objects){objects=objects||[];var del=this.delegate;if(del){if(!del.sparseArrayShouldReplace||!del.sparseArrayShouldReplace(this,idx,amt,objects)){return this}}var content=this._sa_content;if(!content){content=this._sa_content=[]}content.replace(idx,amt,objects);var len=objects?(objects.get?objects.get("length"):objects.length):0;var delta=len-amt;if(!SC.none(this._length)){this.propertyWillChange("length");this._length+=delta;this.propertyDidChange("length")}this.enumerableContentDidChange(idx,amt,delta);return this},reset:function(){this._sa_content=null;this._length=null;this.enumerableContentDidChange();this.invokeDelegateMethod(this.delegate,"sparseArrayDidReset",this);return this}});SC.SparseArray.array=function(len){return this.create({_length:len||0})}});tiki.script("sproutcore/runtime:en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js");tiki.register("sproutcore/datastore",{packages:{"sproutcore/runtime":{scripts:[{url:"/static/sproutcore/runtime/en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js",id:"sproutcore/runtime:en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js"}]},tiki:{scripts:[{url:"/static/tiki/en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js",id:"tiki:en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js"}]}},depends:["tiki","sproutcore/runtime"],scripts:[{url:"/static/sproutcore/datastore/en/eb43c56c9a551db9bba1cd04f29ca1dfb2e47e4c/javascript.js",id:"sproutcore/datastore:en/eb43c56c9a551db9bba1cd04f29ca1dfb2e47e4c/javascript.js"}]});tiki.module("sproutcore/datastore:index",function(require,exports,module){var m});tiki.script("sproutcore/datastore:en/eb43c56c9a551db9bba1cd04f29ca1dfb2e47e4c/javascript.js");tiki.register("sproutcore/foundation",{packages:{"sproutcore/runtime":{scripts:[{url:"/static/sproutcore/runtime/en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js",id:"sproutcore/runtime:en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js"}]},tiki:{scripts:[{url:"/static/tiki/en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js",id:"tiki:en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js"}]}},stylesheets:[{url:"/static/sproutcore/foundation/en/a04970954a917ede9918ca06897bc0e1406986d5/stylesheet.css",id:"sproutcore/foundation:en/a04970954a917ede9918ca06897bc0e1406986d5/stylesheet.css"}],depends:["tiki","sproutcore/runtime"],scripts:[{url:"/static/sproutcore/foundation/en/a04970954a917ede9918ca06897bc0e1406986d5/javascript.js",id:"sproutcore/foundation:en/a04970954a917ede9918ca06897bc0e1406986d5/javascript.js"}]});tiki.global("sproutcore/foundation");SC.Locale=SC.Object.extend({init:function(){if(!this.language){SC.Locale._assignLocales()}if(!this.hasStrings){var langs=this._deprecatedLanguageCodes||[];langs.push(this.language);var idx=langs.length;var strings=null;while(!strings&&--idx>=0){strings=String[langs[idx]]}if(strings){this.hasStrings=YES;this.strings=strings}}},hasStrings:NO,strings:{},toString:function(){if(!this.language){SC.Locale._assignLocales()}return"SC.Locale["+this.language+"]"+SC.guidFor(this)},locWithDefault:function(string,def){return this.strings[string]||def||string}});SC.Locale.mixin({useAutodetectedLanguage:NO,preferredLanguage:null,createCurrentLocale:function(){var autodetect=(String.useAutodetectedLanguage!==undefined)?String.useAutodetectedLanguage:this.useAutodetectedLanguage;var preferred=(String.preferredLanguage!==undefined)?String.preferredLanguage:this.preferredLanguage;var lang=((autodetect)?SC.browser.language:null)||preferred||SC.browser.language||"en";lang=SC.Locale.normalizeLanguage(lang);var klass=this.localeClassFor(lang);if(lang!=this.currentLanguage){this.currentLanguage=lang;this.currentLocale=klass.create()}return this.currentLocale},localeClassFor:function(lang){lang=SC.Locale.normalizeLanguage(lang);var parent,klass=this.locales[lang];if(!klass&&((parent=lang.split("-")[0])!==lang)&&(klass=this.locales[parent])){klass=this.locales[lang]=klass.extend()}if(!klass){klass=this.locales[lang]=this.locales.en.extend()}return klass},define:function(localeName,options){var locale;if(options===undefined&&(SC.typeOf(localeName)!==SC.T_STRING)){locale=this;options=localeName}else{locale=SC.Locale.localeClassFor(localeName)}SC.mixin(locale.prototype,options);return locale},options:function(){return this.prototype},addStrings:function(stringsHash){var strings=this.prototype.strings;if(strings){if(!this.prototype.hasOwnProperty("strings")){this.prototype.strings=SC.clone(strings)}}else{strings=this.prototype.strings={}}if(stringsHash){this.prototype.strings=SC.mixin(strings,stringsHash)}this.prototype.hasStrings=YES;return this},_map:{english:"en",french:"fr",german:"de",japanese:"ja",jp:"ja",spanish:"es"},normalizeLanguage:function(languageCode){if(!languageCode){return"en"}return SC.Locale._map[languageCode.toLowerCase()]||languageCode},_assignLocales:function(){for(var key in this.locales){this.locales[key].prototype.language=key}},toString:function(){if(!this.prototype.language){SC.Locale._assignLocales()}return"SC.Locale["+this.prototype.language+"]"},extend:function(){var ret=SC.Object.extend.apply(this,arguments);ret.addStrings=SC.Locale.addStrings;ret.define=SC.Locale.define;ret.options=SC.Locale.options;ret.toString=SC.Locale.toString;return ret}});SC.Locale.locales={en:SC.Locale.extend({_deprecatedLanguageCodes:["English"]}),fr:SC.Locale.extend({_deprecatedLanguageCodes:["French"]}),de:SC.Locale.extend({_deprecatedLanguageCodes:["German"]}),ja:SC.Locale.extend({_deprecatedLanguageCodes:["Japanese","jp"]}),es:SC.Locale.extend({_deprecatedLanguageCodes:["Spanish"]})};SC.stringsFor=function(languageCode,strings){var locale=SC.Locale.localeClassFor(languageCode);locale.addStrings(strings);return this};sc_require("system/locale");SC.stringsFor("English",{"_SC.DateTime.dayNames":"Sunday Monday Tuesday Wednesday Thursday Friday Saturday","_SC.DateTime.abbreviatedDayNames":"Sun Mon Tue Wed Thu Fri Sat","_SC.DateTime.monthNames":"January February March April May June July August September October November December","_SC.DateTime.abbreviatedMonthNames":"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"});SC.DROP_ON=1;SC.DROP_BEFORE=2;SC.DROP_AFTER=4;SC.DROP_ANY=7;SC.SAFARI_FOCUS_BEHAVIOR=YES;SC.mixin({data:function(elem,name,data){elem=(elem===window)?"@window":elem;var hash=SC.hashFor(elem);var cache=SC._data_cache;if(!cache){SC._data_cache=cache={}}var elemCache=cache[hash];if(name&&!elemCache){cache[hash]=elemCache={}}if(elemCache&&(data!==undefined)){elemCache[name]=data}return(name)?elemCache[name]:elemCache},removeData:function(elem,name){elem=(elem===window)?"@window":elem;var hash=SC.hashFor(elem);var cache=SC._data_cache;if(!cache){return undefined}var elemCache=cache[hash];if(!elemCache){return undefined}var ret=(name)?elemCache[name]:elemCache;if(name){delete elemCache[name]}else{delete cache[hash]}return ret}});SC.mixin(Function.prototype,{invokeLater:function(target,interval){if(interval===undefined){interval=1}var f=this;if(arguments.length>2){var args=SC.$A(arguments).slice(2,arguments.length);args.unshift(target);var that=this,func=f;f=function(){return func.apply(that,args.slice(1))}}return SC.Timer.schedule({target:target,action:f,interval:interval})}});SC.Controller=SC.Object.extend({isEditable:YES});SC.SelectionSupport={hasSelectionSupport:YES,allowsSelection:YES,allowsMultipleSelection:YES,allowsEmptySelection:YES,firstSelectableObject:function(){return this.get("firstObject")}.property(),selection:function(key,value){var old=this._scsel_selection,oldlen=old?old.get("length"):0,content,empty,len;if((value===undefined)||!this.get("allowsSelection")){value=old}len=(value&&value.isEnumerable)?value.get("length"):0;if((len>1)&&!this.get("allowsMultipleSelection")){if(oldlen>1){value=SC.SelectionSet.create().addObject(old.get("firstObject")).freeze();len=1}else{value=old;len=oldlen}}if((len===0)&&!this.get("allowsEmptySelection")){if(oldlen===0){value=this.get("firstSelectableObject");if(value){value=SC.SelectionSet.create().addObject(value).freeze()}else{value=SC.SelectionSet.EMPTY}len=value.get("length")}else{value=old;len=oldlen}}if(len===0){value=SC.SelectionSet.EMPTY}value=value.frozenCopy();this._scsel_selection=value;return value}.property("arrangedObjects","allowsEmptySelection","allowsMultipleSelection","allowsSelection").cacheable(),hasSelection:function(){var sel=this.get("selection");return !!sel&&(sel.get("length")>0)}.property("selection").cacheable(),selectObjects:function(objects,extend){if(!objects||objects.get("length")===0){if(!extend){this.set("selection",SC.SelectionSet.EMPTY)}return this}var sel=this.get("selection");if(extend&&sel){sel=sel.copy()}else{sel=SC.SelectionSet.create()}sel.addObjects(objects).freeze();this.set("selection",sel);return this},selectObject:function(object,extend){if(object===null){if(!extend){this.set("selection",null)}return this}else{return this.selectObjects([object],extend)}},deselectObjects:function(objects){if(!objects||objects.get("length")===0){return this}var sel=this.get("selection");if(!sel||sel.get("length")===0){return this}sel=sel.copy().removeObjects(objects).freeze();this.set("selection",sel.freeze());return this},deselectObject:function(object){if(!object){return this}else{return this.deselectObjects([object])}},updateSelectionAfterContentChange:function(){var content=this.get("arrangedObjects"),sel=this.get("selection"),ret=sel,indexes,len,max;if(ret&&content&&ret.get("sources").indexOf(content)>=0){indexes=ret.indexSetForSource(content);len=content.get("length");max=indexes?indexes.get("max"):0;if(max>len){ret=ret.copy().remove(content,len,max-len).freeze();this.set("selection",ret)}}if(ret===sel){len=sel?sel.get("length"):0;max=content?content.get("length"):0;if((len===0)&&!this.get("allowsEmptySelection")&&max>0){this.notifyPropertyChange("selection")}}return this}};sc_require("controllers/controller");sc_require("mixins/selection_support");SC.ArrayController=SC.Controller.extend(SC.Array,SC.SelectionSupport,{content:null,isEditable:YES,orderBy:null,allowsSingleContent:YES,destroyOnRemoval:NO,arrangedObjects:function(){return this}.property().cacheable(),canRemoveContent:function(){var content=this.get("content"),ret;ret=!!content&&this.get("isEditable")&&this.get("hasContent");if(ret){return !content.isEnumerable||(SC.typeOf(content.removeObject)===SC.T_FUNCTION)}else{return NO}}.property("content","isEditable","hasContent"),canReorderContent:function(){var content=this.get("content"),ret;ret=!!content&&this.get("isEditable")&&!this.get("orderBy");return ret&&!!content.isSCArray}.property("content","isEditable","orderBy"),canAddContent:function(){var content=this.get("content"),ret;ret=content&&this.get("isEditable")&&content.isEnumerable;if(ret){return(SC.typeOf(content.addObject)===SC.T_FUNCTION)||(SC.typeOf(content.pushObject)===SC.T_FUNCTION)}else{return NO}}.property("content","isEditable"),hasContent:function(){var content=this.get("content");return !!content&&(!!content.isEnumerable||!!this.get("allowsSingleContent"))}.property("content","allowSingleContent"),status:function(){var content=this.get("content"),ret=content?content.get("status"):null;return ret?ret:SC.Record.READY}.property().cacheable(),addObject:function(object){if(!this.get("canAddContent")){throw"%@ cannot add content".fmt(this)}var content=this.get("content");if(content.isSCArray){content.pushObject(object)}else{if(content.addObject){content.addObject(object)}else{throw"%@.content does not support addObject".fmt(this)}}return this},removeObject:function(object){if(!this.get("canRemoveContent")){throw"%@ cannot remove content".fmt(this)}var content=this.get("content");if(content.isEnumerable){content.removeObject(object)}else{this.set("content",null)}if(this.get("destroyOnRemoval")&&object.destroy){object.destroy()}return this},length:function(){var content=this._scac_observableContent();return content?content.get("length"):0}.property().cacheable(),objectAt:function(idx){var content=this._scac_observableContent();return content?content.objectAt(idx):undefined},replace:function(start,amt,objects){if(!objects||objects.get("length")===0){if(!this.get("canRemoveContent")){throw"%@ cannot remove objects from the current content".fmt(this)}}else{if(!this.get("canReorderContent")){throw"%@ cannot add or reorder the current content".fmt(this)}}var content=this.get("content");var objsToDestroy=[],i,objsLen;if(this.get("destroyOnRemoval")){for(i=0;i<amt;i++){objsToDestroy.push(content.objectAt(i+start))}}if(content){content.replace(start,amt,objects)}for(i=0,objsLen=objsToDestroy.length;i<objsLen;i++){objsToDestroy[i].destroy()}objsToDestroy=null;return this},indexOf:function(object,startAt){var content=this._scac_observableContent();return content?content.indexOf(object,startAt):-1},init:function(){arguments.callee.base.apply(this,arguments);this._scac_contentDidChange()},_scac_cached:NO,_scac_observableContent:function(){var ret=this._scac_cached;if(ret!==NO){return ret}var content=this.get("content"),orderBy,func,t,len;if(SC.none(content)){return this._scac_cached=[]}if(!content.isEnumerable){ret=this.get("allowsSingleContent")?[content]:[];return(this._scac_cached=ret)}orderBy=this.get("orderBy");if(!orderBy){if(content.isSCArray){return(this._scac_cached=content)}else{throw"%@.orderBy is required for unordered content".fmt(this)}}switch(SC.typeOf(orderBy)){case SC.T_STRING:orderBy=[orderBy];break;case SC.T_FUNCTION:func=orderBy;break;case SC.T_ARRAY:break;default:throw"%@.orderBy must be Array, String, or Function".fmt(this)}if(!func){len=orderBy.get("length");func=function(a,b){var idx=0,status=0,key,aValue,bValue,descending;for(idx=0;(idx<len)&&(status===0);idx++){key=orderBy.objectAt(idx);descending=NO;if(key.indexOf("ASC")>-1){key=key.split("ASC ")[1]}else{if(key.indexOf("DESC")>-1){key=key.split("DESC ")[1];descending=YES}}if(!a){aValue=a}else{if(a.isObservable){aValue=a.get(key)}else{aValue=a[key]}}if(!b){bValue=b}else{if(b.isObservable){bValue=b.get(key)}else{bValue=b[key]}}status=SC.compare(aValue,bValue);if(descending){status=(-1)*status}}return status}}ret=[];content.forEach(function(o){ret.push(o)});ret.sort(func);func=null;return(this._scac_cached=ret)},_scac_contentDidChange:function(){this._scac_cached=NO;var cur=this.get("content"),orders=!!this.get("orderBy"),last=this._scac_content,oldlen=this._scac_length||0,ro=this._scac_rangeObserver,func=this._scac_rangeDidChange,efunc=this._scac_enumerableDidChange,sfunc=this._scac_contentStatusDidChange,newlen;if(last===cur){return this}if(last){if(ro&&last.isSCArray){last.removeRangeObserver(ro)}else{if(last.isEnumerable){last.removeObserver("[]",this,efunc)}}last.removeObserver("status",this,sfunc)}ro=null;this._scac_cached=NO;this._scac_content=cur;if(cur){if(!orders&&cur.isSCArray){ro=cur.addRangeObserver(null,this,func)}else{if(cur.isEnumerable){cur.addObserver("[]",this,efunc)}}newlen=cur.isEnumerable?cur.get("length"):1;cur.addObserver("status",this,sfunc)}else{newlen=SC.none(cur)?0:1}this._scac_rangeObserver=ro;this._scac_length=newlen;this._scac_contentStatusDidChange();this.enumerableContentDidChange(0,newlen,newlen-oldlen);this.updateSelectionAfterContentChange()}.observes("content"),_scac_enumerableDidChange:function(){var content=this.get("content"),newlen=content?content.get("length"):0,oldlen=this._scac_length;this._scac_length=newlen;this.beginPropertyChanges();this._scac_cached=NO;this.enumerableContentDidChange(0,newlen,newlen-oldlen);this.endPropertyChanges();this.updateSelectionAfterContentChange()}.observes("orderBy"),_scac_rangeDidChange:function(array,objects,key,indexes){if(key!=="[]"){return}var content=this.get("content");this._scac_length=content.get("length");this._scac_cached=NO;if(indexes){this.beginPropertyChanges();indexes.forEachRange(function(start,length){this.enumerableContentDidChange(start,length,0)},this);this.endPropertyChanges();this.updateSelectionAfterContentChange()}},_scac_contentStatusDidChange:function(){this.notifyPropertyChange("status")}});sc_require("controllers/controller");SC.ObjectController=SC.Controller.extend({content:null,allowsMultipleContent:NO,hasContent:function(){return !SC.none(this.get("observableContent"))}.property("observableContent"),isEditable:YES,observableContent:function(){var content=this.get("content"),len,allowsMultiple;if(content&&content.isEnumerable){len=content.get("length");allowsMultiple=this.get("allowsMultipleContent");if(len===1){content=content.firstObject()}else{if(len===0||!allowsMultiple){content=null}}if(content&&!allowsMultiple&&content.isEnumerable){content=null}}return content}.property("content","allowsMultipleContent").cacheable(),destroy:function(){var content=this.get("observableContent");if(content&&SC.typeOf(content.destroy)===SC.T_FUNCTION){content.destroy()}this.set("content",null);return this},contentPropertyDidChange:function(target,key){if(key==="*"){this.allPropertiesDidChange()}else{this.notifyPropertyChange(key)}},unknownProperty:function(key,value){if(key==="content"){if(value!==undefined){this.content=value}return this.content}var content=this.get("observableContent"),loc,cur,isSame;if(content===null||content===undefined){return undefined}if(value===undefined){if(content.isEnumerable){value=content.getEach(key);loc=value.get("length");if(loc>0){isSame=YES;cur=value.objectAt(0);while((--loc>0)&&isSame){if(cur!==value.objectAt(loc)){isSame=NO}}if(isSame){value=cur}}else{value=undefined}}else{value=(content.isObservable)?content.get(key):content[key]}}else{if(!this.get("isEditable")){throw"%@.%@ is not editable".fmt(this,key)}if(content.isEnumerable){content.setEach(key,value)}else{if(content.isObservable){content.set(key,value)}else{content[key]=value}}}return value},init:function(){arguments.callee.base.apply(this,arguments);if(this.get("content")){this._scoc_contentDidChange()}if(this.get("observableContent")){this._scoc_observableContentDidChange()}},_scoc_contentDidChange:function(){var last=this._scoc_content,cur=this.get("content");if(last!==cur){this._scoc_content=cur;var func=this._scoc_enumerableContentDidChange;if(last&&last.isEnumerable){last.removeObserver("[]",this,func)}if(cur&&cur.isEnumerable){cur.addObserver("[]",this,func)}}}.observes("content"),_scoc_observableContentDidChange:function(){var last=this._scoc_observableContent,cur=this.get("observableContent"),func=this.contentPropertyDidChange,efunc=this._scoc_enumerableContentDidChange;if(last===cur){return this}this._scoc_observableContent=cur;if(last){if(last.isEnumerable){last.removeObserver("[]",this,efunc)}else{if(last.isObservable){last.removeObserver("*",this,func)}}}if(cur){if(cur.isEnumerable){cur.addObserver("[]",this,efunc)}else{if(cur.isObservable){cur.addObserver("*",this,func)}}}if((last&&last.isEnumerable)||(cur&&cur.isEnumerable)){this._scoc_enumerableContentDidChange()}else{this.contentPropertyDidChange(cur,"*")}}.observes("observableContent"),_scoc_enumerableContentDidChange:function(){var cur=this.get("observableContent"),set=this._scoc_observableContentItems,func=this.contentPropertyDidChange;if(set){set.forEach(function(item){if(item.isObservable){item.removeObserver("*",this,func)}},this);set.clear()}if(cur&&cur.isEnumerable){if(!set){set=SC.Set.create()}cur.forEach(function(item){if(set.contains(item)){return}set.add(item);if(item.isObservable){item.addObserver("*",this,func)}},this)}else{set=null}this._scoc_observableContentItems=set;this.contentPropertyDidChange(cur,"*");return this}});SC.TreeItemContent={isTreeItemContent:YES,treeItemChildren:null,treeItemIsExpanded:YES,treeItemIsGrouped:NO,treeItemDisclosureState:function(parent,idx){return this.get("treeItemIsExpanded")?SC.BRANCH_OPEN:SC.BRANCH_CLOSED},treeItemCollapse:function(parent,idx){this.setIfChanged("treeItemIsExpanded",NO)},treeItemExpand:function(parent,idx){this.setIfChanged("treeItemIsExpanded",YES)},treeItemBranchIndexes:function(parent,index){var children=this.get("treeItemChildren"),ret,lim,idx,item;if(!children){return null}ret=SC.IndexSet.create();lim=children.get("length");for(idx=0;idx<lim;idx++){if(!(item=children.objectAt(idx))){continue}if(!item.get("treeItemChildren")){continue}if(item.treeItemDisclosureState(this,idx)!==SC.LEAF_NODE){ret.add(idx)}}return ret.get("length")>0?ret:null}};SC.BRANCH_OPEN=17;SC.BRANCH_CLOSED=18;SC.LEAF_NODE=32;SC.CollectionContent={isCollectionContent:YES,contentIndexIsSelected:function(view,content,idx){var sel=view.get("selection");return sel?sel.contains(content,idx):NO},contentIndexIsEnabled:function(view,content,idx){return view.get("isEnabled")},contentGroupIndexes:function(view,content){return null},contentIndexIsGroup:function(view,content,idx){return NO},contentIndexOutlineLevel:function(view,content,idx){return -1},contentIndexDisclosureState:function(view,content,idx){return SC.LEAF_NODE},contentIndexExpand:function(view,content,idx){SC.Logger.log("contentIndexExpand(%@, %@, %@)".fmt(view,content,idx))},contentIndexCollapse:function(view,content,idx){SC.Logger.log("contentIndexCollapse(%@, %@, %@)".fmt(view,content,idx))}};sc_require("mixins/tree_item_content");sc_require("mixins/collection_content");SC.TreeItemObserver=SC.Object.extend(SC.Array,SC.CollectionContent,{item:null,delegate:null,parentObserver:null,parentItem:function(){var p=this.get("parentObserver");return p?p.get("item"):null}.property("parentObserver").cacheable(),index:null,outlineLevel:0,children:null,disclosureState:SC.BRANCH_OPEN,branchIndexes:function(){var item=this.get("item"),len,pitem,idx,children,ret;if(!item){return SC.IndexSet.EMPTY}else{if(item.isTreeItemContent){pitem=this.get("parentItem");idx=this.get("index");return item.treeItemBranchIndexes(pitem,idx)}else{children=this.get("children");if(!children){return null}ret=SC.IndexSet.create();len=children.get("length");pitem=item;for(idx=0;idx<len;idx++){if(!(item=children.objectAt(idx))){continue}if(!this._computeChildren(item,pitem,idx)){continue}if(this._computeDisclosureState(item,pitem,idx)!==SC.LEAF_NODE){ret.add(idx)}}return ret.get("length")>0?ret:null}}}.property("children").cacheable(),isHeaderVisible:function(){return !!this.get("parentObserver")}.property("parentObserver").cacheable(),length:0,objectAt:function(index){var len=this.get("length"),item=this.get("item"),cache=this._objectAtCache,cur=index,loc=0,indexes,children;if(index>=len){return undefined}if(this.get("isHeaderVisible")){if(index===0){return item}else{cur--}}item=null;if(!cache){cache=this._objectAtCache=[]}if((item=cache[index])!==undefined){return item}children=this.get("children");if(!children){return undefined}if(indexes=this.get("branchIndexes")){indexes.forEach(function(i){if(item||(i>cur)){return}var observer=this.branchObserverAt(i),len;if(!observer){return}len=observer.get("length");if(i+len>cur){item=observer.objectAt(cur-i);cur=-1}else{cur-=len-1}},this)}if(cur>=0){item=children.objectAt(cur)}cache[index]=item;return item},replace:function(start,amt,objects,operation){var cur=start,observer=null,indexes,len,max;if(operation===undefined){operation=SC.DROP_BEFORE}if(this.get("isHeaderVisible")){cur--}if(cur<0){throw"Tree Item cannot replace itself"}if(indexes=this.get("branchIndexes")){indexes.forEach(function(i){if(observer||(i>=cur)){return}if(!(observer=this.branchObserverAt(i))){return}len=observer.get("length");if((i+len===cur)&&operation===SC.DROP_AFTER){cur-=i}else{if(i+len>cur){cur-=i}else{cur-=len-1;observer=null}}},this)}if(observer){observer.replace(cur,amt,objects,operation);return this}max=cur+amt;if(amt>1&&indexes){indexes.forEachIn(cur,indexes.get("max")-cur,function(i){if(i>max){return}if(!(observer=this.branchObserverAt(i))){return}len=observer.get("length");max-=len-1},this)}amt=max-cur;var children=this.get("children");if(!children){throw"cannot replace() tree item with no children"}if((amt<0)||(max>children.get("length"))){throw"replace() range must lie within a single tree item"}children.replace(cur,amt,objects,operation);return this},observerContentDidChange:function(start,amt,delta){this.invalidateBranchObserversAt(start);this._objectAtCache=this._outlineLevelCache=null;this._disclosureStateCache=null;this._contentGroupIndexes=NO;this.notifyPropertyChange("branchIndexes");var oldlen=this.get("length"),newlen=this._computeLength(),parent=this.get("parentObserver"),set;if(oldlen!==newlen){this.set("length",newlen)}if(!this._notifyParent){return this}if(parent){set=SC.IndexSet.create(this.get("index"));parent._childrenRangeDidChange(parent.get("children"),null,"[]",set)}else{if(oldlen===newlen){amt=this.expandChildIndex(start+amt);start=this.expandChildIndex(start);amt=amt-start;delta=0}else{start=this.expandChildIndex(start);amt=newlen-start;delta=newlen-oldlen}this.enumerableContentDidChange(start,amt,delta)}},expandChildIndex:function(index){var ret=index;if(this.get("isHeaderVisible")){index++}var branches=this.get("branchIndexes");if(!branches||branches.get("length")===0){return ret}branches.forEachIn(0,index,function(idx){ret+=this.branchObserverAt(idx).get("length")-1},this);return ret},_contentGroupIndexes:NO,contentGroupIndexes:function(view,content){if(content!==this){return null}var ret=this._contentGroupIndexes;if(ret!==NO){return ret}if(this.get("parentObserver")){return null}var item=this.get("item"),group,indexes,len,cur,loc,children;if(item&&item.isTreeItemContent){group=item.get("treeItemIsGrouped")}else{group=!!this.delegate.get("treeItemIsGrouped")}if(group){ret=SC.IndexSet.create();indexes=this.get("branchIndexes");children=this.get("children");len=children?children.get("length"):0;cur=loc=0;if(indexes){indexes.forEach(function(i){ret.add(cur,(i+1)-loc);cur+=(i+1)-loc;loc=i+1;var observer=this.branchObserverAt(i);if(observer){cur+=observer.get("length")-1}},this)}if(loc<len){ret.add(cur,len-loc)}}else{ret=null}this._contentGroupIndexes=ret;return ret},contentIndexIsGroup:function(view,content,idx){var indexes=this.contentGroupIndexes(view,content);return indexes?indexes.contains(idx):NO},contentIndexOutlineLevel:function(view,content,index){if(content!==this){return -1}var cache=this._outlineLevelCache;if(cache&&(cache[index]!==undefined)){return cache[index]}if(!cache){cache=this._outlineLevelCache=[]}var len=this.get("length"),cur=index,loc=0,ret=null,indexes,children,observer;if(index>=len){return -1}if(this.get("isHeaderVisible")){if(index===0){return cache[0]=this.get("outlineLevel")-1}else{cur--}}if(indexes=this.get("branchIndexes")){indexes.forEach(function(i){if((ret!==null)||(i>cur)){return}var observer=this.branchObserverAt(i),len;if(!observer){return}len=observer.get("length");if(i+len>cur){ret=observer.contentIndexOutlineLevel(view,observer,cur-i);cur=-1}else{cur-=len-1}},this)}if(cur>=0){ret=this.get("outlineLevel")}cache[index]=ret;return ret},contentIndexDisclosureState:function(view,content,index){if(content!==this){return -1}var cache=this._disclosureStateCache;if(cache&&(cache[index]!==undefined)){return cache[index]}if(!cache){cache=this._disclosureStateCache=[]}var len=this.get("length"),cur=index,loc=0,ret=null,indexes,children,observer;if(index>=len){return SC.LEAF_NODE}if(this.get("isHeaderVisible")){if(index===0){return cache[0]=this.get("disclosureState")}else{cur--}}if(indexes=this.get("branchIndexes")){indexes.forEach(function(i){if((ret!==null)||(i>cur)){return}var observer=this.branchObserverAt(i),len;if(!observer){return}len=observer.get("length");if(i+len>cur){ret=observer.contentIndexDisclosureState(view,observer,cur-i);cur=-1}else{cur-=len-1}},this)}if(cur>=0){ret=SC.LEAF_NODE}cache[index]=ret;return ret},contentIndexExpand:function(view,content,idx){var indexes,cur=idx,children,item;if(content!==this){return}if(this.get("isHeaderVisible")){if(idx===0){this._expand(this.get("item"));return}else{cur--}}if(indexes=this.get("branchIndexes")){indexes.forEach(function(i){if(i>=cur){return}var observer=this.branchObserverAt(i),len;if(!observer){return}len=observer.get("length");if(i+len>cur){observer.contentIndexExpand(view,observer,cur-i);cur=-1}else{cur-=len-1}},this)}if(cur>=0){children=this.get("children");item=children?children.objectAt(cur):null;if(item){this._expand(item,this.get("item"),cur)}}},contentIndexCollapse:function(view,content,idx){var indexes,children,item,cur=idx;if(content!==this){return}if(this.get("isHeaderVisible")){if(idx===0){this._collapse(this.get("item"));return}else{cur--}}if(indexes=this.get("branchIndexes")){indexes.forEach(function(i){if(i>=cur){return}var observer=this.branchObserverAt(i),len;if(!observer){return}len=observer.get("length");if(i+len>cur){observer.contentIndexCollapse(view,observer,cur-i);cur=-1}else{cur-=len-1}},this)}if(cur>=0){children=this.get("children");item=children?children.objectAt(cur):null;if(item){this._collapse(item,this.get("item"),cur)}}},branchObserverAt:function(index){var byIndex=this._branchObserversByIndex,indexes=this._branchObserverIndexes,ret,parent,pitem,item,children,guid,del;if(!byIndex){byIndex=this._branchObserversByIndex=[]}if(!indexes){indexes=this._branchObserverIndexes=SC.IndexSet.create()}if(ret=byIndex[index]){return ret}children=this.get("children");item=children?children.objectAt(index):null;if(!item){return null}byIndex[index]=ret=SC.TreeItemObserver.create({item:item,delegate:this.get("delegate"),parentObserver:this,index:index,outlineLevel:this.get("outlineLevel")+1});indexes.add(index);return ret},invalidateBranchObserversAt:function(index){var byIndex=this._branchObserversByIndex,indexes=this._branchObserverIndexes;if(!byIndex||byIndex.length<=index){return this}if(index<0){index=0}indexes.forEachIn(index,indexes.get("max")-index,function(i){var observer=byIndex[i];if(observer){observer.destroy()}},this);byIndex.length=index;return this},init:function(){arguments.callee.base.apply(this,arguments);var item=this.get("item");if(!item){throw"SC.TreeItemObserver.item cannot be null"}item.addObserver("*",this,this._itemPropertyDidChange);this._itemPropertyDidChange(item,"*");this._notifyParent=YES},destroy:function(){this.invalidateBranchObserversAt(0);this._objectAtCache=null;var item=this.get("item");if(item){item.removeObserver("*",this,this._itemPropertyDidChange)}var children=this._children,ro=this._childrenRangeObserver;if(children&&ro){children.removeRangeObserver(ro)}arguments.callee.base.apply(this,arguments)},_itemPropertyDidChange:function(target,key){var children=this.get("children"),state=this.get("disclosureState"),item=this.get("item"),next;this.beginPropertyChanges();next=this._computeDisclosureState(item);if(state!==next){this.set("disclosureState",next)}next=this._computeChildren(item);if(children!==next){this.set("children",next)}this.endPropertyChanges()},_childrenDidChange:function(){var state=this.get("disclosureState"),cur=state===SC.BRANCH_OPEN?this.get("children"):null,last=this._children,ro=this._childrenRangeObserver;if(last===cur){return this}if(ro){last.removeRangeObserver(ro)}if(cur){this._childrenRangeObserver=cur.addRangeObserver(null,this,this._childrenRangeDidChange)}else{this._childrenRangeObserver=null}this._children=cur;this._childrenRangeDidChange(cur,null,"[]",null)}.observes("children","disclosureState"),_childrenRangeDidChange:function(array,objects,key,indexes){var children=this.get("children"),len=children?children.get("length"):0,min=indexes?indexes.get("min"):0,max=indexes?indexes.get("max"):len,old=this._childrenLen||0;this._childrenLen=len;this.observerContentDidChange(min,max-min,len-old)},_computeDisclosureState:function(item,pitem,index){var key,del;if(!item||!this._computeChildren(item)){return SC.LEAF_NODE}else{if(item.isTreeItemContent){if(pitem===undefined){pitem=this.get("parentItem")}if(index===undefined){index=this.get("index")}return item.treeItemDisclosureState(pitem,index)}else{key=this._treeItemIsExpandedKey;if(!key){del=this.get("delegate");key=del?del.get("treeItemIsExpandedKey"):"treeItemIsExpanded";this._treeItemIsExpandedKey=key}return item.get(key)?SC.BRANCH_OPEN:SC.BRANCH_CLOSED}}},_collapse:function(item,pitem,index){var key,del;if(!item||!this._computeChildren(item)){return this}else{if(item.isTreeItemContent){if(pitem===undefined){pitem=this.get("parentItem")}if(index===undefined){index=this.get("index")}item.treeItemCollapse(pitem,index)}else{key=this._treeItemIsExpandedKey;if(!key){del=this.get("delegate");key=del?del.get("treeItemIsExpandedKey"):"treeItemIsExpanded";this._treeItemIsExpandedKey=key}item.setIfChanged(key,NO)}}return this},_expand:function(item,pitem,index){var key,del;if(!item||!this._computeChildren(item)){return this}else{if(item.isTreeItemContent){if(pitem===undefined){pitem=this.get("parentItem")}if(index===undefined){index=this.get("index")}item.treeItemExpand(pitem,index)}else{key=this._treeItemIsExpandedKey;if(!key){del=this.get("delegate");key=del?del.get("treeItemIsExpandedKey"):"treeItemIsExpanded";this._treeItemIsExpandedKey=key}item.setIfChanged(key,YES)}}return this},_computeChildren:function(item){var del,key;if(!item){return null}else{if(item.isTreeItemContent){return item.get("treeItemChildren")}else{key=this._treeItemChildrenKey;if(!key){del=this.get("delegate");key=del?del.get("treeItemChildrenKey"):"treeItemChildren";this._treeItemChildrenKey=key}return item.get(key)}}},_computeLength:function(){var ret=this.get("isHeaderVisible")?1:0,state=this.get("disclosureState"),children=this.get("children"),indexes;if((state===SC.BRANCH_OPEN)&&children){ret+=children.get("length");if(indexes=this.get("branchIndexes")){indexes.forEach(function(idx){var observer=this.branchObserverAt(idx);ret+=observer.get("length")-1},this)}}return ret}});sc_require("controllers/object");sc_require("mixins/selection_support");sc_require("private/tree_item_observer");SC.TreeController=SC.ObjectController.extend(SC.SelectionSupport,{treeItemIsGrouped:NO,treeItemIsExpandedKey:"treeItemIsExpanded",treeItemChildrenKey:"treeItemChildren",arrangedObjects:function(){var ret,content=this.get("content");if(content){ret=SC.TreeItemObserver.create({item:content,delegate:this})}else{ret=null}this._sctc_arrangedObjects=ret;return ret}.property().cacheable(),_sctc_invalidateArrangedObjects:function(){this.propertyWillChange("arrangedObjects");var ret=this._sctc_arrangedObjects;if(ret){ret.destroy()}this._sctc_arrangedObjects=null;this.propertyDidChange("arrangedObjects")}.observes("content","treeItemIsExpandedKey","treeItemChildrenKey","treeItemIsGrouped"),_sctc_arrangedObjectsContentDidChange:function(){this.updateSelectionAfterContentChange()}.observes("*arrangedObjects.[]"),firstSelectableObject:function(){var objects=this.get("arrangedObjects"),indexes,len,idx=0;if(!objects){return null}indexes=objects.contentGroupIndexes(null,objects);len=objects.get("length");while(indexes.contains(idx)&&(idx<len)){idx++}return idx>=len?null:objects.objectAt(idx)}.property()});SC.mixin(SC.Object.prototype,{invokeLater:function(methodName,interval){if(interval===undefined){interval=1}var f=methodName,args,func;if(arguments.length>2){args=SC.$A(arguments).slice(2);if(SC.typeOf(f)===SC.T_STRING){f=this[methodName]}func=f;f=function(){return func.apply(this,args)}}return SC.Timer.schedule({target:this,action:f,interval:interval})},invokeWith:function(pathName,target,method){if(method===undefined){method=target;target=this}if(!target){target=this}if(SC.typeOf(method)===SC.T_STRING){method=target[method]}var v=this.getPath(pathName);method.call(target,v,this);return this}});SC.RunLoop=SC.RunLoop.extend({startTime:function(){if(!this._start){this._start=Date.now()}return this._start}.property(),endRunLoop:function(){this.fireExpiredTimers();var ret=arguments.callee.base.apply(this,arguments);this.scheduleNextTimeout();return ret},scheduleTimer:function(timer,runTime){this._timerQueue=timer.removeFromTimerQueue(this._timerQueue);this._timerQueue=timer.scheduleInTimerQueue(this._timerQueue,runTime);return this},cancelTimer:function(timer){this._timerQueue=timer.removeFromTimerQueue(this._timerQueue);return this},TIMER_ARRAY:[],fireExpiredTimers:function(){if(!this._timerQueue||this._firing){return NO}var now=this.get("startTime"),timers=this.TIMER_ARRAY,idx,len,didFire;this._firing=YES;this._timerQueue=this._timerQueue.collectExpiredTimers(timers,now);len=timers.length;for(idx=0;idx<len;idx++){timers[idx].fire()}didFire=timers.length>0;timers.length=0;this._firing=NO;return didFire},scheduleNextTimeout:function(){var timer=this._timerQueue;var ret=NO;if(!timer){if(this._timeout){clearTimeout(this._timeout)}}else{var nextTimeoutAt=timer._timerQueueRunTime;if(this._timeoutAt!==nextTimeoutAt){if(this._timeout){clearTimeout(this._timeout)}var delay=Math.max(0,nextTimeoutAt-Date.now());this._timeout=setTimeout(this._timeoutDidFire,delay);this._timeoutAt=nextTimeoutAt}ret=YES}return ret},_timeoutDidFire:function(){var rl=SC.RunLoop.currentRunLoop;rl._timeout=rl._timeoutAt=null;SC.RunLoop.begin().end()}});SC.RunLoop.currentRunLoop=SC.RunLoop.create();
/* @license

Portions of this software are copyright Yahoo, Inc, used under the following license:

Software License Agreement (BSD License)
Copyright (c) 2009, Yahoo! Inc.
All rights reserved.
Redistribution and use of this software in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list of conditions and the
following disclaimer.
Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
Neither the name of Yahoo! Inc. nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission of Yahoo! Inc.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

Sources of Intellectual Property Included in the YUI Library
Where not otherwise indicated, all YUI content is authored by Yahoo! engineers and consists of Yahoo!-owned intellectual property. YUI is issued by Yahoo! under the BSD license above. In some specific instances, YUI will incorporate work done by developers outside of Yahoo! with their express permission.

*/
SC.Button={value:null,toggleOnValue:YES,toggleOffValue:NO,localize:NO,localizeBindingDefault:SC.Binding.bool(),title:"",contentTitleKey:null,icon:null,contentIconKey:null,needsEllipsis:YES,displayTitle:function(){var ret=this.get("title");return(ret&&this.get("localize"))?ret.loc():(ret||"")}.property("title","localize").cacheable(),keyEquivalent:null,renderTitle:function(context,firstTime){var icon=this.get("icon"),image="",title=this.get("displayTitle"),needsTitle=(!SC.none(title)&&title.length>0),elem,htmlNode,imgTitle;if(this.get("escapeHTML")){title=SC.RenderContext.escapeHTML(title)}if(icon){var blank=SC.BLANK_IMAGE_URL;if(icon.indexOf("/")>=0){image='<img src="'+icon+'" alt="" class="icon" />'}else{image='<img src="'+blank+'" alt="" class="'+icon+'" />'}needsTitle=YES}imgTitle=image+title;if(firstTime){if(this.get("needsEllipsis")){context.push('<label class="sc-button-label ellipsis">'+imgTitle+"</label>")}else{context.push('<label class="sc-button-label">'+imgTitle+"</label>")}this._ImageTitleCached=imgTitle}else{elem=this.$("label");if((htmlNode=elem[0])){if(needsTitle){if(this.get("needsEllipsis")){elem.addClass("ellipsis");if(this._ImageTitleCached!==imgTitle){this._ImageTitleCached=imgTitle;htmlNode.innerHTML=imgTitle}}else{elem.removeClass("ellipsis");if(this._ImageTitleCached!==imgTitle){this._ImageTitleCached=imgTitle;htmlNode.innerHTML=imgTitle}}}else{htmlNode.innerHTML=""}}}return context},contentPropertyDidChange:function(target,key){var del=this.get("displayDelegate"),content=this.get("content"),value;var valueKey=this.getDelegateProperty("contentValueKey",del);if(valueKey&&(key===valueKey||key==="*")){this.set("value",content?content.get(valueKey):null)}var titleKey=this.getDelegateProperty("contentTitleKey",del);if(titleKey&&(key===titleKey||key==="*")){this.set("title",content?content.get(titleKey):null)}var iconKey=this.getDelegateProperty("contentIconKey",del);if(iconKey&&(key===iconKey||key==="*")){this.set("icon",content?content.get(iconKey):null)}return this},_button_displayObserver:function(){this.displayDidChange()}.observes("title","icon","value"),performKeyEquivalent:function(keystring,evt){if(!this.get("isEnabled")){return NO}var equiv=this.get("keyEquivalent");if(equiv){if(equiv===keystring){return this.triggerAction(evt)}}else{if((this.get("isDefault")&&(keystring==="return"))||(this.get("isCancel")&&(keystring==="escape"))){return this.triggerAction(evt)}}return NO},triggerAction:function(evt){throw"SC.Button.triggerAction() is not defined in %@".fmt(this)},computeIsSelectedForValue:function(value){var targetValue=this.get("toggleOnValue"),state,next;if(SC.typeOf(value)===SC.T_ARRAY){if(value.length===1){state=(value[0]==targetValue)}else{state=null;value.find(function(x){next=(x==targetValue);if(state===null){state=next}else{if(next!==state){state=SC.MIXED_STATE}}return state===SC.MIXED_STATE})}}else{if(value===SC.MIXED_STATE){state=SC.MIXED_STATE}else{state=(value==targetValue)}}return state},initMixin:function(){if(!SC.none(this.get("value"))){this._button_valueDidChange()}},_button_valueDidChange:function(){var value=this.get("value"),state=this.computeIsSelectedForValue(value);this.set("isSelected",state)}.observes("value"),_button_isSelectedDidChange:function(){var newState=this.get("isSelected"),curState=this.computeIsSelectedForValue(this.get("value"));if((newState!==SC.MIXED_STATE)&&(curState!==newState)){var valueKey=(newState)?"toggleOnValue":"toggleOffValue";this.set("value",this.get(valueKey))}}.observes("isSelected")};SC.ContentDisplay={concatenatedProperties:"contentDisplayProperties",displayProperties:["content"],contentDisplayProperties:[],_display_contentDidChange:function(target,key,value){if((value=this.get("content"))!=this._display_content){var f=this._display_contentPropertyDidChange;var content=this._display_content;if(content){if(SC.isArray(content)){content.invoke("removeObserver","*",this,f)}else{if(content.removeObserver){content.removeObserver("*",this,f)}}}content=this._display_content=value;if(content){if(SC.isArray(content)){content.invoke("addObserver","*",this,f)}else{if(content.addObserver){content.addObserver("*",this,f)}}}this.allPropertiesDidChange();this.endPropertyChanges()}}.observes("content","contentDisplayProperties"),_display_contentPropertyDidChange:function(target,key,value,propertyRevision){if(key==="*"){this.displayDidChange()}else{var ary=this.get("contentDisplayProperties");if(ary&&ary.indexOf(key)>=0){this.displayDidChange()}}}};sc_require("system/locale");SC.STRING_TITLEIZE_REGEXP=(/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g);SC.STRING_DECAMELIZE_REGEXP=(/([a-z])([A-Z])/g);SC.STRING_DASHERIZE_REGEXP=(/[ _]/g);SC.STRING_HUMANIZE_REGEXP=(/[\-_]/g);SC.STRING_TRIM_REGEXP=(/^\s+|\s+$/g);SC.STRING_TRIM_LEFT_REGEXP=(/^\s+/g);SC.STRING_TRIM_RIGHT_REGEXP=(/\s+$/g);SC.STRING_REGEXP_ESCAPED_REGEXP=(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g);SC.String={loc:function(){if(!SC.Locale.currentLocale){SC.Locale.createCurrentLocale()}var str=SC.Locale.currentLocale.locWithDefault(this)||this;return str.fmt.apply(str,arguments)},locWithDefault:function(def){if(!SC.Locale.currentLocale){SC.Locale.createCurrentLocale()}var str=SC.Locale.currentLocale.locWithDefault(def)||this;var args=SC.$A(arguments);args.shift();return str.fmt.apply(str,args)},capitalize:function(){return this.charAt(0).toUpperCase()+this.slice(1)},capitalizeEach:function(){return this.replace(SC.STRING_TITLEIZE_REGEXP,function(str,sep,character){return(character)?(sep+character.toUpperCase()):sep}).capitalize()},titleize:function(){var ret=this.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2");return ret.replace(SC.STRING_TITLEIZE_REGEXP,function(str,separater,character){return(character)?(" "+character.toUpperCase()):" "}).capitalize()},camelize:function(){var ret=this.replace(SC.STRING_TITLEIZE_REGEXP,function(str,separater,character){return(character)?character.toUpperCase():""});var first=ret.charAt(0),lower=first.toLowerCase();return(first!==lower)?(lower+ret.slice(1)):ret},classify:function(){var ret=this.replace(SC.STRING_TITLEIZE_REGEXP,function(str,separater,character){return(character)?character.toUpperCase():""});var first=ret.charAt(0),upper=first.toUpperCase();return(first!==upper)?(upper+ret.slice(1)):ret},decamelize:function(){return this.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2").toLowerCase()},dasherize:function(){return this.decamelize().replace(SC.STRING_DASHERIZE_REGEXP,"-")},humanize:function(){return this.decamelize().replace(SC.STRING_HUMANIZE_REGEXP," ")},escapeForRegExp:function(){return this.replace(SC.STRING_REGEXP_ESCAPED_REGEXP,"\\$1")},removeDiacritics:function(){var diacriticMappingTable=SC.diacriticMappingTable;if(!diacriticMappingTable){SC.diacriticMappingTable={"À":"A","?":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ā":"A","Ă":"A","Ą":"A","?":"A","Ǟ":"A","Ǡ":"A","Ǻ":"A","Ȁ":"A","Ȃ":"A","Ȧ":"A","Ḁ":"A","Ạ":"A","Ả":"A","Ấ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ậ":"A","Ắ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ặ":"A","Å":"A","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ç":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ḉ":"C","Ď":"D","Ḋ":"D","Ḍ":"D","Ḏ":"D","?":"D","Ḓ":"D","È":"E","É":"E","Ê":"E","Ë":"E","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ȩ":"E","Ḕ":"E","Ḗ":"E","Ḙ":"E","Ḛ":"E","Ḝ":"E","Ẹ":"E","Ẻ":"E","Ẽ":"E","Ế":"E","Ề":"E","Ể":"E","Ễ":"E","Ệ":"E","Ḟ":"F","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","Ǧ":"G","Ǵ":"G","Ḡ":"G","Ĥ":"H","Ȟ":"H","Ḣ":"H","Ḥ":"H","Ḧ":"H","Ḩ":"H","Ḫ":"H","Ì":"I","?":"I","Î":"I","?":"I","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","?":"I","Ȉ":"I","Ȋ":"I","Ḭ":"I","Ḯ":"I","Ỉ":"I","Ị":"I","Ĵ":"J","Ķ":"K","Ǩ":"K","Ḱ":"K","Ḳ":"K","Ḵ":"K","Ĺ":"L","Ļ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ḻ":"L","Ḽ":"L","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ñ":"N","Ń":"N","Ņ":"N","Ň":"N","Ǹ":"N","Ṅ":"N","Ṇ":"N","Ṉ":"N","Ṋ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ō":"O","Ŏ":"O","?":"O","Ơ":"O","Ǒ":"O","Ǫ":"O","Ǭ":"O","Ȍ":"O","Ȏ":"O","Ȫ":"O","Ȭ":"O","Ȯ":"O","Ȱ":"O","Ṍ":"O","Ṏ":"O","?":"O","Ṓ":"O","Ọ":"O","Ỏ":"O","?":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ộ":"O","Ớ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ợ":"O","Ṕ":"P","Ṗ":"P","Ŕ":"R","Ŗ":"R","Ř":"R","?":"R","Ȓ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ṟ":"R","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṥ":"S","Ṧ":"S","Ṩ":"S","Ţ":"T","Ť":"T","Ț":"T","Ṫ":"T","Ṭ":"T","Ṯ":"T","Ṱ":"T","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","Ư":"U","Ǔ":"U","Ǖ":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ȕ":"U","Ȗ":"U","Ṳ":"U","Ṵ":"U","Ṷ":"U","Ṹ":"U","Ṻ":"U","Ụ":"U","Ủ":"U","Ứ":"U","Ừ":"U","Ử":"U","Ữ":"U","Ự":"U","Ṽ":"V","Ṿ":"V","Ŵ":"W","Ẁ":"W","Ẃ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẋ":"X","Ẍ":"X","?":"Y","Ŷ":"Y","Ÿ":"Y","Ȳ":"Y","Ẏ":"Y","Ỳ":"Y","Ỵ":"Y","Ỷ":"Y","Ỹ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","?":"Z","Ẓ":"Z","Ẕ":"Z","`":"`","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","?":"a","ă":"a","ą":"a","ǎ":"a","ǟ":"a","ǡ":"a","ǻ":"a","?":"a","ȃ":"a","ȧ":"a","?":"a","ạ":"a","ả":"a","ấ":"a","ầ":"a","ẩ":"a","ẫ":"a","":"a","ắ":"a","ằ":"a","ẳ":"a","ẵ":"a","ặ":"a","ḃ":"b","ḅ":"b","ḇ":"b","ç":"c","ć":"c","ĉ":"c","ċ":"c","?":"c","ḉ":"c","?":"d","ḋ":"d","?":"d","?":"d","ḑ":"d","ḓ":"d","è":"e","é":"e","ê":"e","ë":"e","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","ȅ":"e","ȇ":"e","ȩ":"e","ḕ":"e","ḗ":"e","ḙ":"e","ḛ":"e","?":"e","ẹ":"e","ẻ":"e","ẽ":"e","ế":"e","?":"e","ể":"e","ễ":"e","ệ":"e","ḟ":"f","?":"g","ğ":"g","ġ":"g","ģ":"g","ǧ":"g","ǵ":"g","ḡ":"g","ĥ":"h","ȟ":"h","ḣ":"h","ḥ":"h","ḧ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ì":"i","":"i","î":"i","ï":"i","ĩ":"i","ī":"i","":"i","į":"i","?":"i","ȉ":"i","ȋ":"i","":"i","ḯ":"i","ỉ":"i","ị":"i","ĵ":"j","ǰ":"j","ķ":"k","ǩ":"k","ḱ":"k","ḳ":"k","ḵ":"k","ĺ":"l","ļ":"l","ľ":"l","ḷ":"l","ḹ":"l","ḻ":"l","ḽ":"l","ḿ":"m","?":"m","ṃ":"m","ñ":"n","ń":"n","ņ":"n","ň":"n","ǹ":"n","ṅ":"n","ṇ":"n","ṉ":"n","ṋ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","?":"o","?":"o","ő":"o","ơ":"o","ǒ":"o","ǫ":"o","":"o","?":"o","?":"o","ȫ":"o","":"o","ȯ":"o","ȱ":"o","?":"o","?":"o","ṑ":"o","ṓ":"o","?":"o","?":"o","ố":"o","ồ":"o","ổ":"o","ỗ":"o","ộ":"o","ớ":"o","?":"o","ở":"o","ỡ":"o","ợ":"o","ṕ":"p","ṗ":"p","ŕ":"r","ŗ":"r","ř":"r","ȑ":"r","ȓ":"r","ṙ":"r","ṛ":"r","?":"r","ṟ":"r","ś":"s","?":"s","ş":"s","š":"s","ș":"s","ṡ":"s","ṣ":"s","ṥ":"s","ṧ":"s","ṩ":"s","ţ":"t","ť":"t","ț":"t","ṫ":"t","":"t","ṯ":"t","ṱ":"t","ẗ":"t","ù":"u","ú":"u","û":"u","ü":"u","ũ":"u","ū":"u","":"u","ů":"u","ű":"u","ų":"u","ư":"u","ǔ":"u","ǖ":"u","ǘ":"u","ǚ":"u","ǜ":"u","ȕ":"u","ȗ":"u","ṳ":"u","ṵ":"u","ṷ":"u","ṹ":"u","ṻ":"u","ụ":"u","ủ":"u","ứ":"u","ừ":"u","":"u","ữ":"u","ự":"u","ṽ":"v","ṿ":"v","ŵ":"w","?":"w","ẃ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẘ":"w","ẋ":"x","?":"x","ý":"y","ÿ":"y","ŷ":"y","ȳ":"y","?":"y","ẙ":"y","ỳ":"y","ỵ":"y","ỷ":"y","ỹ":"y","ź":"z","ż":"z","ž":"z","ẑ":"z","ẓ":"z","ẕ":"z"};diacriticMappingTable=SC.diacriticMappingTable}var original,replacement,ret="",length=this.length;for(var i=0;i<=length;++i){original=this.charAt(i);replacement=diacriticMappingTable[original];if(replacement){ret+=replacement}else{ret+=original}}return ret},trim:function(){return this.replace(SC.STRING_TRIM_REGEXP,"")},trimLeft:function(){return this.replace(SC.STRING_TRIM_LEFT_REGEXP,"")},trimRight:function(){return this.replace(SC.STRING_TRIM_RIGHT_REGEXP,"")}};SC.String.strip=SC.String.trim;SC.supplement(String.prototype,SC.String);String.prototype.loc=SC.String.loc;SC.String.fmt=String.prototype.fmt;sc_require("mixins/string");SC.MIXED_STATE="__MIXED__";SC.HUGE_CONTROL_SIZE="sc-huge-size";SC.LARGE_CONTROL_SIZE="sc-large-size";SC.REGULAR_CONTROL_SIZE="sc-regular-size";SC.SMALL_CONTROL_SIZE="sc-small-size";SC.TINY_CONTROL_SIZE="sc-tiny-size";SC.Control={initMixin:function(){this._control_contentDidChange()},isSelected:NO,isSelectedBindingDefault:SC.Binding.oneWay().bool(),isActive:NO,isActiveBindingDefault:SC.Binding.oneWay().bool(),value:null,content:null,contentValueKey:null,contentPropertyDidChange:function(target,key){return this.updatePropertyFromContent("value",key,"contentValueKey")},updatePropertyFromContent:function(prop,key,contentKey,content){var all=key==="*";if(contentKey===undefined){contentKey="content"+prop.capitalize()+"Key"}if(content===undefined){content=this.get("content")}contentKey=this[contentKey]?this.get(contentKey):this.getDelegateProperty(contentKey,this.displayDelegate);if(contentKey&&(all||key===contentKey)){var v=(content)?(content.get?content.get(contentKey):content[contentKey]):null;this.set(prop,v)}return this},updateContentWithValueObserver:function(){var key=this.contentValueKey?this.get("contentValueKey"):this.getDelegateProperty("contentValueKey",this.displayDelegate),content=this.get("content");if(!key||!content){return}var value=this.get("value");if(typeof content.setIfChanged===SC.T_FUNCTION){content.setIfChanged(key,value)}else{if(content[key]!==value){content[key]=value}}}.observes("value"),fieldKey:null,fieldLabel:null,errorLabel:function(){var ret,fk,def;if(ret=this.get("fieldLabel")){return ret}fk=this.get("fieldKey")||this.constructor.toString();def=(fk||"").humanize().capitalize();return"ErrorLabel."+fk.locWithDefault(("FieldKey."+fk).locWithDefault(def))}.property("fieldLabel","fieldKey").cacheable(),controlSize:SC.REGULAR_CONTROL_SIZE,displayProperties:"isEnabled isSelected isActive controlSize".w(),_CONTROL_TMP_CLASSNAMES:{},renderMixin:function(context,firstTime){var sel=this.get("isSelected"),disabled=!this.get("isEnabled"),names=this._CONTROL_TMP_CLASSNAMES;names.mixed=sel===SC.MIXED_STATE;names.sel=sel&&(sel!==SC.MIXED_STATE);names.active=this.get("isActive");context.setClass(names).addClass(this.get("controlSize"));if(!firstTime&&this.$input){var inps=this.$input();if(inps.attr("type")!=="radio"){this.$input().attr("disabled",disabled)}}},_control_content:null,_control_contentDidChange:function(){var content=this.get("content");if(this._control_content===content){return}var f=this.contentPropertyDidChange,old=this._control_content;if(old&&old.removeObserver){old.removeObserver("*",this,f)}this._control_content=content;if(content&&content.addObserver){content.addObserver("*",this,f)}this.contentPropertyDidChange(content,"*")}.observes("content")};SC.Editable={isEditable:NO,isEditing:NO,beginEditing:function(){if(!this.get("isEditable")){return NO}if(this.get("isEditing")){return YES}this.set("isEditing",YES);this.becomeFirstResponder();return YES},discardEditing:function(){return !this.get("isEditing")},commitEditing:function(){if(!this.get("isEditing")){return YES}this.set("isEditing",NO);this.resignFirstResponder();return YES}};SC.browser=(function(){var userAgent=navigator.userAgent.toLowerCase();var version=(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1];var browser={version:version,safari:(/webkit/).test(userAgent)?version:0,opera:(/opera/).test(userAgent)?version:0,msie:(/msie/).test(userAgent)&&!(/opera/).test(userAgent)?version:0,mozilla:(/mozilla/).test(userAgent)&&!(/(compatible|webkit)/).test(userAgent)?version:0,mobileSafari:(/apple.*mobile.*safari/).test(userAgent)?version:0,windows:!!(/(windows)/).test(userAgent),mac:!!((/(macintosh)/).test(userAgent)||(/(mac os x)/).test(userAgent)),language:(navigator.language||navigator.browserLanguage).split("-",1)[0],touch:("createTouch" in document)};SC.extend(browser,{isOpera:!!browser.opera,isIe:!!browser.msie,isIE:!!browser.msie,isSafari:!!browser.safari,isMobileSafari:!!browser.mobileSafari,isMozilla:!!browser.mozilla,isWindows:!!browser.windows,isMac:!!browser.mac,current:browser.msie?"msie":browser.mozilla?"mozilla":browser.safari?"safari":browser.opera?"opera":"unknown",compareVersion:function(){if(this._versionSplit===undefined){function coerce(part){return Number(part.match(/^[0-9]+/))}this._versionSplit=SC.A(this.version.split(".")).map(coerce)}var tests=SC.A(arguments).map(Number);for(var i=0;i<tests.length;i++){var check=this._versionSplit[i]-tests[i];if(isNaN(check)){return 0}if(check!==0){return check}}return 0}});return browser})();SC.Builder=function(props){return SC.Builder.create(props)};SC.Builder.create=function create(props){var fn=SC.mixin(SC.beget(this.fn),props||{});if(props.hasOwnProperty("toString")){fn.toString=props.toString}var construct=function(){var ret=SC.beget(fn);ret.defaultClass=this;ret.constructor=construct;return ret.init.apply(ret,arguments)};construct.fn=construct.prototype=fn;construct.extend=SC.Builder.create;construct.mixin=SC.Builder.mixin;return construct};SC.Builder.mixin=function(){var len=arguments.length,idx;for(idx=0;idx<len;idx++){SC.mixin(this,arguments[idx])}return this};SC.Builder.fn={init:function(content){if(content!==undefined){if(SC.typeOf(content)===SC.T_ARRAY){var loc=content.length;while(--loc>=0){this[loc]=content.objectAt?content.objectAt(loc):content[loc]}this.length=content.length}else{this[0]=content;this.length=1}}return this},size:function(){return this.length},pushStack:function(){var ret=this.constructor.apply(this,arguments);ret.prevObject=this;return ret},end:function(){return this.prevObject||this.constructor()},toString:function(){return"%@$(%@)".fmt(this.defaultClass.toString(),SC.A(this).invoke("toString").join(","))},mixin:SC.Builder.mixin};(function(){var enumerable=SC.Enumerable,fn=SC.Builder.fn,key,value;for(key in enumerable){if(!enumerable.hasOwnProperty(key)){continue}value=Array.prototype[key]||enumerable[key];fn[key]=value}})();sc_require("system/builder");SC.CoreQuery=(function(){var quickExpr=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,isSimple=/^.[^:#\[\.]*$/;var CQHtmlRegEx=/ CQ\d+="(?:\d+|null)"/g,tagSearchRegEx=/(<(\w+)[^>]*?)\/>/g,xmlTagsRegEx=/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i,checkforSpaceRegEx=/\s+/,trimWhiteSpaceRegEx=/^\s+/,bodyHTMLOffsetRegEx=/^body|html$/i,specialAttributesRegEx=/href|src|style/,tagsWithTabIndexRegEx=/(button|input|object|select|textarea)/i,alphaDetectRegEx=/alpha\([^)]*\)/,alphaReplaceRegEx=/opacity=([^)]*)/;var styleFloat=SC.browser.msie?"styleFloat":"cssFloat";var chars=(SC.browser.safari&&parseInt(SC.browser.version,0)<417)?"(?:[\\w*_-]|\\\\.)":"(?:[\\w\u0128-\uFFFF*_-]|\\\\.)";var quickID=new RegExp("^("+chars+"+)(#)("+chars+"+)");var singleClass=new RegExp("^([#.]?)("+chars+"*)");var quickSplit=new RegExp("([#.]?)("+chars+"*)","g");var LEFT_RIGHT=["Left","Right"];var TOP_BOTTOM=["Top","Bottom"];var CSS_DISPLAY_PROPS={position:"absolute",visibility:"hidden",display:"block"};var getWH=function getWH(elem,name,which){var val=name==="width"?elem.offsetWidth:elem.offsetHeight;var padding=0,border=0,loc=which.length,dim;while(--loc>=0){dim=which[loc];padding+=parseFloat(CQ.curCSS(elem,"padding"+dim,true))||0;border+=parseFloat(CQ.curCSS(elem,"border"+dim+"Width",true))||0}val-=Math.round(padding+border);return val};var expando=SC.guidKey,uuid=0,windowData={},exclude=/z-?index|font-?weight|opacity|zoom|line-?height/i,defaultView=document.defaultView||{};var styleIsBorked=function styleIsBorked(elem){if(!SC.browser.safari){return false}var ret=defaultView.getComputedStyle(elem,null);return !ret||ret.getPropertyValue("color")===""};function num(elem,prop){return elem[0]&&parseInt(CQ.curCSS(elem[0],prop,true),10)||0}var CoreQuery,CQ;CQ=CoreQuery=SC.Builder.create({jquery:"SC.CoreQuery",init:function(selector,context){selector=selector||document;if(selector.nodeType){this[0]=selector;this.length=1;return this}else{if(typeof selector==="string"){var match=quickExpr.exec(selector);if(match&&(match[1]||!context)){if(match[1]){selector=CQ.clean([match[1]],context)}else{var elem=document.getElementById(match[3]);if(elem){if(elem.id!=match[3]){return CQ().find(selector)}return CQ(elem)}selector=[]}}else{return CQ(context).find(selector)}}else{if(SC.typeOf(selector)===SC.T_FUNCTION){return SC.ready(selector)}}}return this.setArray(CQ.makeArray(selector))},size:function(){return this.length},get:function(num){return num===undefined?CQ.makeArray(this):this[num]},find:function(selector){var elems=CQ.map(this,function(elem){return CQ.find(selector,elem)});return this.pushStack(elems)},filter:function(selector){return this.pushStack((SC.typeOf(selector)===SC.T_FUNCTION)&&CQ.grep(this,function(elem,i){return selector.call(elem,i)})||CQ.multiFilter(selector,this))},not:function(selector){if(typeof selector==="string"){if(isSimple.test(selector)){return this.pushStack(CQ.multiFilter(selector,this,true))}else{selector=CQ.multiFilter(selector,this)}}var isArrayLike=selector.length&&selector[selector.length-1]!==undefined&&!selector.nodeType;return this.filter(function(){return isArrayLike?CQ.inArray(this,selector)<0:this!=selector})},setArray:function(elems){this.length=0;Array.prototype.push.apply(this,elems);return this},map:function(callback){return this.pushStack(CQ.map(this,function(elem,i){return callback.call(elem,i,elem)}))},each:function(callback,args){return CQ.each(this,callback,args)},index:function(elem){if(elem&&elem.jquery){elem=elem[0]}return Array.prototype.indexOf.call(this,elem)},eq:function(i){return this.slice(i,+i+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))},add:function(selector){return this.pushStack(CQ.merge(this.get(),typeof selector==="string"?CQ(selector):CQ.makeArray(selector)).uniq())},attr:function(name,value,type){var options=name;if(typeof name==="string"){if(value===undefined){return this[0]&&CQ[type||"attr"](this[0],name)}else{options={};options[name]=value}}return this.each(function(i){for(name in options){CQ.attr((type)?this.style:this,name,CQ.prop(this,options[name],type,i,name))}})},html:function(value){return value===undefined?(this[0]?this[0].innerHTML.replace(CQHtmlRegEx,""):null):this.empty().append(value)},andSelf:function(){return this.add(this.prevObject)},is:function(selector){return !!selector&&CQ.multiFilter(selector,this).length>0},hasClass:function(className){return Array.prototype.every.call(this,function(elem){return(elem.nodeType===1)&&CQ.className.has(elem,className)})},val:function(value){if(value===undefined){var elem=this[0];if(elem){if(CQ.nodeName(elem,"option")){return(elem.attributes.value||{}).specified?elem.value:elem.text}if(CQ.nodeName(elem,"select")){var index=elem.selectedIndex,values=[],options=elem.options,one=elem.type==="select-one",option;if(index<0){return null}var i,max=one?index+1:options.length;for(i=one?index:0;i<max;i++){option=options[i];if(option.selected){value=CQ(option).val();if(one){return value}values.push(value)}}return values}return(elem.value||"").replace(/\r/g,"")}return undefined}else{if(typeof value==="number"){value+=""}this.each(function(){if(this.nodeType!==1){return}if(SC.typeOf(value)===SC.T_ARRAY&&(/radio|checkbox/).test(this.type)){this.checked=(CQ.inArray(this.value,value)>=0||CQ.inArray(this.name,value)>=0)}else{if(CQ.nodeName(this,"select")){var values=CQ.makeArray(value);CQ("option",this).each(function(){this.selected=(CQ.inArray(this.value,values)>=0||CQ.inArray(this.text,values)>=0)});if(!values.length){this.selectedIndex=-1}}else{this.value=value}}})}return this},clone:function(){var ret=this.map(function(){if(SC.browser.msie&&!CQ.isXMLDoc(this)){var clone=this.cloneNode(true),container=document.createElement("div");container.appendChild(clone);return CQ.clean([container.innerHTML])[0]}else{return this.cloneNode(true)}});var clone=ret.find("*").andSelf().each(function(){if(this[SC.guidKey]!==undefined){this[SC.guidKey]=null}});return ret},css:function(key,value){if((key==="width"||key==="height")&&parseFloat(value,0)<0){value=undefined}return this.attr(key,value,"curCSS")},text:function(text){if(text!==undefined&&typeof text!=="object"&&text!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(text))}var ret="";CQ.each(text||this,function(){CQ.each(this.childNodes,function(){if(this.nodeType!==8){ret+=this.nodeType!==1?this.nodeValue:CQ.fn.text([this])}})});return ret},show:function(){var isVisible=SC.$.isVisible;this.each(function(){if(!isVisible(this)){this.style.display=this.oldblock||"";if(CQ.css(this,"display")==="none"){var elem=CQ("<"+this.tagName+"/>");CQ("body").append(elem);this.style.display=elem.css("display");if(this.style.display==="none"){this.style.display="block"}elem.remove();elem=null}}});return this},hide:function(){var isVisible=SC.$.isVisible;this.each(function(){if(isVisible(this)){this.oldblock=this.oldblock||CQ.css(this,"display");this.style.display="none"}});return this},domManip:function(args,table,reverse,callback){var clone=this.length>1,elems;return this.each(function(){if(!elems){elems=CQ.clean(args,this.ownerDocument);if(reverse){elems.reverse()}}var obj=this;if(table&&CQ.nodeName(this,"table")&&CQ.nodeName(elems[0],"tr")){obj=this.getElementsByTagName("tbody")[0]||this.appendChild(this.ownerDocument.createElement("tbody"))}CQ.each(elems,function(){var elem=clone?CQ(this).clone(true)[0]:this;callback.call(obj,elem)})})},append:function(){return this.domManip(arguments,true,false,function(elem){if(this.nodeType===1){this.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,true,true,function(elem){if(this.nodeType===1){this.insertBefore(elem,this.firstChild)}})},before:function(){return this.domManip(arguments,false,false,function(elem){this.parentNode.insertBefore(elem,this)})},after:function(){return this.domManip(arguments,false,true,function(elem){this.parentNode.insertBefore(elem,this.nextSibling)})},replaceWith:function(value){return this.after(value).remove()},removeData:function(key){return this.each(function(){SC.removeData(this,key)})}});CoreQuery.mixin({nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()===name.toUpperCase()},map:function(elems,callback){var ret=[],value,i,length;for(i=0,length=elems.length;i<length;i++){value=callback(elems[i],i);if(value!=null){ret[ret.length]=value}}return ret.concat.apply([],ret)},each:function(object,callback,args){var name,i=0,length=object.length;if(args){if(length===undefined){for(name in object){if(callback.apply(object[name],args)===false){break}}}else{for(;i<length;){if(callback.apply(object[i++],args)===false){break}}}}else{if(length===undefined){for(name in object){if(callback.call(object[name],name,object[name])===false){break}}}else{for(var value=object[0];i<length&&callback.call(value,i,value)!==false;value=object[++i]){}}}return object},isXMLDoc:function(elem){return elem.documentElement&&!elem.body||elem.tagName&&elem.ownerDocument&&!elem.ownerDocument.body},clean:function(elems,context){var ret=[];context=context||document;if(typeof context.createElement=="undefined"){context=context.ownerDocument||context[0]&&context[0].ownerDocument||document}CQ.each(elems,function(i,elem){if(typeof elem==="number"){elem+=""}if(!elem){return}if(typeof elem==="string"){elem=elem.replace(tagSearchRegEx,function(all,front,tag){return tag.match(xmlTagsRegEx)?all:front+"></"+tag+">"});var tags=elem.replace(trimWhiteSpaceRegEx,"").substring(0,10).toLowerCase(),div=context.createElement("div");var wrap=!tags.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!tags.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||tags.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!tags.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!tags.indexOf("<td")||!tags.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!tags.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||SC.browser.msie&&[1,"div<div>","</div>"]||[0,"",""];div.innerHTML=wrap[1]+elem+wrap[2];while(wrap[0]--){div=div.lastChild}if(SC.browser.msie){var tbody=!tags.indexOf("<table")&&tags.indexOf("<tbody")<0?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&tags.indexOf("<tbody")<0?div.childNodes:[];for(var j=tbody.length-1;j>=0;--j){if(CQ.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j])}}if(/^\s/.test(elem)){div.insertBefore(context.createTextNode(elem.match(/^\s*/)[0]),div.firstChild)}}elem=CQ.makeArray(div.childNodes)}if(elem.length===0&&(!CQ.nodeName(elem,"form")&&!CQ.nodeName(elem,"select"))){return}if(elem[0]===undefined||CQ.nodeName(elem,"form")||elem.options){ret.push(elem)}else{ret=CQ.merge(ret,elem)}});return ret},find:function(t,context){var ret;if(typeof t!=="string"){return[t]}if(t.indexOf(",")>=0){ret=t.split(",").map(function(sel){return CQ.find(sel,context)});return ret.concat.apply([],ret).uniq()}if(context&&context.nodeType!==1&&context.nodeType!==9){return[]}context=context||document;ret=[context];var nodeName,inFindMode=YES,parts=t.match(quickSplit),len=parts.length,m;for(var idx=0;idx<len;idx++){t=parts[idx];if(t===" "||t===""){inFindMode=YES}else{if(inFindMode){m=singleClass.exec(t);if((m[1]==="")&&(idx<(len-1))&&(parts[idx+1].charAt(0)==="#")){t=parts[idx+1];parts[idx+1]=parts[idx];m=singleClass.exec(t)}var next=[],retlen=ret.length,retidx,cur,val=m[2],found;for(retidx=0;retidx<retlen;retidx++){cur=ret[retidx];switch(m[1]){case"":if(!val){val="*"}if(val==="*"&&cur.nodeName.toLowerCase()==="object"){val="param"}next=CQ.merge(next,cur.getElementsByTagName(val));break;case"#":if(cur===document){found=document.getElementById(val);if(SC.browser.msie&&found&&found.getAttribute("id")!==val){found=NO}else{if(found){next.push(found)}found=YES}}else{found=NO}if(!found){found=cur.getElementsByTagName("*");found=Array.prototype.find.call(found,function(el){return el.getAttribute&&(el.getAttribute("id")===val)});if(found){next.push(found)}}break;case".":if(cur.getElementsByClassName){next=CQ.merge(next,cur.getElementsByClassName(val))}else{next=CQ.merge(next,CQ.classFilter(cur.getElementsByTagName("*"),val))}break;default:}}delete ret;ret=next;inFindMode=NO}else{ret=CQ.filter(t,ret)}}}if(ret&&ret[0]==context){ret.shift()}return ret.uniq()},classFilter:function(r,m,not){m=" "+m+" ";var tmp=[],pass;for(var i=0;r[i];i++){pass=(" "+r[i].className+" ").indexOf(m)>=0;if(!not&&pass||not&&!pass){tmp.push(r[i])}}return tmp},filter:function(t,r,not){var m=singleClass.exec(t),val=m[2],kind=m[1],filter;if(kind==="."){return CQ.classFilter(CQ.makeArray(r),val,not)}else{if(kind==="#"){filter=function(el){var ret=el&&el.getAttribute&&(el.getAttribute("id")===val);return(not)?!ret:ret}}else{filter=function(el){var ret=CQ.nodeName(el,val);return(not)?!ret:ret}}return Array.prototype.filter.call(CQ.makeArray(r),filter)}},multiFilter:function(expr,elems,not){expr=expr.indexOf(",")?expr.split(","):[expr];var loc=expr.length,cur,ret=[];while(--loc>=0){cur=CQ.filter(expr[loc].trim(),elems,not);ret=not?elems=cur:CQ.merge(cur,ret)}return ret},merge:function(first,second){var i=0,elem,pos=first.length;if(SC.browser.msie){while(elem=second[i++]){if(elem.nodeType!==8){first[pos++]=elem}}}else{while(elem=second[i++]){first[pos++]=elem}}return first},makeArray:function(array){var ret=[];if(array!==undefined||array!=null){var i=array.length;if(i==null||typeof array==="string"||array.setInterval){ret[0]=array}else{while(i){ret[--i]=array[i]}}}return ret},inArray:function(elem,array){return array.indexOf?array.indexOf(elem):Array.prototype.indexOf.call(array,elem)},boxModel:!SC.browser.msie||document.compatMode==="CSS1Compat",props:{"for":"htmlFor","class":"className","float":styleFloat,cssFloat:styleFloat,styleFloat:styleFloat,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan"},prop:function(elem,value,type,i,name){if(SC.typeOf(value)===SC.T_FUNCTION){value=value.call(elem,i)}return value&&(typeof value==="number")&&type==="curCSS"&&!exclude.test(name)?value+"px":value},grep:function(elems,callback,inv){var ret=[];for(var i=0,length=elems.length;i<length;i++){if(!inv!=!callback(elems[i],i)){ret.push(elems[i])}}return ret},className:{add:function(elem,classNames){var has=CQ.className.has;CQ.each((classNames||"").split(checkforSpaceRegEx),function(i,className){if(elem.nodeType===1&&!has(elem.className,className)){elem.className+=(elem.className?" ":"")+className}})},remove:function(elem,classNames){if(elem.nodeType===1){elem.className=classNames!==undefined?CQ.grep(elem.className.split(checkforSpaceRegEx),function(className){return !CQ.className.has(classNames,className)}).join(" "):""}},has:function(elem,className){return elem&&CQ.inArray(className,(elem.className||elem).toString().split(checkforSpaceRegEx))>-1}},swap:function(elem,options,callback,direction,arg){var old={},name;for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}var ret=callback(elem,direction,arg);for(name in options){elem.style[name]=old[name]}return ret},css:function(elem,name,force){if(name==="width"||name==="height"){var val,which=(name==="width")?LEFT_RIGHT:TOP_BOTTOM,props=CSS_DISPLAY_PROPS;val=SC.$.isVisible(elem)?getWH(elem,name,which):CQ.swap(elem,props,getWH,name,which);return Math.max(0,val)}return CQ.curCSS(elem,name,force)},curCSS:function(elem,name,force){var ret,style=elem.style;if(name==="opacity"&&SC.browser.msie){ret=CQ.attr(style,"opacity");return ret===""?"1":ret}if(SC.browser.opera&&name==="display"){var save=style.outline;style.outline="0 solid black";style.outline=save}var isFloat=name.match(/float/i);if(isFloat){name=styleFloat}if(!force&&style&&style[name]){ret=style[name]}else{if(defaultView.getComputedStyle){if(isFloat){name="float"}name=name.replace(/([A-Z])/g,"-$1").toLowerCase();var computedStyle=defaultView.getComputedStyle(elem,null);if(computedStyle&&!styleIsBorked(elem,defaultView)){ret=computedStyle.getPropertyValue(name)}else{var swap=[],stack=[],a=elem,i=0,swLen,stLen;for(;a&&styleIsBorked(a);a=a.parentNode){stack.unshift(a)}for(stLen=stack.length;i<stLen;i++){if(styleIsBorked(stack[i])){swap[i]=stack[i].style.display;stack[i].style.display="block"}}ret=(name==="display"&&swap[stack.length-1]!==null)?"none":(computedStyle&&computedStyle.getPropertyValue(name))||"";for(i=0,swLen=swap.length;i<swLen;i++){if(swap[i]!==null){stack[i].style.display=swap[i]}}}if(name==="opacity"&&ret===""){ret="1"}}else{if(elem.currentStyle){ret=elem.currentStyle[name]||elem.currentStyle[name.camelize()];if(!(/^\d+(px)?$/i).test(ret)&&(/^\d/).test(ret)){var left=style.left,rsLeft=elem.runtimeStyle.left;elem.runtimeStyle.left=elem.currentStyle.left;style.left=ret||0;ret=style.pixelLeft+"px";style.left=left;elem.runtimeStyle.left=rsLeft}}}}return ret},dir:function(elem,dir){var matched=[],cur=elem[dir];while(cur&&cur!=document){if(cur.nodeType===1){matched.push(cur)}cur=cur[dir]}return matched},nth:function(cur,result,dir,elem){result=result||1;var num=0;for(;cur;cur=cur[dir]){if(cur.nodeType===1&&++num==result){break}}return cur},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!=elem){r.push(n)}}return r},attr:function(elem,name,value){if(!elem||elem.nodeType===3||elem.nodeType===8){return undefined}var notxml=!CQ.isXMLDoc(elem),set=value!==undefined,msie=SC.browser.msie;name=notxml&&CQ.props[name]||name;if(elem.tagName){var special=specialAttributesRegEx.test(name);if(name==="selected"&&elem.parentNode){elem.parentNode.selectedIndex}if(name in elem&&notxml&&!special){if(set){if(name==="type"&&CQ.nodeName(elem,"input")&&elem.parentNode){throw"type property can't be changed"}elem[name]=value}if(CQ.nodeName(elem,"form")&&elem.getAttributeNode(name)){return elem.getAttributeNode(name).nodeValue}if(name==="tabIndex"){var attributeNode=elem.getAttributeNode("tabIndex");return attributeNode&&attributeNode.specified?attributeNode.value:elem.nodeName.match(tagsWithTabIndexRegEx)?0:elem.nodeName.match(/^(a|area)$/i)&&elem.href?0:undefined}return elem[name]}if(msie&&notxml&&name==="style"){return CQ.attr(elem.style,"cssText",value)}if(set){elem.setAttribute(name,""+value)}var attr=(msie&&notxml&&special)?elem.getAttribute(name,2):elem.getAttribute(name);return attr===null?undefined:attr}if(msie&&name==="opacity"){if(set){elem.zoom=1;elem.filter=(elem.filter||"").replace(alphaDetectRegEx,"")+(parseInt(value,0)+""=="NaN"?"":"alpha(opacity="+value*100+")")}return elem.filter&&elem.filter.indexOf("opacity=")>=0?(parseFloat(elem.filter.match(alphaReplaceRegEx)[1])/100)+"":""}name=name.camelize();if(set){elem[name]=value}return elem[name]}});CQ.fn.init.prototype=CQ.fn;CQ.each({parent:function(elem){return elem.parentNode},parents:function(elem){return CQ.dir(elem,"parentNode")},next:function(elem){return CQ.nth(elem,2,"nextSibling")},prev:function(elem){return CQ.nth(elem,2,"previousSibling")},nextAll:function(elem){return CQ.dir(elem,"nextSibling")},prevAll:function(elem){return CQ.dir(elem,"previousSibling")},siblings:function(elem){return CQ.sibling(elem.parentNode.firstChild,elem)},children:function(elem){return CQ.sibling(elem.firstChild)},contents:function(elem){return CQ.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:CQ.makeArray(elem.childNodes)}},function(name,fn){CQ.fn[name]=function(selector){var ret=CQ.map(this,fn);if(selector&&typeof selector==="string"){ret=CQ.multiFilter(selector,ret)}return this.pushStack(ret.uniq())}});CQ.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){CQ.fn[name]=function(){var args=arguments;return this.each(function(){for(var i=0,length=args.length;i<length;i++){CQ(args[i])[original](this)}})}});CQ.each({removeAttr:function(name){CQ.attr(this,name,"");if(this.nodeType===1){this.removeAttribute(name)}},addClass:function(classNames){CQ.className.add(this,classNames)},removeClass:function(classNames){CQ.className.remove(this,classNames)},toggleClass:function(classNames){CQ.className[CQ.className.has(this,classNames)?"remove":"add"](this,classNames)},remove:function(selector){if(!selector||CQ.filter(selector,[this]).length){if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){while(this.firstChild){this.removeChild(this.firstChild)}}},function(name,fn){CQ.fn[name]=function(){return this.each(fn,arguments)}});CQ.each(["Height","Width"],function(i,name){var type=name.toLowerCase(),ret;CQ.fn[type]=function(size){if(this[0]===window){if(SC.browser.opera){ret=document.body["client"+name]}else{if(SC.browser.safari){ret=window["inner"+name]}else{if(document.compatMode){ret=documentElement["client"+name]}else{ret=document.body["client"+name]}}}}else{if(this[0]===document){ret=Math.max(Math.max(document.body["scroll"+name],document.documentElement["scroll"+name]),Math.max(document.body["offset"+name],document.documentElement["offset"+name]))}else{if(size===undefined){return this.length?CQ.css(this[0],type):null}else{return this.css(type,(typeof size==="string")?size:size+"px")}}}return ret};var tl=i?"Left":"Top",br=i?"Right":"Bottom";CQ.fn["inner"+name]=function(){return this[name.toLowerCase()]()+num(this,"padding"+tl)+num(this,"padding"+br)};CQ.fn["outer"+name]=function(margin){return this["inner"+name]()+num(this,"border"+tl+"Width")+num(this,"border"+br+"Width")+(margin?num(this,"margin"+tl)+num(this,"margin"+br):0)}});CoreQuery.fn.offset=function(){var left=0,top=0,elem=this[0],br=SC.browser,results;if(!elem){return undefined}function border(elem){add(CQ.curCSS(elem,"borderLeftWidth",true),CQ.curCSS(elem,"borderTopWidth",true))}function add(l,t){left+=parseInt(l,10)||0;top+=parseInt(t,10)||0}var parent=elem.parentNode,offsetChild=elem,offsetParent=elem.offsetParent,doc=elem.ownerDocument,safari2=br.safari&&parseInt(br.version,0)<522&&!(/adobeair/i).test(br.userAgent),css=CQ.curCSS,fixed=CQ.css(elem,"position")==="fixed";if(!(br.mozilla&&elem==document.body)&&elem.getBoundingClientRect){var box=elem.getBoundingClientRect();add(box.left+Math.max(doc.documentElement.scrollLeft,doc.body.scrollLeft),box.top+Math.max(doc.documentElement.scrollTop,doc.body.scrollTop));add(-doc.documentElement.clientLeft,-doc.documentElement.clientTop)}else{add(elem.offsetLeft,elem.offsetTop);while(offsetParent){add(offsetParent.offsetLeft,offsetParent.offsetTop);if(br.mozilla&&!(/^t(able|d|h)$/i).test(offsetParent.tagName)||br.safari&&!safari2){border(offsetParent)}if(!fixed&&css(offsetParent,"position")==="fixed"){fixed=true}offsetChild=(/^body$/i).test(offsetParent.tagName)?offsetChild:offsetParent;offsetParent=offsetParent.offsetParent}while(parent&&parent.tagName&&!(bodyHTMLOffsetRegEx).test(parent.tagName)){if(!(/^inline|table.*$/i).test(css(parent,"display"))){add(-parent.scrollLeft,-parent.scrollTop)}if(br.mozilla&&css(parent,"overflow")!=="visible"){border(parent)}parent=parent.parentNode}if((safari2&&(fixed||css(offsetChild,"position")==="absolute"))||(br.mozilla&&css(offsetChild,"position")!=="absolute")){add(-doc.body.offsetLeft,-doc.body.offsetTop)}if(fixed){add(Math.max(doc.documentElement.scrollLeft,doc.body.scrollLeft),Math.max(doc.documentElement.scrollTop,doc.body.scrollTop))}}results={top:top,left:left};return results};CoreQuery.fn.mixin({position:function(){var left=0,top=0,results;if(this[0]){var offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=bodyHTMLOffsetRegEx.test(offsetParent[0].tagName)?{top:0,left:0}:offsetParent.offset();offset.top-=num(this,"marginTop");offset.left-=num(this,"marginLeft");parentOffset.top+=num(offsetParent,"borderTopWidth");parentOffset.left+=num(offsetParent,"borderLeftWidth");results={top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}}return results},offsetParent:function(){var offsetParent=this[0].offsetParent||document.body;while(offsetParent&&(!(bodyHTMLOffsetRegEx).test(offsetParent.tagName)&&CQ.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return CQ(offsetParent)}});CQ.each(["Left","Top"],function(i,name){var method="scroll"+name;CQ.fn[method]=function(val){if(!this[0]){return}return val!==undefined?this.each(function(){this==window||this==document?window.scrollTo(!i?val:CQ(window).scrollLeft(),i?val:CQ(window).scrollTop()):this[method]=val}):this[0]==window||this[0]==document?self[i?"pageYOffset":"pageXOffset"]||CQ.boxModel&&document.documentElement[method]||document.body[method]:this[0][method]}});return CoreQuery}());SC.$=(typeof jQuery=="undefined")?SC.CoreQuery:jQuery;SC.mixin(SC.$.fn,{isCoreQuery:YES,toString:function(){var values=[];var len=this.length,idx=0;for(idx=0;idx<len;idx++){values[idx]="%@: %@".fmt(idx,this[idx]?this[idx].toString():"(null)")}return"<$:%@>(%@)".fmt(SC.guidFor(this),values.join(" , "))},isVisible:function(){return Array.prototype.every.call(this,function(elem){return SC.$.isVisible(elem)})},first:function(){return this.pushStack([this[0]])},last:function(){return this.pushStack([this[this.length-1]])},view:function(){return this.map(function(){var ret=null,guidKey=SC.viewKey,dom=this,value;while(!ret&&dom&&(dom!==document)){if(value=dom.getAttribute("id")){ret=SC.View.views[value]}dom=dom.parentNode}dom=null;return ret})},setClass:function(className,shouldAdd){if(SC.none(className)){return this}var isHash=SC.typeOf(className)!==SC.T_STRING;var fix=this._fixupClass,key;this.each(function(){if(this.nodeType!==1){return}var classNames=this.className.split(/\s+/),didChange=NO;if(isHash){for(var key in className){if(!className.hasOwnProperty(key)){continue}didChange=fix(classNames,key,className[key])||didChange}}else{didChange=fix(classNames,className,shouldAdd)}if(didChange){this.className=classNames.join(" ")}});return this},_fixupClass:function(classNames,name,shouldAdd){var indexOf=classNames.indexOf(name);if(shouldAdd){if(indexOf<0){classNames.push(name);return YES}}else{if(indexOf>=0){classNames[indexOf]=null;return YES}}return NO},within:function(el){el=SC.$(el);var ret,elCur,myCur,idx,len=el.length;var loc=this.length;while(!ret&&(--loc>=0)){myCur=this[loc];for(idx=0;!ret&&(idx<len);idx++){elCur=el[idx];while(elCur&&(elCur!==myCur)){elCur=elCur.parentNode}ret=elCur===myCur}}myCur=elCur=null;return ret}});(function(){var original={};var wrappers={find:function(callback,target){return(target!==undefined)?SC.Enumerable.find.call(this,callback,target):original.find.call(this,callback)},filter:function(callback,target){return(target!==undefined)?this.pushStack(SC.Enumerable.filter.call(this,callback,target)):original.filter.call(this,callback)},filterProperty:function(key,value){return this.pushStack(SC.Enumerable.filterProperty.call(this,key,value))},indexOf:SC.$.index,map:function(callback,target){return(target!==undefined)?SC.Enumerable.map.call(this,callback,target):original.map.call(this,callback)}};var isCoreQuery=SC.$.jquery==="SC.CoreQuery",fn=SC.$.fn,enumerable=isCoreQuery?wrappers:SC.Enumerable,value;for(var key in enumerable){if(!enumerable.hasOwnProperty(key)){continue}value=enumerable[key];if(key in wrappers){original[key]=fn[key];value=wrappers[key]}fn[key]=value}})();SC.mixin(SC.$,{isVisible:function(elem){var CQ=SC.$;return("hidden"!=elem.type)&&(CQ.css(elem,"display")!="none")&&(CQ.css(elem,"visibility")!="hidden")}});sc_require("system/core_query");SC.Event=function(originalEvent){if(originalEvent){this.originalEvent=originalEvent;var props=SC.Event._props,len=props.length,idx=len,key;while(--idx>=0){key=props[idx];this[key]=originalEvent[key]}}this.timeStamp=this.timeStamp||Date.now();if(!this.target){this.target=this.srcElement||document}if(this.target.nodeType===3){this.target=this.target.parentNode}if(!this.relatedTarget&&this.fromElement){this.relatedTarget=(this.fromElement===this.target)?this.toElement:this.fromElement}if(SC.none(this.pageX)&&!SC.none(this.clientX)){var doc=document.documentElement,body=document.body;this.pageX=this.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc.clientLeft||0);this.pageY=this.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc.clientTop||0)}if(!this.which&&((this.charCode||originalEvent.charCode===0)?this.charCode:this.keyCode)){this.which=this.charCode||this.keyCode}if(!this.metaKey&&this.ctrlKey){this.metaKey=this.ctrlKey}if(!this.which&&this.button){this.which=((this.button&1)?1:((this.button&2)?3:((this.button&4)?2:0)))}if(SC.browser.safari&&originalEvent.wheelDelta!==undefined){this.wheelDelta=0-(originalEvent.wheelDeltaY||originalEvent.wheelDeltaX);this.wheelDeltaY=0-(originalEvent.wheelDeltaY||0);this.wheelDeltaX=0-(originalEvent.wheelDeltaX||0)}else{if(!SC.none(originalEvent.detail)){var detail=Math.floor(originalEvent.detail*40);if(originalEvent.axis&&(originalEvent.axis===originalEvent.HORIZONTAL_AXIS)){this.wheelDeltaX=detail;this.wheelDeltaY=this.wheelDelta=0}else{this.wheelDeltaY=this.wheelDelta=detail;this.wheelDeltaX=0}}else{this.wheelDelta=this.wheelDeltaY=SC.browser.msie?0-originalEvent.wheelDelta:originalEvent.wheelDelta;this.wheelDeltaX=0}}if(SC.browser.touch){var touches=this.changedTouches,target,elem;if(touches&&touches.length>0){var firstTouch=touches[0];this.pageX=firstTouch.pageX;this.pageY=firstTouch.pageY}target=elem=this.target;if(target===SC.RootResponder.responder._touchInterceptElement){elem.style.display="none";target=document.elementFromPoint(this.pageX,this.pageY);this.target=target;elem.style.display="block"}target=elem=null}return this};SC.mixin(SC.Event,{create:function(e){return new SC.Event(e)},add:function(elem,eventType,target,method,context){if(elem&&elem.isCoreQuery){if(elem.length>0){elem.forEach(function(e){this.add(e,eventType,target,method,context)},this);return this}else{elem=elem[0]}}if(!elem){return this}if(elem.nodeType===3||elem.nodeType===8){return SC.Event}if(SC.browser.msie&&elem.setInterval){elem=window}if(SC.typeOf(target)===SC.T_FUNCTION){context=method;method=target;target=null}else{if(target&&SC.typeOf(method)===SC.T_STRING){method=target[method]}}var events=SC.data(elem,"events")||SC.data(elem,"events",{}),handlers=events[eventType];if(!handlers){handlers=events[eventType]={};this._addEventListener(elem,eventType)}handlers[SC.guidFor(method)]=[target,method,context];SC.Event._global[eventType]=YES;elem=events=handlers=null;return this},remove:function(elem,eventType,target,method){if(elem&&elem.isCoreQuery){if(elem.length>0){elem.forEach(function(e){this.remove(e,eventType,target,method)},this);return this}else{elem=elem[0]}}if(!elem){return this}if(elem.nodeType===3||elem.nodeType===8){return SC.Event}if(SC.browser.msie&&elem.setInterval){elem=window}var handlers,key,events=SC.data(elem,"events");if(!events){return this}if(eventType===undefined){for(eventType in events){this.remove(elem,eventType)}}else{if(handlers=events[eventType]){var cleanupHandlers=NO;if(target||method){if(SC.typeOf(target)===SC.T_FUNCTION){method=target;target=null}else{if(SC.typeOf(method)===SC.T_STRING){method=target[method]}}delete handlers[SC.guidFor(method)];key=null;for(key in handlers){break}if(key===null){cleanupHandlers=YES}}else{cleanupHandlers=YES}if(cleanupHandlers){delete events[eventType];this._removeEventListener(elem,eventType)}key=null;for(key in events){break}if(!key){SC.removeData(elem,"events");delete this._elements[SC.guidFor(elem)]}}}elem=events=handlers=null;return this},NO_BUBBLE:["blur","focus","change"],simulateEvent:function(elem,eventType,attrs){var ret=SC.Event.create({type:eventType,target:elem,preventDefault:function(){this.cancelled=YES},stopPropagation:function(){this.bubbles=NO},allowDefault:function(){this.hasCustomEventHandling=YES},timeStamp:Date.now(),bubbles:(this.NO_BUBBLE.indexOf(eventType)<0),cancelled:NO,normalized:YES});if(attrs){SC.mixin(ret,attrs)}return ret},trigger:function(elem,eventType,args,donative){if(elem&&elem.isCoreQuery){if(elem.length>0){elem.forEach(function(e){this.trigger(e,eventType,args,donative)},this);return this}else{elem=elem[0]}}if(!elem){return this}if(elem.nodeType===3||elem.nodeType===8){return undefined}args=SC.A(args);var ret,fn=SC.typeOf(elem[eventType]||null)===SC.T_FUNCTION,event,current,onfoo,isClick;event=args[0];if(!event||!event.preventDefault){event=this.simulateEvent(elem,eventType);args.unshift(event)}event.type=eventType;current=elem;do{ret=SC.Event.handle.apply(current,args);current=(current===document)?null:(current.parentNode||document)}while(!ret&&event.bubbles&&current);current=null;onfoo=elem["on"+eventType];isClick=SC.CoreQuery.nodeName(elem,"a")&&eventType==="click";if((!fn||isClick)&&onfoo&&onfoo.apply(elem,args)===NO){ret=NO}if(fn&&donative!==NO&&ret!==NO&&!isClick){this.triggered=YES;try{elem[eventType]()}catch(e){}}this.triggered=NO;return ret},handle:function(event){if((typeof SC==="undefined")||SC.Event.triggered){return YES}var val,ret,namespace,all,handlers,args,key,handler,method,target;args=SC.A(arguments);args[0]=event=SC.Event.normalizeEvent(event||window.event);handlers=(SC.data(this,"events")||{})[event.type];if(!handlers){return NO}for(key in handlers){handler=handlers[key];method=handler[1];event.handler=method;event.data=event.context=handler[2];target=handler[0]||this;ret=method.apply(target,args);if(val!==NO){val=ret}if(ret===NO){event.preventDefault();event.stopPropagation()}}return val},unload:function(){var key,elements=this._elements;for(key in elements){this.remove(elements[key])}for(key in elements){delete elements[key]}delete this._elements},special:{ready:{setup:function(){SC._bindReady();return},teardown:function(){return}},mouseenter:{setup:function(){if(SC.browser.msie){return NO}SC.Event.add(this,"mouseover",SC.Event.special.mouseover.handler);return YES},teardown:function(){if(SC.browser.msie){return NO}SC.Event.remove(this,"mouseover",SC.Event.special.mouseover.handler);return YES},handler:function(event){if(SC.Event._withinElement(event,this)){return YES}event.type="mouseenter";return SC.Event.handle.apply(this,arguments)}},mouseleave:{setup:function(){if(SC.browser.msie){return NO}SC.Event.add(this,"mouseout",SC.Event.special.mouseleave.handler);return YES},teardown:function(){if(SC.browser.msie){return NO}SC.Event.remove(this,"mouseout",SC.Event.special.mouseleave.handler);return YES},handler:function(event){if(SC.Event._withinElement(event,this)){return YES}event.type="mouseleave";return SC.Event.handle.apply(this,arguments)}}},KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,_withinElement:function(event,elem){var parent=event.relatedTarget;while(parent&&parent!=elem){try{parent=parent.parentNode}catch(error){parent=elem}}return parent===elem},_addEventListener:function(elem,eventType){var listener,special=this.special[eventType];if(!special||special.setup.call(elem)===NO){var guid=SC.guidFor(elem);this._elements[guid]=elem;listener=SC.data(elem,"listener")||SC.data(elem,"listener",function(){return SC.Event.handle.apply(SC.Event._elements[guid],arguments)});if(elem.addEventListener){elem.addEventListener(eventType,listener,NO)}else{if(elem.attachEvent){elem.attachEvent("on"+eventType,listener)}}}elem=special=listener=null},_removeEventListener:function(elem,eventType){var listener,special=SC.Event.special[eventType];if(!special||(special.teardown.call(elem)===NO)){listener=SC.data(elem,"listener");if(listener){if(elem.removeEventListener){elem.removeEventListener(eventType,listener,NO)}else{if(elem.detachEvent){elem.detachEvent("on"+eventType,listener)}}}}elem=special=listener=null},_elements:{},normalizeEvent:function(event){if(event===window.event){return SC.Event.create(event)}else{return event.normalized?event:SC.Event.create(event)}},_global:{},_props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler hasCustomEventHandling keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target timeStamp toElement type view which touches targetTouches changedTouches".split(" ")});SC.Event.prototype={hasCustomEventHandling:NO,allowDefault:function(){this.hasCustomEventHandling=YES;return this},preventDefault:function(){var evt=this.originalEvent;if(evt){if(evt.preventDefault){evt.preventDefault()}evt.returnValue=NO}this.hasCustomEventHandling=YES;return this},stopPropagation:function(){var evt=this.originalEvent;if(evt){if(evt.stopPropagation){evt.stopPropagation()}evt.cancelBubble=YES}this.hasCustomEventHandling=YES;return this},stop:function(){return this.preventDefault().stopPropagation()},normalized:YES,getCharString:function(){if(SC.browser.msie){if(this.keyCode==8||this.keyCode==9||(this.keyCode>=37&&this.keyCode<=40)){return String.fromCharCode(0)}else{return(this.keyCode>0)?String.fromCharCode(this.keyCode):null}}else{return(this.charCode>0)?String.fromCharCode(this.charCode):null}},commandCodes:function(){var code=this.keyCode,ret=null,key=null,modifiers="",lowercase;if(code){ret=SC.FUNCTION_KEYS[code];if(!ret&&(this.altKey||this.ctrlKey||this.metaKey)){ret=SC.PRINTABLE_KEYS[code]}if(ret){if(this.altKey){modifiers+="alt_"}if(this.ctrlKey||this.metaKey){modifiers+="ctrl_"}}}if(!ret){code=this.which;key=ret=String.fromCharCode(code);lowercase=ret.toLowerCase();if(this.metaKey){modifiers="meta_";ret=lowercase}else{ret=null}}if(this.shiftKey&&ret){modifiers+="shift_"}if(ret){ret=modifiers+ret}return[ret,key]}};SC.Event.observe=SC.Event.add;SC.Event.stopObserving=SC.Event.remove;SC.Event.fire=SC.Event.trigger;SC.Event.add(window,"unload",SC.Event.prototype,SC.Event.unload);SC.MODIFIER_KEYS={16:"shift",17:"ctrl",18:"alt"};SC.FUNCTION_KEYS={8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"};SC.PRINTABLE_KEYS={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'};SC.PRINTABLE_KEYS_CHARCODE={};(function(){var k;for(i in SC.PRINTABLE_KEYS){k=SC.PRINTABLE_KEYS[i];SC.PRINTABLE_KEYS_CHARCODE[k.charCodeAt(0)]=i;if(k.toUpperCase()!=k){SC.PRINTABLE_KEYS_CHARCODE[k.toUpperCase().charCodeAt(0)]=i}}})();SC.SYSTEM_CURSOR="default";SC.AUTO_CURSOR=SC.DEFAULT_CURSOR="auto";SC.CROSSHAIR_CURSOR="crosshair";SC.HAND_CURSOR=SC.POINTER_CURSOR="pointer";SC.MOVE_CURSOR="move";SC.E_RESIZE_CURSOR="e-resize";SC.NE_RESIZE_CURSOR="ne-resize";SC.NW_RESIZE_CURSOR="nw-resize";SC.N_RESIZE_CURSOR="n-resize";SC.SE_RESIZE_CURSOR="se-resize";SC.SW_RESIZE_CURSOR="sw-resize";SC.S_RESIZE_CURSOR="s-resize";SC.W_RESIZE_CURSOR="w-resize";SC.IBEAM_CURSOR=SC.TEXT_CURSOR="text";SC.WAIT_CURSOR="wait";SC.HELP_CURSOR="help";SC.Cursor=SC.Object.extend({init:function(){arguments.callee.base.apply(this,arguments);var cursorStyle=this.get("cursorStyle")||SC.DEFAULT_CURSOR,ss=this.constructor.sharedStyleSheet(),guid=SC.guidFor(this);if(ss.insertRule){ss.insertRule("."+guid+" {cursor: "+cursorStyle+";}",ss.cssRules?ss.cssRules.length:0)}else{if(ss.addRule){ss.addRule("."+guid,"cursor: "+cursorStyle)}}this.cursorStyle=cursorStyle;this.className=guid;return this},className:null,cursorStyle:SC.DEFAULT_CURSOR,cursorStyleDidChange:function(){var cursorStyle,rule,selector,ss,rules,idx,len;cursorStyle=this.get("cursorStyle")||SC.DEFAULT_CURSOR;rule=this._rule;if(rule){rule.style.cursor=cursorStyle;return}selector="."+this.get("className");ss=this.constructor.sharedStyleSheet();rules=(ss.cssRules?ss.cssRules:ss.rules)||[];for(idx=0,len=rules.length;idx<len;++idx){rule=rules[idx];if(rule.selectorText===selector){this._rule=rule;rule.style.cursor=cursorStyle;break}}}.observes("cursorStyle")});SC.Cursor.sharedStyleSheet=function(){var head,ss=this._styleSheet;if(!ss){ss=document.createElement("style");ss.type="text/css";head=document.getElementsByTagName("head")[0];if(!head){head=document.documentElement}head.appendChild(ss);ss=document.styleSheets[document.styleSheets.length-1];this._styleSheet=ss}return ss};SC.Responder=SC.Object.extend({isResponder:YES,pane:null,responderContext:null,nextResponder:null,isFirstResponder:NO,hasFirstResponder:NO,acceptsFirstResponder:YES,becomingFirstResponder:NO,becomeFirstResponder:function(){var pane=this.get("pane")||this.get("responderContext")||this.pane();if(pane&&this.get("acceptsFirstResponder")){if(pane.get("firstResponder")!==this){pane.makeFirstResponder(this)}}return this},resignFirstResponder:function(){var pane=this.get("pane")||this.get("responderContext");if(pane&&(pane.get("firstResponder")===this)){pane.makeFirstResponder(null)}return YES},willLoseFirstResponder:function(responder){},didBecomeFirstResponder:function(responder){}});sc_require("system/browser");sc_require("system/event");sc_require("system/cursor");sc_require("system/responder");sc_require("mixins/string");SC.viewKey=SC.guidKey+"_view";SC.LAYOUT_HORIZONTAL="sc-layout-horizontal";SC.LAYOUT_VERTICAL="sc-layout-vertical";SC._VIEW_DEFAULT_DIMS="marginTop marginLeft".w();SC.ANCHOR_TOP={top:0};SC.ANCHOR_LEFT={left:0};SC.ANCHOR_TOP_LEFT={top:0,left:0};SC.ANCHOR_BOTTOM={bottom:0};SC.ANCHOR_RIGHT={right:0};SC.ANCHOR_BOTTOM_RIGHT={bottom:0,right:0};SC.FULL_WIDTH={left:0,right:0};SC.FULL_HEIGHT={top:0,bottom:0};SC.ANCHOR_CENTER={centerX:0,centerY:0};SC.LAYOUT_AUTO="auto";SC.CONTEXT_MENU_ENABLED=YES;SC.TABBING_ONLY_INSIDE_DOCUMENT=YES;SC.ROUTE_TOUCH=YES;SC.EMPTY_CHILD_VIEWS_ARRAY=[];SC.EMPTY_CHILD_VIEWS_ARRAY.needsClone=YES;SC.View=SC.Responder.extend(SC.DelegateSupport,{concatenatedProperties:"outlets displayProperties layoutProperties classNames renderMixin didCreateLayerMixin willDestroyLayerMixin".w(),pane:function(){var view=this;while(view&&!view.isPane){view=view.get("parentView")}return view}.property("parentView").cacheable(),page:null,splitView:function(){var view=this;while(view&&!view.isSplitView){view=view.get("parentView")}return view}.property("parentView").cacheable(),parentView:null,backgroundColor:null,routeTouch:YES,isEnabled:YES,isEnabledBindingDefault:SC.Binding.oneWay().bool(),isEnabledInPane:function(){var ret=this.get("isEnabled"),pv;if(ret&&(pv=this.get("parentView"))){ret=pv.get("isEnabledInPane")}return ret}.property("parentView","isEnabled"),isVisible:YES,isVisibleBindingDefault:SC.Binding.bool(),isVisibleInWindow:NO,isContextMenuEnabled:function(){return SC.CONTEXT_MENU_ENABLED}.property(),recomputeIsVisibleInWindow:function(parentViewIsVisible){var last=this.get("isVisibleInWindow"),cur=this.get("isVisible"),parentView;if(cur){cur=(parentViewIsVisible===undefined)?((parentView=this.get("parentView"))?parentView.get("isVisibleInWindow"):NO):parentViewIsVisible}this.set("isVisibleInWindow",cur);this._needsVisibiltyChange=YES;var childViews=this.get("childViews"),len=childViews.length,idx;for(idx=0;idx<len;idx++){childViews[idx].recomputeIsVisibleInWindow(cur)}if(cur){if(this.parentViewDidResize){this.parentViewDidResize()}if(this.get("childViewsNeedLayout")){this.invokeOnce(this.layoutChildViewsIfNeeded)}}this.set("layerNeedsUpdate",YES);if(!cur&&this.get("isFirstResponder")){this.resignFirstResponder()}return this}.observes("isVisible"),childViews:SC.EMPTY_CHILD_VIEWS_ARRAY,insertBefore:function(view,beforeView){view.beginPropertyChanges();if(view.get("parentView")){view.removeFromParent()}if(this.willAddChild){this.willAddChild(view,beforeView)}if(view.willAddToParent){view.willAddToParent(this,beforeView)}view.set("parentView",this);var idx,childViews=this.get("childViews");if(childViews.needsClone){this.set(childViews=[])}idx=(beforeView)?childViews.indexOf(beforeView):childViews.length;if(idx<0){idx=childViews.length}childViews.insertAt(idx,view);view.parentViewDidChange();view.layoutDidChange();var pane=view.get("pane");if(pane&&pane.get("isPaneAttached")){view._notifyDidAppendToDocument()}if(this.didAddChild){this.didAddChild(view,beforeView)}if(view.didAddToParent){view.didAddToParent(this,beforeView)}view.endPropertyChanges();return this},removeChild:function(view){if(!view){return this}if(view.parentView!==this){throw"%@.removeChild(%@) must belong to parent".fmt(this,view)}if(view.willRemoveFromParent){view.willRemoveFromParent()}if(this.willRemoveChild){this.willRemoveChild(view)}view.set("parentView",null);var childViews=this.get("childViews");var idx=childViews.indexOf(view);if(idx>=0){childViews.removeAt(idx)}view.parentViewDidChange();if(this.didRemoveChild){this.didRemoveChild(view)}if(view.didRemoveFromParent){view.didRemoveFromParent(this)}return this},removeAllChildren:function(){var childViews=this.get("childViews"),view;while(view=childViews.objectAt(childViews.get("length")-1)){this.removeChild(view)}return this},removeFromParent:function(){var parent=this.get("parentView");if(parent){parent.removeChild(this)}return this},replaceChild:function(view,oldView){view.beginPropertyChanges();oldView.beginPropertyChanges();this.beginPropertyChanges();this.insertBefore(view,oldView).removeChild(oldView);this.endPropertyChanges();oldView.endPropertyChanges();view.endPropertyChanges();return this},replaceAllChildren:function(views){var len=views.get("length"),idx;this.beginPropertyChanges();this.destroyLayer().removeAllChildren();for(idx=0;idx<len;idx++){this.appendChild(views.objectAt(idx))}this.replaceLayer();this.endPropertyChanges();return this},appendChild:function(view){return this.insertBefore(view,null)},parentViewDidChange:function(){this.recomputeIsVisibleInWindow();this.set("layerLocationNeedsUpdate",YES);this.invokeOnce(this.updateLayerLocationIfNeeded);this._invalidatePaneCacheForSelfAndAllChildViews();return this}.observes("isVisible"),_invalidatePaneCacheForSelfAndAllChildViews:function(){var childView,childViews=this.get("childViews"),len=childViews.length,idx;this.notifyPropertyChange("pane");for(idx=0;idx<len;++idx){childView=childViews[idx];if(childView._invalidatePaneCacheForSelfAndAllChildViews){childView._invalidatePaneCacheForSelfAndAllChildViews()}}},layer:function(key,value){if(value!==undefined){this._view_layer=value}else{value=this._view_layer;if(!value){var parent=this.get("parentView");if(parent){parent=parent.get("layer")}if(parent){this._view_layer=value=this.findLayerInParentLayer(parent)}parent=null}}return value}.property("isVisibleInWindow").cacheable(),$:function(sel){var ret,layer=this.get("layer");ret=!layer?SC.$([]):(sel===undefined)?SC.$(layer):SC.$(sel,layer);layer=null;return ret},containerLayer:function(){return this.get("layer")}.property("layer").cacheable(),layerId:function(){return SC.guidFor(this)}.property().cacheable(),findLayerInParentLayer:function(parentLayer){var layerId=this.get("layerId"),node,i,ilen,found,elem;if(parentLayer.getElementById){elem=parentLayer.getElementById(layerId)}else{elem=document.getElementById(layerId)}if(SC.browser.msie&&elem&&elem.id!==layerId){elem=null}if(!elem&&parentLayer.querySelector){elem=parentLayer.querySelector("#"+layerId)}if(!elem){elem=parentLayer.firstChild;var q=[];q.push(parentLayer);while(q.length!==0){node=q[0];q.shift();if(node.id===layerId){found=true;elem=node;break}for(i=0,ilen=node.childNodes.length;i<ilen;i++){q.push(node.childNodes[i])}}if(!found){elem=null}}return elem},displayDidChange:function(){this.set("layerNeedsUpdate",YES);return this},layerNeedsUpdate:NO,_view_layerNeedsUpdateDidChange:function(){if(this.get("layerNeedsUpdate")){this.invokeOnce(this.updateLayerIfNeeded)}}.observes("layerNeedsUpdate"),updateLayerIfNeeded:function(){var viz=this.get("isVisibleInWindow");if((viz||this._needsVisibiltyChange)&&this.get("layerNeedsUpdate")){this._needsVisibiltyChange=NO;if(this.get("layer")){this.beginPropertyChanges();this.set("layerNeedsUpdate",NO);this.updateLayer();this.endPropertyChanges()}}else{this.set("layerNeedsUpdate",NO)}return this},updateLayer:function(){var context=this.renderContext(this.get("layer"));this.prepareContext(context,NO);context.update();if(context._innerHTMLReplaced){var pane=this.get("pane");if(pane&&pane.get("isPaneAttached")){this._notifyDidAppendToDocument()}}if(this.didUpdateLayer){this.didUpdateLayer()}if(this.designer&&this.designer.viewDidUpdateLayer){this.designer.viewDidUpdateLayer()}return this},renderContext:function(tagNameOrElement){return SC.RenderContext(tagNameOrElement)},createLayer:function(){if(this.get("layer")){return this}var context=this.renderContext(this.get("tagName"));this.prepareContext(context,YES);this.set("layer",context.element());this._notifyDidCreateLayer();return this},_notifyDidCreateLayer:function(){if(this.didCreateLayer){this.didCreateLayer()}var mixins=this.didCreateLayerMixin,len,idx,childViews=this.get("childViews");if(mixins){len=mixins.length;for(idx=0;idx<len;++idx){mixins[idx].call(this)}}len=childViews.length;for(idx=0;idx<len;++idx){if(!childViews[idx]){continue}childViews[idx]._notifyDidCreateLayer()}},destroyLayer:function(){var layer=this.get("layer");if(layer){this._notifyWillDestroyLayer();if(layer.parentNode){layer.parentNode.removeChild(layer)}layer=null}return this},replaceLayer:function(){this.destroyLayer();this.set("layerLocationNeedsUpdate",YES);this.invokeOnce(this.updateLayerLocationIfNeeded)},_notifyWillDestroyLayer:function(){if(this.willDestroyLayer){this.willDestroyLayer()}var mixins=this.willDestroyLayerMixin,len,idx,childViews=this.get("childViews");if(mixins){len=mixins.length;for(idx=0;idx<len;++idx){mixins[idx].call(this)}}len=childViews.length;for(idx=0;idx<len;++idx){childViews[idx]._notifyWillDestroyLayer()}this.set("layer",null)},prepareContext:function(context,firstTime){var mixins,len,idx,layerId,bgcolor,cursor;if(firstTime){layerId=this.layerId?this.get("layerId"):SC.guidFor(this);context.id(layerId).classNames(this.get("classNames"),YES);this.renderLayout(context,firstTime)}else{context.resetClassNames();context.classNames(this.get("classNames"),YES)}if(this.get("isTextSelectable")){context.addClass("allow-select")}if(!this.get("isEnabled")){context.addClass("disabled")}if(!this.get("isVisible")){context.addClass("hidden")}if(this.get("isFirstResponder")){context.addClass("focus")}bgcolor=this.get("backgroundColor");if(bgcolor){context.addStyle("backgroundColor",bgcolor)}cursor=this.get("cursor");if(cursor){context.addClass(cursor.get("className"))}this.beginPropertyChanges();this.set("layerNeedsUpdate",NO);this.render(context,firstTime);if(mixins=this.renderMixin){len=mixins.length;for(idx=0;idx<len;++idx){mixins[idx].call(this,context,firstTime)}}this.endPropertyChanges()},renderChildViews:function(context,firstTime){var cv=this.get("childViews"),len=cv.length,idx,view;for(idx=0;idx<len;++idx){view=cv[idx];if(!view){continue}context=context.begin(view.get("tagName"));view.prepareContext(context,firstTime);context=context.end()}return context},render:function(context,firstTime){if(firstTime){this.renderChildViews(context,firstTime)}},_notifyDidAppendToDocument:function(){if(this.didAppendToDocument){this.didAppendToDocument()}var i=0,child,childLen,children=this.get("childViews");for(i=0,childLen=children.length;i<childLen;i++){child=children[i];if(child._notifyDidAppendToDocument){child._notifyDidAppendToDocument()}}},tagName:"div",classNames:["sc-view"],toolTip:null,isTextSelectable:NO,displayProperties:["isFirstResponder","isVisible"],cursor:null,layerLocationNeedsUpdate:NO,updateLayerLocationIfNeeded:function(force){if(this.get("layerLocationNeedsUpdate")){this.set("layerLocationNeedsUpdate",NO);this.updateLayerLocation()}return this},updateLayerLocation:function(){var node=this.get("layer"),parentView=this.get("parentView"),parentNode=parentView?parentView.get("containerLayer"):null;if(node&&node.parentNode&&node.parentNode!==parentNode){node.parentNode.removeChild(node)}if(!parentView){if(node&&node.parentNode){node.parentNode.removeChild(node)}}else{if(!parentNode){if(node){if(node.parentNode){node.parentNode.removeChild(node)}this.destroyLayer()}}else{if(!node){this.createLayer();node=this.get("layer");if(!node){return}}var siblings=parentView.get("childViews"),nextView=siblings.objectAt(siblings.indexOf(this)+1),nextNode=(nextView)?nextView.get("layer"):null;if(nextView&&(!nextNode||nextNode.parentNode!==parentNode)){nextView.updateLayerLocationIfNeeded();nextNode=nextView.get("layer")}if((node.parentNode!==parentNode)||(node.nextSibling!==nextNode)){parentNode.insertBefore(node,nextNode);if(this.parentViewDidResize){this.parentViewDidResize()}}}}parentNode=parentView=node=nextNode=null;return this},nextResponder:function(){return this.get("parentView")}.property("parentView").cacheable(),acceptsFirstResponder:NO,isKeyResponder:NO,willLoseKeyResponderTo:function(responder){},willBecomeKeyResponderFrom:function(responder){},didLoseKeyResponderTo:function(responder){},didBecomeKeyResponderFrom:function(responder){},interpretKeyEvents:function(event){var codes=event.commandCodes(),cmd=codes[0],chr=codes[1],ret;if(!cmd&&!chr){return null}if(cmd){var methodName=SC.MODIFIED_KEY_BINDINGS[cmd]||SC.BASE_KEY_BINDINGS[cmd.match(/[^_]+$/)[0]];if(methodName){var target=this,pane=this.get("pane"),handler=null;while(target&&!(handler=target.tryToPerform(methodName,event))){target=(target===pane)?null:target.get("nextResponder")}return handler}}if(chr&&this.respondsTo("insertText")){ret=this.insertText(chr,event);return ret?(ret===YES?this:ret):null}return null},insertText:function(chr){return NO},performKeyEquivalent:function(keystring,evt){var ret=NO,childViews=this.get("childViews"),len=childViews.length,idx=-1;while(!ret&&(++idx<len)){ret=childViews[idx].performKeyEquivalent(keystring,evt)}return ret},nextKeyView:null,nextValidKeyView:function(){var seen=[],rootView=this.pane(),ret;ret=rootView._computeNextValidKeyView(this,seen);if(SC.TABBING_ONLY_IN_DOCUMENT&&SC.ret===null){ret=rootView._computeNextValidKeyView(rootView,seen)}return ret}.property("nextKeyView"),_computeNextValidKeyView:function(currentView,seen){var ret=this.get("nextKeyView"),children,i,childLen,child;if(this!==currentView&&seen.indexOf(currentView)!=-1&&this.get("acceptsFirstResponder")&&this.get("isVisibleInWindow")){return this}seen.push(this);if(!ret){children=this.get("childViews");for(i=0,childLen=children.length;i<childLen;i++){child=children[i];if(child.get("isVisibleInWindow")&&child.get("isVisible")){ret=child._computeNextValidKeyView(currentView,seen)}if(ret){return ret}}ret=null}return ret},previousKeyView:null,previousValidKeyView:function(){var seen=[],rootView=this.pane(),ret;ret=rootView._computePreviousValidKeyView(this,seen);return ret}.property("previousKeyView"),_computePreviousValidKeyView:function(currentView,seen){var ret=this.get("previousKeyView"),children,i,child;if(this!==currentView&&seen.indexOf(currentView)!=-1&&this.get("acceptsFirstResponder")&&this.get("isVisibleInWindow")){return this}seen.push(this);if(!ret){children=this.get("childViews");for(i=children.length-1;0<=i;i--){child=children[i];if(child.get("isVisibleInWindow")&&child.get("isVisible")){ret=child._computePreviousValidKeyView(currentView,seen)}if(ret){return ret}}ret=null}return ret},init:function(){var parentView,path,root,idx,len,lp,dp;arguments.callee.base.apply(this,arguments);if(!this.get("isMaterialized")){SC.View.views[this.get("layerId")]=this}var childViews=this.get("childViews");this.childViews=childViews?childViews.slice():[];this.createChildViews();dp=this.get("displayProperties");idx=dp.length;while(--idx>=0){this.addObserver(dp[idx],this,this.displayDidChange)}if(this.get("isDropTarget")){SC.Drag.addDropTarget(this)}if(this.get("isScrollable")){SC.Drag.addScrollableView(this)}if(SC.ROUTE_TOUCH&&this.get("routeTouch")){this.routeTouchEvents()}},routeTouchEvents:function(){if(!this.respondsTo("touchStart")&&this.respondsTo("mouseDown")){this.touchStart=this.mouseDown}if(!this.respondsTo("touchEnd")&&this.respondsTo("mouseUp")){this.touchEnd=this.mouseUp}if(!this.respondsTo("touchMoved")&&this.respondsTo("mouseMove")){this.touchMoved=this.mouseMove}if(!this.respondsTo("touchEntered")&&this.respondsTo("mouseEntered")){this.touchEntered=this.mouseEntered}if(!this.respondsTo("touchExited")&&this.respondsTo("mouseExited")){this.touchExited=this.mouseExited}},awake:function(){arguments.callee.base.apply(this,arguments);var childViews=this.get("childViews"),len=childViews.length,idx;for(idx=0;idx<len;++idx){if(!childViews[idx]){continue}childViews[idx].awake()}},destroy:function(){if(this.get("isDestroyed")){return this}arguments.callee.base.apply(this,arguments);this.removeFromParent();this._destroy();if(this.get("isDropTarget")){SC.Drag.removeDropTarget(this)}if(this.get("isScrollable")){SC.Drag.removeScrollableView(this)}return this},_destroy:function(){if(this.get("isDestroyed")){return this}this.destroyLayer();var childViews=this.get("childViews"),len=childViews.length,idx;if(len){childViews=childViews.slice();for(idx=0;idx<len;++idx){childViews[idx]._destroy()}}delete SC.View.views[this.get("layerId")];delete this._CQ;delete this.page;this.set("isDestroyed",YES);return this},createChildViews:function(){var childViews=this.get("childViews"),len=childViews.length,idx,key,views,view;this.beginPropertyChanges();for(idx=0;idx<len;++idx){if(key=(view=childViews[idx])){if(typeof key===SC.T_STRING){view=this[key]}else{key=null}if(!view){SC.Logger.error("No view with name "+key+" has been found in "+this.toString());continue}if(view.isClass){view=this.createChildView(view);if(key){this[key]=view}}}childViews[idx]=view}this.endPropertyChanges();return this},createChildView:function(view,attrs){if(!attrs){attrs={}}attrs.owner=attrs.parentView=this;attrs.isVisibleInWindow=this.get("isVisibleInWindow");if(!attrs.page){attrs.page=this.page}view=view.create(attrs);return view},adjust:function(key,value){var layout=SC.clone(this.get("layout")),didChange=NO,cur;if(key===undefined){return this}if(SC.typeOf(key)===SC.T_STRING){cur=layout[key];if(SC.none(value)){if(cur!==undefined){didChange=YES}delete layout[key]}else{if(cur!==value){didChange=YES}layout[key]=value}}else{var hash=key;for(key in hash){if(!hash.hasOwnProperty(key)){continue}value=hash[key];cur=layout[key];if(value===null){if(cur!==undefined){didChange=YES}delete layout[key]}else{if(value!==undefined){if(cur!==value){didChange=YES}layout[key]=value}}}}if(didChange){this.set("layout",layout)}return this},layout:{top:0,left:0,bottom:0,right:0},convertFrameToView:function(frame,targetView){var myX=0,myY=0,targetX=0,targetY=0,view=this,f;if(this.get("useStaticLayout")){throw"convertFrameToView is not available with static layout"}while(view){f=view.get("frame");myX+=f.x;myY+=f.y;view=view.get("layoutView")}if(targetView){view=targetView;while(view){f=view.get("frame");targetX+=f.x;targetY+=f.y;view=view.get("layoutView")}}myX=frame.x+myX-targetX;myY=frame.y+myY-targetY;return{x:myX,y:myY,width:frame.width,height:frame.height}},convertFrameFromView:function(frame,targetView){var myX=0,myY=0,targetX=0,targetY=0,view=this,f;if(this.get("useStaticLayout")){throw"convertFrameToView is not available with static layout"}while(view&&view.get("frame")){f=view.get("frame");myX+=f.x;myY+=f.y;view=view.get("parentView")}if(targetView){view=targetView;while(view){f=view.get("frame");targetX+=f.x;targetY+=f.y;view=view.get("parentView")}}myX=frame.x-myX+targetX;myY=frame.y-myY+targetY;return{x:myX,y:myY,width:frame.width,height:frame.height}},scrollToVisible:function(){var pv=this.get("parentView");while(pv&&!pv.get("isScrollable")){pv=pv.get("parentView")}if(pv){pv.scrollToVisible();return pv.scrollToVisible(this)}else{return NO}},frame:function(){return this.computeFrameWithParentFrame(null)}.property("layout","useStaticLayout").cacheable(),computeFrameWithParentFrame:function(pdim){var layout=this.get("layout"),f={},error,layer,AUTO=SC.LAYOUT_AUTO,stLayout=this.get("useStaticLayout"),pv=this.get("parentView"),dH,dW,borderTop,borderLeft,lR=layout.right,lL=layout.left,lT=layout.top,lB=layout.bottom,lW=layout.width,lH=layout.height,lcX=layout.centerX,lcY=layout.centerY;if(lW!==undefined&&lW===SC.LAYOUT_AUTO&&stLayout!==undefined&&!stLayout){error=SC.Error.desc("%@.layout() you cannot use width:auto if ".fmt(this)+"staticLayout is disabled","%@".fmt(this),-1);SC.Logger.error(error.toString());throw error}if(lH!==undefined&&lH===SC.LAYOUT_AUTO&&stLayout!==undefined&&!stLayout){error=SC.Error.desc("%@.layout() you cannot use height:auto if ".fmt(this)+"staticLayout is disabled","%@".fmt(this),-1);SC.Logger.error(error.toString());throw error}if(stLayout){if(layer=this.get("layer")){f=SC.viewportOffset(layer);f.width=layer.offsetWidth;f.height=layer.offsetHeight;return f}return null}if(!pdim){pdim=this.computeParentDimensions(layout)}dH=pdim.height;dW=pdim.width;if(!SC.none(lL)){if(SC.isPercentage(lL)){f.x=dW*lL}else{f.x=lL}if(lW!==undefined){if(lW===AUTO){f.width=AUTO}else{if(SC.isPercentage(lW)){f.width=dW*lW}else{f.width=lW}}}else{f.width=dW-f.x;if(lR&&SC.isPercentage(lR)){f.width=f.width-(lR*dW)}else{f.width=f.width-(lR||0)}}}else{if(!SC.none(lR)){if(SC.none(lW)){if(SC.isPercentage(lL)){f.width=dW-(dW*lR)}else{f.width=dW-lR}f.x=0}else{if(lW===AUTO){f.width=AUTO}else{if(SC.isPercentage(lW)){f.width=dW*lW}else{f.width=(lW||0)}}if(SC.isPercentage(lW)){f.x=dW-(lR*dW)-f.width}else{f.x=dW-lR-f.width}}}else{if(!SC.none(lcX)){if(lW===AUTO){f.width=AUTO}else{if(SC.isPercentage(lW)){f.width=lW*dW}else{f.width=(lW||0)}}if(SC.isPercentage(lcX)){f.x=(dW-f.width)/2+(lcX*dW)}else{f.x=(dW-f.width)/2+lcX}}else{f.x=0;if(SC.none(lW)){f.width=dW}else{if(lW===AUTO){f.width=AUTO}if(SC.isPercentage(lW)){f.width=lW*dW}else{f.width=(lW||0)}}}}}if(!SC.none(lT)){if(SC.isPercentage(lT)){f.y=lT*dH}else{f.y=lT}if(lH!==undefined){if(lH===AUTO){f.height=AUTO}else{if(SC.isPercentage(lH)){f.height=lH*dH}else{f.height=lH}}}else{if(lB&&SC.isPercentage(lB)){f.height=dH-f.y-(lB*dH)}else{f.height=dH-f.y-(lB||0)}}}else{if(!SC.none(lB)){if(SC.none(lH)){if(SC.isPercentage(lB)){f.height=dH-(lB*dH)}else{f.height=dH-lB}f.y=0}else{if(lH===AUTO){f.height=AUTO}if(lH&&SC.isPercentage(lH)){f.height=lH*dH}else{f.height=(lH||0)}if(SC.isPercentage(lB)){f.y=dH-(lB*dH)-f.height}else{f.y=dH-lB-f.height}}}else{if(!SC.none(lcY)){if(lH===AUTO){f.height=AUTO}if(lH&&SC.isPercentage(lH)){f.height=lH*dH}else{f.height=(lH||0)}if(SC.isPercentage(lcY)){f.y=(dH-f.height)/2+(lcY*dH)}else{f.y=(dH-f.height)/2+lcY}}else{f.y=0;if(SC.none(lH)){f.height=dH}else{if(lH===AUTO){f.height=AUTO}if(SC.isPercentage(lH)){f.height=lH*dH}else{f.height=lH||0}}}}}f.x=Math.floor(f.x);f.y=Math.floor(f.y);if(f.height!==AUTO){f.height=Math.floor(f.height)}if(f.width!==AUTO){f.width=Math.floor(f.width)}if(f.height===AUTO||f.width===AUTO){layer=this.get("layer");if(f.height===AUTO){f.height=layer?layer.clientHeight:0}if(f.width===AUTO){f.width=layer?layer.clientWidth:0}}if(this.get("hasBorder")){borderTop=this.get("borderTop");borderLeft=this.get("borderLeft");f.height-=borderTop+this.get("borderBottom");f.y+=borderTop;f.width-=borderLeft+this.get("borderRight");f.x+=borderLeft}if(pv&&pv.isScrollContainer){pv=pv.get("parentView");f.x-=pv.get("horizontalScrollOffset");f.y-=pv.get("verticalScrollOffset")}if(!SC.none(layout.maxHeight)&&(f.height>layout.maxHeight)){f.height=layout.maxHeight}if(!SC.none(layout.minHeight)&&(f.height<layout.minHeight)){f.height=layout.minHeight}if(!SC.none(layout.maxWidth)&&(f.width>layout.maxWidth)){f.width=layout.maxWidth}if(!SC.none(layout.minWidth)&&(f.width<layout.minWidth)){f.width=layout.minWidth}if(f.height<0){f.height=0}if(f.width<0){f.width=0}return f},computeParentDimensions:function(frame){var ret,pv=this.get("parentView"),pf=(pv)?pv.get("frame"):null;if(pf){ret={width:pf.width,height:pf.height}}else{var f=frame;ret={width:(f.left||0)+(f.width||0)+(f.right||0),height:(f.top||0)+(f.height||0)+(f.bottom||0)}}return ret},clippingFrame:function(){var pv=this.get("parentView"),f=this.get("frame"),ret=f,cf;if(pv){cf=pv.get("clippingFrame");ret=SC.intersectRects(cf,f)}ret.x-=f.x;ret.y-=f.y;return ret}.property("parentView","frame").cacheable(),_sc_view_clippingFrameDidChange:function(){var cvs=this.get("childViews"),len=cvs.length,idx,cv;for(idx=0;idx<len;++idx){cv=cvs[idx];if(!cv.hasStaticLayout){cv.notifyPropertyChange("clippingFrame")}}}.observes("clippingFrame"),parentViewDidResize:function(){var layout=this.get("layout"),isPercentage,isFixed;isFixed=((layout.left!==undefined)&&(layout.top!==undefined)&&(layout.width!==undefined)&&(layout.height!==undefined));isPercentage=(SC.isPercentage(layout.left)||SC.isPercentage(layout.top)||SC.isPercentage(layout.width)||SC.isPercentage(layout.right)||SC.isPercentage(layout.centerX)||SC.isPercentage(layout.centerY));if(!isFixed||isPercentage){this.notifyPropertyChange("frame");this.viewDidResize()}},viewDidResize:function(){var cv=this.childViews,len=cv.length,idx,view;for(idx=0;idx<len;++idx){view=cv[idx];if(view.parentViewDidResize){view.parentViewDidResize()}}}.observes("layout"),beginLiveResize:function(){if(this.willBeginLiveResize){this.willBeginLiveResize()}var ary=this.get("childViews"),len=ary.length,idx,view;for(idx=0;idx<len;++idx){view=ary[idx];if(view.beginLiveResize){view.beginLiveResize()}}return this},endLiveResize:function(){var ary=this.get("childViews"),len=ary.length,idx,view;for(idx=len-1;idx>=0;--idx){view=ary[idx];if(view.endLiveResize){view.endLiveResize()}}if(this.didEndLiveResize){this.didEndLiveResize()}return this},layoutStyle:function(){var layout=this.get("layout"),ret={},pdim=null,error,AUTO=SC.LAYOUT_AUTO,dims=SC._VIEW_DEFAULT_DIMS,loc=dims.length,x,value,key,stLayout=this.get("useStaticLayout"),lR=layout.right,lL=layout.left,lT=layout.top,lB=layout.bottom,lW=layout.width,lH=layout.height,lMW=layout.maxWidth,lMH=layout.maxHeight,lcX=layout.centerX,lcY=layout.centerY;if(lW!==undefined&&lW===SC.LAYOUT_AUTO&&!stLayout){error=SC.Error.desc("%@.layout() you cannot use width:auto if ".fmt(this)+"staticLayout is disabled","%@".fmt(this),-1);SC.Logger.error(error.toString());throw error}if(lH!==undefined&&lH===SC.LAYOUT_AUTO&&!stLayout){error=SC.Error.desc("%@.layout() you cannot use height:auto if ".fmt(this)+"staticLayout is disabled","%@".fmt(this),-1);SC.Logger.error(error.toString());throw error}if(!SC.none(lL)){if(SC.isPercentage(lL)){ret.left=(lL*100)+"%"}else{ret.left=Math.floor(lL)}ret.marginLeft=0;if(lW!==undefined){if(lW===SC.LAYOUT_AUTO){ret.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(lW)){ret.width=(lW*100)+"%"}else{ret.width=Math.floor(lW)}}ret.right=null}else{ret.width=null;if(lR&&SC.isPercentage(lR)){ret.right=(lR*100)+"%"}else{ret.right=Math.floor(lR||0)}}}else{if(!SC.none(lR)){if(SC.isPercentage(lR)){ret.right=Math.floor(lR*100)+"%"}else{ret.right=Math.floor(lR)}ret.marginLeft=0;if(SC.none(lW)){if(SC.none(lMW)){ret.left=0}ret.width=null}else{ret.left=null;if(lW===SC.LAYOUT_AUTO){ret.width=SC.LAYOUT_AUTO}else{if(lW&&SC.isPercentage(lW)){ret.width=(lW*100)+"%"}else{ret.width=Math.floor(lW||0)}}}}else{if(!SC.none(lcX)){ret.left="50%";if(lW&&SC.isPercentage(lW)){ret.width=(lW*100)+"%"}else{ret.width=Math.floor(lW||0)}if(lW&&SC.isPercentage(lW)&&lcX>=0&&lcX<1){ret.marginLeft=Math.floor((lcX-lW/2)*100)+"%"}else{if(lW&&lW>1&&(lcX>=1||lcX<=0)){ret.marginLeft=Math.floor(lcX-ret.width/2)}else{ret.marginLeft=0}}ret.right=null}else{if(!SC.none(lW)){ret.left=0;ret.right=null;if(lW===SC.LAYOUT_AUTO){ret.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(lW)){ret.width=(lW*100)+"%"}else{ret.width=Math.floor(lW)}}ret.marginLeft=0}else{ret.left=0;ret.right=0;ret.width=null;ret.marginLeft=0}}}}ret.minWidth=(layout.minWidth===undefined)?null:layout.minWidth;ret.maxWidth=(layout.maxWidth===undefined)?null:layout.maxWidth;if(!SC.none(lT)){if(SC.isPercentage(lT)){ret.top=(lT*100)+"%"}else{ret.top=Math.floor(lT)}if(lH!==undefined){if(lH===SC.LAYOUT_AUTO){ret.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(lH)){ret.height=(lH*100)+"%"}else{ret.height=Math.floor(lH)}}ret.bottom=null}else{ret.height=null;if(lB&&SC.isPercentage(lB)){ret.bottom=(lB*100)+"%"}else{ret.bottom=Math.floor(lB||0)}}ret.marginTop=0}else{if(!SC.none(lB)){ret.marginTop=0;if(SC.isPercentage(lB)){ret.bottom=(lB*100)+"%"}else{ret.bottom=Math.floor(lB)}if(SC.none(lH)){if(SC.none(lMH)){ret.top=0}ret.height=null}else{ret.top=null;if(lH===SC.LAYOUT_AUTO){ret.height=SC.LAYOUT_AUTO}else{if(lH&&SC.isPercentage(lH)){ret.height=(lH*100)+"%"}else{ret.height=Math.floor(lH||0)}}}}else{if(!SC.none(lcY)){ret.top="50%";ret.bottom=null;if(lH&&SC.isPercentage(lH)){ret.height=(lH*100)+"%"}else{ret.height=Math.floor(lH||0)}if(lH&&SC.isPercentage(lH)&&lcY>=0&&lcY<1){ret.marginTop=Math.floor((lcY-lH/2)*100)+"%"}else{if(lH&&lH>1&&(lcY>=1||lcY<=0)){ret.marginTop=Math.floor(lcY-ret.height/2)}else{SC.Logger.error("You have to set height and centerY to use both percentages or pixels");ret.marginTop=0}}}else{if(!SC.none(lH)){ret.top=0;ret.bottom=null;if(lH===SC.LAYOUT_AUTO){ret.height=SC.LAYOUT_AUTO}else{if(lH&&SC.isPercentage(lH)){ret.height=(lH*100)+"%"}else{ret.height=Math.floor(lH||0)}}ret.marginTop=0}else{ret.top=0;ret.bottom=0;ret.height=null;ret.marginTop=0}}}}ret.minHeight=(layout.minHeight===undefined)?null:layout.minHeight;ret.maxHeight=(layout.maxHeight===undefined)?null:layout.maxHeight;ret.zIndex=SC.none(layout.zIndex)?null:layout.zIndex.toString();ret.backgroundPosition=SC.none(layout.backgroundPosition)?null:layout.backgroundPosition.toString();while(--loc>=0){x=dims[loc];if(ret[x]===0){ret[x]=null}}for(key in ret){value=ret[key];if(typeof value===SC.T_NUMBER){ret[key]=(value+"px")}}return ret}.property().cacheable(),layoutView:function(){return this.get("parentView")}.property("parentView").cacheable(),layoutDidChange:function(){this.beginPropertyChanges();if(this.frame){this.notifyPropertyChange("frame")}this.notifyPropertyChange("layoutStyle");this.endPropertyChanges();var layoutView=this.get("layoutView");if(layoutView){layoutView.set("childViewsNeedLayout",YES);layoutView.layoutDidChangeFor(this);if(layoutView.get("childViewsNeedLayout")){layoutView.invokeOnce(layoutView.layoutChildViewsIfNeeded)}}return this}.observes("layout"),childViewsNeedLayout:NO,layoutDidChangeFor:function(childView){var set=this._needLayoutViews;if(!set){set=this._needLayoutViews=SC.CoreSet.create()}set.add(childView)},layoutChildViewsIfNeeded:function(isVisible){if(!isVisible){isVisible=this.get("isVisibleInWindow")}if(isVisible&&this.get("childViewsNeedLayout")){this.set("childViewsNeedLayout",NO);this.layoutChildViews()}return this},layoutChildViews:function(){var set=this._needLayoutViews,len=set?set.length:0,i;for(i=0;i<len;++i){set[i].updateLayout()}set.clear()},updateLayout:function(){var layer=this.get("layer"),context;if(layer){context=this.renderContext(layer);this.renderLayout(context);context.update()}layer=null;return this},renderLayout:function(context,firstTime){context.addStyle(this.get("layoutStyle"))},isView:YES,selectStart:function(evt){return this.get("isTextSelectable")},contextMenu:function(evt){if(!this.get("isContextMenuEnabled")){evt.stop()}return true}});SC.View.mixin({isViewClass:YES,design:function(){if(this.isDesign){return this}var ret=this.extend.apply(this,arguments);ret.isDesign=YES;if(SC.ViewDesigner){SC.ViewDesigner.didLoadDesign(ret,this,SC.A(arguments))}return ret},layout:function(layout){this.prototype.layout=layout;return this},convertLayoutToAnchoredLayout:function(layout,parentFrame){var ret={top:0,left:0,width:parentFrame.width,height:parentFrame.height},pFW=parentFrame.width,pFH=parentFrame.height,lR=layout.right,lL=layout.left,lT=layout.top,lB=layout.bottom,lW=layout.width,lH=layout.height,lcX=layout.centerX,lcY=layout.centerY;if(!SC.none(lL)){if(SC.isPercentage(lL)){ret.left=lL*pFW}else{ret.left=lL}if(lW!==undefined){if(lW===SC.LAYOUT_AUTO){ret.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(lW)){ret.width=lW*pFW}else{ret.width=lW}}}else{if(lR&&SC.isPercentage(lR)){ret.width=pFW-ret.left-(lR*pFW)}else{ret.width=pFW-ret.left-(lR||0)}}}else{if(!SC.none(lR)){if(SC.none(lW)){ret.left=0;if(lR&&SC.isPercentage(lR)){ret.width=pFW-(lR*pFW)}else{ret.width=pFW-(lR||0)}}else{if(lW===SC.LAYOUT_AUTO){ret.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(lW)){ret.width=lW*pFW}else{ret.width=lW}if(SC.isPercentage(lR)){ret.left=pFW-(ret.width+lR)}else{ret.left=pFW-(ret.width+lR)}}}}else{if(!SC.none(lcX)){if(lW&&SC.isPercentage(lW)){ret.width=(lW*pFW)}else{ret.width=(lW||0)}ret.left=((pFW-ret.width)/2);if(SC.isPercentage(lcX)){ret.left=ret.left+lcX*pFW}else{ret.left=ret.left+lcX}}else{if(!SC.none(lW)){ret.left=0;if(lW===SC.LAYOUT_AUTO){ret.width=SC.LAYOUT_AUTO}else{if(SC.isPercentage(lW)){ret.width=lW*pFW}else{ret.width=lW}}}else{ret.left=0;ret.width=0}}}}if(layout.minWidth!==undefined){ret.minWidth=layout.minWidth}if(layout.maxWidth!==undefined){ret.maxWidth=layout.maxWidth}if(!SC.none(lT)){if(SC.isPercentage(lT)){ret.top=lT*pFH}else{ret.top=lT}if(lH!==undefined){if(lH===SC.LAYOUT_AUTO){ret.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(lH)){ret.height=lH*pFH}else{ret.height=lH}}}else{ret.height=pFH-ret.top;if(lB&&SC.isPercentage(lB)){ret.height=ret.height-(lB*pFH)}else{ret.height=ret.height-(lB||0)}}}else{if(!SC.none(lB)){if(SC.none(lH)){ret.top=0;if(lB&&SC.isPercentage(lB)){ret.height=pFH-(lB*pFH)}else{ret.height=pFH-(lB||0)}}else{if(lH===SC.LAYOUT_AUTO){ret.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(lH)){ret.height=lH*pFH}else{ret.height=lH}ret.top=pFH-ret.height;if(SC.isPercentage(lB)){ret.top=ret.top-(lB*pFH)}else{ret.top=ret.top-lB}}}}else{if(!SC.none(lcY)){if(lH&&SC.isPercentage(lH)){ret.height=(lH*pFH)}else{ret.height=(lH||0)}ret.top=((pFH-ret.height)/2);if(SC.isPercentage(lcY)){ret.top=ret.top+lcY*pFH}else{ret.top=ret.top+lcY}}else{if(!SC.none(lH)){ret.top=0;if(lH===SC.LAYOUT_AUTO){ret.height=SC.LAYOUT_AUTO}else{if(SC.isPercentage(lH)){ret.height=lH*pFH}else{ret.height=lH}}}else{ret.top=0;ret.height=0}}}}if(ret.top){ret.top=Math.floor(ret.top)}if(ret.bottom){ret.bottom=Math.floor(ret.bottom)}if(ret.left){ret.left=Math.floor(ret.left)}if(ret.right){ret.right=Math.floor(ret.right)}if(ret.width!==SC.LAYOUT_AUTO){ret.width=Math.floor(ret.width)}if(ret.height!==SC.LAYOUT_AUTO){ret.height=Math.floor(ret.height)}if(layout.minHeight!==undefined){ret.minHeight=layout.minHeight}if(layout.maxHeight!==undefined){ret.maxHeight=layout.maxHeight}return ret},convertLayoutToCustomLayout:function(layout,layoutParams,parentFrame){},classNames:function(sc){sc=(this.prototype.classNames||[]).concat(sc);this.prototype.classNames=sc;return this},tagName:function(tg){this.prototype.tagName=tg;return this},childView:function(cv){var childViews=this.prototype.childViews||[];if(childViews===this.superclass.prototype.childViews){childViews=childViews.slice()}childViews.push(cv);this.prototype.childViews=childViews;return this},bind:function(keyName,path){var p=this.prototype,s=this.superclass.prototype;var bindings=p._bindings;if(!bindings||bindings===s._bindings){bindings=p._bindings=(bindings||[]).slice()}keyName=keyName+"Binding";p[keyName]=path;bindings.push(keyName);return this},prop:function(keyName,value){this.prototype[keyName]=value;return this},localization:function(attrs,rootElement){if(rootElement){attrs.rootElement=SC.$(rootElement)[0]}return attrs},viewFor:function(element,attrs){var args=SC.$A(arguments);if(SC.none(element)){args.shift()}else{args[0]={rootElement:SC.$(element)[0]}}var ret=this.create.apply(this,arguments);args=args[0]=null;return ret},create:function(){var C=this,ret=new C(arguments);if(SC.ViewDesigner){SC.ViewDesigner.didCreateView(ret,SC.$A(arguments))}return ret},loc:function(loc){var childLocs=loc.childViews;delete loc.childViews;this.applyLocalizedAttributes(loc);if(SC.ViewDesigner){SC.ViewDesigner.didLoadLocalization(this,SC.$A(arguments))}var childViews=this.prototype.childViews,idx=childViews.length,viewClass;while(--idx>=0){viewClass=childViews[idx];loc=childLocs[idx];if(loc&&viewClass&&viewClass.loc){viewClass.loc(loc)}}return this},applyLocalizedAttributes:function(loc){SC.mixin(this.prototype,loc)},views:{}});SC.outlet=function(path){return function(key){return(this[key]=SC.objectForPropertyPath(path,this))}.property()};SC.View.unload=function(){var views=SC.View.views;if(views){for(var key in views){if(!views.hasOwnProperty(key)){continue}delete views[key]}}};SC.Event.add(window,"unload",SC.View,SC.View.unload);SC.Validatable={initMixin:function(){this._validatable_validatorDidChange()},validator:null,errorLabel:null,isValid:function(){return SC.typeOf(this.get("value"))!==SC.T_ERROR}.property("value"),ownerForm:null,performValidate:function(partialChange){var ret=SC.VALIDATE_OK;if(this._validator){var form=this.get("ownerForm");if(partialChange){ret=this._validator.validatePartial(form,this);if((ret==SC.VALIDATE_NO_CHANGE)&&(this._validator.validateChange(form,this)==SC.VALIDATE_OK)){ret=SC.VALIDATE_OK}}else{ret=this._validator.validateChange(form,this)}}return ret},performValidateSubmit:function(){return this._validator?this._validator.validateSubmit(this.get("ownerForm"),this):SC.VALIDATE_OK},performValidateKeyDown:function(evt){var charStr=evt.getCharString();if(!charStr){return YES}return this._validator?this._validator.validateKeyDown(this.get("ownerForm"),this,charStr):YES},validatorObject:function(){return this._validator}.property(),validateSubmit:function(){return this.performValidateSubmit()},objectForFieldValue:function(fieldValue,partialChange){return this._validator?this._validator.objectForFieldValue(fieldValue,this.get("ownerForm"),this):fieldValue},fieldValueForObject:function(object){return this._validator?this._validator.fieldValueForObject(object,this.get("ownerForm"),this):object},_validatable_displayObserver:function(){this.displayDidChange()}.observes("isValid"),renderMixin:function(context){context.setClass("invalid",!this.get("isValid"))},_validatable_validatorDidChange:function(){var form=this.get("ownerForm");var val=SC.Validator.findFor(form,this,this.get("validator"));if(val!=this._validator){this.propertyWillChange("validatorObject");if(this._validator){this._validator.detachFrom(form,this)}this._validator=val;if(this._validator){this._validator.attachTo(form,this)}this.propertyDidChange("validatorObject")}}.observes("validator","ownerForm")};sc_require("views/view");sc_require("mixins/control");sc_require("mixins/validatable");SC.FieldView=SC.View.extend(SC.Control,SC.Validatable,{isTextArea:NO,_field_isMouseDown:NO,fieldValue:function(){var value=this.get("value");if(SC.typeOf(value)===SC.T_ERROR){value=value.get("errorValue")}return this.fieldValueForObject(value)}.property("value","validator").cacheable(),$input:function(){if(this.get("isTextArea")){return this.$("textarea").andSelf().filter("textarea")}else{return this.$("input").andSelf().filter("input")}},setFieldValue:function(newValue){if(SC.none(newValue)){newValue=""}var input=this.$input();if(input.val()!==newValue){input.val(newValue)}return this},getFieldValue:function(){return this.$input().val()},_field_fieldValueDidChange:function(evt){SC.RunLoop.begin();this.fieldValueDidChange(NO);SC.RunLoop.end()},fieldValueDidChange:function(partialChange){var fieldValue=this.getFieldValue();var value=this.objectForFieldValue(fieldValue,partialChange);this.setIfChanged("value",value)},_field_valueDidChange:function(){this.setFieldValue(this.get("fieldValue"))}.observes("fieldValue"),didCreateLayer:function(){this.setFieldValue(this.get("fieldValue"));SC.Event.add(this.$input(),"change",this,this._field_fieldValueDidChange)},didAppendToDocument:function(){if(this.get("isTextArea")){this.setFieldValue(this.get("fieldValue"));SC.Event.add(this.$input(),"change",this,this._field_fieldValueDidChange)}},willDestroyLayer:function(){SC.Event.remove(this.$input(),"change",this,this._field_fieldValueDidChange)},mouseDown:function(evt){this._field_isMouseDown=YES;evt.allowDefault();return YES},mouseOut:function(evt){if(this._field_isMouseDown){this.set("isActive",NO)}evt.allowDefault();return YES},mouseOver:function(evt){this.set("isActive",this._field_isMouseDown);evt.allowDefault();return YES},mouseUp:function(evt){if(this._field_isMouseDown){this.set("isActive",NO)}this._field_isMouseDown=NO;evt.allowDefault();return YES},keyDown:function(evt){if(evt.which===9){var view=evt.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(view){view.becomeFirstResponder()}else{evt.allowDefault()}return YES}if(this.performValidateKeyDown(evt)){this._isKeyDown=YES;evt.allowDefault()}else{evt.stop()}return YES},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")}else{return NO}}.property("isEnabled"),willBecomeKeyResponderFrom:function(keyView){if(!this._isFocused){this._isFocused=YES;this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$input()[0].focus()}}},willLoseKeyResponderTo:function(responder){if(this._isFocused){this._isFocused=NO}},_field_setFieldValue:function(newValue){this.propertyWillChange("fieldValue");if(this.fieldValueForObject){newValue=this.fieldValueForObject(newValue)}var ret=this.setFieldValue(newValue);this.propertyDidChange("fieldValue");return ret},_field_getFieldValue:function(){var ret=this.getFieldValue();if(this.objectForFieldValue){ret=this.objectForFieldValue(ret)}return ret}});SC.TextSelection=SC.Object.extend(SC.Copyable,SC.Freezable,{start:-1,end:-1,length:function(){var start=this.get("start");var end=this.get("end");if((start)===-1||(end===-1)){return -1}else{return end-start}}.property("start","end").cacheable(),init:function(){arguments.callee.base.apply(this,arguments);this.freeze()},copy:function(){return SC.TextSelection.create({start:this.get("start"),end:this.get("end")})},toString:function(){var length=this.get("length");if(length&&length>0){if(length===1){return"[%@ character selected: {%@, %@}]".fmt(length,this.get("start"),this.get("end"))}else{return"[%@ characters selected: {%@, %@}]".fmt(length,this.get("start"),this.get("end"))}}else{return"[no text selected; caret at %@]".fmt(this.get("start"))}}});SC.StaticLayout={hasStaticLayout:YES,useStaticLayout:NO,renderMixin:function(context,firstTime){context.setClass("sc-static-layout",this.get("useStaticLayout"))},parentViewDidResize:function(){return null},beginLiveResize:function(){return null},endLiveResize:function(){return null},viewDidResize:function(){return null}};sc_require("views/field");sc_require("system/text_selection");sc_require("mixins/static_layout");SC.TextFieldView=SC.FieldView.extend(SC.StaticLayout,SC.Editable,{tagName:"label",classNames:["sc-text-field-view"],applyImmediately:YES,isPassword:NO,isTextArea:NO,hint:null,isEditing:NO,leftAccessoryView:null,rightAccessoryView:null,_isFocused:NO,_ignoreBlur:null,routeTouch:NO,isEditable:function(){return this.get("isEnabled")}.property("isEnabled").cacheable(),selection:function(key,value){var element=this.$input()[0],range,start,end;if(value===undefined){if(element){start=null;end=null;if(!element.value){start=end=0}else{if("selectionStart" in element){start=element.selectionStart}if("selectionEnd" in element){end=element.selectionEnd}if(start===null||end===null){var selection=document.selection;if(selection){var type=selection.type;if(type&&(type==="None"||type==="Text")){range=selection.createRange();if(!this.get("isTextArea")){var length=range.text.length;start=Math.abs(range.moveStart("character",0-(element.value.length+1)));end=start+length}else{var dummyRange=range.duplicate();dummyRange.moveToElementText(element);dummyRange.setEndPoint("EndToStart",range);start=dummyRange.text.length;end=start+range.text.length}}}}}return SC.TextSelection.create({start:start,end:end})}else{return null}}else{if(!value||!value.kindOf||!value.kindOf(SC.TextSelection)){throw"When setting the selection, you must specify an SC.TextSelection instance."}if(element){if(element.setSelectionRange){element.setSelectionRange(value.get("start"),value.get("end"))}else{range=element.createTextRange();start=value.get("start");range.move("character",start);range.moveEnd("character",value.get("end")-start);range.select()}}return value}}.property("fieldValue").cacheable(),displayProperties:"hint fieldValue isEditing leftAccessoryView rightAccessoryView isTextArea".w(),createChildViews:function(){this.accessoryViewObserver()},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),accessoryViewObserver:function(){var classNames,viewProperties=["leftAccessoryView","rightAccessoryView"],len=viewProperties.length,i,viewProperty,previousView,accessoryView;for(i=0;i<len;i++){viewProperty=viewProperties[i];previousView=this["_"+viewProperty];accessoryView=this.get(viewProperty);if(!(previousView&&accessoryView&&(previousView===accessoryView))){if(previousView){classNames=previousView.get("classNames");classNames=classNames.without("sc-text-field-accessory-view");previousView.set("classNames",classNames);this.removeChild(previousView);previousView=null;this["_"+viewProperty]=null}if(accessoryView){if(accessoryView.isClass){accessoryView=accessoryView.create({layoutView:this})}classNames=accessoryView.get("classNames");var className="sc-text-field-accessory-view";if(classNames.indexOf(className)<0){classNames.push(className)}this.appendChild(accessoryView);this["_"+viewProperty]=accessoryView}}}}.observes("leftAccessoryView","rightAccessoryView"),layoutChildViewsIfNeeded:function(isVisible){if(!isVisible){isVisible=this.get("isVisibleInWindow")}if(isVisible&&this.get("childViewsNeedLayout")){var rightAccessoryView=this.get("rightAccessoryView");if(rightAccessoryView&&rightAccessoryView.get){var layout=rightAccessoryView.get("layout");if(layout){layout.left=null;if(!layout.right){layout.right=0}rightAccessoryView.adjust({layout:layout})}}}arguments.callee.base.apply(this,arguments)},render:function(context,firstTime){arguments.callee.base.apply(this,arguments);var disabled=this.get("isEnabled")?"":'disabled="disabled"',name=SC.guidFor(this),type=this.get("isPassword")?"password":"text",v,accessoryViewWidths,leftAdjustment,rightAdjustment;if(this.get("isTextArea")){context.addClass("text-area")}v=this.get("fieldValue");if(SC.none(v)){v=""}v=String(v);context.setClass("not-empty",v.length>0);accessoryViewWidths=this._getAccessoryViewWidths();leftAdjustment=accessoryViewWidths.left;rightAdjustment=accessoryViewWidths.right;if(leftAdjustment){leftAdjustment+="px"}if(rightAdjustment){rightAdjustment+="px"}this._renderField(context,firstTime,v,leftAdjustment,rightAdjustment);if(SC.browser.mozilla){this.invokeLast(this._applyFirefoxCursorFix)}},_forceRenderFirstTime:NO,_renderFieldLikeFirstTime:function(){this.set("_forceRenderFirstTime",YES)}.observes("isTextArea"),_renderField:function(context,firstTime,value,leftAdjustment,rightAdjustment){var hint=this.get("hint"),disabled,name,adjustmentStyle,type,hintElements,element,paddingElementStyle;if(firstTime||this._forceRenderFirstTime){this._forceRenderFirstTime=NO;disabled=this.get("isEnabled")?"":'disabled="disabled"';name=this.get("layerId");context.push('<span class="border"></span>');adjustmentStyle="";if(leftAdjustment||rightAdjustment){adjustmentStyle='style="';if(leftAdjustment){adjustmentStyle+="left: "+leftAdjustment+"; "}if(rightAdjustment){adjustmentStyle+="right: "+rightAdjustment+";"}adjustmentStyle+='"'}context.push('<span class="padding" '+adjustmentStyle+">",'<span class="sc-hint">',hint,"</span>");value=this.get("escapeHTML")?SC.RenderContext.escapeHTML(value):value;if(this.get("isTextArea")){context.push('<textarea name="',name,'" ',disabled,">",value,"</textarea></span>")}else{type=this.get("isPassword")?"password":"text";context.push('<input type="',type,'" name="',name,'" ',disabled,' value="',value,'"/></span>')}}else{hintElements=this.$(".sc-hint");if(hint!==this._textField_currentHint){this._textField_currentHint=hint;hintElements.text(hint)}element=this.$input()[0];if(element){if(!this.get("isEnabled")){element.disabled="true"}else{element.disabled=null}paddingElementStyle=element.parentNode.style;if(leftAdjustment){if(paddingElementStyle.left!==leftAdjustment){paddingElementStyle.left=leftAdjustment}}else{paddingElementStyle.left=null}if(rightAdjustment){if(paddingElementStyle.right!==rightAdjustment){paddingElementStyle.right=rightAdjustment}}else{paddingElementStyle.right=null}}}},_getAccessoryViewWidths:function(){var widths={},accessoryViewPositions=["left","right"],numberOfAccessoryViewPositions=accessoryViewPositions.length,i,position,accessoryView,frames,width,layout,offset,frame;for(i=0;i<numberOfAccessoryViewPositions;i++){position=accessoryViewPositions[i];accessoryView=this.get(position+"AccessoryView");if(accessoryView&&accessoryView.get){frame=accessoryView.get("frame");if(frame){width=frame.width;if(width){layout=accessoryView.get("layout");if(layout){offset=layout[position];width+=offset}widths[position]=width}}}}return widths},didCreateLayer:function(){arguments.callee.base.apply(this,arguments);if(this.get("isTextArea")){this.invokeLast(this._addTextAreaEvents)}else{this._addTextAreaEvents()}},_addTextAreaEvents:function(){var input=this.$input();SC.Event.add(input,"focus",this,this._textField_fieldDidFocus);SC.Event.add(input,"blur",this,this._textField_fieldDidBlur);SC.Event.add(input,"select",this,this._textField_selectionDidChange);if(SC.browser.mozilla){this._cacheInputElement=this.$input();this._cachePaddingElement=this.$(".padding")}},willDestroyLayer:function(){arguments.callee.base.apply(this,arguments);var input=this.$input();SC.Event.remove(input,"focus",this,this._textField_fieldDidFocus);SC.Event.remove(input,"blur",this,this._textField_fieldDidBlur);SC.Event.remove(input,"select",this,this._textField_selectionDidChange)},_textField_fieldDidFocus:function(evt){SC.RunLoop.begin();this.fieldDidFocus();SC.RunLoop.end()},_textField_fieldDidBlur:function(evt){SC.RunLoop.begin();this._ignoreBlur=true;this.fieldDidBlur();this._ignoreBlur=false;SC.RunLoop.end()},fieldDidFocus:function(evt){this.beginEditing()},fieldDidBlur:function(){this.commitEditing()},_topOffsetForFirefoxCursorFix:3,_applyFirefoxCursorFix:function(){if(parseFloat(SC.browser.mozilla)<1.9&&!this.get("useStaticLayout")){var top,left,width,height,p,layer,element,textfield;element=this._cacheInputElement;textfield=this._cachePaddingElement;if(textfield&&textfield[0]){layer=textfield[0];p=SC.$(layer).offset();if(SC.browser.compareVersion(1,9,2)<0&&element[0].tagName.toLowerCase()==="input"){top=p.top+this._topOffsetForFirefoxCursorFix}else{top=p.top}left=p.left;width=layer.offsetWidth;height=layer.offsetHeight;var style="position: fixed; top: %@px; left: %@px; width: %@px; height: %@px;".fmt(top,left,width,height);if(!this._prevStyle||this._prevStyle!=style){element.attr("style",style)}this._prevStyle=style}}return this},_textField_selectionDidChange:function(){this.notifyPropertyChange("selection")},willBecomeKeyResponderFrom:function(keyView){if(this.get("isVisibleInWindow")){var inp=this.$input()[0];if(inp){inp.focus()}if(!this._txtFieldMouseDown){if(SC.browser.mozilla){this.invokeOnce(this._selectRootElement)}else{if(SC.browser.safari){this.invokeLater(this._selectRootElement,1)}else{this._selectRootElement()}}}}},willLoseKeyResponderTo:function(responder){},_selectRootElement:function(){this.$input()[0].select()},didLoseKeyResponderTo:function(keyView){if(SC.none(this._ignoreBlur)){this.$input()[0].blur()}},parentViewDidResize:function(){if(SC.browser.mozilla){this.invokeLast(this._applyFirefoxCursorFix)}arguments.callee.base.apply(this,arguments)},keyDown:function(evt){if((evt.which===13&&!evt.isIMEInput)&&!this.get("isTextArea")){return NO}if(evt.which===27){return NO}if(evt.which===9){var view=evt.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(view){view.becomeFirstResponder()}else{evt.allowDefault()}return YES}if(this.performValidateKeyDown(evt)){this._isKeyDown=YES;evt.allowDefault()}else{evt.stop()}return YES},keyUp:function(evt){this.notifyPropertyChange("selection");if(this._isKeyDown&&this.get("applyImmediately")){this.invokeLater(this.fieldValueDidChange,1,YES)}this._isKeyDown=NO;evt.allowDefault();return YES},mouseDown:function(evt){var fieldValue=this.get("fieldValue");this._txtFieldMouseDown=YES;if(!this.get("isEnabled")){evt.stop();return YES}else{if((fieldValue&&fieldValue.length===0)||!fieldValue){this.$input()[0].focus();return YES}else{if(!SC.browser.safari){this.$input()[0].focus()}return arguments.callee.base.apply(this,arguments)}}},mouseUp:function(evt){var fieldValue=this.get("fieldValue");this._txtFieldMouseDown=NO;this.notifyPropertyChange("selection");if(!this.get("isEnabled")){evt.stop();return YES}else{if((fieldValue&&fieldValue.length===0)||!fieldValue){if(SC.browser.msie<8){this.invokeLater(this.focusIE7,1)}else{this.$input()[0].focus()}return YES}else{return arguments.callee.base.apply(this,arguments)}}},focusIE7:function(){this.$input()[0].focus()},selectStart:function(evt){return YES}});sc_require("views/text_field");SC.InlineTextFieldView=SC.TextFieldView.extend(SC.DelegateSupport,{_topOffsetForFirefoxCursorFix:0,beginEditing:function(options){if(!options){return}var layout={},pane,delLayout,paneElem;this._delegate=options.delegate;var del=this._delegate;if(!this.invokeDelegateMethod(del,"inlineEditorShouldBeginEditing",this)){return}this.beginPropertyChanges();if(this.get("isEditing")&&!this.blurEditor()){this.endPropertyChanges();return NO}this._optframe=options.frame;this._optIsCollection=options.isCollection;this._exampleElement=options.exampleElement;this._delegate=options.delegate;this.set("delegate",this._delegate);if(!this._optframe||!this._delegate){throw"At least frame and delegate options are required for inline editor"}this._originalValue=options.value||"";this._multiline=(options.multiline!==undefined)?options.multiline:NO;if(this._multiline){this.set("isTextArea",YES)}else{this.set("isTextArea",NO)}this._commitOnBlur=(options.commitOnBlur!==undefined)?options.commitOnBlur:YES;this.set("validator",options.validator);this.set("value",this._originalValue);this.set("isEditing",YES);pane=this._delegate.pane();layout.height=this._optframe.height;layout.width=this._optframe.width;delLayout=this._delegate.get("layout");paneElem=pane.$()[0];if(this._optIsCollection&&delLayout.left){layout.left=this._optframe.x-delLayout.left-paneElem.offsetLeft-1;if(SC.browser.msie==7){layout.left--}}else{layout.left=this._optframe.x-paneElem.offsetLeft-1;if(SC.browser.msie==7){layout.left--}}if(this._optIsCollection&&delLayout.top){layout.top=this._optframe.y-delLayout.top-paneElem.offsetTop;if(SC.browser.msie==7){layout.top=layout.top-2}}else{layout.top=this._optframe.y-paneElem.offsetTop;if(SC.browser.msie==7){layout.top=layout.top-2}}this.set("layout",layout);this.set("parentNode",pane);pane.appendChild(this);SC.RunLoop.begin().end();this._className=this.getDelegateProperty(del,"inlineEditorClassName");if(this._className&&!this.hasClassName(this._className)){this.setClassName(this._className,true)}this.invokeDelegateMethod(del,"inlineEditorWillBeginEditing",this);this._previousFirstResponder=pane?pane.get("firstResponder"):null;this.endPropertyChanges();this.invokeLast(function(){this.becomeFirstResponder();this.invokeDelegateMethod(del,"inlineEditorDidBeginEditing",this)})},commitEditing:function(){if(!SC.$ok(this.validateSubmit())){return NO}return this._endEditing(this.get("value"))},discardEditing:function(){return this._endEditing(this._originalValue)},blurEditor:function(){if(!this.get("isEditing")){return YES}return this._commitOnBlur?this.commitEditing():this.discardEditing()},_endEditing:function(finalValue){if(!this.get("isEditing")){return YES}var del=this._delegate;if(!this.invokeDelegateMethod(del,"inlineEditorShouldEndEditing",this,finalValue)){return NO}this.invokeDelegateMethod(del,"inlineEditorDidEndEditing",this,finalValue);if(this._className){this.setClassName(this._className,false)}this._originalValue=this._delegate=this._exampleElement=this._optframe=this._className=null;this.set("isEditing",NO);if(this.get("isFirstResponder")){var pane=this.get("pane");if(pane&&this._previousFirstResponder){pane.makeFirstResponder(this._previousFirstResponder)}else{this.resignFirstResponder()}}this._previousFirstResponder=null;if(this.get("parentNode")){this.removeFromParent()}return YES},isEditing:NO,mouseDown:function(e){arguments.callee.base.call(this,e);return this.get("isEditing")},keyDown:function(evt){var ret=this.interpretKeyEvents(evt);this.fieldValueDidChange(true);return !ret?NO:ret},insertText:null,willRemoveFromParent:function(){this.$input()[0].blur()},willLoseFirstResponder:function(responder){if(responder!==this){return}this._previousFirstResponder=null;this.$input()[0].blur();return this.blurEditor()},cancel:function(){this.discardEditing();return YES},fieldValueDidChange:function(partialChange){arguments.callee.base.call(this,partialChange)},insertNewline:function(evt){if(this._multiline){evt.allowDefault();return arguments.callee.base.call(this,evt)}else{if(this.get("value")!=this.$input().val()){this.set("value",this.$input().val())}this.commitEditing();return YES}},insertTab:function(evt){this.resignFirstResponder();this.commitEditing();if(this._delegate){var next=this._delegate.nextValidKeyView();if(next&&next.beginEditing){next.beginEditing()}}return YES},insertBacktab:function(evt){this.commitEditing();if(this._delegate){var prev=this._delegate.previousValidKeyView();if(prev){prev.beginEditing()}}return YES},deleteForward:function(evt){evt.allowDefault();return YES},deleteBackward:function(evt){evt.allowDefault();return YES}});SC.InlineTextFieldView.mixin({beginEditing:function(options){this._exampleElement=options.exampleElement;var klass=options.exampleInlineTextFieldView?options.exampleInlineTextFieldView:this;var layout=options.delegate.get("layout");var s=this.updateViewStyle();var p=this.updateViewPaddingStyle();var str=".inline-editor input{"+s+"} ";str=str+".inline-editor textarea{"+s+"} .inline-editor .padding{"+p+"}";var pa=document.getElementsByTagName("head")[0];var el=document.createElement("style");el.type="text/css";el.media="screen";if(el.styleSheet){el.styleSheet.cssText=str}else{el.appendChild(document.createTextNode(str))}pa.appendChild(el);this.editor=klass.create({classNames:"inline-editor",layout:layout});return this.editor.beginEditing(options)},commitEditing:function(){return this.editor?this.editor.commitEditing():YES},discardEditing:function(){return this.editor?this.editor.discardEditing():YES},updateViewStyle:function(){var el=this._exampleElement[0];var styles="";var s=SC.getStyle(el,"font-size");if(s&&s.length>0){styles=styles+"font-size: "+s+" !important; "}s=SC.getStyle(el,"font-family");if(s&&s.length>0){styles=styles+"font-family: "+s+" !important; "}s=SC.getStyle(el,"font-weight");if(s&&s.length>0){styles=styles+"font-weight: "+s+" !important; "}s=SC.getStyle(el,"z-index");if(s&&s.length>0){styles=styles+"z-index: "+s+" !important; "}s=SC.getStyle(el,"line-height");if(s&&s.length>0){styles=styles+"line-height: "+s+" !important; "}s=SC.getStyle(el,"text-align");if(s&&s.length>0){styles=styles+"text-align: "+s+" !important; "}s=SC.getStyle(el,"top-margin");if(s&&s.length>0){styles=styles+"top-margin: "+s+" !important; "}s=SC.getStyle(el,"bottom-margin");if(s&&s.length>0){styles=styles+"bottom-margin: "+s+" !important; "}s=SC.getStyle(el,"left-margin");if(s&&s.length>0){styles=styles+"left-margin: "+s+" !important; "}s=SC.getStyle(el,"right-margin");if(s&&s.length>0){styles=styles+"right-margin: "+s+" !important; "}return styles},updateViewPaddingStyle:function(){var el=this._exampleElement[0];var styles="";var s=SC.getStyle(el,"padding-top");if(s&&s.length>0){styles=styles+"top: "+s+" !important; "}s=SC.getStyle(el,"padding-bottom");if(s&&s.length>0){styles=styles+"bottom: "+s+" !important; "}s=SC.getStyle(el,"padding-left");if(s&&s.length>0){styles=styles+"left: "+s+" !important; "}s=SC.getStyle(el,"padding-right");if(s&&s.length>0){styles=styles+"right: "+s+" !important; "}return styles},editor:null});sc_require("views/view");SC.Pane=SC.View.extend({isPane:YES,page:null,rootResponder:null,currentWindowSize:null,computeParentDimensions:function(frame){var wframe=this.get("currentWindowSize");var wDim={x:0,y:0,width:1000,height:1000};if(wframe){wDim.width=wframe.width;wDim.height=wframe.height}else{if(SC.RootResponder.responder){var wSize=SC.RootResponder.responder.get("currentWindowSize");if(wSize){wDim.width=wSize.width;wDim.height=wSize.height}}else{if(window.innerHeight){wDim.width=window.innerWidth;wDim.height=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){wDim.width=document.documentElement.clientWidth;wDim.height=document.documentElement.clientHeight}else{if(document.body){wDim.width=document.body.clientWidth;wDim.height=document.body.clientHeight}}}this.windowSizeDidChange(null,wDim)}}return wDim},frame:function(){return this.computeFrameWithParentFrame(null)}.property(),windowSizeDidChange:function(oldSize,newSize){this.set("currentWindowSize",newSize);this.parentViewDidResize();return this},paneLayoutDidChange:function(){this.invokeOnce(this.updateLayout)}.observes("layout"),sendEvent:function(action,evt,target){var handler;if(!target){target=this.get("firstResponder")}while(target&&!target.tryToPerform(action,evt)){target=(target===this)?null:target.get("nextResponder")}if(!target&&(target=this.get("defaultResponder"))){if(typeof target===SC.T_STRING){target=SC.objectForPropertyPath(target)}if(!target){target=null}else{if(target.isResponderContext){target=target.sendAction(action,this,evt)}else{target=target.tryToPerform(action,evt)?target:null}}}return evt.mouseHandler||target},sendTouchEvent:function(action,evt,target){var handler,response,exclusive=NO,ret=[];if(!target){target=this.get("firstResponder")}while(target){if(target.respondsTo(action)){switch(target[action](evt)){case SC.MIXED_STATE:ret.push(target);break;case YES:ret=[target];target=null;exclusive=YES;continue}}target=(target===this)?null:target.get("nextResponder")}if(!exclusive&&(target=this.get("defaultResponder"))){if(typeof target===SC.T_STRING){target=SC.objectForPropertyPath(target)}if(target){if(target.isResponderContext){ret=ret.concat(target.sendTouchAction(action,this,evt))}else{if(target.respondsTo(action)){response=target[action](evt)}switch(response){case SC.MIXED_STATE:ret.push(target);break;case YES:ret=[target]}}}}target=null;return ret},performKeyEquivalent:function(keystring,evt){var ret=arguments.callee.base.apply(this,arguments);if(!ret){var defaultResponder=this.get("defaultResponder");if(defaultResponder){if(defaultResponder.performKeyEquivalent){ret=defaultResponder.performKeyEquivalent(keystring,evt)}if(!ret&&defaultResponder.tryToPerform){ret=defaultResponder.tryToPerform(keystring,evt)}}}return ret},defaultResponder:null,nextResponder:function(){return null}.property().cacheable(),firstResponder:null,acceptsKeyPane:YES,isKeyPane:NO,becomeKeyPane:function(){if(this.get("isKeyPane")){return this}if(this.rootResponder){this.rootResponder.makeKeyPane(this)}return this},resignKeyPane:function(){if(!this.get("isKeyPane")){return this}if(this.rootResponder){this.rootResponder.makeKeyPane(null)}return this},makeFirstResponder:function(view){var current=this.get("firstResponder"),isKeyPane=this.get("isKeyPane");if(current===view){return this}if(current){current.willLoseFirstResponder(current)}if(isKeyPane){if(current){current.willLoseKeyResponderTo(view)}if(view){view.willBecomeKeyResponderFrom(current)}}if(current){current.beginPropertyChanges().set("isFirstResponder",NO).set("isKeyResponder",NO).endPropertyChanges()}this.set("firstResponder",view);if(view){view.beginPropertyChanges().set("isFirstResponder",YES).set("isKeyResponder",isKeyPane).endPropertyChanges()}if(isKeyPane){if(view){view.didBecomeKeyResponderFrom(current)}if(current){current.didLoseKeyResponderTo(view)}}if(view){view.didBecomeFirstResponder(view)}return this},_forwardKeyChange:function(shouldForward,methodName,pane,isKey){var keyView,responder,newKeyView;if(shouldForward&&(responder=this.get("firstResponder"))){newKeyView=(pane)?pane.get("firstResponder"):null;keyView=this.get("firstResponder");if(keyView){keyView[methodName](newKeyView)}if((isKey!==undefined)&&responder){responder.set("isKeyResponder",isKey)}}},willLoseKeyPaneTo:function(pane){this._forwardKeyChange(this.get("isKeyPane"),"willLoseKeyResponderTo",pane,NO);return this},willBecomeKeyPaneFrom:function(pane){this._forwardKeyChange(!this.get("isKeyPane"),"willBecomeKeyResponderFrom",pane,YES);return this},didLoseKeyPaneTo:function(pane){var isKeyPane=this.get("isKeyPane");this.set("isKeyPane",NO);this._forwardKeyChange(isKeyPane,"didLoseKeyResponderTo",pane);return this},didBecomeKeyPaneFrom:function(pane){var isKeyPane=this.get("isKeyPane");this.set("isKeyPane",YES);this._forwardKeyChange(!isKeyPane,"didBecomeKeyResponderFrom",pane,YES);return this},isMainPane:NO,focusFrom:function(pane){},blurTo:function(pane){},blurMainTo:function(pane){this.set("isMainPane",NO)},focusMainFrom:function(pane){this.set("isMainPane",YES)},append:function(){return this.appendTo(document.body)},remove:function(){if(!this.get("isVisibleInWindow")){return this}if(!this.get("isPaneAttached")){return this}this.set("isVisibleInWindow",NO);var dom=this.get("layer");if(dom.parentNode){dom.parentNode.removeChild(dom)}dom=null;this.resignKeyPane();var rootResponder=this.rootResponder;if(this.get("isMainPane")){rootResponder.makeMainPane(null)}rootResponder.panes.remove(this);this.rootResponder=null;this.set("isPaneAttached",NO);return this},appendTo:function(elem){var layer=this.get("layer");if(!layer){layer=this.createLayer().get("layer")}if(this.get("isPaneAttached")&&(layer.parentNode===elem)){return this}elem.insertBefore(layer,null);elem=layer=null;return this.paneDidAttach()},prependTo:function(elem){if(this.get("isPaneAttached")){return this}var layer=this.get("layer");if(!layer){layer=this.createLayer().get("layer")}if(this.get("isPaneAttached")&&(layer.parentNode===elem)){return this}elem.insertBefore(layer,elem.firstChild);elem=layer=null;return this.paneDidAttach()},before:function(elem){if(this.get("isPaneAttached")){return this}var layer=this.get("layer");if(!layer){layer=this.createLayer().get("layer")}var parent=elem.parentNode;if(this.get("isPaneAttached")&&(layer.parentNode===parent)){return this}parent.insertBefore(layer,elem);parent=elem=layer=null;return this.paneDidAttach()},after:function(elem){var layer=this.get("layer");if(!layer){layer=this.createLayer().get("layer")}var parent=elem.parentNode;if(this.get("isPaneAttached")&&(layer.parentNode===parent)){return this}parent.insertBefore(layer,elem.nextSibling);parent=elem=layer=null;return this.paneDidAttach()},removeFromParent:function(){},paneDidAttach:function(){var responder=(this.rootResponder=SC.RootResponder.responder);responder.panes.add(this);this.set("currentWindowSize",responder.computeWindowSize());this.set("isPaneAttached",YES);this.parentViewDidChange();this._notifyDidAppendToDocument();return this},isPaneAttached:NO,recomputeIsVisibleInWindow:function(parentViewIsVisible){var last=this.get("isVisibleInWindow"),cur=this.get("isVisible");this.set("isVisibleInWindow",cur);this._needsVisibiltyChange=YES;if(cur&&this.get("layerNeedsUpdate")){this.updateLayerIfNeeded()}if(cur&&this.get("childViewsNeedLayout")){this.layoutChildViewsIfNeeded()}var childViews=this.get("childViews"),len=childViews.length,idx;for(idx=0;idx<len;idx++){childViews[idx].recomputeIsVisibleInWindow(cur)}if(!cur&&this.get("isFirstResponder")){this.resignFirstResponder()}if(cur){if(this.parentViewDidResize){this.parentViewDidResize()}if(this.get("childViewsNeedLayout")){this.invokeOnce(this.layoutChildViewsIfNeeded)}}return this},updateLayerLocation:function(){return this},init:function(){var hasLayer=!!this.get("layer");arguments.callee.base.apply(this,arguments);var theme=this.get("theme");if(!theme&&("undefined"!==ENV)){theme=ENV.theme}if(theme){var classNames=this.get("classNames").copy();classNames.push(theme);this.set("classNames",classNames)}if(hasLayer){this.paneDidAttach()}},classNames:function(){var ret=["sc-pane"],browser,platform,shadows,borderRad,classNames,style;browser=SC.browser.current;platform=SC.browser.windows?"windows":SC.browser.mac?"mac":"other-platform";style=document.documentElement.style;shadows=(style.MozBoxShadow!==undefined)||(style.webkitBoxShadow!==undefined)||(style.oBoxShadow!==undefined)||(style.boxShadow!==undefined);borderRad=(style.MozBorderRadius!==undefined)||(style.webkitBorderRadius!==undefined)||(style.oBorderRadius!==undefined)||(style.borderRadius!==undefined);if(shadows){ret.push("box-shadow")}if(borderRad){ret.push("border-rad")}ret.push(browser);ret.push(platform);if(SC.browser.msie==7){ret.push("ie7")}if(SC.browser.mobileSafari){ret.push("mobile-safari")}return ret}()});sc_require("system/responder");SC.ResponderContext=SC.Responder.extend({isResponderContext:YES,trace:NO,defaultResponder:null,nextResponder:function(){return this.get("defaultResponder")}.property("defaultResponder").cacheable(),firstResponder:null,nextResponderFor:function(responder){var next=responder.get("nextResponder");if(typeof next===SC.T_STRING){next=SC.objectForPropertyPath(next,this)}else{if(!next&&(responder!==this)){next=this}}return next},responderNameFor:function(responder){if(!responder){return"(No Responder)"}else{if(responder._scrc_name){return responder._scrc_name}}var n=this.NAMESPACE;this._findResponderNamesFor(this,3,n?[this.NAMESPACE]:[]);return responder._scrc_name||responder.toString()},_findResponderNamesFor:function(responder,level,path){var key,value;for(key in responder){if(key==="nextResponder"){continue}value=responder[key];if(value&&value.isResponder){if(value._scrc_name){continue}path.push(key);value._scrc_name=path.join(".");if(level>0){this._findResponderNamesFor(value,level-1,path)}path.pop()}}},makeFirstResponder:function(responder){var current=this.get("firstResponder"),last=this.get("nextResponder"),trace=this.get("trace"),common;if(this._locked){if(trace){SC.Logger.log("%@: AFTER ACTION: makeFirstResponder => %@".fmt(this,this.responderNameFor(responder)))}this._pendingResponder=responder;return}if(trace){SC.Logger.log("%@: makeFirstResponder => %@".fmt(this,this.responderNameFor(responder)))}responder.set("becomingFirstResponder",YES);this._locked=YES;this._pendingResponder=null;common=responder?responder:null;while(common){if(common.get("hasFirstResponder")){break}common=(common===last)?null:this.nextResponderFor(common)}if(!common){common=last}this._notifyWillLoseFirstResponder(current,current,common);if(current){current.set("isFirstResponder",NO)}this.beginPropertyChanges();this.set("firstResponder",responder);if(responder){responder.set("isFirstResponder",YES)}this._notifyDidBecomeFirstResponder(responder,responder,common);this.endPropertyChanges();this._locked=NO;if(this._pendingResponder){this.makeFirstResponder(this._pendingResponder);this._pendingResponder=null}responder.set("becomingFirstResponder",NO);return this},_notifyWillLoseFirstResponder:function(responder,cur,root){if(cur===root){return}cur.willLoseFirstResponder(responder);cur.set("hasFirstResponder",NO);var next=this.nextResponderFor(cur);if(next){this._notifyWillLoseFirstResponder(responder,next,root)}},_notifyDidBecomeFirstResponder:function(responder,cur,root){if(cur===root){return}var next=this.nextResponderFor(cur);if(next){this._notifyDidBecomeFirstResponder(responder,next,root)}cur.set("hasFirstResponder",YES);cur.didBecomeFirstResponder(responder)},sendAction:function(action,sender,context){var working=this.get("firstResponder"),last=this.get("nextResponder"),trace=this.get("trace"),handled=NO,responder;this._locked=YES;if(trace){SC.Logger.log("%@: begin action '%@' (%@, %@)".fmt(this,action,sender,context))}while(!handled&&working){if(working.tryToPerform){handled=working.tryToPerform(action,sender,context)}if(!handled){working=(working===last)?null:this.nextResponderFor(working)}}if(trace){if(!handled){SC.Logger.log("%@:  action '%@' NOT HANDLED".fmt(this,action))}else{SC.Logger.log("%@: action '%@' handled by %@".fmt(this,action,this.responderNameFor(working)))}}this._locked=NO;if(responder=this._pendingResponder){this._pendingResponder=null;this.makeFirstResponder(responder)}return working}});sc_require("system/responder_context");SC.Application=SC.ResponderContext.extend({});sc_require("core");SC.Benchmark={verbose:NO,enabled:YES,stats:{},globalStartTime:null,start:function(key,parentKey,time,topLevelOnly){if(!this.enabled){return}var start=(time||Date.now()),stat;if(parentKey){stat=this._subStatFor(key,parentKey)}else{stat=this._statFor(key)}if(topLevelOnly&&stat._starts.length>0){stat._starts.push("ignore")}else{stat._starts.push(start)}stat._times.push({start:start,_subStats:{}});return key},end:function(key,parentKey,time){var stat;if(!this.enabled){return}if(parentKey){stat=this._subStatFor(key,parentKey)}else{stat=this._statFor(key)}var start=stat._starts.pop();if(!start){SC.Logger.log('SC.Benchmark "%@" ended without a matching start.  No information was saved.'.fmt(key));return}if(start=="ignore"){return}var end=(time||Date.now());var dur=end-start;stat._times[stat._times.length-1].end=end;stat._times[stat._times.length-1].dur=dur;stat.amt+=dur;stat.runs++;if(this.verbose){this.log(key)}},setGlobalStartTime:function(time){this.globalStartTime=time},bench:function(func,key,reps){if(!key){key="bench%@".fmt(this._benchCount++)}if(!reps){reps=1}var ret;while(--reps>=0){var timeKey=SC.Benchmark.start(key);ret=func();SC.Benchmark.end(timeKey)}return ret},install:function(object,method,topLevelOnly){object["b__"+method]=object[method];var __func=object["b__"+method];object[method]=function(){var key="%@(%@)".fmt(method,$A(arguments).join(", "));SC.Benchmark.start(key,topLevelOnly);var ret=__func.apply(this,arguments);SC.Benchmark.end(key);return ret}},restore:function(object,method){object[method]=object["b__"+method]},report:function(key){if(key){return this._genReport(key)}var ret=[];for(var k in this.stats){if(!this.stats.hasOwnProperty(k)){continue}ret.push(this._genReport(k))}return ret.join("\n")},timelineReport:function(appName){appName=(appName)?"SproutCore Application":appName;var ret=[appName,"User-Agent: %@".fmt(navigator.userAgent),"Report Generated: %@ (%@)".fmt(new Date().toString(),Date.now()),""];var chart=this._compileChartData(true);for(var i=0;i<chart.length;i++){if(chart[i][4]){ret.push(this._timelineGenSubReport(chart[i]))}else{ret.push(this._timelineGenReport(chart[i]))}}return ret.join("\n")},timelineChart:function(appName){var i=0;this.hideChart();var chart=this._compileChartData(false);var chartLen=chart.length;if(chartLen===0){return}var gStart=this.globalStartTime?this.globalStartTime:chart[0][1];var maxDur=chart[chartLen-1][2]-gStart;var maxHeight=50+chartLen*30;var incr=Math.ceil(maxDur/200)+1;var maxWidth=incr*50;var graph=document.createElement("div");graph.className="sc-benchmark-graph";document.body.appendChild(graph);var title=document.createElement("div");title.innerHTML=((appName)?appName:"SproutCore Application")+(" - Total Captured Time: "+maxDur+" ms - Points Captured: "+chartLen)+' [<a href="javascript:SC.Benchmark.hideChart();">Hide Chart</a>]';title.className="sc-benchmark-title";graph.appendChild(title);var topBox=document.createElement("div");topBox.className="sc-benchmark-top";topBox.style.width=maxWidth+"px";graph.appendChild(topBox);for(i=0;i<incr;i++){var tick=document.createElement("div");tick.className="sc-benchmark-tick";tick.style.left=(i*50)+"px";tick.style.height=maxHeight+"px";var tickLabel=document.createElement("div");tickLabel.className="sc-benchmark-tick-label";tickLabel.style.left=(i*50)+"px";tickLabel.innerHTML=i*200+" ms";graph.appendChild(tick);graph.appendChild(tickLabel)}for(i=0;i<chartLen;i++){var row=document.createElement("div");row.style.top=(75+(i*30))+"px";row.style.width=maxWidth+"px";row.className=(i%2===0)?"sc-benchmark-row even":"sc-benchmark-row";graph.appendChild(row);var div=document.createElement("div");var start=chart[i][1];var end=chart[i][2];var duration=chart[i][3];div.innerHTML="&nbsp;"+(chart[i][0]+" <span class='sc-benchmark-emphasis'>"+duration+"ms</span>");div.className="sc-benchmark-bar";div.style.cssText="left:"+(((start-gStart)/4))+"px; width: "+((duration/4))+"px; top: "+(53+(i*30))+"px;";div.title="start: "+(start-gStart)+" ms, end: "+(end-gStart)+" ms, duration: "+duration+" ms";graph.appendChild(div)}this._graph=graph},hideChart:function(){if(this._graph){try{document.body.removeChild(this._graph)}catch(e){}}},log:function(key){SC.Logger.log(this.report(key))},startProfile:function(key){if(!this.enabled){return}if(console&&console.profile){console.profile(key)}},endProfile:function(key){if(!this.enabled){return}if(console&&console.profileEnd){console.profileEnd(key)}},_compileChartData:function(showSub){var chart=[],dispKey;for(var key in this.stats){var stat=this.stats[key];for(var i=0;i<stat._times.length;i++){var st=stat._times[i];dispKey=(stat._times.length>1)?(i+1)+" - "+key:key;chart.push([dispKey,st.start,st.end,st.dur,false]);if(showSub){var subStats=st._subStats;for(var k in subStats){var subStat=subStats[k];for(var j=0;j<subStat._times.length;j++){var s=subStat._times[j];dispKey=(subStat._times.length>1)?(j+1)+" - "+k:k;chart.push([dispKey,s.start,s.end,s.dur,true])}}}}}chart.sort(function(a,b){if(a[1]<b[1]){return -1}else{if(a[1]==b[1]){if(a[3]&&!b[3]){return -1}if(!a[3]&&b[3]){return 1}return 0}}return 1});return chart},_genReport:function(key){var stat=this._statFor(key);var avg=(stat.runs>0)?(Math.floor(stat.amt*1000/stat.runs)/1000):0;return"BENCH %@ msec: %@ (%@x)".fmt(avg,(stat.name||key),stat.runs)},_timelineGenReport:function(val){if(this.globalStartTime){return"BENCH start: %@ msec, duration: %@ msec,  %@".fmt((val[1]-this.globalStartTime),val[3],val[0])}else{return"BENCH duration: %@ msec, %@".fmt(val[3],val[0])}},_timelineGenSubReport:function(val){if(this.globalStartTime){return"   CHECKPOINT BENCH start: %@ msec, duration: %@ msec,  %@".fmt((val[1]-this.globalStartTime),val[3],val[0])}else{return"   CHECKPOINT BENCH duration: %@ msec, %@".fmt(val[3],val[0])}},_subStatFor:function(key,parentKey){var parentTimeLen=this.stats[parentKey]._times.length;if(parentTimeLen===0){return}var parentSubStats=this.stats[parentKey]._times[this.stats[parentKey]._times.length-1]._subStats;var ret=parentSubStats[key];if(!ret){parentSubStats[key]={runs:0,amt:0,name:key,_starts:[],_times:[]};ret=parentSubStats[key]}return ret},_statFor:function(key){var ret=this.stats[key];if(!ret){ret=this.stats[key]={runs:0,amt:0,name:key,_starts:[],_times:[]};ret=this.stats[key]}return ret},reset:function(){this.stats={}},_bench:function(func,name){SC.Benchmark.bench(func,name,1)},_benchCount:1};SC.Benchmark=SC.Benchmark;SC.mixin({logBundleLoading:NO,bundleIsLoaded:function(bundleName){return tiki.ready(bundleName)},loadBundle:function(bundleName,target,method){var idx,len;if(method===undefined&&SC.typeOf(target)===SC.T_FUNCTION){method=target;target=null}var args=SC.A(arguments).slice(3);if(target&&(method===undefined)){method=target;target=this}var handler=function(){if(SC.T_STRING===typeof target){target=SC.objectForPropertyPath(target)}if(SC.T_STRING===typeof method){method=SC.objectForPropertyPath(method,target)}if(target){if(SC.T_STRING===typeof method){method=target[method]}if(!method){throw"could not find callback for load"}SC.RunLoop.begin();method.apply(target,args);SC.RunLoop.end()}handler=target=method=null};tiki.async(bundleName).then(function(){tiki.require("tiki").ready(this,handler)})}});sc_require("system/locale");SC.IMAGE_ABORTED_ERROR=SC.$error("SC.Image.AbortedError","Image",-100);SC.IMAGE_FAILED_ERROR=SC.$error("SC.Image.FailedError","Image",-101);SC.imageCache=SC.Object.create({loadLimit:4,activeRequests:0,loadImage:function(url,target,method,isBackgroundFlag){var type=SC.typeOf(target);if(SC.none(method)&&SC.typeOf(target)===SC.T_FUNCTION){target=null;method=target}if(SC.typeOf(method)===SC.T_STRING){method=target[method]}if(SC.none(isBackgroundFlag)){isBackgroundFlag=SC.none(target)&&SC.none(method)}var entry=this._imageEntryFor(url);if(entry.status===this.IMAGE_LOADED){if(method){method.call(target||entry.image,entry.url,entry.image)}}else{if(target||method){this._addCallback(entry,target,method)}entry.retainCount++;this._scheduleImageEntry(entry,isBackgroundFlag)}},releaseImage:function(url,target,method){var entry=this._imageEntryFor(url,NO);if(!entry){return this}if(--entry.retainCount<=0){this._deleteEntry(entry)}else{if(target||method){var type=SC.typeOf(target);if(SC.none(method)&&SC.typeOf(target)===SC.T_FUNCTION){target=null;method=target}if(SC.typeOf(method)===SC.T_STRING){method=target[method]}this._removeCallback(entry,target,method)}}},reloadImage:function(url){var entry=this._imageEntryFor(url,NO);if(entry&&entry.status===this.IMAGE_LOADED){entry.status=this.IMAGE_WAITING}},loadNextImage:function(){var entry=null,queue;if(this.get("activeRequests")>=this.get("loadLimit")){return}queue=this._foregroundQueue;while(queue.length>0&&!entry){entry=queue.shift()}if(!entry){queue=this._backgroundQueue;while(queue.length>0&&!entry){entry=queue.shift()}}this.set("isLoading",!!entry);if(entry){var img=entry.image;img.onabort=this._imageDidAbort;img.onerror=this._imageDidError;img.onload=this._imageDidLoad;img.src=entry.url;this._loading.push(entry);this.incrementProperty("activeRequests");this.loadNextImage()}},_imageEntryFor:function(url,createIfNeeded){if(createIfNeeded===undefined){createIfNeeded=YES}var entry=this._images[url];if(!entry&&createIfNeeded){var img=new Image();entry=this._images[url]={url:url,status:this.IMAGE_WAITING,callbacks:[],retainCount:0,image:img};img.entry=entry}return entry},_deleteEntry:function(entry){this._unscheduleImageEntry(entry);delete this._images[entry.url]},_addCallback:function(entry,target,method){var callbacks=entry.callbacks;var handler=callbacks.find(function(x){return x[0]===target&&x[1]===method},this);if(!handler){callbacks.push([target,method])}callbacks=null;return this},_removeCallback:function(entry,target,method){var callbacks=entry.callbacks;callbacks.forEach(function(x,idx){if(x[0]===target&&x[1]===method){callbacks[idx]=null}},this);callbacks=null;return this},_scheduleImageEntry:function(entry,isBackgroundFlag){var background=this._backgroundQueue;var foreground=this._foregroundQueue;if(entry.status===this.IMAGE_LOADED){return this}if((entry.status===this.IMAGE_QUEUED)&&!isBackgroundFlag&&entry.isBackground){background[background.indexOf(entry)]=null;entry.status=this.IMAGE_WAITING}if(entry.status!==this.IMAGE_QUEUED){var queue=(isBackgroundFlag)?background:foreground;queue.push(entry);entry.status=this.IMAGE_QUEUED;entry.isBackground=isBackgroundFlag}if(!this.isLoading){this.invokeLater(this.loadNextImage,100)}this.set("isLoading",YES);return this},_unscheduleImageEntry:function(entry){if(entry.status!==this.IMAGE_QUEUED){return this}var queue=entry.isBackground?this._backgroundQueue:this._foregroundQueue;queue[queue.indexOf(entry)]=null;if(this._loading.indexOf(entry)>=0){queue.image.abort();this.imageStatusDidChange(entry,this.ABORTED)}return this},_imageDidAbort:function(){SC.imageCache.imageStatusDidChange(this.entry,SC.imageCache.ABORTED)},_imageDidError:function(){SC.imageCache.imageStatusDidChange(this.entry,SC.imageCache.ERROR)},_imageDidLoad:function(){SC.imageCache.imageStatusDidChange(this.entry,SC.imageCache.LOADED)},imageStatusDidChange:function(entry,status){if(!entry){return}var url=entry.url;var value;switch(status){case this.LOADED:value=entry.image;break;case this.ABORTED:value=SC.IMAGE_ABORTED_ERROR;break;case this.ERROR:value=SC.IMAGE_FAILED_ERROR;break;default:value=SC.IMAGE_FAILED_ERROR;break}entry.callbacks.forEach(function(x){var target=x[0],method=x[1];method.call(target,url,value)},this);entry.callbacks=[];entry.status=(status===this.LOADED)?this.IMAGE_LOADED:this.IMAGE_WAITING;var image=entry.image;if(image){image.onload=image.onerror=image.onabort=null;if(status!==this.LOADED){entry.image=null}}this._loading[this._loading.indexOf(entry)]=null;if(this._loading.length>this.loadLimit*2){this._loading=this._loading.compact()}this.decrementProperty("activeRequests");this.loadNextImage()},init:function(){arguments.callee.base.apply(this,arguments);this._images={};this._loading=[];this._foregroundQueue=[];this._backgroundQueue=[]},IMAGE_LOADED:"loaded",IMAGE_QUEUED:"queued",IMAGE_WAITING:"waiting",ABORTED:"aborted",ERROR:"error",LOADED:"loaded"});SC.Math=SC.Object.create({near:function(n1,n2,lambda){if(!lambda){lambda=0.00001}return Math.abs(n1-n2)<=lambda},round:function(n,decimalPlace){if(!decimalPlace){decimalPlace=0}var factor=Math.pow(10,decimalPlace);if(decimalPlace<0){var s=factor.toString();factor=s.substring(0,s.indexOf("1")+1)}n=n.valueOf();return Math.round(n*factor)/factor}});SC.Page=SC.Object.extend({owner:null,get:function(key){var value=this[key];if(value&&value.isClass){this[key]=value=value.create({page:this});if(!this.get("inDesignMode")){value.awake()}return value}else{return arguments.callee.base.apply(this,arguments)}},awake:function(){var value,key;for(key in this){if(!this.hasOwnProperty(key)){continue}value=this[key];if(value&&value.isViewClass){this[key]=value=value.create({page:this})}}return this},getIfConfigured:function(key){var ret=this[key];return(ret&&ret.isViewClass)?null:this.get(key)},loc:function(locs){var view,key;for(key in locs){if(!locs.hasOwnProperty(key)){continue}view=this[key];if(!view||!view.isViewClass){continue}view.loc(locs[key])}return this}});SC.Page.design=SC.Page.create;SC.Page.localization=function(attrs){return attrs};sc_require("system/event");SC.mixin({_isReadyBound:NO,_bindReady:function(){if(this._isReadyBound){return}this._isReadyBound=YES;tiki.require("tiki").ready.main(SC,SC._didBecomeReady)},_readyQueue:[],_afterReadyQueue:[],isReady:NO,_didBecomeReady:function(){if(SC.isReady){return}if(typeof SC.mapDisplayNames===SC.T_FUNCTION){SC.mapDisplayNames()}if(typeof SC.addInvokeOnceLastDebuggingInfo===SC.T_FUNCTION){SC.addInvokeOnceLastDebuggingInfo()}SC.Locale.createCurrentLocale();if(document&&document.getElementsByTagName){var body=document.getElementsByTagName("body")[0];if(body){var className=body.className;var language=SC.Locale.currentLanguage.toLowerCase();body.className=(className&&className.length>0)?[className,language].join(" "):language}}SC.Benchmark.start("ready");SC.RunLoop.begin();var handler,ary,idx,len;do{ary=SC._readyQueue;SC._readyQueue=[];for(idx=0,len=ary.length;idx<len;idx++){handler=ary[idx];var target=handler[0]||document;var method=handler[1];if(method){method.call(target)}}}while(SC._readyQueue.length>0);SC.isReady=YES;SC._readyQueue=null;SC.Event.trigger("ready",null,document,NO);if(SC.removeLoading){SC.$("#loading").remove()}if(SC.userDefaults.get("ready")){if((SC.mode===SC.APP_MODE)&&(typeof main!="undefined")&&(main instanceof Function)&&!SC.suppressMain){main()}}else{SC.userDefaults.readyCallback(window,main)}if(SC.routes&&SC.routes.ping){SC.routes.ping()}SC.RunLoop.end();SC.Benchmark.end("ready");SC.Benchmark.log()},ready:function(target,method){var queue=this._readyQueue;if(method===undefined){method=target;target=null}else{if(SC.typeOf(method)===SC.T_STRING){method=target[method]}}if(!method){return this}if(this.isReady){return method.call(target||document)}queue.push([target,method]);return this}});SC._bindReady();SC.removeLoading=YES;SC.APP_MODE="APP_MODE";SC.TEST_MODE="TEST_MODE";SC.mode=SC.APP_MODE;sc_require("system/builder");SC.MODE_REPLACE="replace";SC.MODE_APPEND="append";SC.MODE_PREPEND="prepend";SC.RenderContext=SC.Builder.create({SELF_CLOSING:SC.CoreSet.create().addEach("area base basefront br hr input img link meta".w()),init:function(tagNameOrElement,prevContext){if(tagNameOrElement===undefined){tagNameOrElement="div"}if(prevContext){this.prevObject=prevContext;this.strings=prevContext.strings;this.offset=prevContext.length+prevContext.offset}if(!this.strings){this.strings=[]}this.needsContent=YES;if(SC.typeOf(tagNameOrElement)===SC.T_STRING){this._tagName=tagNameOrElement.toLowerCase();this._needsTag=YES;var c=this;while(c){c.length++;c=c.prevObject}this.strings.push(null);this._selfClosing=this.SELF_CLOSING.contains(this._tagName)}else{this._elem=tagNameOrElement;this._needsTag=NO;this.length=0;this.needsContent=NO}return this},strings:null,offset:0,length:0,updateMode:SC.MODE_REPLACE,needsContent:NO,get:function(idx){var strings=this.strings||[];return(idx===undefined)?strings.slice(this.offset,this.length):strings[idx+this.offset]},push:function(line){var strings=this.strings,len=arguments.length;if(!strings){this.strings=strings=[]}if(len>1){strings.push.apply(strings,arguments)}else{strings.push(line)}var c=this;while(c){c.length+=len;c=c.prevObject}this.needsContent=YES;return this},text:function(line){var len=arguments.length,idx=0;for(idx=0;idx<len;idx++){this.push(SC.RenderContext.escapeHTML(arguments[idx]))}return this},join:function(joinChar){if(this._needsTag){this.end()}var strings=this.strings;return strings?strings.join(joinChar||""):""},begin:function(tagNameOrElement){return SC.RenderContext(tagNameOrElement,this)},element:function(){if(this._elem){return this._elem}var ret,child;if(!SC.RenderContext.factory){SC.RenderContext.factory=document.createElement("div")}SC.RenderContext.factory.innerHTML=this.join();if(SC.RenderContext.factory.innerHTML.length>0){child=SC.RenderContext.factory.firstChild.cloneNode(true);SC.RenderContext.factory.innerHTML=""}else{child=null}return child},remove:function(elementId){if(!elementId){return}var el,elem=this._elem;if(!elem||!elem.removeChild){return}el=document.getElementById(elementId);if(el){el=elem.removeChild(el);el=null}},update:function(){var elem=this._elem,mode=this.updateMode,key,value,styles,factory,cur,next,before;this._innerHTMLReplaced=NO;if(!elem){return}if(this.length>0){this._innerHTMLReplaced=YES;if(mode===SC.MODE_REPLACE){elem.innerHTML=this.join()}else{factory=elem.cloneNode(false);factory.innerHTML=this.join();before=(mode===SC.MODE_APPEND)?null:elem.firstChild;cur=factory.firstChild;while(cur){next=cur.nextSibling;elem.insertBefore(cur,next);cur=next}cur=next=factory=before=null}}if(this._attrsDidChange&&(value=this._attrs)){for(key in value){if(!value.hasOwnProperty(key)){continue}if(value[key]===null){elem.removeAttribute(key)}else{SC.$(elem).attr(key,value[key])}}}if(this._classNamesDidChange&&(value=this._classNames)){SC.$(elem).attr("class",value.join(" "))}if(this._idDidChange&&(value=this._id)){SC.$(elem).attr("id",value)}if(this._stylesDidChange&&(styles=this._styles)){var pair=this._STYLE_PAIR_ARRAY,joined=this._JOIN_ARRAY;for(key in styles){if(!styles.hasOwnProperty(key)){continue}value=styles[key];if(value===null){continue}if(typeof value===SC.T_NUMBER){value=value.toString()+"px"}pair[0]=key.dasherize();pair[1]=value;joined.push(pair.join(": "))}SC.$(elem).attr("style",joined.join("; "));joined.length=0}elem=this._elem=null;return this.prevObject||this},_DEFAULT_ATTRS:{},_TAG_ARRAY:[],_JOIN_ARRAY:[],_STYLE_PAIR_ARRAY:[],end:function(){var tag=this._TAG_ARRAY,pair,joined,key,attrs=this._attrs,className=this._classNames,id=this._id,styles=this._styles;tag[0]="<";tag[1]=this._tagName;if(attrs||className||styles||id){if(!attrs){attrs=this._DEFAULT_ATTRS}if(id){attrs.id=id}if(className){attrs["class"]=className.join(" ")}if(styles){joined=this._JOIN_ARRAY;pair=this._STYLE_PAIR_ARRAY;for(key in styles){if(!styles.hasOwnProperty(key)){continue}pair[0]=key.dasherize();pair[1]=styles[key];if(pair[1]===null){continue}if(typeof pair[1]===SC.T_NUMBER){pair[1]=pair[1]+"px"}joined.push(pair.join(": "))}attrs.style=joined.join("; ");joined.length=0}tag.push(" ");for(key in attrs){if(!attrs.hasOwnProperty(key)){continue}if(attrs[key]===null){continue}tag.push(key,'="',attrs[key],'" ')}if(attrs===this._DEFAULT_ATTRS){delete attrs.style;delete attrs["class"];delete attrs.id}}var strings=this.strings;var selfClosing=(this._selfClosing===NO)?NO:(this.length===1);tag.push(selfClosing?" />":">");strings[this.offset]=tag.join("");tag.length=0;if(!selfClosing){tag[0]="</";tag[1]=this._tagName;tag[2]=">";strings.push(tag.join(""));var c=this;while(c){c.length++;c=c.prevObject}tag.length=0}this._elem=null;return this.prevObject||this},tag:function(tagName,opts){return this.begin(tagName,opts).end()},tagName:function(tagName){if(tagName===undefined){if(!this._tagName&&this._elem){this._tagName=this._elem.tagName}return this._tagName}else{this._tagName=tagName;this._tagNameDidChange=YES;return this}},id:function(idName){if(idName===undefined){if(!this._id&&this._elem){this._id=this._elem.id}return this._id}else{this._id=idName;this._idDidChange=YES;return this}},classNames:function(classNames,cloneOnModify){if(classNames===undefined){if(!this._classNames&&this._elem){this._classNames=(SC.$(this._elem).attr("class")||"").split(" ")}if(this._cloneClassNames){this._classNames=(this._classNames||[]).slice();this._cloneClassNames=NO}if(!this._classNames){this._classNames=[]}return this._classNames}else{this._classNames=classNames;this._cloneClassNames=cloneOnModify||NO;this._classNamesDidChange=YES;return this}},hasClass:function(className){return this.classNames().indexOf(className)>=0},addClass:function(nameOrClasses){if(nameOrClasses===undefined||nameOrClasses===null){SC.Logger.warn("You are adding an undefined or empty class"+this.toString());return this}var classNames=this.classNames();if(SC.typeOf(nameOrClasses)===SC.T_STRING){if(classNames.indexOf(nameOrClasses)<0){classNames.push(nameOrClasses);this._classNamesDidChange=YES}}else{for(var i=0,iLen=nameOrClasses.length;i<iLen;i++){var cl=nameOrClasses[i];if(classNames.indexOf(cl)<0){classNames.push(cl);this._classNamesDidChange=YES}}}return this},removeClass:function(className){var classNames=this._classNames,idx;if(!classNames&&this._elem){classNames=this._classNames=(SC.$(this._elem).attr("class")||"").split(" ")}if(classNames&&(idx=classNames.indexOf(className))>=0){if(this._cloneClassNames){classNames=this._classNames=classNames.slice();this._cloneClassNames=NO}classNames[idx]=null;this._classNamesDidChange=YES}return this},resetClassNames:function(){this._classNames=[];this._classNamesDidChange=YES;return this},setClass:function(className,shouldAdd){var classNames,idx,key,didChange;if(shouldAdd!==undefined){return shouldAdd?this.addClass(className):this.removeClass(className)}else{classNames=this._classNames;if(!classNames&&this._elem){classNames=this._classNames=(SC.$(this._elem).attr("class")||"").split(" ")}if(!classNames){classNames=this._classNames=[]}if(this._cloneClassNames){classNames=this._classNames=classNames.slice();this._cloneClassNames=NO}didChange=NO;for(key in className){if(!className.hasOwnProperty(key)){continue}idx=classNames.indexOf(key);if(className[key]){if(idx<0){classNames.push(key);didChange=YES}}else{if(idx>=0){classNames[idx]=null;didChange=YES}}}if(didChange){this._classNamesDidChange=YES}}return this},_STYLE_REGEX:/\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g,styles:function(styles,cloneOnModify){var attr,regex,match;if(styles===undefined){if(!this._styles&&this._elem){attr=SC.$(this._elem).attr("style");if(attr&&(attr=attr.toString()).length>0){if(SC.browser.msie){attr=attr.toLowerCase()}styles={};regex=this._STYLE_REGEX;regex.lastIndex=0;while(match=regex.exec(attr)){styles[match[1].camelize()]=match[2]}this._styles=styles;this._cloneStyles=NO}else{this._styles={}}}else{if(!this._styles){this._styles={}}else{if(this._cloneStyles){this._styles=SC.beget(this._styles);this._cloneStyles=NO}}}return this._styles}else{this._styles=styles;this._cloneStyles=cloneOnModify||NO;this._stylesDidChange=YES;return this}},addStyle:function(nameOrStyles,value){var key,didChange=NO,styles=this.styles();if(typeof nameOrStyles===SC.T_STRING){if(value===undefined){return styles[nameOrStyles]}else{if(styles[nameOrStyles]!==value){styles[nameOrStyles]=value;this._stylesDidChange=YES}}}else{for(key in nameOrStyles){if(!nameOrStyles.hasOwnProperty(key)){continue}value=nameOrStyles[key];if(styles[key]!==value){styles[key]=value;didChange=YES}}if(didChange){this._stylesDidChange=YES}}return this},removeStyle:function(styleName){if(!this._styles&&!this._elem){return this}var styles=this.styles();if(styles[styleName]){styles[styleName]=null;this._stylesDidChange=YES}},attr:function(nameOrAttrs,value){var key,attrs=this._attrs,didChange=NO;if(!attrs){this._attrs=attrs={}}if(typeof nameOrAttrs===SC.T_STRING){if(value===undefined){return attrs[nameOrAttrs]}else{if(attrs[nameOrAttrs]!==value){attrs[nameOrAttrs]=value;this._attrsDidChange=YES}}}else{for(key in nameOrAttrs){if(!nameOrAttrs.hasOwnProperty(key)){continue}value=nameOrAttrs[key];if(attrs[key]!==value){attrs[key]=value;didChange=YES}}if(didChange){this._attrsDidChange=YES}}return this}});SC.RenderContext.fn.html=SC.RenderContext.fn.push;SC.RenderContext.fn.css=SC.RenderContext.fn.addStyle;if(!SC.browser.isSafari||parseInt(SC.browser.version,10)<526){SC.RenderContext._safari3=YES}SC.RenderContext.escapeHTML=function(text){var elem,node,ret;if(SC.none(text)){return text}elem=this.escapeHTMLElement;if(!elem){elem=this.escapeHTMLElement=document.createElement("div")}node=this.escapeTextNode;if(!node){node=this.escapeTextNode=document.createTextNode("");elem.appendChild(node)}node.data=text;ret=elem.innerHTML;if(SC.RenderContext._safari3){ret=ret.replace(/>/g,"&gt;")}node=elem=null;return ret};SC.Response=SC.Object.extend({isError:NO,errorValue:function(){return this}.property().cacheable(),errorObject:null,request:null,originalRequest:function(){var ret=this.get("request");while(ret.get("source")){ret=ret.get("source")}return ret}.property("request").cacheable(),type:function(){return this.getPath("request.type")}.property("request").cacheable(),address:function(){return this.getPath("request.address")}.property("request").cacheable(),isJSON:function(){return this.getPath("request.isJSON")||NO}.property("request").cacheable(),isXML:function(){return this.getPath("request.isXML")||NO}.property("request").cacheable(),listeners:function(){return this.getPath("request.listeners")}.property("request").cacheable(),status:-100,headers:null,encodedBody:null,body:function(){var ret=this.get("encodedBody");if(ret&&this.get("isJSON")){try{ret=SC.json.decode(ret)}catch(e){return SC.Error.create({message:e.name+": "+e.message,label:"Response",errorValue:this})}}return ret}.property("encodedBody").cacheable(),response:function(){return this.get("body")}.property("body").cacheable(),isCancelled:NO,timedOut:null,timeoutTimer:null,fire:function(){var req=this.get("request"),source=req?req.get("source"):null;if(source&&source.willSend){source.willSend(req,this)}req.freeze();if(!this.get("isCancelled")){this.invokeTransport()}var timeout=req.get("timeout");if(timeout){var timer=SC.Timer.schedule({target:this,action:"timeoutReached",interval:timeout,repeats:NO});this.set("timeoutTimer",timer)}if(!this.get("isCancelled")&&source&&source.didSend){source.didSend(req,this)}},invokeTransport:function(){this.receive(function(proceed){this.set("status",200)},this)},receive:function(callback,context){if(!this.get("timedOut")){var timer=this.get("timeoutTimer");if(timer){timer.invalidate()}this.set("timedOut",NO);var req=this.get("request");var source=req?req.get("source"):null;if(source&&source.willReceive){source.willReceive(req,this)}callback.call(context,!this.get("isCancelled"));if(!this.get("isCancelled")&&source&&source.didReceive){source.didReceive(req,this)}if(!this.get("isCancelled")){this.notify()}}SC.Request.manager.transportDidClose(this);return this},cancel:function(){if(!this.get("isCancelled")){this.set("isCancelled",YES);this.cancelTransport();SC.Request.manager.transportDidClose(this)}},timeoutReached:function(){if(this.get("timedOut")===null){this.set("timedOut",YES);this.cancelTransport();SC.Request.manager.transportDidClose(this);var error=SC.$error("HTTP Request timed out","Request",408);error.set("errorValue",this);this.set("isError",YES);this.set("errorObject",error);var req=this.get("request");var source=req?req.get("source"):null;if(!this.get("isCancelled")&&source&&source.didTimeout){source.didTimeout(req,this)}}},cancelTransport:function(){},_notifyListener:function(listeners,status){var info=listeners[status],params,target,action;if(!info){return NO}params=(info.params||[]).copy();params.unshift(this);target=info.target;action=info.action;if(SC.typeOf(action)===SC.T_STRING){action=target[action]}return action.apply(target,params)},notify:function(){var listeners=this.get("listeners"),status=this.get("status"),baseStat=Math.floor(status/100)*100,handled=NO;if(!listeners){return this}SC.RunLoop.begin();handled=this._notifyListener(listeners,status);if(!handled){handled=this._notifyListener(listeners,baseStat)}if(!handled){handled=this._notifyListener(listeners,0)}SC.RunLoop.end();return this},toString:function(){var ret=arguments.callee.base.apply(this,arguments);return"%@<%@ %@, status=%@".fmt(ret,this.get("type"),this.get("address"),this.get("status"))}});SC.XHRResponse=SC.Response.extend({headers:function(){var xhr=this.get("rawRequest"),str=xhr?xhr.getAllResponseHeaders():null,ret={};if(!str){return ret}str.split("\n").forEach(function(header){var idx=header.indexOf(":"),key,value;if(idx>=0){key=header.slice(0,idx);value=header.slice(idx+1).trim();ret[key]=value}},this);return ret}.property("status").cacheable(),header:function(key){var xhr=this.get("rawRequest");return xhr?xhr.getResponseHeader(key):null},encodedBody:function(){var xhr=this.get("rawRequest"),ret;if(!xhr){ret=null}else{if(this.get("isXML")){ret=xhr.responseXML}else{ret=xhr.responseText}}return ret}.property("status").cacheable(),cancelTransport:function(){var rawRequest=this.get("rawRequest");if(rawRequest){rawRequest.abort()}this.set("rawRequest",null)},invokeTransport:function(){var rawRequest,transport,handleReadyStateChange,async,headers;function tryThese(){for(var i=0;i<arguments.length;i++){try{var item=arguments[i]();return item}catch(e){}}return NO}rawRequest=tryThese(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")});this.set("rawRequest",rawRequest);async=!!this.getPath("request.isAsynchronous");if(async){if(!SC.browser.msie){SC.Event.add(rawRequest,"readystatechange",this,this.finishRequest,rawRequest)}else{transport=this;handleReadyStateChange=function(){if(!transport){return null}var ret=transport.finishRequest();if(ret){transport=null}return ret};rawRequest.onreadystatechange=handleReadyStateChange}}rawRequest.open(this.get("type"),this.get("address"),async);headers=this.getPath("request.headers");for(var headerKey in headers){rawRequest.setRequestHeader(headerKey,headers[headerKey])}rawRequest.send(this.getPath("request.encodedBody"));if(!async){this.finishRequest()}return rawRequest},finishRequest:function(evt){var rawRequest=this.get("rawRequest"),readyState=rawRequest.readyState,error,status,msg;if(readyState===4){this.receive(function(proceed){if(!proceed){return}status=-1;try{status=rawRequest.status||0}catch(e){}if((status<200)||(status>=300)){try{msg=rawRequest.statusText||""}catch(e2){msg=""}error=SC.$error(msg||"HTTP Request failed","Request",status);error.set("errorValue",this);this.set("isError",YES);this.set("errorObject",error)}this.set("status",status)},this);rawRequest.onreadystatechange=function(){};return YES}return NO}});sc_require("system/response");SC.Request=SC.Object.extend(SC.Copyable,SC.Freezable,{isAsynchronous:YES,isJSON:NO,isXML:NO,headers:function(){var ret=this._headers;if(!ret){ret=this._headers={}}return ret}.property().cacheable(),responseClass:SC.XHRResponse,source:null,address:null,type:"GET",timeout:null,body:null,encodedBody:function(){var ret=this.get("body");if(ret&&this.get("isJSON")){ret=SC.json.encode(ret)}return ret}.property("isJSON","isXML","body").cacheable(),willSend:function(request,response){},didSend:function(request,response){},willReceive:function(request,response){},didReceive:function(request,response){},didTimeout:function(request,response){},COPY_KEYS:"isAsynchronous isJSON isXML address type timeout body responseClass willSend didSend willReceive didReceive".w(),copy:function(){var ret={},keys=this.COPY_KEYS,loc=keys.length,key,listeners,headers;while(--loc>=0){key=keys[loc];if(this.hasOwnProperty(key)){ret[key]=this.get(key)}}if(this.hasOwnProperty("listeners")){ret.listeners=SC.copy(this.get("listeners"))}if(this.hasOwnProperty("_headers")){ret._headers=SC.copy(this._headers)}ret.source=this.get("source")||this;return this.constructor.create(ret)},header:function(key,value){var headers;if(SC.typeOf(key)===SC.T_STRING){headers=this._headers;if(arguments.length===1){return headers?headers[key]:null}else{this.propertyWillChange("headers");if(!headers){headers=this._headers={}}headers[key]=value;this.propertyDidChange("headers");return this}}else{if(value===undefined){headers=key;this.beginPropertyChanges();for(key in headers){if(!headers.hasOwnProperty(key)){continue}this.header(key,headers[key])}this.endPropertyChanges();return this}}return this},async:function(flag){if(flag===undefined){flag=YES}return this.set("isAsynchronous",flag)},json:function(flag){if(flag===undefined){flag=YES}if(flag){this.set("isXML",NO)}return this.set("isJSON",flag)},xml:function(flag){if(flag===undefined){flag=YES}if(flag){this.set("isJSON",NO)}return this.set("isXML",flag)},_prep:function(){var hasContentType=!!this.header("Content-Type");if(this.get("isJSON")&&!hasContentType){this.header("Content-Type","application/json")}else{if(this.get("isXML")&&!hasContentType){this.header("Content-Type","text/xml")}}return this},send:function(body){var timeout=this.get("timeout");if(timeout){if(!this.get("isAsynchronous")){throw"Timeout values cannot be used with synchronous requests"}}else{if(timeout===0){throw"The timeout value must either not be specified or must be greater than 0"}}if(body){this.set("body",body)}return SC.Request.manager.sendRequest(this.copy()._prep())},resend:function(){var req=this.get("source")?this:this.copy()._prep();return SC.Request.manager.sendRequest(req)},notify:function(status,target,action,params){var hasStatus=YES;if(SC.typeOf(status)!==SC.T_NUMBER){params=SC.A(arguments).slice(2);action=target;target=status;status=0;hasStatus=NO}else{params=SC.A(arguments).slice(3)}var listeners=this.get("listeners");if(!listeners){this.set("listeners",listeners={})}listeners[status]={target:target,action:action,params:params};return this}});SC.Request.mixin({getUrl:function(address){return this.create().set("address",address).set("type","GET")},postUrl:function(address,body){var req=this.create().set("address",address).set("type","POST");if(body){req.set("body",body)}return req},deleteUrl:function(address){return this.create().set("address",address).set("type","DELETE")},putUrl:function(address,body){var req=this.create().set("address",address).set("type","PUT");if(body){req.set("body",body)}return req}});SC.Request.manager=SC.Object.create(SC.DelegateSupport,{maxRequests:6,inflight:[],pending:[],sendRequest:function(request){if(!request){return null}var response=request.get("responseClass").create({request:request});this.get("pending").pushObject(response);this.fireRequestIfNeeded();return response},cancel:function(response){var pending=this.get("pending"),inflight=this.get("inflight"),idx;if(pending.indexOf(response)>=0){this.propertyWillChange("pending");pending.removeObject(response);this.propertyDidChange("pending");return YES}else{if(inflight.indexOf(response)>=0){response.cancel();inflight.removeObject(response);this.fireRequestIfNeeded();return YES}else{return NO}}},cancelAll:function(){if(this.get("pending").length||this.get("inflight").length){this.set("pending",[]);this.get("inflight").forEach(function(r){r.cancel()});this.set("inflight",[]);return YES}else{return NO}},fireRequestIfNeeded:function(){var pending=this.get("pending"),inflight=this.get("inflight"),max=this.get("maxRequests"),next;if((pending.length>0)&&(inflight.length<max)){next=pending.shiftObject();inflight.pushObject(next);next.fire()}},transportDidClose:function(response){this.get("inflight").removeObject(response);this.fireRequestIfNeeded()}});sc_require("system/ready");SC.RootResponder=SC.Object.extend({panes:null,init:function(){arguments.callee.base.apply(this,arguments);this.panes=SC.Set.create()},mainPane:null,makeMainPane:function(pane){var currentMain=this.get("mainPane");if(currentMain===pane){return this}this.beginPropertyChanges();if(this.get("keyPane")===currentMain){this.makeKeyPane(pane)}this.set("mainPane",pane);if(currentMain){currentMain.blurMainTo(pane)}if(pane){pane.focusMainFrom(currentMain)}this.endPropertyChanges();return this},keyPane:null,previousKeyPanes:[],makeKeyPane:function(pane){var newKeyPane,previousKeyPane,previousKeyPanes;if(pane){if(!pane.get("acceptsKeyPane")){return this}else{previousKeyPane=this.get("keyPane");if(previousKeyPane===pane){return this}else{if(previousKeyPane){previousKeyPanes=this.get("previousKeyPanes");previousKeyPanes.push(previousKeyPane)}newKeyPane=pane}}}else{previousKeyPane=this.get("keyPane");previousKeyPanes=this.get("previousKeyPanes");newKeyPane=null;while(previousKeyPanes.length>0){var candidate=previousKeyPanes.pop();if(candidate.get("isPaneAttached")&&candidate.get("acceptsKeyPane")){newKeyPane=candidate;break}}}if(!newKeyPane){var mainPane=this.get("mainPane");if(mainPane&&mainPane.get("acceptsKeyPane")){newKeyPane=mainPane}}if(previousKeyPane){previousKeyPane.willLoseKeyPaneTo(newKeyPane)}if(newKeyPane){newKeyPane.willBecomeKeyPaneFrom(previousKeyPane)}this.set("keyPane",newKeyPane);if(newKeyPane){newKeyPane.didBecomeKeyPaneFrom(previousKeyPane)}if(previousKeyPane){previousKeyPane.didLoseKeyPaneTo(newKeyPane)}return this},computeWindowSize:function(){return{width:640,height:480}},defaultResponder:null,sendAction:function(action,target,sender,pane,context){target=this.targetForAction(action,target,sender,pane);if(target&&target.isResponderContext){return !!target.sendAction(action,sender,context)}else{return target&&target.tryToPerform(action,sender)}},_responderFor:function(target,methodName){var defaultResponder=target?target.get("defaultResponder"):null;if(target){target=target.get("firstResponder")||target;do{if(target.respondsTo(methodName)){return target}}while(target=target.get("nextResponder"))}if(typeof defaultResponder===SC.T_STRING){defaultResponder=SC.objectForPropertyPath(defaultResponder)}if(!defaultResponder){return null}else{if(defaultResponder.isResponderContext){return defaultResponder}else{if(defaultResponder.respondsTo(methodName)){return defaultResponder}else{return null}}}},targetForAction:function(methodName,target,sender,pane){if(!methodName||(SC.typeOf(methodName)!==SC.T_STRING)){return null}if(target){if(SC.typeOf(target)===SC.T_STRING){target=SC.objectForPropertyPath(target)}if(target){if(target.respondsTo&&!target.respondsTo(methodName)){target=null}else{if(SC.typeOf(target[methodName])!==SC.T_FUNCTION){target=null}}}return target}if(pane){return this._responderFor(pane,methodName)}var keyPane=this.get("keyPane"),mainPane=this.get("mainPane");if(keyPane&&(keyPane!==pane)){target=this._responderFor(keyPane,methodName)}if(!target&&mainPane&&(mainPane!==keyPane)){target=this._responderFor(mainPane,methodName)}if(!target&&(target=this.get("defaultResponder"))){if(SC.typeOf(target)===SC.T_STRING){target=SC.objectForPropertyPath(target);if(target){this.set("defaultResponder",target)}}if(target){if(target.respondsTo&&!target.respondsTo(methodName)){target=null}else{if(SC.typeOf(target[methodName])!==SC.T_FUNCTION){target=null}}}}return target},targetViewForEvent:function(evt){return evt.target?SC.$(evt.target).view()[0]:null},sendEvent:function(action,evt,target){var pane,ret;SC.RunLoop.begin();if(target){pane=target.get("pane")}else{pane=this.get("keyPane")||this.get("mainPane")}ret=(pane)?pane.sendEvent(action,evt,target):null;SC.RunLoop.end();return ret},sendTouchEvent:function(action,evt,target){var pane,ret;SC.RunLoop.begin();if(target){pane=target.get("pane")}else{pane=this.get("keyPane")||this.get("mainPane")}ret=(pane)?pane.sendTouchEvent(action,evt,target):null;SC.RunLoop.end();return ret},listenFor:function(keyNames,target){keyNames.forEach(function(keyName){var method=this[keyName];if(method){SC.Event.add(target,keyName,this,method)}},this);target=null;return this},setup:function(){this.listenFor("touchstart touchmove touchend touchcancel".w(),document);if(SC.browser.touch){var elem=document.createElement("div");elem.id="sc-touch-intercept";elem.style.position="absolute";elem.style.top="0px";elem.style.left="0px";elem.style.bottom="0px";elem.style.right="0px";elem.style.zIndex=999;document.body.appendChild(elem);this._touchInterceptElement=elem;elem=null}},touchstart:function(evt){try{var view=this.targetViewForEvent(evt);this._touchViews=this.sendTouchEvent("touchStart",evt,view)}catch(e){SC.Logger.warn("Exception during touchStart: %@".fmt(e));this._touchViews=null;return NO}return view?evt.hasCustomEventHandling:YES},touchmove:function(evt){SC.RunLoop.begin();try{var lh=this._lastHovered||[],nh=[],view=this.targetViewForEvent(evt),exited,loc,len,touchViews,response;while(view&&(view!==this)){if(lh.indexOf(view)!==-1){view.tryToPerform("touchMoved",evt);nh.push(view)}else{view.tryToPerform("touchEntered",evt);nh.push(view)}view=view.get("nextResponder")}for(loc=0,len=lh.length;loc<len;loc++){view=lh[loc];exited=view.respondsTo("touchExited");if(exited&&!(nh.indexOf(view)!==-1)){view.tryToPerform("touchExited",evt)}}this._lastHovered=nh;touchViews=this._touchViews;len=touchViews.length;for(loc=0;loc<len;loc++){view=touchViews[loc];if(view.respondsTo("touchDragged")){switch(view.touchDragged(evt)){case YES:this.cancelTouch(touchViews,view);touchViews=null;this._touchViews=[view];break;case NO:touchViews.removeObject(view);break}}}}catch(e){SC.Logger.warn("Exception during touchMove: %@".fmt(e))}SC.RunLoop.end();return NO},touchend:function(evt){try{evt.cancel=NO;var handler=null,views=this._touchViews,idx,len,view;if(views){len=views.get("length");for(idx=0;idx<len;idx++){view=views[idx];if(view.respondsTo("touchEnd")){view.touchEnd(evt)}}}this._touchViews=null}catch(e){SC.Logger.warn("Exception during touchEnd: %@".fmt(e));this._touchViews=null;return NO}return(handler)?evt.hasCustomEventHandling:YES},touchcancel:function(evt){evt.cancel=YES;return this.touchend(evt)},cancelTouch:function(views,newView,evt){var view,idx,len;len=views.get("length");for(idx=0;idx<len;idx++){view=views.objectAt(idx);if(view!==newView){view.tryToPerform("touchCancelled",evt)}}}});SC.ready(SC.RootResponder,SC.RootResponder.ready=function(){var r;r=SC.RootResponder.responder=SC.RootResponder.create();r.setup()});SC.routes=SC.Object.create({location:function(key,value){if(value!==undefined){if(value===null){value=""}if(typeof(value)=="object"){var parts=value.route?value.route.split("&"):[""];var route=parts.shift();var params={};parts.forEach(function(p){var bits=p.split("=");params[bits[0]]=bits[1]});for(key in value){if(!value.hasOwnProperty(key)){continue}if(key!="route"){params[key]=encodeURIComponent(""+value[key])}}parts=[route];for(key in params){if(!params.hasOwnProperty(key)){continue}parts.push([key,params[key]].join("="))}value=parts.join("&")}if(this._location!=value){this._location=value;this._setWindowLocation(value)}}return this._location}.property(),ping:function(){if(!this._didSetupHistory){this._didSetupHistory=true;this._setupHistory()}this._checkWindowLocation()},add:function(route,target,method){if(method===undefined&&SC.typeOf(target)===SC.T_FUNCTION){method=target;target=null}else{if(SC.typeOf(method)===SC.T_STRING){method=target[method]}}var parts=route.split("/");if(!this._routes){this._routes=SC.routes._Route.create()}this._routes.addRoute(parts,target,method);return this},gotoRoute:function(route){var params={},parts,routeHandler,target,method;this._lastRoute=route;parts=route.split("&");if(parts&&parts.length>0){route=parts.shift();parts.forEach(function(part){var param=part.split("=");if(param&&param.length>1){params[param[0]]=decodeURIComponent(param[1])}})}else{route=""}parts=route.split("/");if(!this._routes){this._routes=SC.routes._Route.create()}routeHandler=this._routes.functionForRoute(parts,params);if(routeHandler){target=routeHandler._target;method=routeHandler._method;if(method){method.call(target,params)}}},init:function(){arguments.callee.base.call(this);if(SC.browser.isSafari&&parseInt(SC.browser.version,0)<417){SC.mixin(this,this.browserFuncs.safari)}else{if(SC.browser.isIE){SC.mixin(this,this.browserFuncs.ie)}else{if(SC.browser.isMozilla){SC.mixin(this,this.browserFuncs.firefox)}}}this._didSetupHistory=false},invokeCheckWindowLocation:function(after){var f=this.__checkWindowLocation,that=this;if(!f){f=this.__checkWindowLocation=function(){that._checkWindowLocation()}}setTimeout(f,after)},browserFuncs:{safari:{_setupHistory:function(){var cloc=location.hash;cloc=(cloc&&cloc.length>0)?cloc.slice(1,cloc.length):"";this._cloc=cloc;this._backStack=[];this._backStack.length=history.length;this._backStack.push(cloc);this._forwardStack=[];this.invokeCheckWindowLocation(1000)},_checkWindowLocation:function(){var historyDidChange=(history.length-this._lastLength)!==0;var delta=(historyDidChange)?(history.length-this._backStack.length):0;this._lastLength=history.length;if(historyDidChange){SC.Logger.log("historyDidChange")}if(delta){if(delta<0){this._forwardStack.push(this._cloc);for(var i=0;i<Math.abs(delta+1);i++){this._forwardStack.push(this._backStack.pop())}this._cloc=this._backStack.pop()}else{this._backStack.push(this._cloc);for(i=0;i<(delta-1);i++){this._backStack.push(this._forwardStack.pop())}this._cloc=this._forwardStack.pop()}}else{if(historyDidChange&&this._locationDidChange){this.gotoRoute(this._cloc);this._locationDidChange=false}}var cloc=this._cloc;var loc=this.get("location");if(cloc!=loc){this.set("location",(cloc)?cloc:"");this.gotoRoute(cloc)}this.invokeCheckWindowLocation(50)},_setWindowLocation:function(loc){var cloc=this._cloc;if(cloc!=loc){this._backStack.push(this._cloc);this._forwardStack.length=0;this._cloc=loc;location.hash=(loc&&loc.length>0)?loc:"";this._locationDidChange=true}}},ie:{_setupHistory:function(){this.invokeCheckWindowLocation(1000)},_checkWindowLocation:function(){var loc=this.get("location");var cloc=location.hash;cloc=(cloc&&cloc.length>0)?cloc.slice(1,cloc.length):"";if(cloc!=loc){this.set("location",(cloc)?cloc:"")}this.invokeCheckWindowLocation(100)},_setWindowLocation:function(loc){var cloc=location.hash;cloc=(cloc&&cloc.length>0)?cloc.slice(1,cloc.length):"";if(cloc!=loc){location.hash=(loc&&loc.length>0)?loc:"#"}this.gotoRoute(loc)}},firefox:{_checkWindowLocation:function(){var loc=this.get("location");var cloc=location.hash;cloc=(cloc&&cloc.length>0)?cloc.slice(1,cloc.length):"";if(cloc!=loc){SC.RunLoop.begin();this.set("location",(cloc)?cloc:"");SC.RunLoop.end()}this.invokeCheckWindowLocation(150)},_setWindowLocation:function(loc){var cloc=location.hash;cloc=(cloc&&cloc.length>0)?cloc.slice(1,cloc.length):"";if(cloc!=loc){location.hash=(loc&&loc.length>0)?loc:"#"}this.gotoRoute(loc)}}},_setupHistory:function(){var that=this;this.invokeCheckWindowLocation(1000)},_checkWindowLocation:function(){var loc=this.get("location");var cloc=decodeURI(location.hash);cloc=(cloc&&cloc.length>0)?cloc.slice(1,cloc.length):"";if(cloc!==loc){SC.RunLoop.begin();this.set("location",(cloc)?cloc:"");SC.RunLoop.end()}this.invokeCheckWindowLocation(150)},_setWindowLocation:function(loc){var cloc=location.hash;cloc=(cloc&&cloc.length>0)?cloc.slice(1,cloc.length):"";if(cloc!=loc){location.hash=(loc&&loc.length>0)?encodeURI(loc):"#"}this.gotoRoute(loc)},_routes:null,_Route:SC.Object.extend({_target:null,_method:null,_static:null,_dynamic:null,_wildcard:null,addRoute:function(parts,target,method){if(!parts||parts.length===0){this._target=target;this._method=method}else{var part=parts.shift();var nextRoute=null;switch(part.slice(0,1)){case":":part=part.slice(1,part.length);var routes=this._dynamic[part]||[];nextRoute=SC.routes._Route.create();routes.push(nextRoute);this._dynamic[part]=routes;break;case"*":part=part.slice(1,part.length);this._wildcard=part;this._target=target;this._method=method;break;default:routes=this._static[part]||[];nextRoute=SC.routes._Route.create();routes.push(nextRoute);this._static[part]=routes}if(nextRoute){nextRoute.addRoute(parts,target,method)}}},functionForRoute:function(parts,params){if(!parts||parts.length===0){return this}else{var part=parts.shift(),ret=null,routes,nextRoute,loc,routesLen;routes=this._static[part];if(routes){for(loc=0,routesLen=routes.length;(loc<routesLen)&&(ret===null);loc++){var clone=parts.slice();ret=routes[loc].functionForRoute(clone,params)}}if(ret===null){for(var key in this._dynamic){routes=this._dynamic[key];if(routes){for(loc=0,routesLen=routes.length;(loc<routesLen)&&(ret===null);loc++){clone=parts.slice();ret=routes[loc].functionForRoute(clone,params);if(ret&&params){params[key]=part}}}if(ret){break}}}if((ret===null)&&this._wildcard){parts.unshift(part);if(params){params[this._wildcard]=parts.join("/")}ret=this}return ret}},init:function(){arguments.callee.base.call(this);this._static={};this._dynamic={}}})});SC.time=function(timeoffset){var ret=SC.beget(fn);ret.value=timeOffset;return ret};(function(){var date=new Date();SC.mixin(SC.time,{month:function(offset,newMonth){date.setTime(offset);if(newMonth===undefined){return date.getMonth()}date.setMonth(newMonth);return date.getTime()},utc:function(offset){date.setTime(offset);return offset+(date.getTimezoneOffset()*60*1000)},local:function(offset){date.setTime(offset);return offset-(date.getTimezoneOffset()*60*1000)},parse:function(string){},format:function(offset){}})})();SC.time.fmt=SC.time.format;SC.time.fn={done:function(){return this.value}};"month day year".split(" ").forEach(function(key){SC.time.fn[key]=function(newTime){if(newTime===undefined){return SC.time[key](this.value)}else{this.value=SC.time[key](this.value,newTime);return this}}});var MONTH_NAMES=new Array("January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");var DAY_NAMES=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sun","Mon","Tue","Wed","Thu","Fri","Sat");function LZ(x){return(x<0||x>9?"":"0")+x}SC.Locale.define("en",{longMonthNames:"January February March April May".split(" "),shortMonthNames:[],shortDateFormat:"dd/mm/yy",longDateFormat:""});SC.mixin(Date,{now:function(){return new Date().getTime()},isDate:function(val,format){var date=Date.getDateFromFormat(val,format);if(date==0){return false}return true},compareDates:function(date1,dateformat1,date2,dateformat2){var d1=Date.getDateFromFormat(date1,dateformat1);var d2=Date.getDateFromFormat(date2,dateformat2);if(d1==0||d2==0){return -1}else{if(d1>d2){return 1}}return 0},getDateFromFormat:function(val,format){val=val+"";format=format+"";var i_val=0;var i_format=0;var c="";var token="";var token2="";var x,y;var now=new Date();var year=now.getFullYear();var month=now.getMonth()+1;var date=1;var hh=now.getHours();var mm=now.getMinutes();var ss=now.getSeconds();var ampm="";var locale=SC.Locale.currentLocale;while(i_format<format.length){c=format.charAt(i_format);token="";while((format.charAt(i_format)==c)&&(i_format<format.length)){token+=format.charAt(i_format++)}if(token=="yyyy"||token=="yy"||token=="y"){if(token=="yyyy"){x=4;y=4}if(token=="yy"){x=2;y=2}if(token=="y"){x=2;y=4}year=Date._getInt(val,i_val,x,y);if(year==null){return 0}i_val+=year.length;if(year.length==2){if(year>70){year=1900+(year-0)}else{year=2000+(year-0)}}}else{if(token=="MMM"||token=="NNN"){month=0;for(var i=0;i<MONTH_NAMES.length;i++){var month_name=MONTH_NAMES[i];if(val.substring(i_val,i_val+month_name.length).toLowerCase()==month_name.toLowerCase()){if(token=="MMM"||(token=="NNN"&&i>11)){month=i+1;if(month>12){month-=12}i_val+=month_name.length;break}}}if((month<1)||(month>12)){return 0}}else{if(token=="EE"||token=="E"){for(var i=0;i<DAY_NAMES.length;i++){var day_name=DAY_NAMES[i];if(val.substring(i_val,i_val+day_name.length).toLowerCase()==day_name.toLowerCase()){i_val+=day_name.length;break}}}else{if(token=="MM"||token=="M"){month=Date._getInt(val,i_val,token.length,2);if(month==null||(month<1)||(month>12)){return 0}i_val+=month.length}else{if(token=="dd"||token=="d"){date=Date._getInt(val,i_val,token.length,2);if(date==null||(date<1)||(date>31)){return 0}i_val+=date.length}else{if(token=="hh"||token=="h"){hh=Date._getInt(val,i_val,token.length,2);if(hh==null||(hh<1)||(hh>12)){return 0}i_val+=hh.length}else{if(token=="HH"||token=="H"){hh=Date._getInt(val,i_val,token.length,2);if(hh==null||(hh<0)||(hh>23)){return 0}i_val+=hh.length}else{if(token=="KK"||token=="K"){hh=Date._getInt(val,i_val,token.length,2);if(hh==null||(hh<0)||(hh>11)){return 0}i_val+=hh.length}else{if(token=="kk"||token=="k"){hh=Date._getInt(val,i_val,token.length,2);if(hh==null||(hh<1)||(hh>24)){return 0}i_val+=hh.length;hh--}else{if(token=="mm"||token=="m"){mm=Date._getInt(val,i_val,token.length,2);if(mm==null||(mm<0)||(mm>59)){return 0}i_val+=mm.length}else{if(token=="ss"||token=="s"){ss=Date._getInt(val,i_val,token.length,2);if(ss==null||(ss<0)||(ss>59)){return 0}i_val+=ss.length}else{if(token=="a"){if(val.substring(i_val,i_val+2).toLowerCase()=="am"){ampm="AM"}else{if(val.substring(i_val,i_val+2).toLowerCase()=="pm"){ampm="PM"}else{return 0}}i_val+=2}else{if(val.substring(i_val,i_val+token.length)!=token){return 0}else{i_val+=token.length}}}}}}}}}}}}}}if(i_val!=val.length){return 0}if(month==2){if(((year%4==0)&&(year%100!=0))||(year%400==0)){if(date>29){return 0}}else{if(date>28){return 0}}}if((month==4)||(month==6)||(month==9)||(month==11)){if(date>30){return 0}}if(hh<12&&ampm=="PM"){hh=hh-0+12}else{if(hh>11&&ampm=="AM"){hh-=12}}var newdate=new Date(year,month-1,date,hh,mm,ss);return newdate.getTime()},parseDate:function(val){var preferEuro=(arguments.length==2)?arguments[1]:false;generalFormats=new Array("E NNN dd HH:mm:ss UTC yyyy","y-M-d","y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d","d MMM y","d.MMM.y","y MMM d","y.MMM.d");monthFirst=new Array("M/d/y","M-d-y","M.d.y","MMM-d","M/d","M-d");dateFirst=new Array("d/M/y","d-M-y","d.M.y","d-MMM","d/M","d-M");var checkList=new Array("generalFormats",preferEuro?"dateFirst":"monthFirst",preferEuro?"monthFirst":"dateFirst");var d=null;d=0;var now=new Date().getTime();switch(val.toLowerCase()){case"yesterday".loc():d=now-(24*60*60*1000);break;case"today".loc():case"now".loc():d=now;break;case"tomorrow".loc():d=now+(24*60*60*1000);break}if(d>0){return new Date(d)}for(var i=0;i<checkList.length;i++){var l=window[checkList[i]];for(var j=0;j<l.length;j++){d=Date.getDateFromFormat(val,l[j]);if(d==0){d=Date.getDateFromFormat(val,l[j]+" H:m:s")}if(d==0){d=Date.getDateFromFormat(val,l[j]+" h:m:s a")}if(d!=0){return new Date(d)}}}return null},_isInteger:function(val){var digits="1234567890";for(var i=0;i<val.length;i++){if(digits.indexOf(val.charAt(i))==-1){return false}}return true},_getInt:function(str,i,minlength,maxlength){for(var x=maxlength;x>=minlength;x--){var token=str.substring(i,i+x);if(token.length<minlength){return null}if(Date._isInteger(token)){return token}}return null}});SC.mixin(Date.prototype,{format:function(format){format=format+"";var date=this;var result="";var i_format=0;var c="";var token="";var y=date.getFullYear()+"";var M=date.getMonth()+1;var d=date.getDate();var E=date.getDay();var H=date.getHours();var m=date.getMinutes();var s=date.getSeconds();var yyyy,yy,MMM,MM,dd,hh,h,mm,ss,ampm,HH,H,KK,K,kk,k;var value=new Object();if(y.length<4){y=""+(y-0+1900)}value.y=""+y;value.yyyy=y;value.yy=y.substring(2,4);value.M=M;value.MM=LZ(M);value.MMM=MONTH_NAMES[M-1];value.NNN=MONTH_NAMES[M+11];value.d=d;value.dd=LZ(d);value.E=DAY_NAMES[E+7];value.EE=DAY_NAMES[E];value.H=H;value.HH=LZ(H);if(H==0){value.h=12}else{if(H>12){value.h=H-12}else{value.h=H}}value.hh=LZ(value.h);if(H>11){value.K=H-12}else{value.K=H}value.k=H+1;value.KK=LZ(value.K);value.kk=LZ(value.k);if(H>11){value.a="PM"}else{value.a="AM"}value.m=m;value.mm=LZ(m);value.s=s;value.ss=LZ(s);while(i_format<format.length){c=format.charAt(i_format);token="";while((format.charAt(i_format)==c)&&(i_format<format.length)){token+=format.charAt(i_format++)}if(value[token]!=null){result=result+value[token]}else{result=result+token}}return result},utcFormat:function(){return(new Date(this.getTime()+(this.getTimezoneOffset()*60*1000))).format("E NNN dd HH:mm:ss UTC yyyy")}});SC.Timer=SC.Object.extend({target:null,action:null,isPooled:NO,interval:0,startTime:null,repeats:NO,until:null,isPaused:NO,isScheduled:NO,isValid:YES,lastFireTime:0,fireTime:function(){if(!this.get("isValid")){return -1}var start=this.get("startTime");if(!start||start===0){return -1}var interval=this.get("interval"),last=this.get("lastFireTime");if(last<start){last=start}var next;if(this.get("repeats")){if(interval===0){next=last}else{next=start+(Math.floor((last-start)/interval)+1)*interval}}else{next=start+interval}var until=this.get("until");if(until&&until>0&&next>until){next=until}return next}.property("interval","startTime","repeats","until","isValid","lastFireTime").cacheable(),schedule:function(){if(!this.get("isValid")){return this}this.beginPropertyChanges();if(!this.startTime){this.set("startTime",SC.RunLoop.currentRunLoop.get("startTime"))}var next=this.get("fireTime"),last=this.get("lastFireTime");if(next>=last){this.set("isScheduled",YES);SC.RunLoop.currentRunLoop.scheduleTimer(this,next)}this.endPropertyChanges();return this},invalidate:function(){this.beginPropertyChanges();this.set("isValid",NO);SC.RunLoop.currentRunLoop.cancelTimer(this);this.action=this.target=null;this.endPropertyChanges();if(this.get("isPooled")){SC.Timer.returnTimerToPool(this)}return this},fire:function(){var last=Date.now();this.set("lastFireTime",last);var next=this.get("fireTime");if(!this.get("isPaused")){this.performAction()}if(next>last){this.schedule()}else{this.invalidate()}},performAction:function(){var typeOfAction=SC.typeOf(this.action);if(typeOfAction==SC.T_FUNCTION){this.action.call((this.target||this),this)}else{if(typeOfAction===SC.T_STRING){if(this.action.indexOf(".")>=0){var path=this.action.split(".");var property=path.pop();var target=SC.objectForPropertyPath(path,window);var action=target.get?target.get(property):target[property];if(action&&SC.typeOf(action)==SC.T_FUNCTION){action.call(target,this)}else{throw"%@: Timer could not find a function at %@".fmt(this,this.action)}}else{SC.RootResponder.responder.sendAction(this.action,this.target,this)}}}},init:function(){arguments.callee.base.apply(this,arguments);if(this.startTime instanceof Date){this.startTime=this.startTime.getTime()}if(this.until instanceof Date){this.until=this.until.getTime()}},RESET_DEFAULTS:{target:null,action:null,isPooled:NO,isPaused:NO,isScheduled:NO,isValid:YES,interval:0,repeats:NO,until:null,startTime:null,lastFireTime:0},reset:function(props){if(!props){props=SC.EMPTY_HASH}this.propertyWillChange("fireTime");var defaults=this.RESET_DEFAULTS;for(var key in defaults){if(!defaults.hasOwnProperty(key)){continue}this[key]=SC.none(props[key])?defaults[key]:props[key]}this.propertyDidChange("fireTime");return this},removeFromTimerQueue:function(timerQueueRoot){var prev=this._timerQueuePrevious,next=this._timerQueueNext;if(!prev&&!next&&timerQueueRoot!==this){return timerQueueRoot}if(prev){prev._timerQueueNext=next}if(next){next._timerQueuePrevious=prev}this._timerQueuePrevious=this._timerQueueNext=null;return(timerQueueRoot===this)?next:timerQueueRoot},scheduleInTimerQueue:function(timerQueueRoot,runTime){this._timerQueueRunTime=runTime;var beforeNode=timerQueueRoot;var afterNode=null;while(beforeNode&&beforeNode._timerQueueRunTime<runTime){afterNode=beforeNode;beforeNode=beforeNode._timerQueueNext}if(afterNode){afterNode._timerQueueNext=this;this._timerQueuePrevious=afterNode}if(beforeNode){beforeNode._timerQueuePrevious=this;this._timerQueueNext=beforeNode}return(beforeNode===timerQueueRoot)?this:timerQueueRoot},collectExpiredTimers:function(timers,now){if(this._timerQueueRunTime>now){return this}timers.push(this);var next=this._timerQueueNext;this._timerQueueNext=null;if(next){next._timerQueuePrevious=null}return next?next.collectExpiredTimers(timers,now):null}});SC.Timer.schedule=function(props){var timer;if(!props||SC.none(props.isPooled)||props.isPooled){timer=this.timerFromPool(props)}else{timer=this.create(props)}return timer.schedule()};SC.Timer.timerFromPool=function(props){var timers=this._timerPool;if(!timers){timers=this._timerPool=[]}var timer=timers.pop();if(!timer){timer=this.create()}return timer.reset(props)};SC.Timer.returnTimerToPool=function(timer){if(!this._timerPool){this._timerPool=[]}this._timerPool.push(timer);return this};SC.UserDefaults=SC.Object.extend({ready:NO,userDomain:null,appDomain:null,_defaults:null,_safari3DB:null,defaults:function(newDefaults){this._defaults=newDefaults;this.allPropertiesDidChange()},readDefault:function(keyName){var ret=undefined,userKeyName,localStorage,key,del,storageSafari3;keyName=this._normalizeKeyName(keyName);userKeyName=this._userKeyName(keyName);if(this._written){ret=this._written[userKeyName]}if(SC.browser.msie=="7.0"){localStorage=document.body;try{localStorage.load("SC.UserDefaults")}catch(e){SC.Logger.err("Couldn't load userDefaults in IE7: "+e.description)}}else{if(this.HTML5DB_noLocalStorage){storageSafari3=this._safari3DB}else{localStorage=window.localStorage;if(!localStorage&&window.globalStorage){localStorage=window.globalStorage[window.location.hostname]}}}if(localStorage||storageSafari3){key=["SC.UserDefaults",userKeyName].join("-at-");if(SC.browser.msie=="7.0"){ret=localStorage.getAttribute(key.replace(/\W/gi,""))}else{if(storageSafari3){ret=this.dataHash[key]}else{ret=localStorage[key]}}if(!SC.none(ret)){try{ret=SC.json.decode(ret)}catch(ex){ret=undefined}}else{ret=undefined}}del=this.delegate;if(del&&del.userDefaultsNeedsDefault){ret=del.userDefaultsNeedsDefault(this,keyName,userKeyName)}if((ret===undefined)&&this._defaults){ret=this._defaults[userKeyName]||this._defaults[keyName]}return ret},writeDefault:function(keyName,value){var userKeyName,written,localStorage,key,del,storageSafari3;keyName=this._normalizeKeyName(keyName);userKeyName=this._userKeyName(keyName);written=this._written;if(!written){written=this._written={}}written[userKeyName]=value;if(SC.browser.msie=="7.0"){localStorage=document.body}else{if(this.HTML5DB_noLocalStorage){storageSafari3=this._safari3DB}else{localStorage=window.localStorage;if(!localStorage&&window.globalStorage){localStorage=window.globalStorage[window.location.hostname]}}}key=["SC.UserDefaults",userKeyName].join("-at-");if(localStorage||storageSafari3){var encodedValue=SC.json.encode(value);if(SC.browser.msie=="7.0"){localStorage.setAttribute(key.replace(/\W/gi,""),encodedValue);localStorage.save("SC.UserDefaults")}else{if(storageSafari3){var obj=this;storageSafari3.transaction(function(t){t.executeSql("delete from SCLocalStorage where key = ?",[key],function(){t.executeSql("insert into SCLocalStorage(key, value) VALUES ('"+key+"', '"+encodedValue+"');",[],obj._nullDataHandler,obj.killTransaction)})});this.dataHash[key]=encodedValue}else{try{localStorage[key]=encodedValue}catch(e){SC.Logger.error("Failed using localStorage. "+e)}}}}del=this.delegate;if(del&&del.userDefaultsDidChange){del.userDefaultsDidChange(this,keyName,value,userKeyName)}return this},resetDefault:function(keyName){var fullKeyName,userKeyName,written,localStorage,key,storageSafari3;fullKeyName=this._normalizeKeyName(keyName);userKeyName=this._userKeyName(fullKeyName);this.propertyWillChange(keyName);this.propertyWillChange(fullKeyName);written=this._written;if(written){delete written[userKeyName]}if(SC.browser.msie=="7.0"){localStorage=document.body}else{if(this.HTML5DB_noLocalStorage){storageSafari3=this._safari3DB}else{localStorage=window.localStorage;if(!localStorage&&window.globalStorage){localStorage=window.globalStorage[window.location.hostname]}}}key=["SC.UserDefaults",userKeyName].join("-at-");if(localStorage){if(SC.browser.msie=="7.0"){localStorage.setAttribute(key.replace(/\W/gi,""),null);localStorage.save("SC.UserDefaults")}else{if(storageSafari3){var obj=this;storageSafari3.transaction(function(t){t.executeSql("delete from SCLocalStorage where key = ?",[key],null)});delete this.dataHash[key]}else{delete localStorage[key]}}}this.propertyDidChange(keyName);this.propertyDidChange(fullKeyName);return this},unknownProperty:function(key,value){if(value===undefined){return this.readDefault(key)}else{this.writeDefault(key,value);return value}},_normalizeKeyName:function(keyName){if(keyName.indexOf(":")<0){var domain=this.get("appDomain")||"app";keyName=[domain,keyName].join(":")}return keyName},_userKeyName:function(keyName){var user=this.get("userDomain")||"(anonymous)";return[user,keyName].join("-at-")},_domainDidChange:function(){var didChange=NO;if(this.get("userDomain")!==this._scud_userDomain){this._scud_userDomain=this.get("userDomain");didChange=YES}if(this.get("appDomain")!==this._scud_appDomain){this._scud_appDomain=this.get("appDomain");didChange=YES}if(didChange){this.allPropertiesDidChange()}}.observes("userDomain","appDomain"),init:function(){arguments.callee.base.apply(this,arguments);if(SC.userDefaults&&SC.userDefaults.get("dataHash")){var dh=SC.userDefaults.get("dataHash");if(dh){this.dataHash=SC.userDefaults.get("dataHash")}}this._scud_userDomain=this.get("userDomain");this._scud_appDomain=this.get("appDomain");if(SC.browser.msie=="7.0"){document.body.addBehavior("#default#userData")}this.HTML5DB_noLocalStorage=((parseInt(SC.browser.safari,0)>523)&&(parseInt(SC.browser.safari,0)<528));if(this.HTML5DB_noLocalStorage){var myDB;try{if(!window.openDatabase){SC.Logger.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");return}else{var shortName="scdb",version="1.0",displayName="SproutCore database",maxSize=65536;myDB=openDatabase(shortName,version,displayName,maxSize)}}catch(e){SC.Logger.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");return}if(myDB){var obj=this;myDB.transaction(function(transaction){transaction.executeSql("CREATE TABLE IF NOT EXISTS SCLocalStorage(key TEXT NOT NULL PRIMARY KEY, value TEXT NOT NULL);",[],obj._nullDataHandler,obj.killTransaction)});myDB.transaction(function(transaction){transaction.parent=obj;transaction.executeSql("SELECT * from SCLocalStorage;",[],function(transaction,results){var hash={},row;for(var i=0,iLen=results.rows.length;i<iLen;i++){row=results.rows.item(i);hash[row.key]=row.value}transaction.parent.dataHash=hash;SC.userDefaults.set("ready",YES)},obj.killTransaction)});this._safari3DB=myDB}}else{this.set("ready",YES)}},_killTransaction:function(transaction,error){return true},_nullDataHandler:function(transaction,results){},readyCallback:function(ob,func){this.func=func;this.ob=ob},readyChanged:function(){if(this.ready===YES){var f=this.func;if(f){f.apply(this.ob)}}}.observes("ready")});SC.userDefaults=SC.UserDefaults.create();sc_require("system/browser");SC.mixin({_downloadFrames:0,_copy_computed_props:["maxWidth","maxHeight","paddingLeft","paddingRight","paddingTop","paddingBottom","fontFamily","fontSize","fontStyle","fontWeight","fontVariant","lineHeight","whiteSpace"],download:function(path){var tempDLIFrame=document.createElement("iframe");var frameId="DownloadFrame_"+this._downloadFrames;SC.$(tempDLIFrame).attr("id",frameId);tempDLIFrame.style.border="10px";tempDLIFrame.style.width="0px";tempDLIFrame.style.height="0px";tempDLIFrame.style.position="absolute";tempDLIFrame.style.top="-10000px";tempDLIFrame.style.left="-10000px";if(!SC.browser.isSafari){SC.$(tempDLIFrame).attr("src",path)}document.getElementsByTagName("body")[0].appendChild(tempDLIFrame);if(SC.browser.isSafari){SC.$(tempDLIFrame).attr("src",path)}this._downloadFrames=this._downloadFrames+1;if(!SC.browser.isSafari){var r=function(){document.body.removeChild(document.getElementById(frameId));frameId=null};var t=r.invokeLater(null,2000)}tempDLIFrame=null},normalizeURL:function(url){if(url.slice(0,1)=="/"){url=window.location.protocol+"//"+window.location.host+url}else{if((url.slice(0,5)=="http:")||(url.slice(0,6)=="https:")){}else{url=window.location.href+"/"+url}}return url},isPercentage:function(val){return(val<1&&val>0)},minX:function(frame){return frame.x||0},maxX:function(frame){return(frame.x||0)+(frame.width||0)},midX:function(frame){return(frame.x||0)+((frame.width||0)/2)},minY:function(frame){return frame.y||0},maxY:function(frame){return(frame.y||0)+(frame.height||0)},midY:function(frame){return(frame.y||0)+((frame.height||0)/2)},centerX:function(innerFrame,outerFrame){return(outerFrame.width-innerFrame.width)/2},centerY:function(innerFrame,outerFrame){return(outerFrame.height-innerFrame.height)/2},pointInRect:function(point,f){return(point.x>=SC.minX(f))&&(point.y>=SC.minY(f))&&(point.x<=SC.maxX(f))&&(point.y<=SC.maxY(f))},rectsEqual:function(r1,r2,delta){if(!r1||!r2){return(r1==r2)}if(!delta&&delta!==0){delta=0.1}if((r1.y!=r2.y)&&(Math.abs(r1.y-r2.y)>delta)){return NO}if((r1.x!=r2.x)&&(Math.abs(r1.x-r2.x)>delta)){return NO}if((r1.width!=r2.width)&&(Math.abs(r1.width-r2.width)>delta)){return NO}if((r1.height!=r2.height)&&(Math.abs(r1.height-r2.height)>delta)){return NO}return YES},intersectRects:function(r1,r2){var ret={x:Math.max(SC.minX(r1),SC.minX(r2)),y:Math.max(SC.minY(r1),SC.minY(r2)),width:Math.min(SC.maxX(r1),SC.maxX(r2)),height:Math.min(SC.maxY(r1),SC.maxY(r2))};ret.width=Math.max(0,ret.width-ret.x);ret.height=Math.max(0,ret.height-ret.y);return ret},unionRects:function(r1,r2){var ret={x:Math.min(SC.minX(r1),SC.minX(r2)),y:Math.min(SC.minY(r1),SC.minY(r2)),width:Math.max(SC.maxX(r1),SC.maxX(r2)),height:Math.max(SC.maxY(r1),SC.maxY(r2))};ret.width=Math.max(0,ret.width-ret.x);ret.height=Math.max(0,ret.height-ret.y);return ret},cloneRect:function(r){return{x:r.x,y:r.y,width:r.width,height:r.height}},stringFromRect:function(r){return"{x:"+r.x+", y:"+r.y+", width:"+r.width+", height:"+r.height+"}"},stringFromLayout:function(layout){var keys=["maxHeight","maxWidth","minHeight","minWidth","centerY","centerX","width","height","bottom","right","top","left"];var keyValues=[];var i=keys.length;while(--i>=0){var key=keys[i];if(layout.hasOwnProperty(key)){keyValues.push(key+":"+layout[key])}}return"{"+keyValues.join(", ")+"}"},heightForString:function(str,width,style,classNames){var elem=this._heightCalcElement,classes,height;classes=(classNames&&SC.typeOf(classNames)===SC.T_ARRAY)?classNames.join(" "):"";if(!width){width=100}if(!elem){elem=this._heightCalcElement=document.createElement("div");document.body.insertBefore(elem,null)}style=style+"; width: "+width+"px; left: "+(-1*width)+"px; position: absolute";SC.$(elem).attr("style",style);if(classes!==""){SC.$(elem).attr("class",classes)}elem.innerHTML=str;height=elem.clientHeight;elem=null;return height},prepareStringMeasurement:function(exampleElement,classNames){var element=this._metricsCalculationElement,classes,styles,style;classes=SC.A(classNames).join(" ");if(!element){element=this._metricsCalculationElement=document.createElement("div");document.body.insertBefore(element,null)}if(SC.typeOf(exampleElement)!=SC.T_STRING){var computed=null;if(document.defaultView&&document.defaultView.getComputedStyle){computed=document.defaultView.getComputedStyle(exampleElement,null)}else{computed=exampleElement.currentStyle}style=computed.cssText;if(!style||style.trim()===""){var props=this._copy_computed_props;for(var i=0;i<props.length;i++){var prop=props[i],val=computed[prop];element.style[prop]=val}var cs=element.style;if(cs.font===""){var font="";if(cs.fontStyle){font+=cs.fontStyle+" "}if(cs.fontVariant){font+=cs.fontVariant+" "}if(cs.fontWeight){font+=cs.fontWeight+" "}if(cs.fontSize){font+=cs.fontSize}else{font+="10px"}if(cs.lineHeight){font+="/"+cs.lineHeight}font+=" ";if(cs.fontFamily){font+=cs.fontFamily}else{cs+="sans-serif"}element.style.font=font}SC.mixin(element.style,{left:"0px",top:"0px",position:"absolute",bottom:"auto",right:"auto",width:"auto",height:"auto"})}else{element.setAttribute("style",style+"; position:absolute; left: 0px; top: 0px; bottom: auto; right: auto; width: auto; height: auto;")}computed=null}else{style=exampleElement;element.setAttribute("style",style+"; position:absolute; left: 0px; top: 0px; bottom: auto; right: auto; width: auto; height: auto;")}element.className=classes;element=null},teardownStringMeasurement:function(){var element=this._metricsCalculationElement;element.innerHTML="";element.className="";element.setAttribute("style","");element=null},measureString:function(string){var element=this._metricsCalculationElement;if(!element){throw"measureString requires a string measurement environment to be set up. Did you mean metricsForString?"}if(typeof element.innerText!="undefined"){element.innerText=string}else{element.textContent=string}var result={width:element.clientWidth,height:element.clientHeight};element=null;return result},metricsForString:function(string,exampleElement,classNames){SC.prepareStringMeasurement(exampleElement,classNames);var result=SC.measureString(string);SC.teardownStringMeasurement();return result},viewportOffset:function(el){if(el.getBoundingClientRect){var boundingRect=el.getBoundingClientRect();return{x:boundingRect.left,y:boundingRect.top}}var valueL=0;var valueT=0;var element=el;var isFirefox3=SC.browser.mozilla>=3;while(element){valueT+=(element.offsetTop||0);if(!isFirefox3||(element!==el)){valueT+=(element.clientTop||0)}valueL+=(element.offsetLeft||0);if(!isFirefox3||(element!==el)){valueL+=(element.clientLeft||0)}if(SC.browser.mozilla){var overflow=SC.$(element).attr("overflow");if(overflow!=="visible"){var left=parseInt(SC.$(element).attr("borderLeftWidth"),0)||0;var top=parseInt(SC.$(element).attr("borderTopWidth"),0)||0;if(el!==element){left*=2;top*=2}valueL+=left;valueT+=top}var offsetParent=element.offsetParent;if(SC.browser.mozilla.match(/1[.]9/)&&offsetParent){valueT-=offsetParent.clientTop;valueL-=offsetParent.clientLeft}}if(element.offsetParent==document.body&&SC.$(element).attr("position")=="absolute"){break}element=element.offsetParent}element=el;while(element){if(!SC.browser.isOpera||element.tagName=="BODY"){valueT-=element.scrollTop||0;valueL-=element.scrollLeft||0}element=element.parentNode}return{x:valueL,y:valueT}},ZERO_POINT:{x:0,y:0},ZERO_RANGE:{start:0,length:0},RANGE_NOT_FOUND:{start:0,length:-1},valueInRange:function(value,range){return(value>=0)&&(value>=range.start)&&(value<(range.start+range.length))},minRange:function(range){return range.start},maxRange:function(range){return(range.length<0)?-1:(range.start+range.length)},unionRanges:function(r1,r2){if((r1==null)||(r1.length<0)){return r2}if((r2==null)||(r2.length<0)){return r1}var min=Math.min(r1.start,r2.start);var max=Math.max(SC.maxRange(r1),SC.maxRange(r2));return{start:min,length:max-min}},intersectRanges:function(r1,r2){if((r1==null)||(r2==null)){return SC.RANGE_NOT_FOUND}if((r1.length<0)||(r2.length<0)){return SC.RANGE_NOT_FOUND}var min=Math.max(SC.minRange(r1),SC.minRange(r2));var max=Math.min(SC.maxRange(r1),SC.maxRange(r2));if(max<min){return SC.RANGE_NOT_FOUND}return{start:min,length:max-min}},subtractRanges:function(r1,r2){if((r1==null)||(r2==null)){return SC.RANGE_NOT_FOUND}if((r1.length<0)||(r2.length<0)){return SC.RANGE_NOT_FOUND}var max=Math.max(SC.minRange(r1),SC.minRange(r2));var min=Math.min(SC.maxRange(r1),SC.maxRange(r2));if(max<min){return SC.RANGE_NOT_FOUND}return{start:min,length:max-min}},cloneRange:function(r){return{start:r.start,length:r.length}},rangesEqual:function(r1,r2){if(r1===r2){return true}if(r1==null){return r2.length<0}if(r2==null){return r1.length<0}return(r1.start==r2.start)&&(r1.length==r2.length)},convertHsvToHex:function(h,s,v){var r=0;var g=0;var b=0;if(v>0){var i=(h==1)?0:Math.floor(h*6);var f=(h==1)?0:(h*6)-i;var p=v*(1-s);var q=v*(1-(s*f));var t=v*(1-(s*(1-f)));var rgb=[[v,t,p],[q,v,p],[p,v,t],[p,q,v],[t,p,v],[v,p,q]];r=Math.round(255*rgb[i][0]);g=Math.round(255*rgb[i][1]);b=Math.round(255*rgb[i][2])}return this.parseColor("rgb("+r+","+g+","+b+")")},convertHexToHsv:function(hex){var rgb=this.expandColor(hex);var max=Math.max(Math.max(rgb[0],rgb[1]),rgb[2]);var min=Math.min(Math.min(rgb[0],rgb[1]),rgb[2]);var h=(max==min)?0:((max==rgb[0])?((rgb[1]-rgb[2])/(max-min)/6):((max==rgb[1])?((rgb[2]-rgb[0])/(max-min)/6+1/3):((rgb[0]-rgb[1])/(max-min)/6+2/3)));h=(h<0)?(h+1):((h>1)?(h-1):h);var s=(max==0)?0:(1-min/max);var v=max/255;return[h,s,v]},PARSE_COLOR_RGBRE:/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,PARSE_COLOR_HEXRE:/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,expandColor:function(color){var hexColor,red,green,blue;hexColor=this.parseColor(color);if(hexColor){red=parseInt(hexColor.slice(1,3),16);green=parseInt(hexColor.slice(3,5),16);blue=parseInt(hexColor.slice(5,7),16);return[red,green,blue]}},parseColor:function(string){var i=0,color="#",match;if(match=this.PARSE_COLOR_RGBRE.exec(string)){var part;for(i=1;i<=3;i++){part=Math.max(0,Math.min(255,parseInt(match[i],0)));color+=this.toColorPart(part)}return color}if(match=this.PARSE_COLOR_HEXRE.exec(string)){if(match[1].length==3){for(i=0;i<3;i++){color+=match[1].charAt(i)+match[1].charAt(i)}return color}return"#"+match[1]}return false},toColorPart:function(number){if(number>255){number=255}var digits=number.toString(16);if(number<16){return"0"+digits}return digits},getStyle:function(oElm,strCssRule){var strValue="";if(document.defaultView&&document.defaultView.getComputedStyle){strValue=document.defaultView.getComputedStyle(oElm,"").getPropertyValue(strCssRule)}else{if(oElm.currentStyle){strCssRule=strCssRule.replace(/\-(\w)/g,function(strMatch,p1){return p1.toUpperCase()});strValue=oElm.currentStyle[strCssRule]}}return strValue}});SC.VALIDATE_OK=YES;SC.VALIDATE_NO_CHANGE=NO;SC.Validator=SC.Object.extend({fieldValueForObject:function(object,form,view){return object},objectForFieldValue:function(value,form,view){return value},validate:function(form,field){return true},validateError:function(form,field){return SC.$error("Invalid.General(%@)".loc(field.get("fieldValue")),field.get("fieldKey"))},validateChange:function(form,field,oldValue){return this.validate(form,field)?SC.VALIDATE_OK:this.validateError(form,field)},validateSubmit:function(form,field){return this.validate(form,field)?SC.VALIDATE_OK:this.validateError(form,field)},validatePartial:function(form,field){if(!field.get("isValid")){return this.validate(form,field)?SC.VALIDATE_OK:this.validateError(form,field)}else{return SC.VALIDATE_NO_CHANGE}},validateKeyDown:function(form,field,charStr){return true},attachTo:function(form,field){},detachFrom:function(form,field){}});SC.Validator.mixin({OK:true,NO_CHANGE:false,findFor:function(form,field,validatorKey){var validator;if(!validatorKey){return}if(validatorKey instanceof SC.Validator){validator=validatorKey}else{if(validatorKey.isClass){validator=validatorKey.create()}else{if(SC.typeOf(validatorKey)===SC.T_STRING){var name=null;var m=validatorKey.match(/^(.+)\[(.*)\]/);if(m){validatorKey=m[1];name=m[2]}validatorKey=validatorKey.classify();var validatorClass=SC.Validator[validatorKey];if(SC.none(validatorClass)){throw"validator %@ not found for %@".fmt(validatorKey,field)}else{if(name){if(!form){throw"named validator (%@) could not be found for field %@ because the field does not belong to a form".fmt(name,field)}if(!form._validatorHash){form._validatorHash={}}validator=(name)?form._validatorHash[name]:null;if(!validator){validator=validatorClass.create()}if(name){form._validatorHash[name]=validator}}else{validator=validatorClass.create()}}}}}return validator},fieldValueForObject:function(object,form,field){if(this.prototype&&this.prototype.fieldValueForObject){return this.prototype.fieldValueForObject(object,form,field)}else{return null}},objectForFieldValue:function(value,form,field){if(this.prototype&&this.prototype.objectForFieldValue){return this.prototype.objectForFieldValue(value,form,field)}else{return null}}});sc_require("validators/validator");SC.Validator.CreditCard=SC.Validator.extend({fieldValueForObject:function(object,form,field){if(typeof(object)=="string"&&object.length==16){object=[object.slice(0,4),object.slice(4,8),object.slice(8,12),object.slice(12,16)].join(" ")}return object},objectForFieldValue:function(value,form,field){return value.replace(/[\s-\.\:]/g,"")},validate:function(form,field){return this.checkNumber(field.get("fieldValue"))},validateError:function(form,field){var label=field.get("errorLabel")||"Field";return SC.$error("Invalid.CreditCard(%@)".loc(label),label)},validateKeyDown:function(form,field,charStr){return !!charStr.match(/[0-9\- ]/)},checkNumber:function(ccNumb){if(!ccNumb||ccNumb.length===0){return YES}ccNumb=ccNumb.replace(/[^0-9]/g,"");var valid="0123456789";var len=ccNumb.length;var iCCN=parseInt(ccNumb,0);var sCCN=ccNumb.toString();sCCN=sCCN.replace(/^\s+|\s+$/g,"");var iTotal=0;var bNum=true;var bResult=false;var temp;var calc;for(var j=0;j<len;j++){temp=""+sCCN.substring(j,j+1);if(valid.indexOf(temp)=="-1"){bNum=false}}if(!bNum){bResult=false}if((len===0)&&(bResult)){bResult=false}else{if(len>=15){for(var i=len;i>0;i--){calc=parseInt(iCCN,0)%10;calc=parseInt(calc,0);iTotal+=calc;i--;iCCN=iCCN/10;calc=parseInt(iCCN,0)%10;calc=calc*2;switch(calc){case 10:calc=1;break;case 12:calc=3;break;case 14:calc=5;break;case 16:calc=7;break;case 18:calc=9;break;default:calc=calc}iCCN=iCCN/10;iTotal+=calc}if((iTotal%10)===0){bResult=true}else{bResult=false}}}return bResult}});sc_require("validators/validator");SC.Validator.Date=SC.Validator.extend({format:"NNN d, yyyy h:mm:ss a",fieldValueForObject:function(object,form,field){var date;if(typeof(object)==="number"){date=new Date(object)}else{if(object instanceof Date){date=object}}if(date){object=date.format(this.get("format"))}return object},objectForFieldValue:function(value,form,field){if(value){var date=Date.parseDate(value);value=(date)?date.getTime():null}return value}});sc_require("validators/validator");SC.Validator.Email=SC.Validator.extend({validate:function(form,field){return(field.get("fieldValue")||"").match(/.+@.+\...+/)},validateError:function(form,field){var label=field.get("errorLabel")||"Field";return SC.$error("Invalid.Email(%@)".loc(label),label)}});SC.Validator.EmailOrEmpty=SC.Validator.Email.extend({validate:function(form,field){var value=field.get("fieldValue");return(value&&value.length>0)?value.match(/.+@.+\...+/):true}});sc_require("validators/validator");SC.Validator.NotEmpty=SC.Validator.extend({validate:function(form,field){var value=field.get("fieldValue");var ret=!!value;if(ret&&value.length){ret=value.length>0}return ret},validateError:function(form,field){var label=field.get("errorLabel")||"Field";return SC.$error("Invalid.NotEmpty(%@)".loc(label.capitalize()),field.get("errorLabel"))}});sc_require("validators/validator");SC.Validator.Number=SC.Validator.extend({places:0,fieldValueForObject:function(object,form,field){switch(SC.typeOf(object)){case SC.T_NUMBER:object=object.toFixed(this.get("places"));break;case SC.T_NULL:case SC.T_UNDEFINED:object="";break}return object},objectForFieldValue:function(value,form,field){value=value.replace(/,/g,"");switch(SC.typeOf(value)){case SC.T_STRING:if(value.length===0){value=null}else{if(this.get("places")>0){value=parseFloat(value)}else{if(value.length==1&&value.match(/-/)){value=null}else{value=parseInt(value,0)}}}break;case SC.T_NULL:case SC.T_UNDEFINED:value=null;break}return value},validate:function(form,field){var value=field.get("fieldValue");return(value==="")||!(isNaN(value)||isNaN(parseFloat(value)))},validateError:function(form,field){var label=field.get("errorLabel")||"Field";return SC.$error("Invalid.Number(%@)".loc(label),label)},validateKeyDown:function(form,field,charStr){var text=field.$input().val();if(!text){text=""}text+=charStr;if(this.get("places")===0){if(charStr.length===0){return true}else{return text.match(/^[\-{0,1}]?[0-9,\0]*/)[0]===text}}else{if(charStr.length===0){return true}else{return text.match(/^[\-{0,1}]?[0-9,\0]*\.?[0-9\0]+/)===text}}}});sc_require("validators/validator");SC.Validator.Password=SC.Validator.extend({attachTo:function(form,field){arguments.callee.base.apply(this,arguments);if(!this.fields){this.fields=[]}this.fields.push(field)},validate:function(force){if(!this.fields||this.fields.length===0){return true}var empty=false;var notEmpty=false;var ret=true;var value=this.fields[0].get("fieldValue");this.fields.forEach(function(field){var curValue=field.get("fieldValue");if(curValue!=value){ret=false}if(!curValue||curValue.length===0){empty=true}if(curValue&&curValue.length>0){notEmpty=true}});if(force){return(notEmpty===false)?false:ret}else{return(empty===true)?true:ret}},updateFields:function(form,valid){if(!this.fields||this.fields.length===0){return true}var err="Invalid.Password".loc();var topField=this._field;this.fields.forEach(function(f){var msg=(valid)?null:((f==topField)?err:"");form.setErrorFor(f,msg)});return(valid)?SC.VALIDATE_OK:err},validateChange:function(form,field,oldValue){return this.updateFields(form,this.validate(false))},validateSubmit:function(form,field){return this.updateFields(form,this.validate(true))},validatePartial:function(form,field){var isInvalid=!this._field.get("isValid");if(isInvalid){return this.updateFields(form,this.validate(false))}else{return SC.VALIDATE_NO_CHANGE}}});sc_require("validators/validator");SC.Validator.PositiveInteger=SC.Validator.extend({defaultValue:null,fieldValueForObject:function(object,form,field){switch(SC.typeOf(object)){case SC.T_NUMBER:object=object.toFixed(0);break;case SC.T_NULL:case SC.T_UNDEFINED:object=this.get("defaultValue");break}return object},objectForFieldValue:function(value,form,field){value=value.replace(/,/g,"");switch(SC.typeOf(value)){case SC.T_STRING:if(value.length===0){value=this.get("defaultValue")}else{value=parseInt(value,0)}break;case SC.T_NULL:case SC.T_UNDEFINED:value=this.get("defaultValue");break}return value},validate:function(form,field){var value=field.get("fieldValue");return(value==="")||!isNaN(value)},validateError:function(form,field){var label=field.get("errorLabel")||"Field";return SC.$error("Invalid.Number(%@)".loc(label),label)},validateKeyDown:function(form,field,charStr){var text=field.$input().val();if(!text){text=""}text+=charStr;if(charStr.length===0){return true}else{return text.match(/^[0-9\0]*/)[0]===text}}});sc_require("views/view");SC.ContainerView=SC.View.extend({classNames:["sc-container-view"],nowShowing:null,contentView:null,contentViewBindingDefault:SC.Binding.single(),replaceContent:function(newContent){this.removeAllChildren();if(newContent){this.appendChild(newContent)}},createChildViews:function(){var view=this.get("contentView");if(view){view=this.contentView=this.createChildView(view);this.childViews=[view]}},awake:function(){arguments.callee.base.apply(this,arguments);var nowShowing=this.get("nowShowing");if(nowShowing&&nowShowing.length>0){this.nowShowingDidChange()}},nowShowingDidChange:function(){var nowShowing=this.get("nowShowing");var content=null;if(SC.typeOf(nowShowing)===SC.T_STRING){if(nowShowing===SC.CONTENT_SET_DIRECTLY){return}if(nowShowing&&nowShowing.length>0){if(nowShowing.indexOf(".")>0){content=SC.objectForPropertyPath(nowShowing,null)}else{content=SC.objectForPropertyPath(nowShowing,this.get("page"))}}}else{content=nowShowing}if(content&&!(content instanceof SC.View)){content=null}this.set("contentView",content)}.observes("nowShowing"),contentViewDidChange:function(){this.replaceContent(this.get("contentView"))}.observes("contentView")});sc_require("views/view");sc_require("mixins/control");SC.IMAGE_STATE_NONE="none";SC.IMAGE_STATE_LOADING="loading";SC.IMAGE_STATE_LOADED="loaded";SC.IMAGE_STATE_FAILED="failed";SC.IMAGE_STATE_SPRITE="sprite";SC.BLANK_IMAGE_DATAURL="data:image/gif;base64,R0lGODlhAQABAJAAAP///wAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw==";SC.BLANK_IMAGE_URL=SC.browser.msie&&SC.browser.msie<8?"/static/sproutcore/foundation/en/a04970954a917ede9918ca06897bc0e1406986d5/blank.gif":SC.BLANK_IMAGE_DATAURL;SC.ImageView=SC.View.extend(SC.Control,{classNames:"sc-image-view",tagName:"img",status:SC.IMAGE_STATE_NONE,value:null,useImageCache:YES,canLoadInBackground:NO,localize:YES,displayProperties:"status toolTip".w(),render:function(context,firstTime){var status=this.get("status"),value=this.get("value");if(status===SC.IMAGE_STATE_NONE&&value){this._image_valueDidChange()}status=this.get("status");var src=(status===SC.IMAGE_STATE_LOADED)?value:SC.BLANK_IMAGE_URL;if(status===SC.IMAGE_STATE_SPRITE){context.addClass(value)}context.attr("src",src);var toolTip=this.get("toolTip");if(SC.typeOf(toolTip)===SC.T_STRING){if(this.get("localize")){toolTip=toolTip.loc()}context.attr("title",toolTip);context.attr("alt",toolTip)}},_image_valueDidChange:function(){var value=this.get("value"),isUrl;if(value&&value.isEnumerable){value=value.firstObject()}isUrl=SC.ImageView.valueIsUrl(value);if(isUrl&&this.get("useImageCache")){var isBackground=this.get("isVisibleInWindow")||this.get("canLoadInBackground");this._loadingUrl=value;SC.imageCache.loadImage(value,this,this.imageDidLoad,isBackground);if(this._loadingUrl){this.set("status",SC.IMAGE_STATE_LOADING)}}else{this._loadingUrl=null;this.set("status",(isUrl)?SC.IMAGE_STATE_LOADED:SC.IMAGE_STATE_SPRITE);this.displayDidChange()}}.observes("value"),imageDidLoad:function(url,imageOrError){if(url===this._loadingUrl){this._loadingUrl=null}if(this.get("value")===url){this.set("status",SC.$ok(imageOrError)?SC.IMAGE_STATE_LOADED:SC.IMAGE_STATE_FAILED);this.displayDidChange()}}});SC.ImageView.valueIsUrl=function(value){return value?value.indexOf("/")>=0:NO};sc_require("views/view");sc_require("mixins/control");SC.ALIGN_LEFT="left";SC.ALIGN_RIGHT="right";SC.ALIGN_CENTER="center";SC.REGULAR_WEIGHT="normal";SC.BOLD_WEIGHT="bold";SC.LabelView=SC.View.extend(SC.Control,{classNames:["sc-label-view"],fontWeight:SC.REGULAR_WEIGHT,escapeHTML:true,escapeHTMLBindingDefault:SC.Binding.oneWay().bool(),localize:false,localizeBindingDefault:SC.Binding.oneWay().bool(),formatter:null,value:"",hint:null,exampleInlineTextFieldView:SC.InlineTextFieldView,icon:null,textAlign:SC.ALIGN_LEFT,isInlineEditorMultiline:NO,displayValue:function(){var value,formatter;value=this.get("value");formatter=this.getDelegateProperty("formatter",this.displayDelegate);if(formatter){var formattedValue=(SC.typeOf(formatter)===SC.T_FUNCTION)?formatter(value,this):formatter.fieldValueForObject(value,this);if(!SC.none(formattedValue)){value=formattedValue}}if(SC.typeOf(value)===SC.T_ARRAY){var ary=[];for(var idx=0,idxLen=value.get("length");idx<idxLen;idx++){var x=value.objectAt(idx);if(!SC.none(x)&&x.toString){x=x.toString()}ary.push(x)}value=ary.join(",")}if(!SC.none(value)&&value.toString){value=value.toString()}if(value&&this.getDelegateProperty("localize",this.displayDelegate)){value=value.loc()}if(this.get("escapeHTML")){value=SC.RenderContext.escapeHTML(value)}return value}.property("value","localize","formatter","escapeHTML").cacheable(),hintValue:function(){var hintVal=this.get("hint");if(this.get("escapeHTML")){hintVal=SC.RenderContext.escapeHTML(hintVal)}return hintVal}.property("hint","escapeHTML").cacheable(),isEditable:NO,isEditableBindingDefault:SC.Binding.bool(),isEditing:NO,validator:null,doubleClick:function(evt){return this.beginEditing()},beginEditing:function(){if(this.get("isEditing")){return YES}if(!this.get("isEditable")){return NO}var el=this.$(),value=this.get("value")||"",f=SC.viewportOffset(el[0]),frameTemp=this.convertFrameFromView(this.get("frame"),null);f.width=frameTemp.width;f.height=frameTemp.height;SC.InlineTextFieldView.beginEditing({frame:f,delegate:this,exampleElement:el,value:value,multiline:this.get("isInlineEditorMultiline"),isCollection:NO,validator:this.get("validator"),exampleInlineTextFieldView:this.get("exampleInlineTextFieldView")})},discardEditing:function(){if(!this.get("isEditing")){return YES}return SC.InlineTextFieldView.discardEditing()},commitEditing:function(){if(!this.get("isEditing")){return YES}return SC.InlineTextFieldView.commitEditing()},inlineEditorShouldBeginEditing:function(inlineEditor){return YES},inlineEditorWillBeginEditing:function(inlineEditor){this.set("isEditing",YES)},inlineEditorDidBeginEditing:function(inlineEditor){var layer=this.$();this._oldOpacity=layer.css("opacity");layer.css("opacity",0)},inlineEditorShouldEndEditing:function(inlineEditor,finalValue){return YES},inlineEditorDidEndEditing:function(inlineEditor,finalValue){this.setIfChanged("value",finalValue);this.$().css("opacity",this._oldOpacity);this._oldOpacity=null;this.set("isEditing",NO)},displayProperties:"displayValue textAlign fontWeight icon".w(),_TEMPORARY_CLASS_HASH:{},render:function(context,firstTime){var value=this.get("displayValue"),icon=this.get("icon"),hint=this.get("hintValue"),classes,stylesHash,text,iconChanged=false,textChanged=false;if(icon){var url=(icon.indexOf("/")>=0)?icon:SC.BLANK_IMAGE_URL,className=(url===icon)?"":icon;icon='<img src="'+url+'" alt="" class="icon '+className+'" />';if(icon!==this._iconCache){this._iconCache=icon;iconChanged=true}}if(hint&&(!value||value==="")){text='<span class="sc-hint">'+hint+"</span>"}else{text=value}if(text!==this._textCache){this._textCache=text;textChanged=true}if(firstTime||textChanged||iconChanged){context.push(icon,text)}stylesHash={"text-align":this.get("textAlign"),"font-weight":this.get("fontWeight")};if(this.get("isEditing")){stylesHash.opacity=0}context.addStyle(stylesHash);classes=this._TEMPORARY_CLASS_HASH;classes.icon=!!this.get("icon");context.setClass(classes)}});sc_require("panes/pane");SC.MainPane=SC.Pane.extend({layout:{left:0,right:0,top:0,bottom:0},paneDidAttach:function(){var ret=arguments.callee.base.apply(this,arguments);var responder=this.rootResponder;responder.makeMainPane(this);if(!responder.get("keyRootView")){responder.makeKeyPane(this)}return ret},acceptsKeyPane:YES,classNames:["sc-main"]});tiki.script("sproutcore/foundation:en/a04970954a917ede9918ca06897bc0e1406986d5/javascript.js");tiki.register("sproutcore/desktop",{packages:{"sproutcore/runtime":{scripts:[{url:"/static/sproutcore/runtime/en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js",id:"sproutcore/runtime:en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js"}]},"sproutcore/datastore":{scripts:[{url:"/static/sproutcore/datastore/en/eb43c56c9a551db9bba1cd04f29ca1dfb2e47e4c/javascript.js",id:"sproutcore/datastore:en/eb43c56c9a551db9bba1cd04f29ca1dfb2e47e4c/javascript.js"}]},"sproutcore/foundation":{stylesheets:[{url:"/static/sproutcore/foundation/en/a04970954a917ede9918ca06897bc0e1406986d5/stylesheet.css",id:"sproutcore/foundation:en/a04970954a917ede9918ca06897bc0e1406986d5/stylesheet.css"}],scripts:[{url:"/static/sproutcore/foundation/en/a04970954a917ede9918ca06897bc0e1406986d5/javascript.js",id:"sproutcore/foundation:en/a04970954a917ede9918ca06897bc0e1406986d5/javascript.js"}]}},stylesheets:[{url:"/static/sproutcore/desktop/en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/stylesheet.css",id:"sproutcore/desktop:en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/stylesheet.css"}],depends:["sproutcore/runtime","sproutcore/datastore","sproutcore/foundation"],scripts:[{url:"/static/sproutcore/desktop/en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/javascript.js",id:"sproutcore/desktop:en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/javascript.js"}]});tiki.global("sproutcore/desktop");SC.stringsFor("English",{"Invalid.CreditCard(%@)":"%@ is not a valid credit card number","Invalid.Email(%@)":"%@ is not a valid email address","Invalid.NotEmpty(%@)":"%@ must not be empty","Invalid.Password":"Your passwords do not match.  Please try typing them again.","Invalid.General(%@)":"%@ is invalid.  Please try again.","Invalid.Number(%@)":"%@ is not a number."});SC.allowsBackspaceToPreviousPage=NO;SC.BORDER_BEZEL="sc-bezel-border";SC.BORDER_BLACK="sc-black-border";SC.BORDER_GRAY="sc-gray-border";SC.BORDER_TOP="sc-top-border";SC.BORDER_BOTTOM="sc-bottom-border";SC.BORDER_NONE=null;SC.Border={borderTop:0,borderRight:0,borderBottom:0,borderLeft:0,borderStyle:SC.BORDER_GRAY,hasBorder:YES,displayProperties:["borderStyle"],_BORDER_REGEXP:(/-border$/),initMixin:function(){this._sc_border_borderStyleDidChange()},renderMixin:function(context,firstTime){var style=this.get("borderStyle");if(style){if(this._BORDER_REGEXP.exec(style)){context.addClass(style)}else{context.addStyle("border","1px "+style+" solid")}}},_sc_border_borderStyleDidChange:function(){var borderStyle=this.get("borderStyle"),borderSize=SC.Border.dimensions[borderStyle];if(borderSize){this.borderTop=borderSize;this.borderRight=borderSize;this.borderBottom=borderSize;this.borderLeft=borderSize}}};SC.mixin(SC.Border,{dimensions:{"sc-bezel-border":1,"sc-black-border":1,"sc-gray-border":1,"sc-top-border":1,"sc-bottom-border":1}});SC.CollectionGroup={classNames:["sc-collection-group"]};SC.CollectionRowDelegate={isCollectionRowDelegate:YES,rowHeight:18,customRowHeightIndexes:null,contentIndexRowHeight:function(view,content,contentIndex){return this.get("rowHeight")}};SC.CollectionViewDelegate={isCollectionViewDelegate:YES,collectionViewSelectionForProposedSelection:function(view,sel){return sel},collectionViewShouldSelectIndexes:function(view,indexes,extend){return indexes},collectionViewShouldDeselectIndexes:function(view,indexes){return indexes},collectionViewShouldDeleteIndexes:function(view,indexes){return indexes},collectionViewDeleteContent:function(view,content,indexes){if(!content){return NO}if(SC.typeOf(content.destroyAt)===SC.T_FUNCTION){content.destroyAt(indexes);view.selectPreviousItem(NO,1);return YES}else{if(SC.typeOf(content.removeAt)===SC.T_FUNCTION){content.removeAt(indexes);view.selectPreviousItem(NO,1);return YES}else{return NO}}},collectionViewShouldBeginDrag:function(view){return YES},collectionViewDragDataTypes:function(view){return[]},collectionViewDragDataForType:function(view,drag,dataType){return null},collectionViewComputeDragOperations:function(view,drag,proposedDragOperations){return proposedDragOperations},collectionViewValidateDragOperation:function(view,drag,op,proposedInsertionIndex,proposedDropOperation){return(proposedDropOperation&SC.DROP_ON)?SC.DRAG_NONE:op},collectionViewPerformDragOperation:function(view,drag,op,proposedInsertionIndex,proposedDropOperation){return SC.DRAG_NONE},collectionViewDragViewFor:function(view,dragContent){return null},ghostActsLikeCursor:NO};SC.Scrollable={isScrollable:true,verticalLineScroll:20,horizontalLineScroll:20,verticalPageScroll:function(){return this.get("innerFrame").height}.property("innerFrame"),horizontalPageScroll:function(){return this.get("innerFrame").width}.property("innerFrame"),hasVerticalScroller:function(){return this.get("scrollFrame").height>this.get("innerFrame").height}.property("scrollFrame"),hasHorizontalScroller:function(){return this.get("scrollFrame").width>this.get("innerFrame").width}.property("scrollFrame"),scrollBy:function(amount){var sf=this.get("scrollFrame");var f=this.get("innerFrame");if(!this.get("hasVerticalScroller")){amount.y=0}if(sf.height<=f.height){amount.y=0}if(!this.get("hasHorizontalScroller")){amount.x=0}if(sf.width<=f.width){amount.x=0}var newSf={x:sf.x-(amount.x||0),y:sf.y-(amount.y||0)};this.set("scrollFrame",newSf);newSf=this.get("scrollFrame");return{x:newSf.x-sf.x,y:newSf.y-sf.y}},scrollTo:function(x,y){this.set("scrollFrame",{x:0-x,y:0-y})},scrollToVisible:function(view){var f=this.get("innerFrame");var sf=this.get("scrollFrame");var vf=this.convertFrameFromView(view.get("frame"),view);vf.x-=(f.x+sf.x);vf.y-=(f.y+sf.y);var vo={x:0-sf.x,y:0-sf.y,width:f.width,height:f.height};vo.y-=Math.max(0,SC.minY(vo)-SC.minY(vf));vo.x-=Math.max(0,SC.minX(vo)-SC.minX(vf));vo.y+=Math.max(0,SC.maxY(vf)-SC.maxY(vo));vo.x+=Math.max(0,SC.maxX(vf)-SC.maxX(vo));this.scrollTo(vo.x,vo.y)},scrollDownLine:function(lines){if(lines===undefined){lines=1}return this.scrollBy({y:this.get("verticalLineScroll")*lines}).y},scrollUpLine:function(lines){if(lines===undefined){lines=1}return 0-this.scrollBy({y:0-this.get("verticalLineScroll")*lines}).y},scrollRightLine:function(lines){if(lines===undefined){lines=1}return this.scrollTo({y:this.get("horizontalLineScroll")*lines}).x},scrollLeftLine:function(lines){if(lines===undefined){lines=1}return 0-this.scrollTo({y:0-this.get("horizontalLineScroll")*lines}).x},scrollDownPage:function(pages){if(pages===undefined){pages=1}return this.scrollBy({y:this.get("verticalPageScroll")*pages}).y},scrollUpPage:function(pages){if(pages===undefined){pages=1}return 0-this.scrollBy({y:0-this.get("verticalPageScroll")*pages}).y},scrollRightPage:function(pages){if(pages===undefined){pages=1}return this.scrollTo({y:this.get("horizontalPageScroll")*pages}).x},scrollLeftPage:function(pages){if(pages===undefined){pages=1}return 0-this.scrollTo({y:0-this.get("horizontalPageScroll")*pages}).x}};SC.ModalPane=SC.Pane.extend({classNames:"sc-modal",layout:{top:0,left:0,bottom:0,right:0},_openPaneCount:0,paneWillAppend:function(pane){this._openPaneCount++;if(!this.get("isVisibleInWindow")){this.append()}return this},paneDidRemove:function(pane){this._openPaneCount--;if(this._openPaneCount<=0){this._openPaneCount=0;if(this.get("isVisibleInWindow")){this.remove()}}},mouseDown:function(evt){var owner=this.get("owner");if(owner&&owner.modalPaneDidClick){owner.modalPaneDidClick(evt)}},touchStart:function(evt){this.mouseDown(evt)}});sc_require("panes/modal");SC.PanelPane=SC.Pane.extend({layout:{left:0,right:0,top:0,bottom:0},classNames:["sc-panel"],acceptsKeyPane:YES,isModal:YES,modalPane:SC.ModalPane.extend({classNames:"for-sc-panel"}),contentView:null,contentViewBindingDefault:SC.Binding.single(),render:function(context,firstTime){if(context.needsContent){this.renderChildViews(context,firstTime);context.push("<div class='top-left-edge'></div>","<div class='top-edge'></div>","<div class='top-right-edge'></div>","<div class='right-edge'></div>","<div class='bottom-right-edge'></div>","<div class='bottom-edge'></div>","<div class='bottom-left-edge'></div>","<div class='left-edge'></div>")}},replaceContent:function(newContent){this.removeAllChildren();if(newContent){this.appendChild(newContent)}},createChildViews:function(){var view=this.contentView;if(view){view=this.contentView=this.createChildView(view);this.childViews=[view]}},contentViewDidChange:function(){this.replaceContent(this.get("contentView"))}.observes("contentView"),_modalPane:function(){var pane=this.get("modalPane");if(pane&&pane.isClass){pane=pane.create({owner:this});this.set("modalPane",pane)}return pane},appendTo:function(elem){var pane;if(!this.get("isVisibleInWindow")&&this.get("isModal")&&(pane=this._modalPane())){this._isShowingModal=YES;pane.paneWillAppend(this)}return arguments.callee.base.apply(this,arguments)},remove:function(){var pane,ret=arguments.callee.base.apply(this,arguments);if(this._isShowingModal){this._isShowingModal=NO;if(pane=this._modalPane()){pane.paneDidRemove(this)}}return ret},_isModalDidChange:function(){var pane,isModal=this.get("isModal");if(isModal){if(!this._isShowingModal&&this.get("isVisibleInWindow")&&(pane=this._modalPane())){this._isShowingModal=YES;pane.paneWillAppend(this)}}else{if(this._isShowingModal&&(pane=this._modalPane())){this._isShowingModal=NO;pane.paneDidRemove(this)}}}.observes("isModal"),paneDidAttach:function(){var ret=arguments.callee.base.apply(this,arguments);this.becomeKeyPane();return ret}});SC.TOGGLE_BEHAVIOR="toggle";SC.PUSH_BEHAVIOR="push";SC.TOGGLE_ON_BEHAVIOR="on";SC.TOGGLE_OFF_BEHAVIOR="off";SC.HOLD_BEHAVIOR="hold";SC.REGULAR_BUTTON_HEIGHT=24;SC.ButtonView=SC.View.extend(SC.Control,SC.Button,SC.StaticLayout,{tagName:"div",classNames:["sc-button-view"],theme:"square",buttonBehavior:SC.PUSH_BEHAVIOR,holdInterval:100,isDefault:NO,isDefaultBindingDefault:SC.Binding.oneWay().bool(),isCancel:NO,isCancelBindingDefault:SC.Binding.oneWay().bool(),href:"",action:null,target:null,supportFocusRing:NO,triggerAction:function(evt){if(!this.get("isEnabled")){return NO}this.set("isActive",YES);this._action(evt,YES);this.didTriggerAction();this.invokeLater("set",200,"isActive",NO);return true},didTriggerAction:function(){},titleMinWidth:80,init:function(){arguments.callee.base.apply(this,arguments);if(this.get("keyEquivalent")){this._defaultKeyEquivalent=this.get("keyEquivalent")}},_TEMPORARY_CLASS_HASH:{},displayProperties:["href","icon","title","value","toolTip"],renderStyle:"renderDefault",render:function(context,firstTime){var href,toolTip,classes,theme;if(this.get("tagName")==="a"){href=this.get("href");if(!href||(href.length===0)){href="javascript:;"}context.attr("href",href)}else{context.attr("role","button")}toolTip=this.get("toolTip");if(SC.typeOf(toolTip)===SC.T_STRING){if(this.get("localize")){toolTip=toolTip.loc()}context.attr("title",toolTip);context.attr("alt",toolTip)}classes=this._TEMPORARY_CLASS_HASH;classes.def=this.get("isDefault");classes.cancel=this.get("isCancel");classes.icon=!!this.get("icon");context.attr("role","button").setClass(classes);theme=this.get("theme");if(theme){context.addClass(theme)}this[this.get("renderStyle")](context,firstTime)},renderDefault:function(context,firstTime){if(firstTime){context=context.push("<span class='sc-button-inner' style = 'min-width:",this.get("titleMinWidth"),"px'>");this.renderTitle(context,firstTime);context.push("</span>");if(this.get("supportFocusRing")){context.push('<div class="focus-ring">','<div class="focus-left"></div>','<div class="focus-middle"></div>','<div class="focus-right"></div></div>')}}else{this.renderTitle(context,firstTime)}},renderImage:function(context,firstTime){var icon=this.get("icon");if(icon){context.push("<div class='img "+icon+"'></div>")}else{context.push("<div class='img'></div>")}},_defaultKeyEquivalent:null,_isDefaultOrCancelDidChange:function(){var isDef=!!this.get("isDefault"),isCancel=!isDef&&this.get("isCancel");if(this.didChangeFor("defaultCancelChanged","isDefault","isCancel")){this.displayDidChange();if(isDef){this.set("keyEquivalent","return")}else{if(isCancel){this.setIfChanged("keyEquivalent","escape")}else{this.set("keyEquivalent",this._defaultKeyEquivalent)}}}}.observes("isDefault","isCancel"),isMouseDown:false,mouseDown:function(evt){var buttonBehavior=this.get("buttonBehavior");if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;if(buttonBehavior===SC.HOLD_BEHAVIOR){this._action(evt)}else{if(!this._isFocused&&(buttonBehavior!==SC.PUSH_BEHAVIOR)){this._isFocused=YES;this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$()[0].focus()}}}return YES},mouseExited:function(evt){if(this._isMouseDown){this.set("isActive",NO)}return YES},mouseEntered:function(evt){this.set("isActive",this._isMouseDown);return YES},mouseUp:function(evt){if(this._isMouseDown){this.set("isActive",NO)}this._isMouseDown=false;if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){var inside=this.$().within(evt.target);if(inside&&this.get("isEnabled")){this._action(evt)}}return YES},keyDown:function(evt){if(evt.which===9){var view=evt.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(view){view.becomeFirstResponder()}else{evt.allowDefault()}return YES}if(evt.which===13){this.triggerAction(evt);return YES}return YES},_action:function(evt,skipHoldRepeat){switch(this.get("buttonBehavior")){case SC.TOGGLE_BEHAVIOR:var sel=this.get("isSelected");if(sel){this.set("value",this.get("toggleOffValue"))}else{this.set("value",this.get("toggleOnValue"))}break;case SC.TOGGLE_ON_BEHAVIOR:this.set("value",this.get("toggleOnValue"));break;case SC.TOGGLE_OFF_BEHAVIOR:this.set("value",this.get("toggleOffValue"));break;case SC.HOLD_BEHAVIOR:this._runHoldAction(evt,skipHoldRepeat);break;default:this._runAction(evt)}},_runAction:function(evt){var action=this.get("action"),target=this.get("target")||null;if(action){if(this._hasLegacyActionHandler()){this._triggerLegacyActionHandler(evt)}else{this.getPath("pane.rootResponder").sendAction(action,target,this,this.get("pane"))}}},_runHoldAction:function(evt,skipRepeat){if(this.get("isActive")){this._runAction();if(!skipRepeat){SC.RunLoop.begin();this.invokeLater("_runHoldAction",this.get("holdInterval"),evt);SC.RunLoop.end()}}},_hasLegacyActionHandler:function(){var action=this.get("action");if(action&&(SC.typeOf(action)===SC.T_FUNCTION)){return true}if(action&&(SC.typeOf(action)===SC.T_STRING)&&(action.indexOf(".")!=-1)){return true}return false},_triggerLegacyActionHandler:function(evt){if(!this._hasLegacyActionHandler()){return false}var action=this.get("action");if(SC.typeOf(action)===SC.T_FUNCTION){this.action(evt)}if(SC.typeOf(action)===SC.T_STRING){eval("this.action = function(e) { return "+action+"(this, e); };");this.action(evt)}},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")}else{return NO}}.property("isEnabled"),willBecomeKeyResponderFrom:function(keyView){if(!this._isFocused){this._isFocused=YES;this.becomeFirstResponder();if(this.get("isVisibleInWindow")){var elem=this.$()[0];if(elem){elem.focus()}}}},willLoseKeyResponderTo:function(responder){if(this._isFocused){this._isFocused=NO}},didAppendToDocument:function(){if(SC.browser.msie===7){var elem=this.$();if(elem&&elem[0]){var w=elem[0].clientWidth,padding=parseInt(elem.css("paddingRight"),0);this.$(".sc-button-label").css("minWidth",w-(padding*2)+"px")}}}});sc_require("panes/panel");sc_require("views/button");SC.BUTTON1_STATUS="button1";SC.BUTTON2_STATUS="button2";SC.BUTTON3_STATUS="button3";SC.AlertPane=SC.PanelPane.extend({classNames:"sc-alert",delegate:null,icon:"sc-icon-alert-48",message:"",description:"",displayDescription:function(){var desc=this.get("description");if(!desc||desc.length===0){return desc}desc=SC.RenderContext.escapeHTML(desc);return'<p class="description">'+desc.split("\n").join('</p><p class="description">')+"</p>"}.property("description").cacheable(),caption:"",displayCaption:function(){var caption=this.get("caption");if(!caption||caption.length===0){return caption}caption=SC.RenderContext.escapeHTML(caption);return'<p class="caption">'+caption.split("\n").join('</p><p class="caption">')+"</p>"}.property("caption").cacheable(),buttonOne:SC.outlet("contentView.childViews.1.childViews.1"),buttonTwo:SC.outlet("contentView.childViews.1.childViews.0"),buttonThree:SC.outlet("contentView.childViews.2.childViews.0"),buttonThreeWrapper:SC.outlet("contentView.childViews.2"),layout:{centerX:0,width:500,top:55},contentView:SC.View.extend({useStaticLayout:YES,layout:{left:0,right:0,top:0,height:"auto"},childViews:[SC.View.extend(SC.StaticLayout,{classNames:["info"],render:function(context,firstTime){var pane=this.get("pane");var blank=SC.BLANK_IMAGE_URL;if(pane.get("icon")=="blank"){context.addClass("plain")}context.push('<img src="'+blank+'" class="icon '+pane.get("icon")+'" />');context.begin("h1").text(pane.get("message")||"").end();context.push(pane.get("displayDescription")||"");context.push(pane.get("displayCaption")||"");context.push('<div class="separator"></div>')}}),SC.View.extend({layout:{bottom:13,height:24,right:18,width:466},childViews:["cancelButton","okButton"],classNames:["text-align-right"],cancelButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON2_STATUS,localize:YES,titleMinWidth:64,layout:{right:5,height:"auto",width:"auto",bottom:0},theme:"capsule",title:"Cancel",action:"dismiss",isVisible:NO}),okButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON1_STATUS,localize:YES,titleMinWidth:64,layout:{left:0,height:"auto",width:"auto",bottom:0},theme:"capsule",title:"OK",isDefault:YES,action:"dismiss"})}),SC.View.extend({layout:{bottom:13,height:24,left:18,width:150},isVisible:NO,childViews:[SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON3_STATUS,localize:YES,titleMinWidth:64,layout:{left:0,height:"auto",width:"auto",bottom:0},theme:"capsule",title:"Extra",action:"dismiss",isVisible:NO})]})]}),dismiss:function(sender){var del=this.delegate;if(del&&del.alertPaneDidDismiss){del.alertPaneDidDismiss(this,sender.get("actionKey"))}this.remove()},alertInfoDidChange:function(){var v=this.getPath("contentView.childViews.0");if(v){v.displayDidChange()}}.observes("icon","message","displayDescription","displayCaption")});SC.AlertPane._normalizeArguments=function(args){args=SC.A(args);var len=args.length,delegate=args[len-1];if(SC.typeOf(delegate)!==SC.T_STRING){args[len-1]=null}else{delegate=null}args[7]=delegate;return args};SC.AlertPane.show=function(message,description,caption,button1Title,button2Title,button3Title,iconUrl,delegate){var args=this._normalizeArguments(arguments);var ret=this.create({message:args[0]||"",description:args[1]||null,caption:args[2]||null,icon:args[6]||"sc-icon-alert-48",delegate:args[7]});var buttonKeys="buttonOne buttonTwo buttonThree".w(),button,title;for(var idx=0;idx<3;idx++){button=ret.get(buttonKeys[idx]);title=args[idx+3];if(title){button.set("title",title).set("isVisible",YES);if(title=="?"){button.set("titleMinWidth",0)}if(idx==2){var button_wrapper=ret.get("buttonThreeWrapper");button_wrapper.set("isVisible",YES)}}}var show=ret.append();ret.adjust("height",ret.childViews[0].$().height());ret.updateLayout();return show};SC.AlertPane.warn=function(message,description,caption,button1Title,button2Title,button3Title,delegate){var args=this._normalizeArguments(arguments);args[6]="sc-icon-alert-48";return this.show.apply(this,args)};SC.AlertPane.info=function(message,description,caption,button1Title,button2Title,button3Title,delegate){var args=this._normalizeArguments(arguments);args[6]="sc-icon-info-48";return this.show.apply(this,args)};SC.AlertPane.error=function(message,description,caption,button1Title,button2Title,button3Title,delegate){var args=this._normalizeArguments(arguments);args[6]="sc-icon-error-48";return this.show.apply(this,args)};SC.AlertPane.plain=function(message,description,caption,button1Title,button2Title,button3Title,delegate){var args=this._normalizeArguments(arguments);args[6]="blank";return this.show.apply(this,args)};sc_require("panes/panel");SC.PalettePane=SC.PanelPane.extend({classNames:"sc-palette",isModal:NO,modalPane:SC.ModalPane,isAnchored:NO,_mouseOffsetX:null,_mouseOffsetY:null,mouseDown:function(evt){var f=this.get("frame");this._mouseOffsetX=f?(f.x-evt.pageX):0;this._mouseOffsetY=f?(f.y-evt.pageY):0;return YES},mouseDragged:function(evt){if(!this.isAnchored){this.set("layout",{width:this.layout.width,height:this.layout.height,left:this._mouseOffsetX+evt.pageX,top:this._mouseOffsetY+evt.pageY});this.updateLayout()}return YES}});sc_require("panes/palette");SC.PICKER_MENU="menu";SC.PICKER_FIXED="fixed";SC.PICKER_POINTER="pointer";SC.POINTER_LAYOUT=["perfectRight","perfectLeft","perfectTop","perfectBottom"];SC.PickerPane=SC.PalettePane.extend({classNames:"sc-picker",isAnchored:YES,isModal:YES,pointerPos:"perfectRight",pointerPosX:0,pointerPosY:0,anchorElement:null,preferType:null,preferMatrix:null,popup:function(anchorViewOrElement,preferType,preferMatrix){var anchor=anchorViewOrElement.isView?anchorViewOrElement.get("layer"):anchorViewOrElement;this.beginPropertyChanges();this.set("anchorElement",anchor);if(preferType){this.set("preferType",preferType)}if(preferMatrix){this.set("preferMatrix",preferMatrix)}this.endPropertyChanges();this.positionPane();this.append()},positionPane:function(){var anchor=this.get("anchorElement"),preferType=this.get("preferType"),preferMatrix=this.get("preferMatrix"),layout=this.get("layout"),origin;if(anchor){anchor=this.computeAnchorRect(anchor);origin=SC.cloneRect(anchor);if(preferType){switch(preferType){case SC.PICKER_MENU:case SC.PICKER_FIXED:if(!preferMatrix||preferMatrix.length!==3){this.set("preferMatrix",[1,4,3])}origin.x+=((this.preferMatrix[2]===0)?origin.width:0)+this.preferMatrix[0];origin.y+=((this.preferMatrix[2]===3)?origin.height:0)+this.preferMatrix[1];break;default:origin.y+=origin.height;break}}else{origin.y+=origin.height}origin=this.fitPositionToScreen(origin,this.get("frame"),anchor);layout={width:origin.width,height:origin.height,left:origin.x,top:origin.y}}else{layout={width:layout.width,height:layout.height,centerX:0,centerY:0}}this.set("layout",layout).updateLayout();return this},computeAnchorRect:function(anchor){var ret=SC.viewportOffset(anchor);var cq=SC.$(anchor);var wsize=SC.RootResponder.responder.computeWindowSize();ret.width=cq.outerWidth();ret.height=(wsize.height-ret.y)<cq.outerHeight()?(wsize.height-ret.y):cq.outerHeight();return ret},fitPositionToScreen:function(preferredPosition,picker,anchor){var wsize=SC.RootResponder.responder.computeWindowSize();var wret={x:0,y:0,width:wsize.width,height:wsize.height};picker.x=preferredPosition.x;picker.y=preferredPosition.y;if(this.preferType){switch(this.preferType){case SC.PICKER_MENU:picker=this.fitPositionToScreenMenu(wret,picker,this.get("isSubMenu"));break;case SC.PICKER_POINTER:picker=this.fitPositionToScreenPointer(wret,picker,anchor);break;case SC.PICKER_FIXED:break;default:break}}else{picker=this.fitPositionToScreenDefault(wret,picker,anchor)}this.displayDidChange();return picker},fitPositionToScreenDefault:function(w,f,a){if(SC.maxX(f)>w.width){var mx=Math.max(SC.maxX(a),f.width);f.x=Math.min(mx,w.width)-f.width}if(SC.minX(f)<0){f.x=SC.minX(Math.max(a,0));if(SC.maxX(f)>w.width){f.x=Math.max(0,w.width-f.width)}}if(SC.maxY(f)>w.height){mx=Math.max((a.y-f.height),0);if(mx>w.height){f.y=Math.max(0,w.height-f.height)}else{f.y=mx}}if(SC.minY(f)<0){mx=Math.min(SC.maxY(a),(w.height-a.height));f.y=Math.max(mx,0)}return f},fitPositionToScreenMenu:function(w,f,subMenu){if((f.x+f.width)>(w.width-20)){if(subMenu){f.x=f.x-(f.width*2)}else{f.x=w.width-f.width-20}}if(f.x<7){f.x=7}if(f.height+f.y+35>=w.height){if(f.height+50>=w.height){f.y=15;f.height=w.height-50}else{f.y+=(w.height-(f.height+f.y+35))}}return f},fitPositionToScreenPointer:function(w,f,a){var overlapTunningX=(a.height>12)?0:1;var overlapTunningY=(a.height>12)?0:3;var prefP1=[[a.x+a.width+(7+overlapTunningX),a.y+parseInt(a.height/2,0)-40],[a.x-f.width-(7+overlapTunningX),a.y+parseInt(a.height/2,0)-40],[a.x+parseInt((a.width/2)-(f.width/2),0),a.y-f.height-(17+overlapTunningY)],[a.x+parseInt((a.width/2)-(f.width/2),0),a.y+a.height+(17+overlapTunningY)]];var prefP2=[[a.x+a.width+f.width+(7+overlapTunningX),a.y+parseInt(a.height/2,0)+f.height-24],[a.x-(7+overlapTunningX),a.y+parseInt(a.height/2,0)+f.height-24],[a.x+parseInt((a.width/2)-(f.width/2),0)+f.width,a.y-(17+overlapTunningY)],[a.x+parseInt((a.width/2)-(f.width/2),0)+f.width,a.y+a.height+f.height+(17+overlapTunningY)]];var cutoffPrefP=[[prefP1[0][1]>0?0:0-prefP1[0][1],prefP2[0][0]<w.width?0:prefP2[0][0]-w.width,prefP2[0][1]<w.height?0:prefP2[0][1]-w.height,prefP1[0][0]>0?0:0-prefP1[0][0]],[prefP1[1][1]>0?0:0-prefP1[1][1],prefP2[1][0]<w.width?0:prefP2[1][0]-w.width,prefP2[1][1]<w.height?0:prefP2[1][1]-w.height,prefP1[1][0]>0?0:0-prefP1[1][0]],[prefP1[2][1]>0?0:0-prefP1[2][1],prefP2[2][0]<w.width?0:prefP2[2][0]-w.width,prefP2[2][1]<w.height?0:prefP2[2][1]-w.height,prefP1[2][0]>0?0:0-prefP1[2][0]],[prefP1[3][1]>0?0:0-prefP1[3][1],prefP2[3][0]<w.width?0:prefP2[3][0]-w.width,prefP2[3][1]<w.height?0:prefP2[3][1]-w.height,prefP1[3][0]>0?0:0-prefP1[3][0]]];if(!this.preferMatrix||this.preferMatrix.length!==5){this.set("preferMatrix",[0,1,2,3,2])}var m=this.preferMatrix;if(m[4]===-1){f.x=a.x+parseInt(a.width/2,0);f.y=a.y+parseInt(a.height/2,0)-parseInt(f.height/2,0);this.set("pointerPos",SC.POINTER_LAYOUT[0]+" fallback");this.set("pointerPosY",parseInt(f.height/2,0)-40)}else{f.x=prefP1[m[4]][0];f.y=prefP1[m[4]][1];this.set("pointerPos",SC.POINTER_LAYOUT[m[4]]);this.set("pointerPosY",0)}this.set("pointerPosX",0);for(var i=0,cM,pointerLen=SC.POINTER_LAYOUT.length;i<pointerLen;i++){cM=m[i];if(cutoffPrefP[cM][0]===0&&cutoffPrefP[cM][1]===0&&cutoffPrefP[cM][2]===0&&cutoffPrefP[cM][3]===0){if(m[4]!==cM){f.x=prefP1[cM][0];f.y=prefP1[cM][1];this.set("pointerPosY",0);this.set("pointerPos",SC.POINTER_LAYOUT[cM])}i=SC.POINTER_LAYOUT.length}else{if((cM===0||cM===1)&&cutoffPrefP[cM][0]===0&&cutoffPrefP[cM][1]===0&&cutoffPrefP[cM][2]<f.height-91&&cutoffPrefP[cM][3]===0){if(m[4]!==cM){f.x=prefP1[cM][0];this.set("pointerPos",SC.POINTER_LAYOUT[cM])}f.y=prefP1[cM][1]-cutoffPrefP[cM][2];this.set("pointerPosY",cutoffPrefP[cM][2]);i=SC.POINTER_LAYOUT.length}else{if((cM===0||cM===1)&&cutoffPrefP[cM][0]===0&&cutoffPrefP[cM][1]===0&&cutoffPrefP[cM][2]<=f.height-57&&cutoffPrefP[cM][3]===0){if(m[4]!==cM){f.x=prefP1[cM][0]}f.y=prefP1[cM][1]-(f.height-57);this.set("pointerPosY",(f.height-59));this.set("pointerPos",SC.POINTER_LAYOUT[cM]+" extra-low");i=SC.POINTER_LAYOUT.length}}}}return f},displayProperties:["pointerPosY"],render:function(context,firstTime){var ret=arguments.callee.base.apply(this,arguments);if(context.needsContent){if(this.get("preferType")==SC.PICKER_POINTER){context.push('<div class="sc-pointer '+this.get("pointerPos")+'" style="margin-top: '+this.get("pointerPosY")+'px"></div>')}}else{var el=this.$(".sc-pointer");el.attr("class","sc-pointer "+this.get("pointerPos"));el.attr("style","margin-top: "+this.get("pointerPosY")+"px")}return ret},modalPaneDidClick:function(evt){var f=this.get("frame");if(!this.clickInside(f,evt)){this.remove()}return YES},mouseDown:function(evt){return this.modalPaneDidClick(evt)},clickInside:function(frame,evt){return SC.pointInRect({x:evt.pageX,y:evt.pageY},frame)},windowSizeDidChange:function(oldSize,newSize){this.positionPane()}});SC.SeparatorView=SC.View.extend({classNames:["sc-separator-view"],tagName:"span",layoutDirection:SC.LAYOUT_HORIZONTAL,render:function(context,firstTime){if(firstTime){context.push("<span></span>")}context.addClass(this.get("layoutDirection"))}});sc_require("views/button");sc_require("views/separator");SC.MenuItemView=SC.View.extend(SC.ContentDisplay,{classNames:["sc-menu-item"],acceptsFirstResponder:YES,content:null,isSubMenuViewVisible:null,hasMouseExited:NO,subMenu:function(){var content=this.get("content"),menuItems,parentMenu;if(!content){return null}parentMenu=this.get("parentMenu");menuItems=content.get(parentMenu.itemSubMenuKey);if(menuItems){if(SC.kindOf(menuItems,SC.MenuPane)){menuItems.set("isModal",NO);menuItems.set("isSubMenu",YES);menuItems.set("parentMenu",parentMenu);return menuItems}else{return SC.MenuPane.create({layout:{width:200},items:menuItems,isModal:NO,isSubMenu:YES,parentMenu:parentMenu})}}return null}.property("content").cacheable(),hasSubMenu:function(){return !!this.get("subMenu")}.property("subMenu").cacheable(),render:function(context,firstTime){var content=this.get("content");var key,val;var menu=this.get("parentMenu");var itemWidth=this.get("itemWidth")||menu.layout.width;var itemHeight=this.get("itemHeight")||SC.DEFAULT_MENU_ITEM_HEIGHT;this.set("itemWidth",itemWidth);this.set("itemHeight",itemHeight);context=context.begin("a");if(content.get(menu.itemSeparatorKey)){context.push('<span class="separator"></span>');context.addClass("disabled")}else{val=content.get(menu.itemIconKey);if(val){this.renderImage(context,val);context.addClass("has-icon")}val=this.get("title");if(SC.typeOf(val)!==SC.T_STRING){val=val.toString()}this.renderLabel(context,val);if(this.getContentProperty("itemCheckboxKey")){context.push('<div class="checkbox"></div>')}if(this.get("hasSubMenu")){this.renderBranch(context)}val=this.getContentProperty("itemShortCutKey");if(val){this.renderShortcut(context,val)}}context=context.end()},renderImage:function(context,image){var url,className;if(image&&SC.ImageView.valueIsUrl(image)){url=image;className=""}else{className=image;url=SC.BLANK_IMAGE_URL}context.begin("img").addClass("image").addClass(className).attr("src",url).end()},renderLabel:function(context,label){if(this.get("escapeHTML")){label=SC.RenderContext.escapeHTML(label)}context.push("<span class='value ellipsis'>"+label+"</span>")},renderBranch:function(context){context.push('<span class="has-branch"></span>')},renderShortcut:function(context,shortcut){context.push('<span class = "shortcut">'+shortcut+"</span>")},isSeparator:function(){return this.getContentProperty("itemSeparatorKey")===YES}.property("content").cacheable(),showSubMenu:function(){var subMenu=this.get("subMenu");if(subMenu){subMenu.popup(this,[0,0,0])}},isEnabled:function(){return this.getContentProperty("itemIsEnabledKey")!==NO&&this.getContentProperty("itemSeparatorKey")!==YES}.property("content.isEnabled").cacheable(),title:function(){var ret=this.getContentProperty("itemTitleKey"),localize=this.getPath("parentMenu.localize");if(localize&&ret){ret=ret.loc()}return ret||""}.property("content.title").cacheable(),getContentProperty:function(property){var content=this.get("content"),menu=this.get("parentMenu");if(content){return content.get(menu.get(property))}},mouseUp:function(evt){var targetMenuItem;targetMenuItem=this.getPath("parentMenu.rootMenu.targetMenuItem");if(targetMenuItem){targetMenuItem.performAction()}return YES},performAction:function(){if(!this.get("isEnabled")||this.get("hasSubMenu")){return}var disableFlash=this.getContentProperty("itemDisableMenuFlashKey");if(disableFlash){this.sendAction()}else{this._flashCounter=0;this.invokeLater(this.flashHighlight,25);this.invokeLater(this.sendAction,200)}},sendAction:function(){var action=this.getContentProperty("itemActionKey"),target=this.getContentProperty("itemTargetKey"),rootMenu=this.getPath("parentMenu.rootMenu"),responder;action=(action===undefined)?rootMenu.get("action"):action;target=(target===undefined)?rootMenu.get("target"):target;rootMenu.set("selectedItem",this.get("content"));if(SC.typeOf(action)===SC.T_FUNCTION){action.apply(target,[rootMenu]);SC.Logger.warn("Support for menu item action functions has been deprecated. Please use target and action.")}else{responder=this.getPath("pane.rootResponder")||SC.RootResponder.responder;if(responder){responder.sendAction(action,target,this,this.get("pane"))}}this.getPath("parentMenu.rootMenu").remove()},flashHighlight:function(){var flashCounter=this._flashCounter,layer=this.$();if(flashCounter%2===0){layer.addClass("focus")}else{layer.removeClass("focus")}if(flashCounter<=2){this.invokeLater(this.flashHighlight,50);this._flashCounter++}},mouseDown:function(evt){return YES},mouseEntered:function(evt){var menu=this.get("parentMenu");menu.set("mouseHasEntered",YES);menu.set("currentMenuItem",this);if(this.get("hasSubMenu")){this.invokeLater(this.showSubMenu,100)}return YES},mouseExited:function(evt){var subMenu,parentMenu;if(this.get("hasSubMenu")){subMenu=this.get("subMenu");this.invokeLater(this.checkMouseLocation,200)}else{parentMenu=this.get("parentMenu");if(parentMenu.get("currentMenuItem")===this){parentMenu.set("currentMenuItem",null)}}return YES},checkMouseLocation:function(){var subMenu=this.get("subMenu"),parentMenu=this.get("parentMenu"),currentMenuItem,previousMenuItem;if(!subMenu.get("mouseHasEntered")){currentMenuItem=parentMenu.get("currentMenuItem");if(currentMenuItem===this||currentMenuItem===null){previousMenuItem=parentMenu.get("previousMenuItem");if(previousMenuItem){previousMenuItem.resignFirstResponder()}subMenu.remove()}}},moveUp:function(sender,evt){var menu=this.get("parentMenu");if(menu){menu.moveUp(this)}return YES},moveDown:function(sender,evt){var menu=this.get("parentMenu");if(menu){menu.moveDown(this)}return YES},moveRight:function(sender,evt){this.showSubMenu();return YES},keyDown:function(evt){return this.interpretKeyEvents(evt)},keyUp:function(evt){return YES},cancel:function(evt){this.getPath("parentMenu.rootMenu").remove();return YES},didBecomeFirstResponder:function(responder){if(responder!==this){return}var parentMenu=this.get("parentMenu");if(parentMenu){parentMenu.set("currentSelectedMenuItem",this)}},willLoseFirstResponder:function(responder){if(responder!==this){return}var parentMenu=this.get("parentMenu");if(parentMenu){parentMenu.set("currentSelectedMenuItem",null);parentMenu.set("previousSelectedMenuItem",this)}},insertNewline:function(sender,evt){this.mouseUp(evt)},closeParent:function(){this.$().removeClass("focus");var menu=this.get("parentMenu");if(menu){menu.remove()}},clickInside:function(frame,evt){return SC.pointInRect({x:evt.pageX,y:evt.pageY},frame)}});sc_require("panes/picker");sc_require("views/menu_item");if(!SC.DEFAULT_MENU_ITEM_HEIGHT){SC.DEFAULT_MENU_ITEM_HEIGHT=20}if(!SC.DEFAULT_MENU_ITEM_SEPARATOR_HEIGHT){SC.DEFAULT_MENU_ITEM_SEPARATOR_HEIGHT=9}if(!SC.DEFAULT_MENU_HEIGHT_PADDING){SC.DEFAULT_MENU_HEIGHT_PADDING=0}SC.MenuPane=SC.PickerPane.extend({classNames:["sc-menu"],items:[],itemHeight:SC.DEFAULT_MENU_ITEM_HEIGHT,itemSeparatorHeight:SC.DEFAULT_MENU_ITEM_SEPARATOR_HEIGHT,menuHeight:0,menuHeightPadding:SC.DEFAULT_MENU_HEIGHT_PADDING,selectedItem:null,exampleView:SC.MenuItemView,anchor:null,isSubMenu:NO,localize:YES,popup:function(anchorViewOrElement,preferMatrix){var anchor;if(anchorViewOrElement){anchor=anchorViewOrElement.isView?anchorViewOrElement.get("layer"):anchorViewOrElement}this.beginPropertyChanges();this.set("anchorElement",anchor);this.set("anchor",anchorViewOrElement);this.set("preferType",SC.PICKER_MENU);if(preferMatrix){this.set("preferMatrix",preferMatrix)}this.endPropertyChanges();this.adjust("height",this.get("menuHeight"));this.positionPane();this.set("defaultResponder",this);this.append()},remove:function(){this.set("currentMenuItem",null);this.closeOpenMenus();this.resignKeyPane();return arguments.callee.base.apply(this,arguments)},itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemValueKey:"value",itemIconKey:"icon",itemHeightKey:"height",itemSubMenuKey:"subMenu",itemSeparatorKey:"separator",itemTargetKey:"target",itemActionKey:"action",itemCheckboxKey:"checkbox",itemShortCutKey:"shortcut",itemKeyEquivalentKey:"keyEquivalent",itemDisableMenuFlashKey:"disableMenuFlash",menuItemKeys:"itemTitleKey itemValueKey itemIsEnabledKey itemIconKey itemSeparatorKey itemActionKey itemCheckboxKey itemShortCutKey itemBranchKey itemHeightKey subMenuKey itemKeyEquivalentKey itemTargetKey".w(),preferType:SC.PICKER_MENU,isModal:YES,_menuView:null,createChildViews:function(){var scroll,menuView,menuItemViews;scroll=this.createChildView(SC.MenuScrollView,{borderStyle:SC.BORDER_NONE});menuView=this._menuView=SC.View.create();menuItemViews=this.get("menuItemViews");menuView.set("layout",{top:0,left:0,height:this.get("menuHeight")});menuView.replaceAllChildren(menuItemViews);scroll.set("contentView",menuView);this.childViews=[scroll];return this},menuItemViews:function(){var views=[],items=this.get("displayItems"),exampleView=this.get("exampleView"),item,view,height,heightKey,separatorKey,defaultHeight,separatorHeight,menuHeight,menuHeightPadding,keyEquivalentKey,keyEquivalent,keyArray,idx,len;if(!items){return views}heightKey=this.get("itemHeightKey");separatorKey=this.get("itemSeparatorKey");defaultHeight=this.get("itemHeight");keyEquivalentKey=this.get("itemKeyEquivalentKey");separatorHeight=this.get("itemSeparatorHeight");menuHeightPadding=Math.floor(this.get("menuHeightPadding")/2);menuHeight=menuHeightPadding;keyArray=this.menuItemKeys.map(SC._menu_fetchKeys,this);len=items.get("length");for(idx=0;idx<len;idx++){item=items[idx];height=item.get(heightKey);if(!height){height=item.get(separatorKey)?separatorHeight:defaultHeight}view=this._menuView.createChildView(exampleView,{layout:{height:height,top:menuHeight},contentDisplayProperties:keyArray,content:item,parentMenu:this});views[idx]=view;menuHeight+=height;keyEquivalent=item.get(keyEquivalentKey);if(keyEquivalent){this._keyEquivalents[keyEquivalent]=view}}this.set("menuHeight",menuHeight+menuHeightPadding);return views}.property("displayItems").cacheable(),menuItemViewForContentIndex:function(idx){var menuItemViews=this.get("menuItemViews");if(!menuItemViews){return undefined}return menuItemViews.objectAt(idx)},_keyEquivalents:{},rootMenu:function(){if(this.get("isSubMenu")){return this.getPath("parentMenu.rootMenu")}return this}.property("isSubMenu").cacheable(),windowSizeDidChange:function(oldSize,newSize){this.remove();return arguments.callee.base.apply(this,arguments)},displayItems:function(){var items=this.get("items"),localize=this.get("localize"),itemHeight=this.get("itemHeight"),len,ret=[],idx,item,itemType;if(!items){return null}len=items.get("length");for(idx=0;idx<len;idx++){item=items.objectAt(idx);if(!item){continue}itemType=SC.typeOf(item);if(itemType===SC.T_STRING){item=SC.Object.create({title:item,value:item,isEnabled:YES})}else{if(itemType===SC.T_HASH){item=SC.Object.create(item)}else{if(itemType===SC.T_ARRAY){item=this.convertArrayMenuItemToObject(item)}}}item.contentIndex=idx;ret.push(item)}return ret}.property("items").cacheable(),_sc_menu_itemsDidChange:function(){var views=this.get("menuItemViews");this._menuView.replaceAllChildren(views);this._menuView.adjust("height",this.get("menuHeight"))}.observes("items"),convertArrayMenuItemToObject:function(item){SC.Logger.warn("Support for Array-based menu items has been deprecated.  Please update your menus to use a hash.");var keys,fetchKeys=SC._menu_fetchKeys,fetchItem=SC._menu_fetchItem,cur,ret=SC.Object.create(),idx,loc;keys=this.menuItemKeys.map(fetchKeys,this);ret[keys[0]]=item[0];ret[keys[1]]=item[1];ret[keys[2]]=item[2];ret[keys[3]]=item[3];ret[keys[4]]=item[4];ret[keys[5]]=item[5];ret[keys[6]]=item[6];ret[keys[7]]=item[7];ret[keys[8]]=item[8];ret[keys[9]]=item[9];ret[keys[10]]=item[10];ret[keys[11]]=item[11];ret[keys[12]]=item[12];return ret},currentMenuItem:function(key,value){if(value!==undefined){if(this._currentMenuItem!==null){this.set("previousMenuItem",this._currentMenuItem)}this._currentMenuItem=value;this.setPath("rootMenu.targetMenuItem",value);return value}return this._currentMenuItem}.property().cacheable(),_sc_menu_currentMenuItemDidChange:function(){var currentMenuItem=this.get("currentMenuItem"),previousMenuItem=this.get("previousMenuItem");if(previousMenuItem){if(previousMenuItem.get("hasSubMenu")&&currentMenuItem===null){}else{previousMenuItem.resignFirstResponder();this.closeOpenMenusFor(previousMenuItem)}}if(currentMenuItem&&currentMenuItem.get("isEnabled")&&!currentMenuItem.get("isSeparator")){currentMenuItem.becomeFirstResponder()}}.observes("currentMenuItem"),closeOpenMenusFor:function(menuItem){if(!menuItem){return}var menu=menuItem.get("parentMenu");while(menu&&menuItem){menu=menuItem.get("subMenu");if(menu){menu.remove();menuItem.resignFirstResponder();menuItem=menu.get("previousMenuItem")}}},closeOpenMenus:function(){this.closeOpenMenusFor(this.get("previousMenuItem"))},mouseDown:function(evt){this.modalPaneDidClick();return YES},keyUp:function(evt){var ret=this.interpretKeyEvents(evt);return !ret?NO:ret},moveUp:function(){var currentMenuItem=this.get("currentMenuItem"),items=this.get("menuItemViews"),currentIndex,parentMenu,idx;if(!currentMenuItem){idx=items.get("length")-1}else{currentIndex=currentMenuItem.getPath("content.contentIndex");if(currentIndex===0){return YES}idx=currentIndex-1}while(idx>=0){if(items[idx].get("isEnabled")){this.set("currentMenuItem",items[idx]);break}idx--}return YES},moveDown:function(){var currentMenuItem=this.get("currentMenuItem"),items=this.get("menuItemViews"),len=items.get("length"),currentIndex,parentMenu,idx;if(!currentMenuItem){idx=0}else{currentIndex=currentMenuItem.getPath("content.contentIndex");if(currentIndex===len){return YES}idx=currentIndex+1}while(idx<len){if(items[idx].get("isEnabled")){this.set("currentMenuItem",items[idx]);break}idx++}return YES},insertText:function(chr,evt){var timer=this._timer,keyBuffer=this._keyBuffer;if(timer){timer.invalidate()}timer=this._timer=SC.Timer.schedule({target:this,action:"clearKeyBuffer",interval:500,isPooled:NO});keyBuffer=keyBuffer||"";keyBuffer+=chr.toUpperCase();this.selectMenuItemForString(keyBuffer);this._keyBuffer=keyBuffer;return YES},performKeyEquivalent:function(keyEquivalent){var menuItem=this._keyEquivalents[keyEquivalent];if(menuItem){menuItem.performAction(YES);return YES}return NO},selectMenuItemForString:function(buffer){var items=this.get("menuItemViews"),item,title,idx,len,bufferLength;if(!items){return}bufferLength=buffer.length;len=items.get("length");for(idx=0;idx<len;idx++){item=items.objectAt(idx);title=item.get("title");if(!title){continue}title=title.replace(/ /g,"").substr(0,bufferLength).toUpperCase();if(title===buffer){this.set("currentMenuItem",item);break}}},clearKeyBuffer:function(){this._keyBuffer=""},modalPaneDidClick:function(evt){this.closeOpenMenusFor(this.get("previousMenuItem"));this.remove();return YES}});SC._menu_fetchKeys=function(k){return this.get(k)};SC._menu_fetchItem=function(k){if(!k){return null}return this.get?this.get(k):this[k]};sc_require("views/button");SC.SelectButtonView=SC.ButtonView.extend({objects:[],objectsBindingDefault:SC.Binding.multiple(),nameKey:null,sortKey:null,valueKey:null,iconKey:null,isEnabledKey:"isEnabled",localize:YES,disableSort:YES,classNames:["select-button"],itemList:[],itemIdx:null,value:null,checkboxEnabled:YES,separatorPostion:null,_defaultVal:null,_defaultTitle:null,_defaultIcon:null,theme:"popup",displayProperties:["icon","value","controlSize","objects"],preferMatrix:null,SELECT_BUTTON_SPRITE_WIDTH:28,CUSTOM_MENU_ITEM_HEIGHT:20,isSelectedBinding:"*menu.isVisibleInWindow",isDefaultPosition:NO,lastMenuWidth:null,customView:null,customViewClassName:null,customViewMenuOffsetWidth:0,needsEllipsis:YES,menuPaneHeightPadding:0,supportFocusRing:YES,leftAlign:function(){var val=0,controlSize=this.get("controlSize");if(controlSize===SC.SMALL_CONTROL_SIZE){val=-12}if(controlSize===SC.REGULAR_CONTROL_SIZE){val=-15}return val}.property("controlSize"),sortObjects:function(objects){if(!this.get("disableSort")){var nameKey=this.get("sortKey")||this.get("nameKey");objects=objects.sort(function(a,b){if(nameKey){a=a.get?a.get(nameKey):a[nameKey];b=b.get?b.get(nameKey):b[nameKey]}return(a<b)?-1:((a>b)?1:0)})}return objects},render:function(context,firstTime){arguments.callee.base.apply(this,arguments);var layoutWidth,objects,len,nameKey,iconKey,valueKey,checkboxEnabled,currentSelectedVal,shouldLocalize,separatorPostion,itemList,isChecked,idx,name,icon,value,item,itemEnabled,isEnabledKey;layoutWidth=this.layout.width;if(firstTime&&layoutWidth){this.adjust({width:layoutWidth-this.SELECT_BUTTON_SPRITE_WIDTH})}objects=this.get("objects");objects=this.sortObjects(objects);len=objects.length;nameKey=this.get("nameKey");iconKey=this.get("iconKey");valueKey=this.get("valueKey");isEnabledKey=this.get("isEnabledKey");checkboxEnabled=this.get("checkboxEnabled");currentSelectedVal=this.get("value");shouldLocalize=this.get("localize");separatorPostion=this.get("separatorPostion");itemList=[];isChecked=YES;idx=0;objects.forEach(function(object){if(object){name=nameKey?(object.get?object.get(nameKey):object[nameKey]):object.toString();name=shouldLocalize?name.loc():name;icon=iconKey?(object.get?object.get(iconKey):object[iconKey]):null;if(SC.none(object[iconKey])){icon=null}value=(valueKey)?(object.get?object.get(valueKey):object[valueKey]):object;if(!SC.none(currentSelectedVal)&&!SC.none(value)){if(currentSelectedVal===value){this.set("title",name);this.set("icon",icon)}}if(value===this.get("value")){this.set("itemIdx",idx);isChecked=!checkboxEnabled?NO:YES}else{isChecked=NO}itemEnabled=object[isEnabledKey];if(NO!==itemEnabled){itemEnabled=YES}if(idx===0){this._defaultVal=value;this._defaultTitle=name;this._defaultIcon=icon}var item=SC.Object.create({title:name,icon:icon,value:value,isEnabled:itemEnabled,checkbox:isChecked,target:this,action:this.displaySelectedItem});itemList.push(item)}idx+=1;if(separatorPostion&&idx===(len-separatorPostion)){var separator=SC.Object.create({separator:YES});itemList.push(separator)}this.set("itemList",itemList)},this);if(firstTime){this.invokeLast(function(){var value=this.get("value");if(SC.none(value)){this.set("value",this._defaultVal);this.set("title",this._defaultTitle);this.set("icon",this._defaultIcon)}})}this.set("CUSTOM_MENU_ITEM_HEIGHT",this.get("controlSize")===SC.SMALL_CONTROL_SIZE?18:20);this.changeSelectButtonPreferMatrix(this.itemIdx)},_action:function(evt){var buttonLabel,menuWidth,scrollWidth,lastMenuWidth,offsetWidth,items,elementOffsetWidth,largestMenuWidth,item,element,idx,value,itemList,menuControlSize,menuHeightPadding,customView,customMenuView,menu,itemsLength;buttonLabel=this.$(".sc-button-label")[0];menuWidth=this.get("layer").offsetWidth;scrollWidth=buttonLabel.scrollWidth;lastMenuWidth=this.get("lastMenuWidth");if(scrollWidth){offsetWidth=buttonLabel.offsetWidth;if(scrollWidth&&offsetWidth){menuWidth=menuWidth+scrollWidth-offsetWidth}}if(!lastMenuWidth||(menuWidth>lastMenuWidth)){lastMenuWidth=menuWidth}items=this.get("itemList");var customViewClassName=this.get("customViewClassName");var customViewMenuOffsetWidth=this.get("customViewMenuOffsetWidth");var className="sc-view sc-pane sc-panel sc-palette sc-picker sc-menu select-button sc-scroll-view sc-menu-scroll-view sc-container-view menuContainer sc-button-view sc-menu-item sc-regular-size";className=customViewClassName?(className+" "+customViewClassName):className;for(idx=0,itemsLength=items.length;idx<itemsLength;++idx){item=items.objectAt(idx);element=document.createElement("div");element.style.cssText="top:-10000px; left: -10000px;  position: absolute;";element.className=className;element.innerHTML=item.title;document.body.appendChild(element);elementOffsetWidth=element.offsetWidth+customViewMenuOffsetWidth;if(!largestMenuWidth||(elementOffsetWidth>largestMenuWidth)){largestMenuWidth=elementOffsetWidth}document.body.removeChild(element)}lastMenuWidth=(largestMenuWidth>lastMenuWidth)?largestMenuWidth:lastMenuWidth;var maxWidth=SC.RootResponder.responder.get("currentWindowSize").width;if(lastMenuWidth>maxWidth){lastMenuWidth=(maxWidth-25)}this.set("lastMenuWidth",lastMenuWidth);value=this.get("value");itemList=this.get("itemList");menuControlSize=this.get("controlSize");menuHeightPadding=this.get("menuPaneHeightPadding");customView=this.get("customView");customMenuView=customView?customView:SC.MenuItemView;menu=SC.MenuPane.create({classNames:["select-button"],items:itemList,exampleView:customMenuView,isEnabled:YES,menuHeightPadding:menuHeightPadding,preferType:SC.PICKER_MENU,itemHeightKey:"height",layout:{width:lastMenuWidth},controlSize:menuControlSize,itemWidth:lastMenuWidth,itemHeight:this.get("itemHeight")||20,contentView:SC.View.extend({})});if(!menu){return NO}menu.popup(this,this.preferMatrix);menu.set("currentMenuItem",menu.menuItemViewForContentIndex(this.get("itemIdx")));return YES},displaySelectedItem:function(menuView){var currentItem=menuView.get("selectedItem");this.set("value",currentItem.get("value"));this.set("title",currentItem.get("title"));this.set("itemIdx",currentItem.get("contentIndex"))},changeSelectButtonPreferMatrix:function(){var controlSizeTuning=this.get("controlSize")===SC.SMALL_CONTROL_SIZE?0:-2;var preferMatrixAttributeTop=controlSizeTuning,itemIdx=this.get("itemIdx"),leftAlign=this.get("leftAlign"),defPreferMatrix,tempPreferMatrix;if(this.get("isDefaultPosition")){defPreferMatrix=[leftAlign,4,3];this.set("preferMatrix",defPreferMatrix)}else{if(itemIdx){preferMatrixAttributeTop=itemIdx*this.CUSTOM_MENU_ITEM_HEIGHT+controlSizeTuning}tempPreferMatrix=[leftAlign,-preferMatrixAttributeTop,2];this.set("preferMatrix",tempPreferMatrix)}},mouseDown:function(evt){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;this.becomeFirstResponder();this._action();return YES},keyDown:function(event){if(this.interpretKeyEvents(event)){return YES}else{arguments.callee.base.apply(this,arguments)}},interpretKeyEvents:function(event){if(event){if((event.keyCode===38||event.keyCode===40)){this._action()}else{if(event.keyCode===27){this.resignFirstResponder()}}}return arguments.callee.base.apply(this,arguments)},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled")});sc_require("panes/panel");SC.SheetPane=SC.PanelPane.extend({classNames:"sc-sheet",transitionDuration:200,_state:"NO_VIEW",init:function(){arguments.callee.base.apply(this,arguments);if(SC.Animatable){SC.SheetPane.ANIMATABLE_AVAILABLE=YES;this.mixin(SC.Animatable);if(!this.transitions){this.transitions={}}if(!this.transitions.top){this.transitions.top={duration:this.transitionDuration===200?0.3:this.transitionDuration/1000,action:"_complete",target:this}}}},append:function(){var layout=this.get("layout");if(!layout.height||!layout.top){layout=SC.View.convertLayoutToAnchoredLayout(layout,this.computeParentDimensions())}layout.top=-1*layout.height;if(this.disableAnimation){this.disableAnimation()}this.adjust(layout);this.updateLayout();if(this.enableAnimation){this.enableAnimation()}return arguments.callee.base.apply(this,arguments)},remove:function(){var that=this,args=arguments;this.invokeLater(function(){args.callee.base.apply(that,args)},this.transitionDuration);this.slideUp();return this},paneDidAttach:function(){var ret=arguments.callee.base.apply(this,arguments);this.slideDown();return ret},slideDown:function(){this._state=SC.SheetPane.ANIMATING;this._direction=SC.SheetPane.SLIDE_DOWN;if(SC.SheetPane.ANIMATABLE_AVAILABLE){this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_OUT;this.adjust("top",0)}else{this._start=Date.now();this._end=this._start+this.get("transitionDuration");this.tick()}},slideUp:function(){this._state=SC.SheetPane.ANIMATING;this._direction=SC.SheetPane.SLIDE_UP;if(SC.SheetPane.ANIMATABLE_AVAILABLE){var layout=this.get("layout");this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_IN;this.adjust("top",-1*layout.height)}else{this._start=Date.now();this._end=this._start+this.get("transitionDuration");this.tick()}},_complete:function(){var dir=this._direction;if(dir===SC.SheetPane.SLIDE_DOWN){if(!SC.SheetPane.ANIMATABLE_AVAILABLE){this.adjust("top",0)}if(SC.browser.mozilla){this.parentViewDidChange()}}else{var layout=this.get("layout");if(!SC.SheetPane.ANIMATABLE_AVAILABLE){this.adjust("top",-1*layout.height)}}this._state=SC.SheetPane.READY;this.updateLayout()},blurTo:function(pane){this.setFirstResponder("")},tick:function(){this._timer=null;var now=Date.now();var pct=(now-this._start)/(this._end-this._start),target=this,dir=this._direction,layout=this.get("layout"),newLayout,adjust;if(pct<0){pct=0}if(pct>=1){this._complete();return this}adjust=Math.floor(layout.height*pct);if(dir==SC.SheetPane.SLIDE_DOWN){target.adjust("top",0-(layout.height-adjust))}else{if(dir==SC.SheetPane.SLIDE_UP){target.adjust("top",0-adjust)}}this._timer=this.invokeLater(this.tick,20);target.updateLayout();return this}});SC.SheetPane.mixin({ANIMATABLE_AVAILABLE:NO,NO_VIEW:"NO_VIEW",ANIMATING:"ANIMATING",READY:"READY",SLIDE_DOWN:"SLIDEDOWN",SLIDE_UP:"SLIDEUP"});SC.DRAG_LINK=4;SC.DRAG_COPY=1;SC.DRAG_MOVE=2;SC.DRAG_NONE=0;SC.DRAG_ANY=7;SC.DRAG_AUTOSCROLL_ZONE_THICKNESS=20;SC.Drag=SC.Object.extend({source:null,ghostView:null,ghostActsLikeCursor:NO,dragView:null,ghost:YES,slideBack:YES,mouseDownEvent:null,ghostOffset:{x:0,y:0},location:{},dataTypes:function(){if(this.dataSource){return this.dataSource.get("dragDataTypes")||[]}var hash=this.data;if(hash){var ret=[];for(var key in hash){if(hash.hasOwnProperty(key)){ret.push(key)}}return ret}var source=this.get("source");if(source&&source.dragDataTypes){return source.get("dragDataTypes")||[]}return[]}.property().cacheable(),hasDataType:function(dataType){return(this.get("dataTypes").indexOf(dataType)>=0)},dataForType:function(dataType){if(this.dataSource){return this.dataSource.dragDataForType(this,dataType)}else{if(this.data){return this.data[dataType]}else{var source=this.get("source");if(source&&SC.typeOf(source.dragDataForType)==SC.T_FUNCTION){return source.dragDataForType(this,dataType)}else{return null}}}},dataSource:null,data:null,allowedDragOperations:SC.DRAG_ANY,_dragInProgress:YES,_dragViewWasVisible:null,startDrag:function(){this._createGhostView();var evt=this.event;var loc={x:evt.pageX,y:evt.pageY};this.set("location",loc);var dv=this._getDragView();var pv=dv.get("parentView");var origin=pv?pv.convertFrameToView(dv.get("frame"),null):dv.get("frame");if(this.ghost){this._dragViewWasVisible=dv.get("isVisible");dv.set("isVisible",NO)}if(this.ghostActsLikeCursor){this.ghostOffset={x:14,y:14}}else{this.ghostOffset={x:(loc.x-origin.x),y:(loc.y-origin.y)}}if(!this._ghostViewHidden){this._positionGhostView(evt)}this.ghostView.rootResponder.dragDidStart(this);var source=this.source;if(source&&source.dragDidBegin){source.dragDidBegin(this,loc)}var ary=this._dropTargets();for(var idx=0,len=ary.length;idx<len;idx++){ary[idx].tryToPerform("dragStarted",this,evt)}},mouseDragged:function(evt){var scrolled=this._autoscroll(evt);var loc=this.get("location");if(!scrolled&&(evt.pageX===loc.x)&&(evt.pageY===loc.y)){return}loc={x:evt.pageX,y:evt.pageY};this.set("location",loc);var source=this.source;var last=this._lastTarget;var target=this._findDropTarget(evt);var op=SC.DRAG_NONE;while(target&&(target!==last)&&(op===SC.DRAG_NONE)){if(target&&source&&source.dragSourceOperationMaskFor){op=source.dragSourceOperationMaskFor(this,target)}else{op=SC.DRAG_ANY}if((op!==SC.DRAG_NONE)&&target&&target.computeDragOperations){op=op&target.computeDragOperations(this,evt,op)}else{op=SC.DRAG_NONE}this.allowedDragOperations=op;if(op===SC.DRAG_NONE){target=this._findNextDropTarget(target)}}if(target!==last){if(last&&last.dragExited){last.dragExited(this,evt)}if(target){if(target.dragEntered){target.dragEntered(this,evt)}if(target.dragUpdated){target.dragUpdated(this,evt)}}this._lastTarget=target}else{if(target&&target.dragUpdated){target.dragUpdated(this,evt)}}if(source&&source.dragDidMove){source.dragDidMove(this,loc)}if(!this._ghostViewHidden){this._positionGhostView(evt)}},mouseUp:function(evt){var loc={x:evt.pageX,y:evt.pageY},target=this._lastTarget,op=this.allowedDragOperations;this.set("location",loc);try{if(target&&target.acceptDragOperation&&target.acceptDragOperation(this,op)){op=target.performDragOperation?target.performDragOperation(this,op):SC.DRAG_NONE}else{op=SC.DRAG_NONE}}catch(e){SC.Logger.error("Exception in SC.Drag.mouseUp(acceptDragOperation|performDragOperation): %@".fmt(e))}try{if(target&&target.dragExited){target.dragExited(this,evt)}}catch(ex){SC.Logger.error("Exception in SC.Drag.mouseUp(target.dragExited): %@".fmt(ex))}var ary=this._dropTargets();for(var idx=0,len=ary.length;idx<len;idx++){try{ary[idx].tryToPerform("dragEnded",this,evt)}catch(ex2){SC.Logger.error("Exception in SC.Drag.mouseUp(dragEnded on %@): %@".fmt(ary[idx],ex2))}}this._destroyGhostView();if(this.ghost){if(this._dragViewWasVisible){this._getDragView().set("isVisible",YES)}this._dragViewWasVisible=null}var source=this.source;if(source&&source.dragDidEnd){source.dragDidEnd(this,loc,op)}this._lastTarget=null;this._dragInProgress=NO},_getDragView:function(){if(!this.dragView){if(!this.source||!this.source.isView){throw"Source can't be used as dragView, because it's not a view."}this.dragView=this.source}return this.dragView},_createGhostView:function(){var that=this,dragView=this._getDragView(),frame=dragView.get("frame"),view;view=this.ghostView=SC.Pane.create({classNames:["sc-ghost-view"],layout:{top:frame.y,left:frame.x,width:frame.width,height:frame.height},owner:this,didCreateLayer:function(){if(dragView){var layer=dragView.get("layer");if(layer){layer=layer.cloneNode(true);layer.style.top="0px";layer.style.left="0px";this.get("layer").appendChild(layer)}}}});view.append()},_positionGhostView:function(evt){var loc=this.get("location");loc.x-=this.ghostOffset.x;loc.y-=this.ghostOffset.y;var gV=this.ghostView;if(gV){gV.adjust({top:loc.y,left:loc.x});gV.invokeOnce("updateLayout")}},_ghostViewHidden:NO,hideGhostView:function(){if(this.ghostView&&!this._ghostViewHidden){this.ghostView.remove();this._ghostViewHidden=YES}},unhideGhostView:function(){if(this._ghostViewHidden){this._ghostViewHidden=NO;this._createGhostView()}},_destroyGhostView:function(){if(this.ghostView){this.ghostView.remove();this.ghostView=null;this._ghostViewHidden=NO}},_dropTargets:function(){if(this._cachedDropTargets){return this._cachedDropTargets}var ret=[];var hash=SC.Drag._dropTargets;for(var key in hash){if(hash.hasOwnProperty(key)){ret.push(hash[key])}}var depth={};var dropTargets=SC.Drag._dropTargets;var getDepthFor=function(x){if(!x){return 0}var guid=SC.guidFor(x);var ret=depth[guid];if(!ret){ret=1;while(x=x.get("parentView")){if(dropTargets[SC.guidFor(x)]!==undefined){ret++}}depth[guid]=ret}return ret};ret.sort(function(a,b){if(a===b){return 0}a=getDepthFor(a);b=getDepthFor(b);return(a>b)?-1:1});this._cachedDropTargets=ret;return ret},_findDropTarget:function(evt){var loc={x:evt.pageX,y:evt.pageY};var target,frame;var ary=this._dropTargets();for(var idx=0,len=ary.length;idx<len;idx++){target=ary[idx];if(!target.get("isVisibleInWindow")){continue}frame=target.convertFrameToView(target.get("clippingFrame"),null);if(SC.pointInRect(loc,frame)){return target}}return null},_findNextDropTarget:function(target){var dropTargets=SC.Drag._dropTargets;while(target=target.get("parentView")){if(dropTargets[SC.guidFor(target)]){return target}}return null},_autoscroll:function(evt){if(!evt){evt=this._lastAutoscrollEvent}if(!this._dragInProgress){return NO}var loc=evt?{x:evt.pageX,y:evt.pageY}:this.get("location"),view=this._findScrollableView(loc),scrollableView=null,vscroll,hscroll,min,max,edge,container,f;while(view&&!scrollableView){vscroll=view.get("canScrollVertical")?1:0;hscroll=view.get("canScrollHorizontal")?1:0;if(vscroll||hscroll){container=view.get("containerView");if(container){f=view.convertFrameToView(container.get("frame"),null)}else{vscroll=hscroll=0}}if(vscroll){max=SC.maxY(f);min=max-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(loc.y>=min&&loc.y<=max){vscroll=1}else{min=SC.minY(f);max=min+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(loc.y>=min&&loc.y<=max){vscroll=-1}else{vscroll=0}}}if(hscroll){max=SC.maxX(f);min=max-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(loc.x>=min&&loc.x<=max){hscroll=1}else{min=SC.minX(f);max=min+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS;if(loc.x>=min&&loc.x<=max){hscroll=-1}else{hscroll=0}}}if(vscroll||hscroll){scrollableView=view}else{view=this._findNextScrollableView(view)}}if(scrollableView&&(this._lastScrollableView===scrollableView)){if((Date.now()-this._hotzoneStartTime)>100){this._horizontalScrollAmount*=1.05;this._verticalScrollAmount*=1.05}}else{this._lastScrollableView=scrollableView;this._horizontalScrollAmount=15;this._verticalScrollAmount=15;this._hotzoneStartTime=(scrollableView)?Date.now():null;hscroll=vscroll=0}if(scrollableView&&(hscroll||vscroll)){var scroll={x:hscroll*this._horizontalScrollAmount,y:vscroll*this._verticalScrollAmount};scrollableView.scrollBy(scroll)}if(scrollableView){if(evt){this._lastAutoscrollEvent={pageX:evt.pageX,pageY:evt.pageY}}this.invokeLater(this._autoscroll,100,null);return YES}else{this._lastAutoscrollEvent=null;return NO}},_scrollableViews:function(){if(this._cachedScrollableView){return this._cachedScrollableView}var ret=[];var hash=SC.Drag._scrollableViews;for(var key in hash){if(hash.hasOwnProperty(key)){ret.push(hash[key])}}ret=ret.sort(function(a,b){var view=a;while(view=view.get("parentView")){if(b==view){return -1}}return 1});this._cachedScrollableView=ret;return ret},_findScrollableView:function(loc){var ary=this._scrollableViews(),len=ary?ary.length:0,target,frame,idx;for(idx=0;idx<len;idx++){target=ary[idx];if(!target.get("isVisibleInWindow")){continue}frame=target.convertFrameToView(target.get("clippingFrame"),null);if(SC.pointInRect(loc,frame)){return target}}return null},_findNextScrollableView:function(view){var scrollableViews=SC.Drag._scrollableViews;while(view=view.get("parentView")){if(scrollableViews[SC.guidFor(view)]){return view}}return null}});SC.Drag.mixin({start:function(ops){var ret=this.create(ops);ret.startDrag();return ret},_dropTargets:{},_scrollableViews:{},addDropTarget:function(target){this._dropTargets[SC.guidFor(target)]=target},removeDropTarget:function(target){delete this._dropTargets[SC.guidFor(target)]},addScrollableView:function(target){this._scrollableViews[SC.guidFor(target)]=target},removeScrollableView:function(target){delete this._scrollableViews[SC.guidFor(target)]}});SC.MODIFIED_KEY_BINDINGS={"ctrl_.":"cancel",shift_tab:"insertBacktab",shift_left:"moveLeftAndModifySelection",shift_right:"moveRightAndModifySelection",shift_up:"moveUpAndModifySelection",shift_down:"moveDownAndModifySelection",alt_left:"moveLeftAndModifySelection",alt_right:"moveRightAndModifySelection",alt_up:"moveUpAndModifySelection",alt_down:"moveDownAndModifySelection",ctrl_a:"selectAll"};SC.BASE_KEY_BINDINGS={escape:"cancel",backspace:"deleteBackward","delete":"deleteForward","return":"insertNewline",tab:"insertTab",left:"moveLeft",right:"moveRight",up:"moveUp",down:"moveDown",home:"moveToBeginningOfDocument",end:"moveToEndOfDocument",pagedown:"pageDown",pageup:"pageUp"};SC.CAPTURE_BACKSPACE_KEY=NO;SC.PANEL_ORDER_LAYER=4096;SC.PALETTE_ORDER_LAYER=8192;SC.POPUP_ORDER_LAYER=12288;SC.RootResponder=SC.RootResponder.extend({platform:"desktop",focusedPane:function(){var views=this.get("orderedPanes");return views[views.length-1]}.property("orderedPanes"),orderedPanes:null,orderBefore:function(pane,beforePane){var currentFocus=this.get("focusedPane"),panes=this.get("orderedPanes").without(pane),len,idx,currentOrder,newFocus;var orderLayer=pane.get("orderLayer");if(beforePane){len=panes.length;idx=panes.indexOf(beforePane);currentOrder=beforePane.get("orderLayer");if(currentOrder<orderLayer){while((beforePane.get("orderLayer")<orderLayer)&&(++idx<len)){beforePane=panes[idx]}if(idx>=len){beforePane=null}}else{if(currentOrder>orderLayer){while((beforePane.get("orderLayer")>orderLayer)&&(--idx>=0)){beforePane=panes[idx]}beforePane=(idx<0)?panes[0]:panes[idx+1]}}}else{idx=panes.length;while((--idx>=0)&&!beforePane){beforePane=panes[idx];if(beforePane.get("orderLayer")>orderLayer){beforePane=null}}if(idx<0){beforePane=panes[0]}else{beforePane=panes[idx+1]}}if(beforePane){idx=panes.indexOf(beforePane);panes.insertAt(idx,pane)}else{panes.push(pane)}this.set("orderedPanes",panes);newFocus=this.get("focusedPane");if(newFocus!==currentFocus){if(currentFocus){currentFocus.blurTo(newFocus)}if(newFocus){newFocus.focusFrom(currentFocus)}}return this},orderOut:function(pane){var currentFocus=this.get("focusedPane"),currentKey=this.get("keyPane");var panes=this.get("orderedPanes").without(pane);this.set("orderedPanes",panes);if(currentFocus===pane){var newFocus=this.get("focusedPane");if(currentFocus){currentFocus.blurTo(newFocus)}if(newFocus){newFocus.focusFrom(currentFocus)}if(currentKey===pane){this.makeKeyPane(newFocus)}}else{if(currentKey===pane){this.makeKeyPane(null)}}return this},init:function(){arguments.callee.base.apply(this,arguments);this.orderedPanes=[]},setup:function(){this.listenFor("keydown keyup beforedeactivate mousedown mouseup click dblclick mouseout mouseover mousemove selectstart contextmenu".w(),document).listenFor("resize focus blur".w(),window);if(this.keypress){if(SC.CAPTURE_BACKSPACE_KEY&&SC.browser.mozilla){var responder=this;document.onkeypress=function(e){e=SC.Event.normalizeEvent(e);return responder.keypress.call(responder,e)};SC.Event.add(window,"unload",this,function(){document.onkeypress=null})}else{SC.Event.add(document,"keypress",this,this.keypress)}}"drag selectstart".w().forEach(function(keyName){var method=this[keyName];if(method){if(SC.browser.msie){var responder=this;document.body["on"+keyName]=function(e){return method.call(responder,SC.Event.normalizeEvent(event||window.event))};SC.Event.add(window,"unload",this,function(){document.body["on"+keyName]=null})}else{SC.Event.add(document,keyName,this,method)}}},this);var mousewheel=SC.browser.mozilla?"DOMMouseScroll":"mousewheel";SC.Event.add(document,mousewheel,this,this.mousewheel);this.set("currentWindowSize",this.computeWindowSize());this.focus();arguments.callee.base.apply(this,arguments)},attemptKeyEquivalent:function(evt){var ret=null;var keystring=evt.commandCodes()[0];if(!keystring){return NO}var keyPane=this.get("keyPane"),mainPane=this.get("mainPane"),mainMenu=this.get("mainMenu");if(keyPane){ret=keyPane.performKeyEquivalent(keystring,evt);if(ret||keyPane.get("isModal")){return ret}}if(!ret&&mainPane&&(mainPane!==keyPane)){ret=mainPane.performKeyEquivalent(keystring,evt);if(ret||mainPane.get("isModal")){return ret}}if(!ret&&mainMenu){ret=mainMenu.performKeyEquivalent(keystring,evt)}return ret},currentWindowSize:null,computeWindowSize:function(){var size;if(window.innerHeight){size={width:window.innerWidth,height:window.innerHeight}}else{if(document.documentElement&&document.documentElement.clientHeight){size={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}else{if(document.body){size={width:document.body.clientWidth,height:document.body.clientHeight}}}}return size},resize:function(){this._resize();return YES},_resize:function(){var newSize=this.computeWindowSize(),oldSize=this.get("currentWindowSize");this.set("currentWindowSize",newSize);if(!SC.rectsEqual(newSize,oldSize)){if(this.panes){SC.RunLoop.begin();this.panes.invoke("windowSizeDidChange",oldSize,newSize);SC.RunLoop.end()}}},hasFocus:NO,focus:function(){if(!this.get("hasFocus")){SC.$("body").addClass("sc-focus").removeClass("sc-blur");SC.RunLoop.begin();this.set("hasFocus",YES);SC.RunLoop.end()}return YES},blur:function(){if(this.get("hasFocus")){SC.$("body").addClass("sc-blur").removeClass("sc-focus");SC.RunLoop.begin();this.set("hasFocus",NO);SC.RunLoop.end()}return YES},dragDidStart:function(drag){this._mouseDownView=drag;this._drag=drag},_lastModifiers:null,_handleModifierChanges:function(evt){var m;m=this._lastModifiers=(this._lastModifiers||{alt:false,ctrl:false,shift:false});var changed=false;if(evt.altKey!==m.alt){m.alt=evt.altKey;changed=true}if(evt.ctrlKey!==m.ctrl){m.ctrl=evt.ctrlKey;changed=true}if(evt.shiftKey!==m.shift){m.shift=evt.shiftKey;changed=true}evt.modifiers=m;return(changed)?(this.sendEvent("flagsChanged",evt)?!!evt.hasCustomEventHandling:YES):YES},_isFunctionOrNonPrintableKey:function(evt){return !!(evt.altKey||evt.ctrlKey||evt.metaKey||((evt.charCode!==evt.which)&&SC.FUNCTION_KEYS[evt.which]))},_isModifierKey:function(evt){return !!SC.MODIFIER_KEYS[evt.charCode]},keydown:function(evt){if(SC.none(evt)){return YES}if(evt.keyCode===229){this._IMEInputON=YES;return YES}if(SC.browser.mozilla){if(SC.FUNCTION_KEYS[evt.keyCode]){return true}else{if((evt.ctrlKey||evt.metaKey)&&SC.PRINTABLE_KEYS[evt.keyCode]){return true}}}var ret=this._handleModifierChanges(evt),target=evt.target||evt.srcElement,forceBlock=(evt.which===8)&&!SC.allowsBackspaceToPreviousPage&&(target===document.body);if(this._isModifierKey(evt)){return(forceBlock?NO:ret)}ret=YES;if(this._isFunctionOrNonPrintableKey(evt)){ret=this.sendEvent("keyDown",evt);if(!ret&&!evt.hasCustomEventHandling){ret=!this.attemptKeyEquivalent(evt)}else{ret=!!evt.hasCustomEventHandling;if(ret){forceBlock=NO}}}return forceBlock?NO:ret},keypress:function(evt){var ret;if(SC.browser.mozilla){if(SC.FUNCTION_KEYS[evt.keyCode]){evt.which=evt.keyCode;ret=this.sendEvent("keyDown",evt);if(!ret&&!evt.hasCustomEventHandling){ret=!this.attemptKeyEquivalent(evt)}else{ret=!!evt.hasCustomEventHandling}if(evt.keyCode===8){var target=evt.target||evt.srcElement;if(target===document.body){ret=ret&&SC.allowsBackspaceToPreviousPage}}return ret}else{if((evt.ctrlKey||evt.metaKey)&&SC.PRINTABLE_KEYS_CHARCODE[evt.charCode]){evt.keyCode=SC.PRINTABLE_KEYS_CHARCODE[evt.charCode];evt.charCode=0;return this.sendEvent("keyDown",evt)?!!evt.hasCustomEventHandling:YES}}}if(evt.charCode!==undefined&&evt.charCode===0){return YES}return this.sendEvent("keyDown",evt)?!!evt.hasCustomEventHandling:YES},keyup:function(evt){if(this._ffevt){this._ffevt=null}var ret=this._handleModifierChanges(evt);if(this._isModifierKey(evt)){return ret}if(this._IMEInputON&&evt.keyCode===13){evt.isIMEInput=YES;this.sendEvent("keyDown",evt);this._IMEInputON=NO}return this.sendEvent("keyUp",evt)?!!evt.hasCustomEventHandling:YES},beforedeactivate:function(evt){var toElement=evt.toElement;if(toElement){var view=SC.$(toElement).view()[0];if(view&&!view.get("acceptsKeyPane")&&!view.get("acceptsFirstResponder")){return NO}}return YES},mousedown:function(evt){try{if(SC.browser.mozilla){window.focus();this.focus()}this._clickCount+=1;if(!this._lastMouseUpAt||((Date.now()-this._lastMouseUpAt)>200)){this._clickCount=1}else{var deltaX=this._lastMouseDownX-evt.clientX;var deltaY=this._lastMouseDownY-evt.clientY;var distance=Math.sqrt(deltaX*deltaX+deltaY*deltaY);if(distance>8){this._clickCount=1}}evt.clickCount=this._clickCount;this._lastMouseDownX=evt.clientX;this._lastMouseDownY=evt.clientY;var fr,view=this.targetViewForEvent(evt);if(view===undefined){return YES}if(view){fr=view.getPath("pane.firstResponder")}if(fr&&fr.kindOf(SC.InlineTextFieldView)&&fr!==view){fr.resignFirstResponder()}view=this._mouseDownView=this.sendEvent("mouseDown",evt,view);if(view&&view.respondsTo("mouseDragged")){this._mouseCanDrag=YES}}catch(e){SC.Logger.warn("Exception during mousedown: %@".fmt(e));this._mouseDownView=null;this._mouseCanDrag=NO;throw e}return view?!!evt.hasCustomEventHandling:YES},mouseup:function(evt){this.targetViewForEvent(evt);try{if(this._drag){this._drag.tryToPerform("mouseUp",evt);this._drag=null}var handler=null,view=this._mouseDownView,targetView=this.targetViewForEvent(evt);this._lastMouseUpAt=Date.now();evt.clickCount=this._clickCount;if(view){handler=this.sendEvent("mouseUp",evt,view);if(!handler&&(this._clickCount===2)){handler=this.sendEvent("doubleClick",evt,view)}if(!handler){handler=this.sendEvent("click",evt,view)}}if(!handler){if(this._clickCount===2){handler=this.sendEvent("doubleClick",evt,targetView)}if(!handler){handler=this.sendEvent("click",evt,targetView)}}this._mouseCanDrag=NO;this._mouseDownView=null}catch(e){this._drag=null;this._mouseCanDrag=NO;this._mouseDownView=null;throw e}return(handler)?!!evt.hasCustomEventHandling:YES},dblclick:function(evt){if(SC.browser.isIE){this._clickCount=2;this.mouseup(evt)}},mousewheel:function(evt){try{var view=this.targetViewForEvent(evt);if(view===undefined){return YES}var handler=this.sendEvent("mouseWheel",evt,view)}catch(e){throw e}return(handler)?!!evt.hasCustomEventHandling:YES},_lastHovered:null,mousemove:function(evt){if(SC.browser.msie){if(this._lastMoveX===evt.clientX&&this._lastMoveY===evt.clientY){return}}this._lastMoveX=evt.clientX;this._lastMoveY=evt.clientY;SC.RunLoop.begin();try{this.focus();if(this._drag){if(SC.browser.msie){if(this._lastMouseDownX!==evt.clientX&&this._lastMouseDownY!==evt.clientY){this._drag.tryToPerform("mouseDragged",evt)}}else{this._drag.tryToPerform("mouseDragged",evt)}}else{var lh=this._lastHovered||[],nh=[],exited,loc,len,view=this.targetViewForEvent(evt);while(view&&(view!==this)){if(lh.indexOf(view)!==-1){view.tryToPerform("mouseMoved",evt);nh.push(view)}else{view.tryToPerform("mouseEntered",evt);nh.push(view)}view=view.get("nextResponder")}for(loc=0,len=lh.length;loc<len;loc++){view=lh[loc];exited=view.respondsTo("mouseExited");if(exited&&!(nh.indexOf(view)!==-1)){view.tryToPerform("mouseExited",evt)}}this._lastHovered=nh;if(this._mouseDownView){if(SC.browser.msie){if(this._lastMouseDownX!==evt.clientX&&this._lastMouseDownY!==evt.clientY){this._mouseDownView.tryToPerform("mouseDragged",evt)}}else{this._mouseDownView.tryToPerform("mouseDragged",evt)}}}}catch(e){throw e}SC.RunLoop.end()},_mouseCanDrag:YES,selectstart:function(evt){var targetView=this.targetViewForEvent(evt);var result=this.sendEvent("selectStart",evt,targetView);if(targetView&&targetView.respondsTo("mouseDragged")){return(result!==null?YES:NO)&&!this._mouseCanDrag}else{return(result!==null?YES:NO)}},drag:function(){return false},contextmenu:function(evt){var view=this.targetViewForEvent(evt);return this.sendEvent("contextMenu",evt,view)}});sc_require("core");SC.UndoManager=SC.Object.extend({undoActionName:function(){return this.undoStack?this.undoStack.name:null}.property("undoStack"),redoActionName:function(){return this.redoStack?this.redoStack.name:null}.property("redoStack"),canUndo:function(){return this.undoStack!=null}.property("undoStack"),canRedo:function(){return this.redoStack!=null}.property("redoStack"),undo:function(){this._undoOrRedo("undoStack","isUndoing")},redo:function(){this._undoOrRedo("redoStack","isRedoing")},isUndoing:false,isRedoing:false,groupingLevel:0,registerUndo:function(func,name){this.beginUndoGroup(name);this._activeGroup.actions.push(func);this.endUndoGroup(name)},beginUndoGroup:function(name){if(this._activeGroup){this.groupingLevel++}else{var stack=this.isUndoing?"redoStack":"undoStack";this._activeGroup={name:name,actions:[],prev:this.get(stack)};this.set(stack,this._activeGroup);this.groupingLevel=1}},endUndoGroup:function(name){if(!this._activeGroup){raise("endUndoGroup() called outside group.")}if(this.groupingLevel>1){this.groupingLevel--}else{this._activeGroup=null;this.groupingLevel=0}this.propertyDidChange(this.isUndoing?"redoStack":"undoStack")},setActionName:function(name){if(!this._activeGroup){raise("setActionName() called outside group.")}this._activeGroup.name=name},_activeGroup:null,undoStack:null,redoStack:null,_undoOrRedo:function(stack,state){if(this._activeGroup){return false}if(this.get(stack)==null){return true}this.set(state,true);var group=this.get(stack);this.set(stack,group.prev);var action;var useGroup=group.actions.length>1;if(useGroup){this.beginUndoGroup(group.name)}while(action=group.actions.pop()){action()}if(useGroup){this.endUndoGroup(group.name)}this.set(state,false)}});SC.CheckboxView=SC.ButtonView.extend(SC.StaticLayout,SC.Button,{classNames:["sc-checkbox-view"],tagName:"label",needsEllipsis:NO,routeTouch:NO,render:function(context,firstTime){var dt,elem,value=this.get("value"),ariaValue=value===SC.MIXED_MODE?"mixed":(value===this.get("toggleOnValue")?"true":"false");if(firstTime){var blank=SC.BLANK_IMAGE_URL,disabled=this.get("isEnabled")?"":'disabled="disabled"',guid=SC.guidFor(this);context.attr("role","checkbox");dt=this._field_currentDisplayTitle=this.get("displayTitle");if(SC.browser.msie){context.attr("for",guid)}context.push('<span class="button" ></span>');if(this.get("needsEllipsis")){context.push('<span class="label ellipsis">',dt,"</span>")}else{context.push('<span class="label">',dt,"</span>")}context.attr("name",guid)}else{dt=this.get("displayTitle");if(dt!==this._field_currentDisplayTitle){this._field_currentDisplayTitle=dt;this.$("span.label").text(dt)}}context.attr("aria-checked",ariaValue)},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")}else{return NO}}.property("isEnabled"),mouseDown:function(evt){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._field_isMouseDown=YES;return YES},mouseUp:function(evt){if(!this.get("isEnabled")){return YES}var val=this.get("value");if(val===this.get("toggleOnValue")){this.$().attr("aria-checked","false");this.set("value",this.get("toggleOffValue"))}else{this.$().attr("aria-checked","true");this.set("value",this.get("toggleOnValue"))}this.set("isActive",NO);this._field_isMouseDown=NO;return YES}});SC.LIST_ITEM_ACTION_CANCEL="sc-list-item-cancel-action";SC.LIST_ITEM_ACTION_REFRESH="sc-list-item-cancel-refresh";SC.LIST_ITEM_ACTION_EJECT="sc-list-item-cancel-eject";SC.ListItemView=SC.View.extend(SC.StaticLayout,SC.Control,{classNames:["sc-list-item-view"],content:null,hasContentIcon:NO,hasContentRightIcon:NO,hasContentBranch:NO,contentCheckboxKey:null,contentIconKey:null,contentRightIconKey:null,contentValueKey:null,escapeHTML:YES,contentUnreadCountKey:null,contentIsBranchKey:null,isEditing:NO,outlineIndent:16,outlineLevel:0,disclosureState:SC.LEAF_NODE,contentPropertyDidChange:function(){if(this.get("contentIsEditable")!==this.contentIsEditable()){this.notifyPropertyChange("contentIsEditable")}this.displayDidChange()},contentIsEditable:function(){var content=this.get("content");return content&&(content.get?content.get("isEditable")!==NO:NO)}.property("content").cacheable(),render:function(context,firstTime){var content=this.get("content"),del=this.displayDelegate,level=this.get("outlineLevel"),indent=this.get("outlineIndent"),key,value,working,classArray=[];classArray.push((this.get("contentIndex")%2===0)?"even":"odd");context.setClass("disabled",!this.get("isEnabled"));working=context.begin("div").addClass("sc-outline");if(level>=0&&indent>0){working.addStyle("left",indent*(level+1))}value=this.get("disclosureState");if(value!==SC.LEAF_NODE){this.renderDisclosure(working,value);classArray.push("has-disclosure")}key=this.getDelegateProperty("contentCheckboxKey",del);if(key){value=content?(content.get?content.get(key):content[key]):NO;this.renderCheckbox(working,value);classArray.push("has-checkbox")}if(this.getDelegateProperty("hasContentIcon",del)){key=this.getDelegateProperty("contentIconKey",del);value=(key&&content)?(content.get?content.get(key):content[key]):null;this.renderIcon(working,value);classArray.push("has-icon")}key=this.getDelegateProperty("contentValueKey",del);value=(key&&content)?(content.get?content.get(key):content[key]):content;if(value&&SC.typeOf(value)!==SC.T_STRING){value=value.toString()}if(this.get("escapeHTML")){value=SC.RenderContext.escapeHTML(value)}this.renderLabel(working,value);if(this.getDelegateProperty("hasContentRightIcon",del)){key=this.getDelegateProperty("contentRightIconKey",del);value=(key&&content)?(content.get?content.get(key):content[key]):null;this.renderRightIcon(working,value);classArray.push("has-right-icon")}key=this.getDelegateProperty("contentUnreadCountKey",del);value=(key&&content)?(content.get?content.get(key):content[key]):null;if(!SC.none(value)&&(value!==0)){this.renderCount(working,value);var digits=["zero","one","two","three","four","five"];var valueLength=value.toString().length;var digitsLength=digits.length;var digit=(valueLength<digitsLength)?digits[valueLength]:digits[digitsLength-1];classArray.push("has-count "+digit+"-digit")}key=this.getDelegateProperty("listItemActionProperty",del);value=(key&&content)?(content.get?content.get(key):content[key]):null;if(value){this.renderAction(working,value);classArray.push("has-action")}if(this.getDelegateProperty("hasContentBranch",del)){key=this.getDelegateProperty("contentIsBranchKey",del);value=(key&&content)?(content.get?content.get(key):content[key]):NO;this.renderBranch(working,value);classArray.push("has-branch")}context.addClass(classArray);context=working.end()},renderDisclosure:function(context,state){var key=(state===SC.BRANCH_OPEN)?"open":"closed",cache=this._scli_disclosureHtml,html,tmp;if(!cache){cache=this.constructor.prototype._scli_disclosureHtml={}}html=cache[key];if(!html){html=cache[key]='<img src="'+SC.BLANK_IMAGE_URL+'" class="disclosure button '+key+'" />'}context.push(html)},renderCheckbox:function(context,state){var key=(state===SC.MIXED_STATE)?"mixed":state?"sel":"nosel",cache=this._scli_checkboxHtml,isEnabled=this.get("contentIsEditable")&&this.get("isEnabled"),html,tmp,classArray=[];if(!isEnabled){key=SC.keyFor("disabled",key)}if(!cache){cache=this.constructor.prototype._scli_checkboxHtml={}}html=cache[key];if(!html){tmp=SC.RenderContext("div").attr("role","button").classNames(SC.clone(SC.CheckboxView.prototype.classNames));if(state===SC.MIXED_STATE){classArray.push("mixed")}else{if(state){classArray.push("sel")}}if(!isEnabled){classArray.push("disabled")}tmp.addClass(classArray);tmp.push('<span class="button"></span>');html=cache[key]=tmp.join()}context.push(html)},renderIcon:function(context,icon){var url=null,className=null,classArray=[];if(icon&&SC.ImageView.valueIsUrl(icon)){url=icon;className=""}else{className=icon;url=SC.BLANK_IMAGE_URL}classArray.push(className);classArray.push("icon");context.begin("img").addClass(classArray).attr("src",url).end()},renderLabel:function(context,label){context.push("<label>",label||"","</label>")},$label:function(){return this.$("label")},renderRightIcon:function(context,icon){var url=null,className=null,classArray=[];if(icon&&SC.ImageView.valueIsUrl(icon)){url=icon;className=""}else{className=icon;url=SC.BLANK_IMAGE_URL}classArray.push("right-icon");classArray.push(className);context.begin("img").addClass(classArray).attr("src",url).end()},renderCount:function(context,count){context.push('<span class="count"><span class="inner">',count.toString(),"</span></span>")},renderAction:function(context,actionClassName){context.push('<img src="',SC.BLANK_IMAGE_URL,'" class="action" />')},renderBranch:function(context,hasBranch){var classArray=[];classArray.push("branch");classArray.push(hasBranch?"branch-visible":"branch-hidden");context.begin("span").addClass(classArray).push("&nbsp;").end()},_isInsideElementWithClassName:function(className,evt){var layer=this.get("layer");if(!layer){return NO}var el=SC.$(evt.target);var ret=NO,classNames;while(!ret&&el.length>0&&(el[0]!==layer)){if(el.hasClass(className)){ret=YES}el=el.parent()}el=layer=null;return ret},_isInsideCheckbox:function(evt){var del=this.displayDelegate;var checkboxKey=this.getDelegateProperty("contentCheckboxKey",del);return checkboxKey&&this._isInsideElementWithClassName("sc-checkbox-view",evt)},_isInsideDisclosure:function(evt){if(this.get("disclosureState")===SC.LEAF_NODE){return NO}return this._isInsideElementWithClassName("disclosure",evt)},_isInsideRightIcon:function(evt){var del=this.displayDelegate;var rightIconKey=this.getDelegateProperty("hasContentRightIcon",del);return rightIconKey&&this._isInsideElementWithClassName("right-icon",evt)},mouseDown:function(evt){if(!this.get("contentIsEditable")){return NO}if(this._isInsideCheckbox(evt)){this._addCheckboxActiveState();this._isMouseDownOnCheckbox=YES;this._isMouseInsideCheckbox=YES;return YES}else{if(this._isInsideDisclosure(evt)){this._addDisclosureActiveState();this._isMouseDownOnDisclosure=YES;this._isMouseInsideDisclosure=YES;return YES}else{if(this._isInsideRightIcon(evt)){this._addRightIconActiveState();this._isMouseDownOnRightIcon=YES;this._isMouseInsideRightIcon=YES;return YES}}}return NO},mouseUp:function(evt){var ret=NO,del,checkboxKey,content,state,idx,set;if(this._isMouseDownOnCheckbox){if(this._isInsideCheckbox(evt)){del=this.displayDelegate;checkboxKey=this.getDelegateProperty("contentCheckboxKey",del);content=this.get("content");if(content&&content.get){var value=content.get(checkboxKey);value=(value===SC.MIXED_STATE)?YES:!value;content.set(checkboxKey,value);this.displayDidChange()}}this._removeCheckboxActiveState();ret=YES}else{if(this._isMouseDownOnDisclosure){if(this._isInsideDisclosure(evt)){state=this.get("disclosureState");idx=this.get("contentIndex");set=(!SC.none(idx))?SC.IndexSet.create(idx):null;del=this.get("displayDelegate");if(state===SC.BRANCH_OPEN){if(set&&del&&del.collapse){del.collapse(set)}else{this.set("disclosureState",SC.BRANCH_CLOSED)}this.displayDidChange()}else{if(state===SC.BRANCH_CLOSED){if(set&&del&&del.expand){del.expand(set)}else{this.set("disclosureState",SC.BRANCH_OPEN)}this.displayDidChange()}}}this._removeDisclosureActiveState();ret=YES}else{if(this._isMouseDownOnRightIcon){this._removeRightIconActiveState();ret=YES}}}this._isMouseInsideCheckbox=this._isMouseDownOnCheckbox=NO;this._isMouseDownOnDisclosure=this._isMouseInsideDisclosure=NO;this._isMouseInsideRightIcon=this._isMouseDownOnRightIcon=NO;return ret},mouseExited:function(evt){if(this._isMouseDownOnCheckbox){this._removeCheckboxActiveState();this._isMouseInsideCheckbox=NO}else{if(this._isMouseDownOnDisclosure){this._removeDisclosureActiveState();this._isMouseInsideDisclosure=NO}else{if(this._isMouseDownOnRightIcon){this._removeRightIconActiveState();this._isMouseInsideRightIcon=NO}}}return NO},mouseEntered:function(evt){if(this._isMouseDownOnCheckbox){this._addCheckboxActiveState();this._isMouseInsideCheckbox=YES}else{if(this._isMouseDownOnDisclosure){this._addDisclosureActiveState();this._isMouseInsideDisclosure=YES}else{if(this._isMouseDownOnRightIcon){this._addRightIconActiveState();this._isMouseInsideRightIcon=YES}}}return NO},_addCheckboxActiveState:function(){var enabled=this.get("isEnabled");this.$(".sc-checkbox-view").setClass("active",enabled)},_removeCheckboxActiveState:function(){this.$(".sc-checkbox-view").removeClass("active")},_addDisclosureActiveState:function(){var enabled=this.get("isEnabled");this.$("img.disclosure").setClass("active",enabled)},_removeDisclosureActiveState:function(){this.$("img.disclosure").removeClass("active")},_addRightIconActiveState:function(){this.$("img.right-icon").setClass("active",YES)},_removeRightIconActiveState:function(){this.$("img.right-icon").removeClass("active")},contentHitTest:function(evt){var del=this.displayDelegate;var labelKey=this.getDelegateProperty("contentValueKey",del);if(!labelKey){return NO}var el=this.$label()[0];if(!el){return NO}var cur=evt.target,layer=this.get("layer");while(cur&&(cur!==layer)&&(cur!==window)){if(cur===el){return YES}cur=cur.parentNode}return NO},beginEditing:function(){if(this.get("isEditing")){return YES}return this._beginEditing(YES)},_beginEditing:function(scrollIfNeeded){var content=this.get("content"),del=this.get("displayDelegate"),labelKey=this.getDelegateProperty("contentValueKey",del),parent=this.get("parentView"),pf=parent?parent.get("frame"):null,el=this.$label(),f,v,offset,oldLineHeight,fontSize,top,lineHeight,lineHeightShift,targetLineHeight,ret;if(scrollIfNeeded&&this.scrollToVisible()){var collectionView=this.get("owner"),idx=this.get("contentIndex");this.invokeLast(function(){var item=collectionView.itemViewForContentIndex(idx);if(item&&item._beginEditing){item._beginEditing(NO)}});return YES}if(!parent||!el||el.get("length")===0){return NO}v=(labelKey&&content&&content.get)?content.get(labelKey):null;f=this.computeFrameWithParentFrame(null);offset=SC.viewportOffset(el[0]);oldLineHeight=el.css("lineHeight");fontSize=el.css("fontSize");top=this.$().css("top");if(top){top=parseInt(top.substring(0,top.length-2),0)}else{top=0}lineHeight=oldLineHeight;lineHeightShift=0;if(fontSize&&lineHeight){targetLineHeight=fontSize*1.5;if(targetLineHeight<lineHeight){el.css({lineHeight:"1.5"});lineHeightShift=(lineHeight-targetLineHeight)/2}else{oldLineHeight=null}}f.x=offset.x;f.y=offset.y+top+lineHeightShift;f.height=el[0].offsetHeight;f.width=el[0].offsetWidth;ret=SC.InlineTextFieldView.beginEditing({frame:f,exampleElement:el,delegate:this,value:v,multiline:NO,isCollection:YES});if(oldLineHeight){el.css({lineHeight:oldLineHeight})}return ret},commitEditing:function(){if(!this.get("isEditing")){return YES}return SC.InlineTextFieldView.commitEditing()},discardEditing:function(){if(!this.get("isEditing")){return YES}return SC.InlineTextFieldView.discardEditing()},inlineEditorShouldBeginEditing:function(inlineEditor){return YES},inlineEditorWillBeginEditing:function(inlineEditor){this.set("isEditing",YES)},inlineEditorDidBeginEditing:function(inlineEditor){var el=this.$label();this._oldOpacity=el.css("opacity");el.css("opacity",0)},inlineEditorShouldEndEditing:function(inlineEditor,finalValue){return YES},inlineEditorDidEndEditing:function(inlineEditor,finalValue){this.set("isEditing",NO);var content=this.get("content");var del=this.displayDelegate;var labelKey=this.getDelegateProperty("contentValueKey",del);if(labelKey&&content&&content.set){content.set(labelKey,finalValue)}this.displayDidChange()}});sc_require("mixins/collection_view_delegate");sc_require("views/list_item");SC.DRAG_REORDER=16;SC.HORIZONTAL_ORIENTATION="horizontal";SC.VERTICAL_ORIENTATION="vertical";SC.BENCHMARK_RELOAD=NO;SC.CollectionView=SC.View.extend(SC.CollectionViewDelegate,SC.CollectionContent,{classNames:["sc-collection-view"],ACTION_DELAY:200,content:null,contentBindingDefault:SC.Binding.multiple(),length:0,nowShowing:function(){return this.computeNowShowing()}.property("length","clippingFrame").cacheable(),selection:null,isSelectable:YES,isSelectableBindingDefault:SC.Binding.bool(),isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),isEditable:YES,isEditableBindingDefault:SC.Binding.bool(),canReorderContent:NO,canReorderContentBindingDefault:SC.Binding.bool(),canDeleteContent:NO,canDeleteContentBindingDefault:SC.Binding.bool(),canEditContent:NO,canEditContentBindingDefault:SC.Binding.bool(),isDropTarget:NO,useToggleSelection:NO,actOnSelect:NO,selectOnMouseDown:YES,exampleView:SC.ListItemView,contentExampleViewKey:null,groupExampleView:null,contentGroupExampleViewKey:null,action:null,target:null,contentValueKey:null,acceptsFirstResponder:NO,isActive:NO,calculatedHeight:0,calculatedWidth:0,computeLayout:function(){return null},layoutForContentIndex:function(contentIndex){return null},allContentIndexes:function(){return SC.IndexSet.create(0,this.get("length")).freeze()}.property("length").cacheable(),contentIndexesInRect:function(rect){return null},computeNowShowing:function(){var r=this.contentIndexesInRect(this.get("clippingFrame"));if(!r){r=this.get("allContentIndexes")}else{var len=this.get("length"),max=r.get("max");if(max>len){r=r.copy().remove(len,max-len).freeze()}}return r},showInsertionPoint:function(itemView,dropOperation){},hideInsertionPoint:function(){},delegate:null,selectionDelegate:function(){var del=this.get("delegate"),content=this.get("content");return this.delegateFor("isCollectionViewDelegate",del,content)}.property("delegate","content").cacheable(),contentDelegate:function(){var del=this.get("delegate"),content=this.get("content");return this.delegateFor("isCollectionContent",del,content)}.property("delegate","content").cacheable(),_contentGroupIndexes:function(){return this.get("contentDelegate").contentGroupIndexes(this,this.get("content"))}.property("contentDelegate","content").cacheable(),contentRangeDidChange:function(content,object,key,indexes){if(!object&&(key==="[]")){this.reload(indexes)}else{this.contentPropertyDidChange(object,key,indexes)}},contentPropertyDidChange:function(target,key,indexes){},updateContentRangeObserver:function(){var nowShowing=this.get("nowShowing"),observer=this._cv_contentRangeObserver,content=this.get("content");if(!content){return}if(observer){content.updateRangeObserver(observer,nowShowing)}else{var func=this.contentRangeDidChange;observer=content.addRangeObserver(nowShowing,this,func,null);this._cv_contentRangeObserver=observer}},removeContentRangeObserver:function(){var content=this.get("content"),observer=this._cv_contentRangeObserver;if(observer){if(content){content.removeRangeObserver(observer)}this._cv_contentRangeObserver=null}},contentLengthDidChange:function(){var content=this.get("content");this.set("length",content?content.get("length"):0)},_cv_contentDidChange:function(){var content=this.get("content"),lfunc=this.contentLengthDidChange;if(content===this._content){return}this.removeContentRangeObserver();if(this._content){this._content.removeObserver("length",this,lfunc)}this._content=content;if(content){content.addObserver("length",this,lfunc)}this.contentLengthDidChange();this.contentRangeDidChange(content,null,"[]",null)}.observes("content"),_invalidIndexes:NO,reload:function(indexes){var invalid=this._invalidIndexes;if(indexes&&invalid!==YES){if(invalid){invalid.add(indexes)}else{invalid=this._invalidIndexes=indexes.clone()}}else{this._invalidIndexes=YES}if(this.get("isVisibleInWindow")){this.invokeOnce(this.reloadIfNeeded)}return this},reloadIfNeeded:function(){var invalid=this._invalidIndexes;if(!invalid||!this.get("isVisibleInWindow")){return this}this._invalidIndexes=NO;var content=this.get("content"),i,len,existing,layout=this.computeLayout(),bench=SC.BENCHMARK_RELOAD,nowShowing=this.get("nowShowing"),itemViews=this._sc_itemViews,containerView=this.get("containerView")||this,exampleView,exampleGroupView,shouldReuseViews,shouldReuseGroupViews,shouldReuse,viewsToRemove,viewsToRedraw,viewsToCreate,views,idx,view,layer,parentNode,viewPool,del,groupIndexes,isGroupView;if(invalid.isIndexSet&&invalid.contains(nowShowing)){invalid=YES}if(this.willReload){this.willReload(invalid===YES?null:invalid)}exampleView=this.get("exampleView");shouldReuseViews=exampleView?exampleView.isReusableInCollections:NO;exampleGroupView=this.get("exampleGroupView");shouldReuseGroupViews=exampleGroupView?exampleGroupView.isReusableInCollections:NO;if(invalid.isIndexSet){if(bench){SC.Benchmark.start(bench="%@#reloadIfNeeded (Partial)".fmt(this),YES)}viewsToRemove=[];viewsToRedraw=[];viewsToCreate=[];invalid.forEach(function(idx){existing=itemViews?itemViews[idx]:null;if(nowShowing.contains(idx)){if(existing&&existing.parentView===containerView){viewsToRedraw.push(idx)}else{viewsToCreate.push(idx)}}else{if(existing&&existing.parentView===containerView){viewsToRemove.push(idx)}}},this);for(i=0,len=viewsToRemove.length;i<len;++i){idx=viewsToRemove[i];existing=itemViews?itemViews[idx]:null;delete itemViews[idx];del=this.get("contentDelegate");groupIndexes=this.get("_contentGroupIndexes");isGroupView=groupIndexes&&groupIndexes.contains(idx);if(isGroupView){isGroupView=del.contentIndexIsGroup(this,content,idx)}shouldReuse=isGroupView?shouldReuseGroupViews:shouldReuseViews;if(shouldReuse){viewPool=isGroupView?this._GROUP_VIEW_POOL:this._VIEW_POOL;viewPool.push(existing);existing.destroyLayer()}containerView.removeChild(existing)}for(i=0,len=viewsToRedraw.length;i<len;++i){idx=viewsToRedraw[i];existing=itemViews?itemViews[idx]:null;view=this.itemViewForContentIndex(idx,YES);existing.destroyLayer();containerView.replaceChild(view,existing)}for(i=0,len=viewsToCreate.length;i<len;++i){idx=viewsToCreate[i];view=this.itemViewForContentIndex(idx,YES);containerView.insertBefore(view,null)}if(bench){SC.Benchmark.end(bench)}}else{if(bench){SC.Benchmark.start(bench="%@#reloadIfNeeded (Full)".fmt(this),YES)}if(itemViews){itemViews.length=0}views=containerView.get("childViews");if(views){views=views.copy()}containerView.beginPropertyChanges();containerView.destroyLayer().removeAllChildren();if(views){for(i=0,len=views.length;i<len;++i){view=views[i];isGroupView=view.get("isGroupView");shouldReuse=isGroupView?shouldReuseGroupViews:shouldReuseViews;if(shouldReuse){viewPool=isGroupView?this._GROUP_VIEW_POOL:this._VIEW_POOL;viewPool.push(view);view.destroyLayer()}}}views=[];nowShowing.forEach(function(idx){views.push(this.itemViewForContentIndex(idx,YES))},this);containerView.set("childViews",views);containerView.replaceLayer();containerView.endPropertyChanges();if(bench){SC.Benchmark.end(bench)}}if(layout){this.adjust(layout)}if(this.didReload){this.didReload(invalid===YES?null:invalid)}return this},displayProperties:"isFirstResponder isEnabled isActive".w(),render:function(context,firstTime){if(firstTime&&this._needsReload){this.reloadIfNeeded()}context.setClass("focus",this.get("isFirstResponder"));context.setClass("disabled",!this.get("isEnabled"));context.setClass("active",this.get("isActive"));return arguments.callee.base.apply(this,arguments)},_TMP_ATTRS:{},_COLLECTION_CLASS_NAMES:"sc-collection-item".w(),_GROUP_COLLECTION_CLASS_NAMES:"sc-collection-item sc-group-item".w(),_VIEW_POOL:null,_GROUP_VIEW_POOL:null,itemViewForContentIndex:function(idx,rebuild){var ret;var itemViews=this._sc_itemViews;if(!itemViews){itemViews=this._sc_itemViews=[]}else{if(!rebuild&&(ret=itemViews[idx])){return ret}}var content=this.get("content"),item=content.objectAt(idx),del=this.get("contentDelegate"),groupIndexes=this.get("_contentGroupIndexes"),isGroupView=NO,key,E,layout,layerId,viewPoolKey,viewPool,reuseFunc,parentView,isEnabled,isSelected,outlineLevel,disclosureState,isVisibleInWindow;isGroupView=groupIndexes&&groupIndexes.contains(idx);if(isGroupView){isGroupView=del.contentIndexIsGroup(this,content,idx)}if(isGroupView){key=this.get("contentGroupExampleViewKey");if(key&&item){E=item.get(key)}if(!E){E=this.get("groupExampleView")||this.get("exampleView")}viewPoolKey="_GROUP_VIEW_POOL"}else{key=this.get("contentExampleViewKey");if(key&&item){E=item.get(key)}if(!E){E=this.get("exampleView")}viewPoolKey="_VIEW_POOL"}parentView=this.get("containerView")||this;layerId=this.layerIdFor(idx);isEnabled=del.contentIndexIsEnabled(this,content,idx);isSelected=del.contentIndexIsSelected(this,content,idx);outlineLevel=del.contentIndexOutlineLevel(this,content,idx);disclosureState=del.contentIndexDisclosureState(this,content,idx);isVisibleInWindow=this.isVisibleInWindow;layout=this.layoutForContentIndex(idx);if(E&&E.isReusableInCollections){viewPool=this[viewPoolKey];if(!viewPool){viewPool=this[viewPoolKey]=[]}if(viewPool.length>0){ret=viewPool.pop();reuseFunc=ret.prepareForReuse;if(reuseFunc){reuseFunc.call(ret)}ret.beginPropertyChanges();ret.set("contentIndex",idx);ret.set("layerId",layerId);ret.set("isEnabled",isEnabled);ret.set("isSelected",isSelected);ret.set("outlineLevel",outlineLevel);ret.set("disclosureState",disclosureState);ret.set("isVisibleInWindow",isVisibleInWindow);ret.set("parentView",parentView);SC.View.views[layerId]=ret;if(layout){ret.set("layout",layout)}else{ret.set("layout",E.prototype.layout)}ret.set("content",item);ret.endPropertyChanges()}}if(!ret){var attrs=this._TMP_ATTRS;attrs.contentIndex=idx;attrs.content=item;attrs.owner=attrs.displayDelegate=this;attrs.parentView=parentView;attrs.page=this.page;attrs.layerId=layerId;attrs.isEnabled=isEnabled;attrs.isSelected=isSelected;attrs.outlineLevel=outlineLevel;attrs.disclosureState=disclosureState;attrs.isGroupView=isGroupView;attrs.isVisibleInWindow=isVisibleInWindow;if(isGroupView){attrs.classNames=this._GROUP_COLLECTION_CLASS_NAMES}else{attrs.classNames=this._COLLECTION_CLASS_NAMES}if(layout){attrs.layout=layout}else{delete attrs.layout}ret=this.createItemView(E,idx,attrs)}itemViews[idx]=ret;return ret},itemViewForContentObject:function(object){return this.itemViewForContentIndex(this.get("content").indexOf(object))},_TMP_LAYERID:[],createItemView:function(exampleClass,idx,attrs){return exampleClass.create(attrs)},layerIdFor:function(idx){var ret=this._TMP_LAYERID;ret[0]=SC.guidFor(this);ret[1]=idx;return ret.join("-")},contentIndexForLayerId:function(id){if(!id||!(id=id.toString())){return null}var base=this._baseLayerId;if(!base){base=this._baseLayerId=SC.guidFor(this)+"-"}if((id.length<=base.length)||(id.indexOf(base)!==0)){return null}var ret=Number(id.slice(id.lastIndexOf("-")+1));return isNaN(ret)?null:ret},itemViewForEvent:function(evt){var responder=this.getPath("pane.rootResponder");if(!responder){return null}var base=SC.guidFor(this)+"-",baseLen=base.length,element=evt.target,layer=this.get("layer"),contentIndex=null,id,itemView,ret;while(element&&element!==document&&element!==layer){id=element?SC.$(element).attr("id"):null;if(id&&(contentIndex=this.contentIndexForLayerId(id))!==null){break}element=element.parentNode}if(contentIndex===null||(element===layer)){element=layer=null;return null}if(contentIndex>=this.get("length")){throw"layout for item view %@ was found when item view does not exist (%@)".fmt(id,this)}return this.itemViewForContentIndex(contentIndex)},expand:function(indexes){if(!indexes){return this}var del=this.get("contentDelegate"),content=this.get("content");indexes.forEach(function(i){var state=del.contentIndexDisclosureState(this,content,i);if(state===SC.BRANCH_CLOSED){del.contentIndexExpand(this,content,i)}},this);return this},collapse:function(indexes){if(!indexes){return this}var del=this.get("contentDelegate"),content=this.get("content");indexes.forEach(function(i){var state=del.contentIndexDisclosureState(this,content,i);if(state===SC.BRANCH_OPEN){del.contentIndexCollapse(this,content,i)}},this);return this},_cv_selectionDidChange:function(){var sel=this.get("selection"),last=this._cv_selection,func=this._cv_selectionContentDidChange;if(sel===last){return}if(last){last.removeObserver("[]",this,func)}if(sel){sel.addObserver("[]",this,func)}this._cv_selection=sel;this._cv_selectionContentDidChange()}.observes("selection"),_cv_selectionContentDidChange:function(){var sel=this.get("selection"),last=this._cv_selindexes,content=this.get("content"),diff;this._cv_selindexes=sel?sel.frozenCopy():null;if(last){last=last.indexSetForSource(content)}if(sel){sel=sel.indexSetForSource(content)}if(sel&&last){diff=sel.without(last).add(last.without(sel))}else{diff=sel||last}if(diff&&diff.get("length")>0){this.reloadSelectionIndexes(diff)}},_invalidSelection:NO,reloadSelectionIndexes:function(indexes){var invalid=this._invalidSelection;if(indexes&&(invalid!==YES)){if(invalid){invalid.add(indexes)}else{invalid=this._invalidSelection=indexes.copy()}}else{this._invalidSelection=YES}if(this.get("isVisibleInWindow")){this.invokeOnce(this.reloadSelectionIndexesIfNeeded)}return this},reloadSelectionIndexesIfNeeded:function(){var invalid=this._invalidSelection;if(!invalid||!this.get("isVisibleInWindow")){return this}var nowShowing=this.get("nowShowing"),reload=this._invalidIndexes,content=this.get("content"),sel=this.get("selection");this._invalidSelection=NO;if(reload===YES||!nowShowing){return this}if(invalid===YES){invalid=nowShowing}if(reload&&reload.isIndexSet){invalid=invalid.without(reload)}invalid.forEach(function(idx){if(!nowShowing.contains(idx)){return}var view=this.itemViewForContentIndex(idx,NO);if(view){view.set("isSelected",sel?sel.contains(content,idx):NO)}},this);return this},select:function(indexes,extend){var content=this.get("content"),del=this.get("selectionDelegate"),groupIndexes=this.get("_contentGroupIndexes"),sel;if(!this.get("isSelectable")){return this}if(SC.typeOf(indexes)===SC.T_NUMBER){indexes=SC.IndexSet.create(indexes,1)}if(indexes&&indexes.get("length")>0){if(groupIndexes&&groupIndexes.get("length")>0){indexes=indexes.copy().remove(groupIndexes)}indexes=del.collectionViewShouldSelectIndexes(this,indexes,extend);if(!indexes||indexes.get("length")===0){return this}}else{indexes=null}if(extend&&(sel=this.get("selection"))){sel=sel.copy()}else{sel=SC.SelectionSet.create()}if(indexes&&indexes.get("length")>0){if(indexes.get("length")===1){sel.addObject(content.objectAt(indexes.get("firstObject")))}else{sel.add(content,indexes)}}sel=del.collectionViewSelectionForProposedSelection(this,sel);if(!sel){sel=SC.SelectionSet.create()}this._selectionAnchor=null;this.set("selection",sel.freeze());return this},deselect:function(indexes){var sel=this.get("selection"),content=this.get("content"),del=this.get("selectionDelegate");if(!this.get("isSelectable")){return this}if(!sel||sel.get("length")===0){return this}if(SC.typeOf(indexes)===SC.T_NUMBER){indexes=SC.IndexSet.create(indexes,1)}indexes=del.collectionViewShouldDeselectIndexes(this,indexes);if(!indexes||indexes.get("length")===0){return this}sel=sel.copy().remove(content,indexes);sel=del.collectionViewSelectionForProposedSelection(this,sel);if(!sel){sel=SC.SelectionSet.create()}this.set("selection",sel.freeze());return this},_findNextSelectableItemFromIndex:function(proposedIndex,bottom){var lim=this.get("length"),range=SC.IndexSet.create(),content=this.get("content"),del=this.get("selectionDelegate"),groupIndexes=this.get("_contentGroupIndexes"),ret,sel;if(!groupIndexes&&(del.collectionViewShouldSelectIndexes===this.collectionViewShouldSelectIndexes)){return proposedIndex}while(proposedIndex<lim){if(!groupIndexes||!groupIndexes.contains(proposedIndex)){range.add(proposedIndex);ret=del.collectionViewShouldSelectIndexes(this,range);if(ret&&ret.get("length")>=1){return proposedIndex}range.remove(proposedIndex)}proposedIndex++}if(bottom===undefined){sel=this.get("selection");bottom=sel?sel.get("max"):-1}return bottom},_findPreviousSelectableItemFromIndex:function(proposedIndex,top){var range=SC.IndexSet.create(),content=this.get("content"),del=this.get("selectionDelegate"),groupIndexes=this.get("_contentGroupIndexes"),ret;if(SC.none(proposedIndex)){proposedIndex=-1}if(!groupIndexes&&(del.collectionViewShouldSelectIndexes===this.collectionViewShouldSelectIndexes)){return proposedIndex}while(proposedIndex>=0){if(!groupIndexes||!groupIndexes.contains(proposedIndex)){range.add(proposedIndex);ret=del.collectionViewShouldSelectIndexes(this,range);if(ret&&ret.get("length")>=1){return proposedIndex}range.remove(proposedIndex)}proposedIndex--}if(top===undefined){var sel=this.get("selection");top=sel?sel.get("min"):-1}if(SC.none(top)){top=-1}return top},selectPreviousItem:function(extend,numberOfItems){if(SC.none(numberOfItems)){numberOfItems=1}if(SC.none(extend)){extend=false}var sel=this.get("selection"),content=this.get("content");if(sel){sel=sel.indexSetForSource(content)}var selTop=sel?sel.get("min"):-1,selBottom=sel?sel.get("max")-1:-1,anchor=this._selectionAnchor;if(SC.none(anchor)){anchor=selTop}if(extend){if(selBottom>anchor){selBottom=selBottom-numberOfItems}else{selTop=this._findPreviousSelectableItemFromIndex(selTop-numberOfItems)}if(SC.none(selTop)||(selTop<0)){selTop=0}if(selBottom<selTop){selBottom=selTop}}else{selTop=this._findPreviousSelectableItemFromIndex(selTop-numberOfItems);if(SC.none(selTop)||(selTop<0)){selTop=0}selBottom=selTop;anchor=null}var scrollToIndex=selTop;sel=SC.IndexSet.create(selTop,selBottom+1-selTop);this.scrollToContentIndex(scrollToIndex);this.select(sel);this._selectionAnchor=anchor;return this},selectNextItem:function(extend,numberOfItems){if(SC.none(numberOfItems)){numberOfItems=1}if(SC.none(extend)){extend=false}var sel=this.get("selection"),content=this.get("content");if(sel){sel=sel.indexSetForSource(content)}var selTop=sel?sel.get("min"):-1,selBottom=sel?sel.get("max")-1:-1,anchor=this._selectionAnchor,lim=this.get("length");if(SC.none(anchor)){anchor=selTop}if(extend){if(selTop<anchor){selTop=selTop+numberOfItems}else{selBottom=this._findNextSelectableItemFromIndex(selBottom+numberOfItems,selBottom)}if(selBottom>=lim){selBottom=lim-1}if(selTop>selBottom){selTop=selBottom}}else{selBottom=this._findNextSelectableItemFromIndex(selBottom+numberOfItems,selBottom);if(selBottom>=lim){selBottom=lim-1}selTop=selBottom;anchor=null}var scrollToIndex=selBottom;sel=SC.IndexSet.create(selTop,selBottom-selTop+1);this.scrollToContentIndex(scrollToIndex);this.select(sel);this._selectionAnchor=anchor;return this},deleteSelection:function(){if(!this.get("canDeleteContent")){return NO}var sel=this.get("selection"),content=this.get("content"),del=this.get("selectionDelegate"),indexes=sel&&content?sel.indexSetForSource(content):null;if(!content||!indexes||indexes.get("length")===0){return NO}indexes=del.collectionViewShouldDeleteIndexes(this,indexes);if(!indexes||indexes.get("length")===0){return NO}del.collectionViewDeleteContent(this,this.get("content"),indexes);return YES},scrollToContentIndex:function(contentIndex){var itemView=this.itemViewForContentIndex(contentIndex);if(itemView){this.scrollToItemView(itemView)}return this},scrollToItemView:function(view){if(view){view.scrollToVisible()}return this},keyDown:function(evt){var ret=this.interpretKeyEvents(evt);return !ret?NO:ret},keyUp:function(){return true},insertText:function(chr,evt){if(chr===" "){var sel=this.get("selection");if(sel&&sel.get("length")>0){this.invokeLater(this._cv_action,0,null,evt)}return YES}else{return NO}},selectAll:function(evt){var content=this.get("content"),sel=content?SC.IndexSet.create(0,content.get("length")):null;this.select(sel,NO);return YES},deleteBackward:function(evt){return this.deleteSelection()},deleteForward:function(evt){return this.deleteSelection()},moveDown:function(sender,evt){this.selectNextItem(false,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,evt,this.ACTION_DELAY);return true},moveUp:function(sender,evt){this.selectPreviousItem(false,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,evt,this.ACTION_DELAY);return true},moveLeft:function(sender,evt){if((this.get("itemsPerRow")||1)>1){this.selectPreviousItem(false,1);this._cv_performSelectAction(null,evt,this.ACTION_DELAY)}else{var sel=this.get("selection"),content=this.get("content"),indexes=sel?sel.indexSetForSource(content):null;if(indexes){var del=undefined,selectParent=false,index=undefined;if(indexes.get("length")===1){index=indexes.get("firstObject");del=this.get("contentDelegate");var state=del.contentIndexDisclosureState(this,content,index);if(state!==SC.BRANCH_OPEN){selectParent=true}}if(selectParent){var desiredOutlineLevel=del.contentIndexOutlineLevel(this,content,index)-1;if(desiredOutlineLevel>=0){var parentIndex=-1;while(parentIndex<0){var previousItemIndex=this._findPreviousSelectableItemFromIndex(index-1);if(previousItemIndex<0){return false}index=previousItemIndex;var outlineLevel=del.contentIndexOutlineLevel(this,content,index);if(outlineLevel===desiredOutlineLevel){parentIndex=previousItemIndex}}if(parentIndex!==-1){this.select(index)}}}else{this.collapse(indexes)}}}return true},moveRight:function(sender,evt){if((this.get("itemsPerRow")||1)>1){this.selectNextItem(false,1);this._cv_performSelectAction(null,evt,this.ACTION_DELAY)}else{var sel=this.get("selection"),content=this.get("content"),indexes=sel?sel.indexSetForSource(content):null;if(indexes){this.expand(indexes)}}return true},moveDownAndModifySelection:function(sender,evt){this.selectNextItem(true,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,evt,this.ACTION_DELAY);return true},moveUpAndModifySelection:function(sender,evt){this.selectPreviousItem(true,this.get("itemsPerRow")||1);this._cv_performSelectAction(null,evt,this.ACTION_DELAY);return true},moveLeftAndModifySelection:function(sender,evt){if((this.get("itemsPerRow")||1)>1){this.selectPreviousItem(true,1);this._cv_performSelectAction(null,evt,this.ACTION_DELAY)}return true},moveRightAndModifySelection:function(sender,evt){if((this.get("itemsPerRow")||1)>1){this.selectNextItem(true,1);this._cv_performSelectAction(null,evt,this.ACTION_DELAY)}return true},insertNewline:function(sender,evt){var canEdit=this.get("isEditable")&&this.get("canEditContent"),sel,content,set,idx,itemView;if(canEdit){sel=this.get("selection");content=this.get("content");if(sel&&sel.get("length")===1){set=sel.indexSetForSource(content);idx=set?set.get("min"):-1;canEdit=idx>=0}}if(canEdit){itemView=this.itemViewForContentIndex(idx);canEdit=itemView&&SC.typeOf(itemView.beginEditing)===SC.T_FUNCTION}if(canEdit){this.scrollToContentIndex(idx);itemView=this.itemViewForContentIndex(idx);itemView.beginEditing()}else{this.invokeLater(this._cv_action,0,itemView,null)}return YES},mouseDown:function(ev){if(this.get("useToggleSelection")){return true}var itemView=this.itemViewForEvent(ev),content=this.get("content"),contentIndex=itemView?itemView.get("contentIndex"):-1,info,anchor;info=this.mouseDownInfo={event:ev,itemView:itemView,contentIndex:contentIndex,at:Date.now()};this.becomeFirstResponder();if(!itemView){if(this.get("allowDeselectAll")){this.select(null,false)}return YES}var sel=this.get("selection"),isSelected,modifierKeyPressed;if(sel){sel=sel.indexSetForSource(content)}isSelected=sel?sel.contains(contentIndex):NO;info.modifierKeyPressed=modifierKeyPressed=ev.ctrlKey||ev.metaKey;if(modifierKeyPressed&&isSelected){info.shouldDeselect=contentIndex>=0}else{if(ev.shiftKey&&sel&&sel.get("length")>0){sel=this._findSelectionExtendedByShift(sel,contentIndex);anchor=this._selectionAnchor;this.select(sel);this._selectionAnchor=anchor}else{if(!modifierKeyPressed&&isSelected){info.shouldReselect=contentIndex>=0}else{if(this.get("selectOnMouseDown")){this.select(contentIndex,modifierKeyPressed)}else{info.shouldSelect=contentIndex>=0}}}}info.previousContentIndex=contentIndex;return YES},mouseUp:function(ev){var view=this.itemViewForEvent(ev),info=this.mouseDownInfo,contentIndex,sel,isSelected,canEdit,itemView,content,idx;if(this.get("useToggleSelection")){if(!view){return}sel=this.get("selection");contentIndex=(view)?view.get("contentIndex"):-1;isSelected=sel&&sel.include(contentIndex);if(isSelected){this.deselect(contentIndex)}else{this.select(contentIndex,YES)}}else{if(info){idx=info.contentIndex;contentIndex=(view)?view.get("contentIndex"):-1;if(info.shouldSelect){this.select(idx,info.modifierKeyPressed)}if(info.shouldDeselect){this.deselect(idx)}if(info.shouldReselect){canEdit=this.get("isEditable")&&this.get("canEditContent");if(canEdit){sel=this.get("selection");canEdit=sel&&(sel.get("length")===1)}if(canEdit){itemView=this.itemViewForContentIndex(idx);canEdit=itemView&&(!itemView.contentHitTest||itemView.contentHitTest(ev));canEdit=(canEdit&&itemView.beginEditing)?itemView.beginEditing():NO}if(!canEdit){if(this._cv_reselectTimer){this._cv_reselectTimer.invalidate()}this._cv_reselectTimer=this.invokeLater(this.select,300,idx,false)}}this._cleanupMouseDown()}}this._cv_performSelectAction(view,ev,0,ev.clickCount);return NO},_cleanupMouseDown:function(){var info=this.mouseDownInfo,key;if(info){for(key in info){if(!info.hasOwnProperty(key)){continue}delete info[key]}}this.mouseDownInfo=null},mouseMoved:function(ev){var view=this.itemViewForEvent(ev),last=this._lastHoveredItem;if(view!==last){if(last&&last.mouseOut){last.mouseOut(ev)}if(view&&view.mouseOver){view.mouseOver(ev)}}this._lastHoveredItem=view;if(view&&view.mouseMoved){view.mouseMoved(ev)}return YES},mouseOut:function(ev){var view=this._lastHoveredItem;this._lastHoveredItem=null;if(view&&view.mouseOut){view.mouseOut(ev)}return YES},touchStart:function(ev){if(this.get("useToggleSelection")){return true}var itemView=this.itemViewForEvent(ev),content=this.get("content"),contentIndex=itemView?itemView.get("contentIndex"):-1,info,anchor;this.becomeFirstResponder();this.select(contentIndex,NO);return SC.MIXED_STATE},touchDragged:function(evt){this.select(null,NO);return SC.MIXED_STATE},touchCancelled:function(evt){this.select(null,NO)},_findSelectionExtendedByShift:function(sel,contentIndex){if(!sel||sel.get("length")===0){return SC.IndexSet.create(contentIndex)}var content=this.get("content"),lim=content.get("length")-1,min=sel.get("min"),max=sel.get("max")-1,info=this.mouseDownInfo,anchor=this._selectionAnchor;if(SC.none(anchor)){anchor=-1}if(contentIndex<min){min=contentIndex;if(anchor<0){this._selectionAnchor=anchor=max}}else{if(contentIndex>max){max=contentIndex;if(anchor<0){this._selectionAnchor=anchor=min}}else{if(contentIndex>=min&&contentIndex<=max){if(anchor<0){this._selectionAnchor=anchor=min}if(contentIndex===anchor){min=max=contentIndex}else{if(contentIndex>anchor){min=anchor;max=contentIndex}else{if(contentIndex<anchor){min=contentIndex;max=anchor}}}}}}return SC.IndexSet.create(min,max-min+1)},reorderDataType:function(){return"SC.CollectionView.Reorder."+SC.guidFor(this)}.property().cacheable(),dragContent:null,proposedInsertionIndex:null,proposedDropOperation:null,mouseDragged:function(ev){var del=this.get("selectionDelegate"),content=this.get("content"),sel=this.get("selection"),info=this.mouseDownInfo,groupIndexes=this.get("_contentGroupIndexes"),dragContent,dragDataTypes,dragView;if(!info||info.contentIndex<0){return YES}if((Date.now()-info.at)<123){return YES}if(del.collectionViewShouldBeginDrag(this)){if(!this.get("selectOnMouseDown")){dragContent=SC.IndexSet.create(info.contentIndex)}else{dragContent=sel?sel.indexSetForSource(content):null}if(dragContent&&groupIndexes&&groupIndexes.get("length")>0){dragContent=dragContent.copy().remove(groupIndexes);if(dragContent.get("length")===0){dragContent=null}else{dragContent.freeze()}}if(!dragContent){return YES}else{dragContent=dragContent.frozenCopy()}dragContent={content:content,indexes:dragContent};this.set("dragContent",dragContent);dragDataTypes=this.get("dragDataTypes");if(dragDataTypes&&dragDataTypes.get("length")>0){dragView=del.collectionViewDragViewFor(this,dragContent.indexes);if(!dragView){dragView=this._cv_dragViewFor(dragContent.indexes)}dragView.createLayer();SC.Drag.start({event:info.event,source:this,dragView:dragView,ghost:NO,ghostActsLikeCursor:del.ghostActsLikeCursor,slideBack:YES,dataSource:this});this._cleanupMouseDown();this._lastInsertionIndex=null}else{this.set("dragContent",null)}return YES}},_cv_dragViewFor:function(dragContent){var indexes=this.get("nowShowing").without(dragContent);indexes=this.get("nowShowing").without(indexes);var dragLayer=this.get("layer").cloneNode(false);var view=SC.View.create({layer:dragLayer,parentView:this});SC.$(dragLayer).css("backgroundColor","transparent").css("border","none").css("top",0).css("left",0);indexes.forEach(function(i){var itemView=this.itemViewForContentIndex(i),isSelected,layer;if(itemView){isSelected=itemView.get("isSelected");itemView.set("isSelected",NO);itemView.updateLayerIfNeeded();layer=itemView.get("layer");if(layer){layer=layer.cloneNode(true)}itemView.set("isSelected",isSelected);itemView.updateLayerIfNeeded()}if(layer){dragLayer.appendChild(layer)}layer=null},this);dragLayer=null;return view},dragDataTypes:function(){var del=this.get("selectionDelegate"),ret=del.collectionViewDragDataTypes(this),key;if(this.get("canReorderContent")){ret=ret?ret.copy():[];key=this.get("reorderDataType");if(ret.indexOf(key)<0){ret.push(key)}}return ret?ret:[]}.property(),dragDataForType:function(drag,dataType){if(this.get("canReorderContent")){if(dataType===this.get("reorderDataType")){return this.get("dragContent")}}var del=this.get("selectionDelegate");return del.collectionViewDragDataForType(this,drag,dataType)},computeDragOperations:function(drag,evt){var op=SC.DRAG_NONE,del=this.get("selectionDelegate");if(this.get("canReorderContent")){if(drag.get("dataTypes").indexOf(this.get("reorderDataType"))>=0){op=SC.DRAG_REORDER}}op=del.collectionViewComputeDragOperations(this,drag,op);if(op&SC.DRAG_REORDER){op=SC.DRAG_MOVE}return op},_computeDropOperationState:function(drag,evt,dragOp){var loc=this.convertFrameFromView(drag.get("location"),null),dropOp=SC.DROP_BEFORE,del=this.get("selectionDelegate"),canReorder=this.get("canReorderContent"),objects,content,isPreviousInDrag,isNextInDrag,len,tmp;var idx=this.insertionIndexForLocation(loc,SC.DROP_ON);if(SC.typeOf(idx)===SC.T_ARRAY){dropOp=idx[1];idx=idx[0]}if(dropOp===SC.DROP_ON){this.set("proposedInsertionIndex",idx);this.set("proposedDropOperation",dropOp);tmp=del.collectionViewValidateDragOperation(this,drag,dragOp,idx,dropOp);idx=this.get("proposedInsertionIndex");dropOp=this.get("proposedDropOperation");this._dropInsertionIndex=this._dropOperation=null;if(tmp!==SC.DRAG_NONE){return[idx,dropOp,tmp]}else{dropOp=SC.DROP_BEFORE;idx=this.insertionIndexForLocation(loc,SC.DROP_BEFORE);if(SC.typeOf(idx)===SC.T_ARRAY){dropOp=idx[1];idx=idx[0]}}}if((idx>=0)&&canReorder&&(dropOp!==SC.DROP_ON)){objects=drag.dataForType(this.get("reorderDataType"));if(objects){content=this.get("content");if(dropOp===SC.DROP_BEFORE){isPreviousInDrag=objects.indexes.contains(idx-1);isNextInDrag=objects.indexes.contains(idx)}else{isPreviousInDrag=objects.indexes.contains(idx);isNextInDrag=objects.indexes.contains(idx-1)}if(isPreviousInDrag&&isNextInDrag){if(SC.none(this._lastInsertionIndex)){if(dropOp===SC.DROP_BEFORE){while((idx>=0)&&objects.indexes.contains(idx)){idx--}}else{len=content?content.get("length"):0;while((idx<len)&&objects.indexes.contains(idx)){idx++}}}else{idx=this._lastInsertionIndex}}if(idx>=0){dragOp=SC.DRAG_REORDER}}}this.set("proposedInsertionIndex",idx);this.set("proposedDropOperation",dropOp);dragOp=del.collectionViewValidateDragOperation(this,drag,dragOp,idx,dropOp);idx=this.get("proposedInsertionIndex");dropOp=this.get("proposedDropOperation");this._dropInsertionIndex=this._dropOperation=null;return[idx,dropOp,dragOp]},dragUpdated:function(drag,evt){var op=drag.get("allowedDragOperations"),state=this._computeDropOperationState(drag,evt,op),idx=state[0],dropOp=state[1],dragOp=state[2];if(dragOp!==SC.DRAG_NONE){if((this._lastInsertionIndex!==idx)||(this._lastDropOperation!==dropOp)){var itemView=this.itemViewForContentIndex(idx);this.showInsertionPoint(itemView,dropOp)}this._lastInsertionIndex=idx;this._lastDropOperation=dropOp}else{this.hideInsertionPoint();this._lastInsertionIndex=this._lastDropOperation=null}return(dragOp&SC.DRAG_REORDER)?SC.DRAG_MOVE:dragOp},dragExited:function(){this.hideInsertionPoint();this._lastInsertionIndex=this._lastDropOperation=null},acceptDragOperation:function(drag,op){return YES},performDragOperation:function(drag,op){var state=this._computeDropOperationState(drag,null,op),idx=state[0],dropOp=state[1],dragOp=state[2],del=this.get("selectionDelegate"),performed,objects,data,content,shift,indexes;if(dragOp&SC.DRAG_REORDER){op=(op&SC.DRAG_MOVE)?SC.DRAG_REORDER:SC.DRAG_NONE}else{op=op&dragOp}if(op===SC.DRAG_NONE){return op}performed=del.collectionViewPerformDragOperation(this,drag,op,idx,dropOp);if((performed===SC.DRAG_NONE)&&(op&SC.DRAG_REORDER)){data=drag.dataForType(this.get("reorderDataType"));if(!data){return SC.DRAG_NONE}content=this.get("content");indexes=data.indexes;if(indexes.get("length")===1){if(((dropOp===SC.DROP_BEFORE)||(dropOp===SC.DROP_AFTER))&&(indexes.get("min")===idx)){return SC.DRAG_MOVE}}content.beginPropertyChanges();objects=[];shift=0;data.indexes.forEach(function(i){objects.push(content.objectAt(i-shift));content.removeAt(i-shift);shift++;if(i<idx){idx--}},this);if(dropOp===SC.DROP_AFTER){idx++}content.replace(idx,0,objects,dropOp);this.select(SC.IndexSet.create(idx,objects.length));content.endPropertyChanges();op=SC.DRAG_MOVE}return op},collectionViewShouldBeginDrag:function(view){return this.get("canReorderContent")},insertionIndexForLocation:function(loc,dropOperation){return -1},_cv_isVisibleInWindowDidChange:function(){if(this.get("isVisibleInWindow")){if(this._invalidIndexes){this.invokeOnce(this.reloadIfNeeded)}if(this._invalidSelection){this.invokeOnce(this.reloadSelectionIndexesIfNeeded)}}}.observes("isVisibleInWindow"),collectionViewShouldSelectItem:function(view,item){return this.get("isSelectable")},_TMP_DIFF1:SC.IndexSet.create(),_TMP_DIFF2:SC.IndexSet.create(),_cv_nowShowingDidChange:function(){var nowShowing=this.get("nowShowing"),last=this._sccv_lastNowShowing,diff,diff1,diff2;if(last!==nowShowing){if(last&&nowShowing){diff1=this._TMP_DIFF1.add(last).remove(nowShowing);diff2=this._TMP_DIFF2.add(nowShowing).remove(last);diff=diff1.add(diff2)}else{diff=last||nowShowing}}if(diff&&diff.get("length")>0){this._sccv_lastNowShowing=nowShowing?nowShowing.frozenCopy():null;this.updateContentRangeObserver();this.reload(diff)}if(diff1){diff1.clear()}if(diff2){diff2.clear()}}.observes("nowShowing"),init:function(){arguments.callee.base.apply(this,arguments);if(this.get("canReorderContent")){this._cv_canReorderContentDidChange()}this._sccv_lastNowShowing=this.get("nowShowing").clone();if(this.content){this._cv_contentDidChange()}if(this.selection){this._cv_selectionDidChange()}},_cv_canReorderContentDidChange:function(){if(this.get("canReorderContent")){if(!this.get("isDropTarget")){this.set("isDropTarget",YES)}SC.Drag.addDropTarget(this)}}.observes("canReorderContent"),_cv_performSelectAction:function(view,ev,delay,clickCount){var sel;if(delay===undefined){delay=0}if(clickCount===undefined){clickCount=1}if((clickCount>1)||this.get("actOnSelect")){if(this._cv_reselectTimer){this._cv_reselectTimer.invalidate()}sel=this.get("selection");sel=sel?sel.toArray():[];if(this._cv_actionTimer){this._cv_actionTimer.invalidate()}this._cv_actionTimer=this.invokeLater(this._cv_action,delay,view,ev,sel)}},_cv_action:function(view,evt,context){var action=this.get("action");var target=this.get("target")||null;this._cv_actionTimer=null;if(action){if(SC.typeOf(action)===SC.T_FUNCTION){return this.action(view,evt)}var pane=this.get("pane");if(pane){pane.rootResponder.sendAction(action,target,this,pane,context)}}else{if(!view){return}else{if(SC.typeOf(view._action)==SC.T_FUNCTION){return view._action(evt)}else{if(SC.typeOf(view.action)==SC.T_FUNCTION){return view.action(evt)}}}}}});SC.DisclosureView=SC.ButtonView.extend({classNames:["sc-disclosure-view"],theme:"disclosure",buttonBehavior:SC.TOGGLE_BEHAVIOR,toggleOnValue:YES,toggleOffValue:NO,valueBindingDefault:SC.Binding.bool(),render:function(context,firstTime){var title=this.get("displayTitle");if(firstTime){context.push('<img src="',SC.BLANK_IMAGE_URL,'" class="button" alt="" />');if(this.get("needsEllipsis")){context.push('<span class="ellipsis sc-button-label">',title,"</span>")}else{context.push('<span class="sc-button-label">',title,"</span>")}}else{this.$("label").text(title)}},keyDown:function(evt){if(evt.which===37||evt.which===38){this.set("value",this.get("toggleOffValue"));return YES}if(evt.which===39||evt.which===40){this.set("value",this.get("toggleOnValue"));return YES}arguments.callee.base.apply(this,arguments)}});sc_require("views/collection");sc_require("mixins/collection_row_delegate");SC.ListView=SC.CollectionView.extend(SC.CollectionRowDelegate,{classNames:["sc-list-view"],acceptsFirstResponder:YES,showAlternatingRows:NO,render:function(context,firstTime){context.setClass("alternating",this.get("showAlternatingRows"));return arguments.callee.base.apply(this,arguments)},rowDelegate:function(){var del=this.delegate,content=this.get("content");return this.delegateFor("isCollectionRowDelegate",del,content)}.property("delegate","content").cacheable(),_sclv_rowDelegateDidChange:function(){var last=this._sclv_rowDelegate,del=this.get("rowDelegate"),func=this._sclv_rowHeightDidChange,func2=this._sclv_customRowHeightIndexesDidChange;if(last===del){return this}this._sclv_rowDelegate=del;if(last){last.removeObserver("rowHeight",this,func);last.removeObserver("customRowHeightIndexes",this,func2)}if(!del){throw"Internal Inconsistancy: ListView must always have CollectionRowDelegate"}del.addObserver("rowHeight",this,func);del.addObserver("customRowHeightIndexes",this,func2);this._sclv_rowHeightDidChange()._sclv_customRowHeightIndexesDidChange();return this}.observes("rowDelegate"),_sclv_rowHeightDidChange:function(){var del=this.get("rowDelegate"),height=del.get("rowHeight"),indexes;if(height===this._sclv_rowHeight){return this}this._sclv_rowHeight=height;indexes=SC.IndexSet.create(0,this.get("length"));this.rowHeightDidChangeForIndexes(indexes);return this},_sclv_customRowHeightIndexesDidChange:function(){var del=this.get("rowDelegate"),indexes=del.get("customRowHeightIndexes"),last=this._sclv_customRowHeightIndexes,func=this._sclv_customRowHeightIndexesContentDidChange;if((indexes===last)||(last&&last.isEqual(indexes))){return this}if(last&&this._sclv_isObservingCustomRowHeightIndexes){last.removeObserver("[]",this,func)}if(this._sclv_isObservingCustomRowHeightIndexes=indexes&&!indexes.get("isFrozen")){indexes.addObserver("[]",this,func)}this._sclv_customRowHeightIndexesContentDidChange();return this},_sclv_customRowHeightIndexesContentDidChange:function(){var del=this.get("rowDelegate"),indexes=del.get("customRowHeightIndexes"),last=this._sclv_customRowHeightIndexes,changed;if(indexes&&last){changed=indexes.copy().add(last)}else{changed=indexes||last}this._sclv_customRowHeightIndexes=indexes?indexes.frozenCopy():null;this.rowHeightDidChangeForIndexes(changed);return this},rowOffsetForContentIndex:function(idx){if(idx===0){return 0}var del=this.get("rowDelegate"),rowHeight=del.get("rowHeight"),rowSpacing,ret,custom,cache,delta,max,content;ret=idx*rowHeight;rowSpacing=this.get("rowSpacing");if(rowSpacing){ret+=idx*rowSpacing}if(del.customRowHeightIndexes&&(custom=del.get("customRowHeightIndexes"))){cache=this._sclv_offsetCache;if(!cache){cache=this._sclv_offsetCache=[];delta=max=0;custom.forEach(function(idx){delta+=this.rowHeightForContentIndex(idx)-rowHeight;cache[idx+1]=delta;max=idx},this);this._sclv_max=max+1}delta=cache[idx];if(delta===undefined){delta=cache[idx]=cache[idx-1];if(delta===undefined){max=this._sclv_max;if(idx<max){max=custom.indexBefore(idx)+1}delta=cache[idx]=cache[max]||0}}ret+=delta}return ret},rowHeightForContentIndex:function(idx){var del=this.get("rowDelegate"),ret,cache,content,indexes;if(del.customRowHeightIndexes&&(indexes=del.get("customRowHeightIndexes"))){cache=this._sclv_heightCache;if(!cache){cache=this._sclv_heightCache=[];content=this.get("content");indexes.forEach(function(idx){cache[idx]=del.contentIndexRowHeight(this,content,idx)},this)}ret=cache[idx];if(ret===undefined){ret=del.get("rowHeight")}}else{ret=del.get("rowHeight")}return ret},rowHeightDidChangeForIndexes:function(indexes){var len=this.get("length");this._sclv_heightCache=this._sclv_offsetCache=null;if(indexes&&indexes.isIndexSet){indexes=indexes.get("min")}this.reload(SC.IndexSet.create(indexes,len-indexes));return this},computeLayout:function(){var ret=this._sclv_layout;if(!ret){ret=this._sclv_layout={}}ret.minHeight=this.rowOffsetForContentIndex(this.get("length"))+4;this.set("calculatedHeight",ret.minHeight);return ret},layoutForContentIndex:function(contentIndex){return{top:this.rowOffsetForContentIndex(contentIndex),height:this.rowHeightForContentIndex(contentIndex),left:0,right:0}},contentIndexesInRect:function(rect){var rowHeight=this.get("rowDelegate").get("rowHeight"),top=SC.minY(rect),bottom=SC.maxY(rect),height=rect.height||0,len=this.get("length"),offset,start,end;start=(top-(top%rowHeight))/rowHeight;offset=this.rowOffsetForContentIndex(start);while(start>0&&offset>=top){start--;offset-=this.rowHeightForContentIndex(start)}offset+=this.rowHeightForContentIndex(start);while(start<len&&offset<top){offset+=this.rowHeightForContentIndex(start);start++}if(start<0){start=0}if(start>=len){start=len}end=start+((height-(height%rowHeight))/rowHeight);if(end>len){end=len}offset=this.rowOffsetForContentIndex(end);while(end>=start&&offset>=bottom){end--;offset-=this.rowHeightForContentIndex(end)}offset+=this.rowHeightForContentIndex(end);while(end<len&&offset<=bottom){offset+=this.rowHeightForContentIndex(end);end++}end++;if(end<start){end=start}if(end>len){end=len}return SC.IndexSet.create(start,end-start)},insertionPointView:SC.View.extend({classNames:"sc-list-insertion-point",render:function(context,firstTime){if(firstTime){context.push('<div class="anchor"></div>')}}}),showInsertionPoint:function(itemView,dropOperation){var view=this._insertionPointView;if(!view){view=this._insertionPointView=this.get("insertionPointView").create()}var index=itemView.get("contentIndex"),len=this.get("length"),layout=SC.clone(itemView.get("layout")),level=itemView.get("outlineLevel"),indent=itemView.get("outlineIndent")||0,group;if((index>=len)&&index>0){group=this.itemViewForContentIndex(len-1);if(group.get("isGroupView")){level=1;indent=group.get("outlineIndent")}}if(SC.none(level)){level=-1}if(dropOperation&SC.DROP_ON){this.hideInsertionPoint();itemView.set("isSelected",YES);this._lastDropOnView=itemView}else{if(this._lastDropOnView){this._lastDropOnView.set("isSelected",NO);this._lastDropOnView=null}if(dropOperation&SC.DROP_AFTER){layout.top+=layout.height}layout.height=2;layout.right=0;layout.left=((level+1)*indent)+12;delete layout.width;view.set("layout",layout);this.appendChild(view)}},hideInsertionPoint:function(){if(this._lastDropOnView){this._lastDropOnView.set("isSelected",NO);this._lastDropOnView=null}var view=this._insertionPointView;if(view){view.removeFromParent().destroy()}this._insertionPointView=null},insertionIndexForLocation:function(loc,dropOperation){var indexes=this.contentIndexesInRect(loc),index=indexes.get("min"),len=this.get("length"),min,max,diff,clevel,cindent,plevel,pindent,itemView,pgroup;if(SC.none(index)||index<0){if((len===0)||(loc.y<=this.rowOffsetForContentIndex(0))){index=0}else{if(loc.y>=this.rowOffsetForContentIndex(len)){index=len}}}min=this.rowOffsetForContentIndex(index);max=min+this.rowHeightForContentIndex(index);if(dropOperation==SC.DROP_ON){if(this.get("isEditable")){diff=Math.min(Math.floor((max-min)*0.2),5)}else{diff=0}if(loc.y>=(min+diff)||loc.y<=(max+diff)){return[index,SC.DROP_ON]}}if((index<len)&&(loc.y>=max-10)){index++}if(index>0){itemView=this.itemViewForContentIndex(index-1);pindent=(itemView?itemView.get("outlineIndent"):0)||0;plevel=itemView?itemView.get("outlineLevel"):0;if(index<len){itemView=this.itemViewForContentIndex(index);clevel=itemView?itemView.get("outlineLevel"):0;cindent=(itemView?itemView.get("outlineIndent"):0)||0;cindent*=clevel}else{clevel=itemView.get("isGroupView")?1:0;cindent=pindent*clevel}pindent*=plevel;if((clevel!==plevel)&&(cindent!==pindent)){if(pindent>cindent){index--;dropOperation=SC.DROP_AFTER}}}if(dropOperation===SC.DROP_BEFORE){itemView=(index<len)?this.itemViewForContentIndex(index):null;if(!itemView||itemView.get("isGroupView")){if(index>0){itemView=this.itemViewForContentIndex(index-1);if(!itemView.get("isGroupView")||(itemView.get("disclosureState")===SC.BRANCH_OPEN)){index=index-1;dropOperation=SC.DROP_AFTER}else{index=-1}}else{index=-1}}if(index<0){dropOperation=SC.DRAG_NONE}}return[index,dropOperation]},mouseWheel:function(evt){var inlineEditor=SC.InlineTextFieldView.editor;if(inlineEditor&&inlineEditor.get("isEditing")){if(inlineEditor.get("delegate").get("displayDelegate")===this){SC.InlineTextFieldView.commitEditing()}}return NO},init:function(){arguments.callee.base.apply(this,arguments);this._sclv_rowDelegateDidChange()}});sc_require("views/list");SC.GridView=SC.ListView.extend({classNames:["sc-grid-view"],layout:{left:0,right:0,top:0,bottom:0},rowHeight:48,columnWidth:64,exampleView:SC.LabelView,insertionOrientation:SC.HORIZONTAL_ORIENTATION,itemsPerRow:function(){var f=this.get("frame"),columnWidth=this.get("columnWidth")||0;return(columnWidth<=0)?1:Math.floor(f.width/columnWidth)}.property("clippingFrame","columnWidth").cacheable(),contentIndexesInRect:function(rect){var rowHeight=this.get("rowHeight")||48,itemsPerRow=this.get("itemsPerRow"),min=Math.floor(SC.minY(rect)/rowHeight)*itemsPerRow,max=Math.ceil(SC.maxY(rect)/rowHeight)*itemsPerRow;return SC.IndexSet.create(min,max-min)},layoutForContentIndex:function(contentIndex){var rowHeight=this.get("rowHeight")||48,frameWidth=this.get("clippingFrame").width,itemsPerRow=this.get("itemsPerRow"),columnWidth=Math.floor(frameWidth/itemsPerRow),row=Math.floor(contentIndex/itemsPerRow),col=contentIndex-(itemsPerRow*row);return{left:col*columnWidth,top:row*rowHeight,height:rowHeight,width:columnWidth}},computeLayout:function(){var content=this.get("content"),count=(content)?content.get("length"):0,rowHeight=this.get("rowHeight")||48,itemsPerRow=this.get("itemsPerRow"),rows=Math.ceil(count/itemsPerRow);var ret=this._cachedLayoutHash;if(!ret){ret=this._cachedLayoutHash={}}ret.minHeight=rows*rowHeight;this.calculatedHeight=ret.minHeight;return ret},insertionPointClass:SC.View.extend({classNames:["grid-insertion-point"],render:function(context,firstTime){if(firstTime){context.push('<span class="anchor"></span>')}}}),showInsertionPoint:function(itemView,dropOperation){if(!itemView){return}if(dropOperation===SC.DROP_ON){if(itemView!==this._dropOnInsertionPoint){this.hideInsertionPoint();itemView.addClassName("drop-target");this._dropOnInsertionPoint=itemView}}else{if(this._dropOnInsertionPoint){this._dropOnInsertionPoint.removeClassName("drop-target");this._dropOnInsertionPoint=null}if(!this._insertionPointView){this._insertionPointView=this.insertionPointClass.create()}var insertionPoint=this._insertionPointView;var itemViewFrame=itemView.get("frame");var f={height:itemViewFrame.height-6,x:itemViewFrame.x,y:itemViewFrame.y+6,width:0};if(!SC.rectsEqual(insertionPoint.get("frame"),f)){insertionPoint.set("frame",f)}if(insertionPoint.parentNode!=itemView.parentNode){itemView.parentNode.appendChild(insertionPoint)}}},hideInsertionPoint:function(){var insertionPoint=this._insertionPointView;if(insertionPoint){insertionPoint.removeFromParent()}if(this._dropOnInsertionPoint){this._dropOnInsertionPoint.removeClassName("drop-target");this._dropOnInsertionPoint=null}},insertionIndexForLocation:function(loc,dropOperation){var f=this.get("frame"),sf=this.get("scrollFrame"),itemsPerRow=this.get("itemsPerRow"),columnWidth=Math.floor(f.width/itemsPerRow),row=Math.floor((loc.y-f.y-sf.y)/this.get("rowHeight"));var retOp=SC.DROP_BEFORE,offset=(loc.x-f.x-sf.x),col=Math.floor(offset/columnWidth),percentage=(offset/columnWidth)-col;if(dropOperation===SC.DROP_ON){if(percentage>0.8){col++}if((percentage>=0.2)&&(percentage<=0.8)){retOp=SC.DROP_ON}}else{if(percentage>0.45){col++}}var ret=(row*itemsPerRow)+col;return[ret,retOp]},_gv_clippingFrameDidChange:function(){var nowShowing=this.get("nowShowing"),itemView,idx,len;this.notifyPropertyChange("itemsPerRow");len=nowShowing.get("length");for(idx=0;idx<len;idx++){itemView=this.itemViewForContentIndex(idx);itemView.adjust(this.layoutForContentIndex(idx))}}.observes("clippingFrame")});SC.ScrollerView=SC.View.extend({classNames:["sc-scroller-view"],value:function(key,val){var minimum=this.get("minimum");if(val!==undefined){this._scs_value=val}val=this._scs_value||minimum;return Math.max(Math.min(val,this.get("maximum")),minimum)}.property("maximum","minimum").cacheable(),proportion:0,maximum:100,minimum:0,isEnabled:YES,layoutDirection:SC.LAYOUT_VERTICAL,hasButtons:YES,scrollbarThickness:14,capLength:18,capOverlap:14,buttonLength:41,buttonOverlap:11,displayProperties:"thumbPosition thumbLength isEnabled controlsHidden".w(),render:function(context,firstTime){var classNames=[],buttons="",thumbPosition,thumbLength,thumbCenterLength,thumbElement,value,max,scrollerLength,length,pct;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:classNames.push("sc-vertical");break;case SC.LAYOUT_HORIZONTAL:classNames.push("sc-horizontal");break}if(!this.get("isEnabled")){classNames.push("disabled")}if(this.get("controlsHidden")){classNames.push("controls-hidden")}context.addClass(classNames);thumbLength=this.get("thumbLength");thumbPosition=this.get("thumbPosition");if(firstTime){if(this.get("hasButtons")){buttons='<div class="button-bottom"></div><div class="button-top"></div>'}else{buttons='<div class="endcap"></div>'}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:context.push('<div class="track"></div>','<div class="cap"></div>',buttons,'<div class="thumb" style="height: '+thumbLength+'px;">','<div class="thumb-center"></div>','<div class="thumb-top"></div>','<div class="thumb-bottom"></div></div>');break;case SC.LAYOUT_HORIZONTAL:context.push('<div class="track"></div>','<div class="cap"></div>',buttons,'<div class="thumb" style="width: '+thumbLength+'px;">','<div class="thumb-center"></div>','<div class="thumb-top"></div>','<div class="thumb-bottom"></div></div>')}}else{if(this.get("controlsHidden")){return}thumbElement=this.$(".thumb");this.adjustThumbSize(thumbElement,thumbLength);this.adjustThumbPosition(thumbElement,thumbPosition)}},adjustThumbPosition:function(thumb,position){if(this._thumbPosition===position){return}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:thumb.css("top",position);break;case SC.LAYOUT_HORIZONTAL:thumb.css("left",position);break}this._thumbPosition=position},adjustThumbSize:function(thumb,size){if(this._thumbSize===size){return}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:thumb.css("height",Math.max(size,20));break;case SC.LAYOUT_HORIZONTAL:thumb.css("width",Math.max(size,20));break}this._thumbSize=size},trackLength:function(){var scrollerLength=this.get("scrollerLength");scrollerLength-=this.capLength-this.capOverlap;scrollerLength-=this.buttonLength-this.buttonOverlap;return scrollerLength}.property("scrollerLength").cacheable(),scrollerLength:function(){switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:return this.get("frame").height;case SC.LAYOUT_HORIZONTAL:return this.get("frame").width}return 0}.property("frame").cacheable(),thumbLength:function(){return Math.max(Math.floor(this.get("trackLength")*this.get("proportion")),20)}.property("trackLength","proportion").cacheable(),thumbPosition:function(){var value=this.get("value"),max=this.get("maximum"),trackLength=this.get("trackLength"),thumbLength=this.get("thumbLength"),capLength=this.get("capLength"),capOverlap=this.get("capOverlap"),position;position=(value/max)*(trackLength-thumbLength);position+=capLength-capOverlap;return Math.floor(position)}.property("value","maximum","trackLength","thumbLength").cacheable(),controlsHidden:function(){return this.get("proportion")>=1}.property("proportion").cacheable(),mouseDown:function(evt){if(!this.get("isEnabled")){return NO}var target=evt.target,thumbPosition=this.get("thumbPosition"),value,clickLocation,clickOffset;if(target.className.indexOf("thumb")>=0){clickLocation=this.convertFrameFromView({x:evt.pageX,y:evt.pageY});clickLocation.x-=thumbPosition;clickLocation.y-=thumbPosition;this._thumbDragging=YES;this._thumbOffset=clickLocation;this._mouseDownLocation={x:evt.pageX,y:evt.pageY};this._thumbPositionAtDragStart=this.get("thumbPosition")}else{if(target.className.indexOf("button-top")>=0){this.decrementProperty("value",30);this.makeButtonActive(".button-top");this.startMouseDownTimer("scrollUp")}else{if(target.className.indexOf("button-bottom")>=0){this.incrementProperty("value",30);this.makeButtonActive(".button-bottom");this.startMouseDownTimer("scrollDown")}else{var scrollerLength=this.get("scrollerLength"),frame=this.convertFrameFromView({x:evt.pageX,y:evt.pageY}),mousePosition;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:this._mouseDownLocation=mousePosition=frame.y;break;case SC.LAYOUT_HORIZONTAL:this._mouseDownLocation=mousePosition=frame.x;break}if(mousePosition<thumbPosition){this.decrementProperty("value",scrollerLength);this.startMouseDownTimer("pageUp")}else{this.incrementProperty("value",scrollerLength);this.startMouseDownTimer("pageDown")}}}}return YES},mouseUp:function(evt){var active=this._scs_buttonActive,ret=NO,timer;if(active){active.removeClass("active");ret=YES}timer=this._mouseDownTimer;if(timer){timer.invalidate();this._mouseDownTimer=null}this._thumbDragging=NO;return ret},mouseDragged:function(evt){var value,length,delta,thumbPosition,thumbPositionAtDragStart=this._thumbPositionAtDragStart;if(!this._thumbDragging){return NO}switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:delta=(evt.pageY-this._mouseDownLocation.y);break;case SC.LAYOUT_HORIZONTAL:delta=(evt.pageX-this._mouseDownLocation.x);break}thumbPosition=thumbPositionAtDragStart+delta;length=this.get("trackLength")-this.get("thumbLength");this.set("value",Math.round((thumbPosition/length)*this.get("maximum")));return YES},startMouseDownTimer:function(action){var timer;this._mouseDownTimerAction=action;this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:300})},mouseDownTimerDidFire:function(){var scrollerLength=this.get("scrollerLength"),mouseLocation=this._mouseDownLocation,thumbPosition;switch(this._mouseDownTimerAction){case"scrollDown":this.incrementProperty("value",30);break;case"scrollUp":this.decrementProperty("value",30);break;case"pageDown":thumbPosition=this._scs_thumbPosition+this._scs_thumbSize;if(mouseLocation<thumbPosition){return}this.incrementProperty("value",scrollerLength);break;case"pageUp":thumbPosition=this._scs_thumbPosition;if(mouseLocation>thumbPosition){return}this.decrementProperty("value",scrollerLength);break}this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:50})},makeButtonActive:function(selector){this._scs_buttonActive=this.$(selector).addClass("active")}});sc_require("views/scroller");sc_require("mixins/border");SC.ScrollView=SC.View.extend(SC.Border,{classNames:["sc-scroll-view"],isScrollable:YES,contentView:null,horizontalScrollOffset:function(key,value){if(value!==undefined){this._scroll_horizontalScrollOffset=Math.max(0,Math.min(this.get("maximumHorizontalScrollOffset"),value))}return this._scroll_horizontalScrollOffset||0}.property().cacheable(),verticalScrollOffset:function(key,value){if(value!==undefined){this._scroll_verticalScrollOffset=Math.max(0,Math.min(this.get("maximumVerticalScrollOffset"),value))}return this._scroll_verticalScrollOffset||0}.property().cacheable(),maximumHorizontalScrollOffset:function(){if(!this.get("canScrollHorizontal")){return 0}var view=this.get("contentView");var contentWidth=view?view.get("frame").width:0;if(view.calculatedWidth&&view.calculatedWidth!==0){contentWidth=view.calculatedWidth}var containerWidth=this.get("containerView").get("frame").width;return Math.max(0,contentWidth-containerWidth)}.property(),maximumVerticalScrollOffset:function(){if(!this.get("canScrollVertical")){return 0}var view=this.get("contentView");var contentHeight=(view&&view.get("frame"))?view.get("frame").height:0;if(view.calculatedHeight&&view.calculatedHeight!==0){contentHeight=view.calculatedHeight}var containerHeight=this.get("containerView").get("frame").height;return Math.max(0,contentHeight-containerHeight)}.property(),verticalLineScroll:20,horizontalLineScroll:20,verticalPageScroll:function(){return this.get("frame").height}.property("frame"),horizontalPageScroll:function(){return this.get("frame").width}.property("frame"),hasHorizontalScroller:YES,horizontalScrollerView:SC.ScrollerView,isHorizontalScrollerVisible:YES,canScrollHorizontal:function(){return !!(this.get("hasHorizontalScroller")&&this.get("horizontalScrollerView")&&this.get("isHorizontalScrollerVisible"))}.property("isHorizontalScrollerVisible").cacheable(),autohidesHorizontalScroller:YES,hasVerticalScroller:YES,verticalScrollerView:SC.ScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:function(){return !!(this.get("hasVerticalScroller")&&this.get("verticalScrollerView")&&this.get("isVerticalScrollerVisible"))}.property("isVerticalScrollerVisible").cacheable(),autohidesVerticalScroller:YES,verticalScrollerBottom:0,verticalOverlay:NO,horizontalOverlay:NO,verticalScrollerLayout:null,horizontalScrollerLayout:null,containerView:SC.ContainerView,scrollTo:function(x,y){if(y===undefined&&SC.typeOf(x)===SC.T_HASH){y=x.y;x=x.x}if(!SC.none(x)){x=Math.max(0,Math.min(this.get("maximumHorizontalScrollOffset"),x));this.set("horizontalScrollOffset",x)}if(!SC.none(y)){y=Math.max(0,Math.min(this.get("maximumVerticalScrollOffset"),y));this.set("verticalScrollOffset",y)}return this},scrollBy:function(x,y){if(y===undefined&&SC.typeOf(x)===SC.T_HASH){y=x.y;x=x.x}x=(x)?this.get("horizontalScrollOffset")+x:null;y=(y)?this.get("verticalScrollOffset")+y:null;return this.scrollTo(x,y)},scrollToVisible:function(view){if(arguments.length===0){return arguments.callee.base.apply(this,arguments)}var contentView=this.get("contentView");if(!contentView){return NO}var vf=view.get("frame");if(!vf){return NO}vf=contentView.convertFrameFromView(vf,view.get("parentView"));var vo=SC.cloneRect(this.get("containerView").get("frame"));vo.x=this.get("horizontalScrollOffset");vo.y=this.get("verticalScrollOffset");var origX=vo.x,origY=vo.y;vo.y-=Math.max(0,SC.minY(vo)-SC.minY(vf));vo.x-=Math.max(0,SC.minX(vo)-SC.minX(vf));vo.y+=Math.max(0,SC.maxY(vf)-SC.maxY(vo));vo.x+=Math.max(0,SC.maxX(vf)-SC.maxX(vo));if((origX!==vo.x)||(origY!==vo.y)){this.scrollTo(vo.x,vo.y);return YES}else{return NO}},scrollDownLine:function(lines){if(lines===undefined){lines=1}return this.scrollBy(null,this.get("verticalLineScroll")*lines)},scrollUpLine:function(lines){if(lines===undefined){lines=1}return this.scrollBy(null,0-this.get("verticalLineScroll")*lines)},scrollRightLine:function(lines){if(lines===undefined){lines=1}return this.scrollTo(this.get("horizontalLineScroll")*lines,null)},scrollLeftLine:function(lines){if(lines===undefined){lines=1}return this.scrollTo(0-this.get("horizontalLineScroll")*lines,null)},scrollDownPage:function(pages){if(pages===undefined){pages=1}return this.scrollBy(null,this.get("verticalPageScroll")*pages)},scrollUpPage:function(pages){if(pages===undefined){pages=1}return this.scrollBy(null,0-(this.get("verticalPageScroll")*pages))},scrollRightPage:function(pages){if(pages===undefined){pages=1}return this.scrollBy(this.get("horizontalPageScroll")*pages,null)},scrollLeftPage:function(pages){if(pages===undefined){pages=1}return this.scrollBy(0-(this.get("horizontalPageScroll")*pages),null)},tile:function(){var hscroll=this.get("hasHorizontalScroller")?this.get("horizontalScrollerView"):null;var hasHorizontal=hscroll&&this.get("isHorizontalScrollerVisible");var vscroll=this.get("hasVerticalScroller")?this.get("verticalScrollerView"):null;var hasVertical=vscroll&&this.get("isVerticalScrollerVisible");var clip=this.get("containerView");var clipLayout={left:0,top:0};var t,layout,vo,ho,vl,hl;var ht=((hasHorizontal)?hscroll.get("scrollbarThickness"):0);var vt=(hasVertical)?vscroll.get("scrollbarThickness"):0;if(hasHorizontal){hl=this.get("horizontalScrollerLayout");layout={left:(hl?hl.left:0),bottom:(hl?hl.bottom:0),right:(hl?hl.right+vt-1:vt-1),height:ht};hscroll.set("layout",layout);ho=this.get("horizontalOverlay");clipLayout.bottom=ho?0:(layout.bottom+ht)}else{clipLayout.bottom=0}if(hscroll){hscroll.set("isVisible",hasHorizontal)}if(hasVertical){ht=ht+this.get("verticalScrollerBottom");vl=this.get("verticalScrollerLayout");layout={top:(vl?vl.top:0),bottom:(vl?vl.bottom+ht:ht),right:(vl?vl.right:0),width:vt};vscroll.set("layout",layout);vo=this.get("verticalOverlay");clipLayout.right=vo?0:(layout.right+vt)}else{clipLayout.right=0}if(vscroll){vscroll.set("isVisible",hasVertical)}clip.set("layout",clipLayout)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible"),_scroll_wheelDeltaX:0,_scroll_wheelDeltaY:0,mouseWheel:function(evt){this._scroll_wheelDeltaX+=evt.wheelDeltaX;this._scroll_wheelDeltaY+=evt.wheelDeltaY;this.invokeLater(this._scroll_mouseWheel,10);return this.get("canScrollHorizontal")||this.get("canScrollVertical")},_scroll_mouseWheel:function(){this.scrollBy(this._scroll_wheelDeltaX,this._scroll_wheelDeltaY);if(SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY>0){this._scroll_wheelDeltaY=Math.floor(this._scroll_wheelDeltaY*0.95);this._scroll_wheelDeltaY=Math.max(this._scroll_wheelDeltaY,0);this.invokeLater(this._scroll_mouseWheel,10)}else{if(SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY<0){this._scroll_wheelDeltaY=Math.ceil(this._scroll_wheelDeltaY*0.95);this._scroll_wheelDeltaY=Math.min(this._scroll_wheelDeltaY,0);this.invokeLater(this._scroll_mouseWheel,10)}else{this._scroll_wheelDeltaY=0;this._scroll_wheelDeltaX=0}}},touchStart:function(evt){this.beginTouchTracking(evt);this.invokeLater(this.beginTouchesInContent,150);return SC.MIXED_STATE},beginTouchesInContent:function(){var touch=this.touch,itemView;if(touch.tracking&&!touch.dragging){var ev=touch.originalEvent;ev.manufactured=YES;this.contentView.mouseDown(ev)}},beginTouchTracking:function(evt){var verticalScrollOffset=this.get("verticalScrollOffset");this.touch={startScrollOffset:{x:this.horizontalScrollOffset,y:verticalScrollOffset},startTime:evt.timeStamp,startTimePosition:verticalScrollOffset,startTouchOffset:{x:evt.pageX,y:evt.pageY},decelerationVelocity:{y:0},originalTarget:SC.RootResponder.responder.targetViewForEvent(evt),originalPane:this.get("pane"),originalEvent:SC.copy(evt),tracking:YES,dragging:NO,decelerating:NO};this.tracking=YES;this.dragging=NO},touchDragged:function(evt){var touch=this.touch,touchY=evt.pageY,offsetY=touch.startScrollOffset.y,maxOffset=this.get("maximumVerticalScrollOffset");var deltaY=touchY-touch.startTouchOffset.y;if(!touch.dragging){if(Math.abs(deltaY)>5){touch.dragging=YES;touch.firstDrag=YES}}if(touch.dragging){offsetY=offsetY-deltaY;if(touch.firstDrag){touch.firstDrag=NO;return}}this.set("verticalScrollOffset",Math.max(0,Math.min(offsetY,maxOffset)));if(evt.timeStamp-touch.lastEventTime>50){touch.startTime=evt.timeStamp;touch.startTimePosition=this.get("verticalScrollOffset")}touch.lastEventTime=evt.timeStamp},touchEnd:function(evt){var touch=this.touch;this.tracking=NO;touch.tracking=NO;this.dragging=NO;if(touch.dragging){touch.dragging=NO;if(evt.timeStamp-touch.lastEventTime<=100){touch.offsetBeforeDeceleration={y:this.get("verticalScrollOffset")};this.startDecelerationAnimation(evt)}}},startDecelerationAnimation:function(evt){var touch=this.touch;var scrollDistance=this.get("verticalScrollOffset")-touch.startTimePosition;var scrollDuration=(evt.timeStamp-touch.startTime)/15;touch.decelerationVelocity={y:scrollDistance/scrollDuration};this.decelerateAnimation()},decelerateAnimation:function(){var touch=this.touch,maxOffset=this.get("maximumVerticalScrollOffset"),newY=this.get("verticalScrollOffset")+touch.decelerationVelocity.y;this.set("verticalScrollOffset",Math.max(0,Math.min(Math.round(newY),maxOffset)));touch.decelerationVelocity.y*=0.95;var absYVelocity=Math.abs(touch.decelerationVelocity.y);if(absYVelocity<1){touch.decelerationVelocity.y=0;touch.decelerating=NO;return}this.invokeLater(this.decelerateAnimation,16)},createChildViews:function(){var childViews=[],view;if(SC.none(view=this.containerView)){view=SC.ContainerView}childViews.push(this.containerView=this.createChildView(view,{contentView:this.contentView,isScrollContainer:YES}));this.contentView=this.containerView.get("contentView");view=this.horizontalScrollerView;if(view){if(this.get("hasHorizontalScroller")){view=this.horizontalScrollerView=this.createChildView(view,{layoutDirection:SC.LAYOUT_HORIZONTAL,valueBinding:"*owner.horizontalScrollOffset"});childViews.push(view)}else{this.horizontalScrollerView=null}}view=this.verticalScrollerView;if(view){if(this.get("hasVerticalScroller")){view=this.verticalScrollerView=this.createChildView(view,{layoutDirection:SC.LAYOUT_VERTICAL,valueBinding:"*owner.verticalScrollOffset"});childViews.push(view)}else{this.verticalScrollerView=null}}this.childViews=childViews;this.contentViewDidChange();this.tile()},init:function(){arguments.callee.base.apply(this,arguments);this._scroll_contentView=this.get("contentView");var contentView=this._scroll_contentView;if(contentView){contentView.addObserver("frame",this,this.contentViewFrameDidChange)}if(this.get("isVisibleInWindow")){this._scsv_registerAutoscroll()}},_scsv_registerAutoscroll:function(){if(this.get("isVisibleInWindow")){SC.Drag.addScrollableView(this)}else{SC.Drag.removeScrollableView(this)}}.observes("isVisibleInWindow"),contentViewDidChange:function(){var newView=this.get("contentView"),oldView=this._scroll_contentView;var f=this.contentViewFrameDidChange;if(newView!==oldView){if(oldView){oldView.removeObserver("frame",this,f)}this._scroll_contentView=newView;if(newView){newView.addObserver("frame",this,f)}this.containerView.set("contentView",newView);this.contentViewFrameDidChange()}}.observes("contentView"),render:function(context,firstTime){this.invokeLast(this.adjustElementScroll);if(firstTime){context.push('<div class="corner"></div>')}return arguments.callee.base.apply(this,arguments)},oldMaxHOffset:0,oldMaxVOffset:0,contentViewFrameDidChange:function(){var view=this.get("contentView"),f=(view)?view.get("frame"):null,width=(f)?f.width:0,height=(f)?f.height:0,dim=this.get("frame");this._scroll_contentWidth=width;this._scroll_contentHeight=height;if(this.get("hasHorizontalScroller")&&(view=this.get("horizontalScrollerView"))){if(this.get("autohidesHorizontalScroller")){this.set("isHorizontalScrollerVisible",width>dim.width)}view.setIfChanged("maximum",width-dim.width);view.setIfChanged("proportion",dim.width/width)}if(this.get("hasVerticalScroller")&&(view=this.get("verticalScrollerView"))){if(this.get("autohidesVerticalScroller")){this.set("isVerticalScrollerVisible",height>dim.height)}height-=this.get("verticalScrollerBottom");view.setIfChanged("maximum",height-dim.height);view.setIfChanged("proportion",dim.height/height)}if(!this.get("isVerticalScrollerVisible")&&(this.get("verticalScrollOffset")!==0)&&this.get("autohidesVerticalScroller")){this.set("verticalScrollOffset",0)}if(!this.get("isHorizontalScrollerVisible")&&(this.get("horizontalScrollOffset")!==0)&&this.get("autohidesHorizontalScroller")){this.set("horizontalScrollOffset",0)}var mxVOffSet=this.get("maximumVerticalScrollOffset"),vOffSet=this.get("verticalScrollOffset"),mxHOffSet=this.get("maximumHorizontalScrollOffset"),hOffSet=this.get("horizontalScrollOffset");var forceHeight=mxVOffSet<vOffSet;var forceWidth=mxHOffSet<hOffSet;if(forceHeight||forceWidth){this.forceDimensionsRecalculation(forceWidth,forceHeight,vOffSet,hOffSet)}},_scroll_horizontalScrollOffsetDidChange:function(){this.invokeLast(this.adjustElementScroll)}.observes("horizontalScrollOffset"),_scroll_verticalScrollOffsetDidChange:function(){this.invokeLast(this.adjustElementScroll)}.observes("verticalScrollOffset"),adjustElementScroll:function(){var container=this.get("containerView"),content=this.get("contentView"),verticalScrollOffset=this.get("verticalScrollOffset"),horizontalScrollOffset=this.get("horizontalScrollOffset");if(content){SC.RunLoop.begin();content.notifyPropertyChange("frame");SC.RunLoop.end();if(SC.browser.touch){var transform="translate3d(-"+horizontalScrollOffset+"px, -"+verticalScrollOffset+"px, 0)";content.get("layer").style.webkitTransform=transform}}if(container&&!SC.browser.touch){var custom=container.get("hasCustomScrolling");var layer=container.get("layer");if(container){if(verticalScrollOffset!==this._verticalScrollOffset){if(!custom){layer.scrollTop=verticalScrollOffset}this._verticalScrollOffset=verticalScrollOffset}if(horizontalScrollOffset!==this._horizontalScrollOffset){if(!custom){layer.scrollLeft=horizontalScrollOffset}this._horizontalScrollOffset=horizontalScrollOffset}}}},forceDimensionsRecalculation:function(forceWidth,forceHeight,vOffSet,hOffSet){var oldScrollHOffset=hOffSet;var oldScrollVOffset=vOffSet;this.scrollTo(0,0);if(forceWidth&&forceHeight){this.scrollTo(this.get("maximumHorizontalScrollOffset"),this.get("maximumVerticalScrollOffset"))}if(forceWidth&&!forceHeight){this.scrollTo(this.get("maximumHorizontalScrollOffset"),oldScrollVOffset)}if(!forceWidth&&forceHeight){this.scrollTo(oldScrollHOffset,this.get("maximumVerticalScrollOffset"))}},_verticalScrollOffset:0,_horizontalScrollOffset:0});sc_require("views/scroll");SC.MenuScrollerView=SC.ScrollerView.extend({classNames:["sc-menu-scroller-view"],scrollDown:NO,value:function(key,val){if(val!==undefined){this._value=val}else{var value=this._value||0;return Math.min(value,this.get("maximum"))}}.property("maximum").cacheable(),maximum:0,isEnabled:YES,layoutDirection:SC.LAYOUT_VERTICAL,verticalLineScroll:20,ownerScrollValueKey:function(){return"verticalScrollOffset"}.property("layoutDirection").cacheable(),render:function(context,firstTime){context.addClass("sc-vertical");if(firstTime){var direction=this.get("scrollDown")?"arrowDown":"arrowUp";context.push('<span class="'+direction+'">&nbsp;</span>')}context.setClass("disabled",!this.get("isEnabled"))},didCreateLayer:function(){},willDestroyLayer:function(){var callback=this._sc_scroller_scrollDidChange;SC.Event.remove(this.$(),"scroll",this,callback)},mouseEntered:function(evt){this.set("isMouseOver",YES);this._invokeScrollOnMouseOver()},mouseExited:function(evt){this.set("isMouseOver",NO)},_sc_scroller_valueDidChange:function(){}.observes("value"),_sc_scroller_armScrollTimer:function(){if(!this._sc_scrollTimer){SC.RunLoop.begin();var method=this._sc_scroller_scrollDidChange;this._sc_scrollTimer=this.invokeLater(method,50);SC.RunLoop.end()}},_sc_scroller_scrollDidChange:function(){var now=Date.now(),last=this._sc_lastScroll,layer=this.get("layer"),scroll=0;if(last&&(now-last)<50){return this._sc_scroller_armScrollTimer()}this._sc_scrollTimer=null;this._sc_lastScroll=now;SC.RunLoop.begin();if(!this.get("isEnabled")){return}this._sc_scrollValue=scroll=layer.scrollTop;this.set("value",scroll);SC.RunLoop.end()},_scrollMenu:function(){var val=this.get("value"),newval;if(this.get("scrollDown")){newval=val+this.verticalLineScroll;if(newval<=this.get("maximum")){this.set("value",newval)}}else{newval=val-this.verticalLineScroll;if(newval>=0){this.set("value",newval)}else{if(val<=this.verticalLineScroll&&val>0){this.set("value",0)}}}return YES},_invokeScrollOnMouseOver:function(){this._scrollMenu();if(this.get("isMouseOver")){this.invokeLater(this._invokeScrollOnMouseOver,100)}}});SC.MenuScrollView=SC.ScrollView.extend({classNames:["sc-menu-scroll-view"],maximumHorizontalScrollOffset:0,hasHorizontalScroller:NO,horizontalScrollerView:SC.MenuScrollerView,isHorizontalScrollerVisible:NO,canScrollHorizontal:NO,autohidesHorizontalScroller:NO,hasVerticalScroller:YES,verticalScrollerView:SC.MenuScrollerView,verticalScrollerView2:SC.MenuScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:YES,autohidesVerticalScroller:YES,verticalScrollerBottom:0,controlSize:SC.REGULAR_CONTROL_SIZE,containerView:SC.ContainerView,tile:function(){var hasScroller,vscroll,vscroll2,hasVertical,clip,clipLayout,viewportHeight;hasScroller=this.get("hasVerticalScroller");vscroll=hasScroller?this.get("verticalScrollerView"):null;vscroll2=hasScroller?this.get("verticalScrollerView2"):null;hasVertical=vscroll&&this.get("isVerticalScrollerVisible");clip=this.get("containerView");clipLayout={left:0,top:0};if(hasVertical){viewportHeight=0;var scrollerThickness=vscroll.get("scrollerThickness")||vscroll2.get("scrollerThickness");var view=this.get("contentView"),view2,f=(view)?view.get("frame"):null,height=(f)?f.height:0,elem=this.containerView.$()[0],verticalOffset=this.get("verticalScrollOffset"),topArrowInvisible={height:0,top:0,right:0,left:0},topArrowVisible={height:scrollerThickness,top:0,right:0,left:0},bottomArrowVisible={height:scrollerThickness,bottom:0,right:0,left:0},bottomArrowInvisible={height:0,bottom:0,right:0,left:0};if(elem){viewportHeight=elem.offsetHeight}if(verticalOffset===0){clipLayout.top=0;clipLayout.bottom=scrollerThickness;vscroll.set("layout",topArrowInvisible);vscroll2.set("layout",bottomArrowVisible)}else{if(verticalOffset>=(height-viewportHeight-scrollerThickness)){clipLayout.top=scrollerThickness;clipLayout.bottom=0;vscroll.set("layout",topArrowVisible);vscroll2.set("layout",bottomArrowInvisible)}else{clipLayout.top=scrollerThickness;clipLayout.bottom=scrollerThickness;vscroll.set("layout",topArrowVisible);vscroll2.set("layout",bottomArrowVisible)}}}if(vscroll){vscroll.set("isVisible",hasVertical);vscroll2.set("isVisible",hasVertical)}clip.set("layout",clipLayout)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible","verticalScrollOffset"),createChildViews:function(){var childViews=[],view,view2;if(SC.none(view=this.containerView)){view=SC.ContainerView}childViews.push(this.containerView=this.createChildView(view,{contentView:this.contentView}));this.contentView=this.containerView.get("contentView");if((view=this.verticalScrollerView)&&(view2=this.verticalScrollerView2)){if(this.get("hasVerticalScroller")){var scrollerThickness=(this.get("controlSize")===SC.SMALL_CONTROL_SIZE)?14:16;view=this.verticalScrollerView=this.createChildView(view,{layout:{top:0,left:0,right:0,height:scrollerThickness},scrollerThickness:scrollerThickness,valueBinding:"*owner.verticalScrollOffset"});childViews.push(view);view2=this.verticalScrollerView2=this.createChildView(view2,{scrollDown:YES,layout:{bottom:0,left:0,right:0,height:scrollerThickness},scrollerThickness:scrollerThickness,valueBinding:"*owner.verticalScrollOffset"});childViews.push(view2)}else{this.verticalScrollerView=null;this.verticalScrollerView2=null}}this.childViews=childViews;this.contentViewFrameDidChange();this.tile()},init:function(){arguments.callee.base.apply(this,arguments);this._scroll_contentView=this.get("contentView");var contentView=this._scroll_contentView;if(contentView){contentView.addObserver("frame",this,this.contentViewFrameDidChange)}if(this.get("isVisibleInWindow")){this._scsv_registerAutoscroll()}},_scsv_registerAutoscroll:function(){if(this.get("isVisibleInWindow")){SC.Drag.addScrollableView(this)}else{SC.Drag.removeScrollableView(this)}}.observes("isVisibleInWindow"),contentViewFrameDidChange:function(){var view=this.get("contentView"),view2,f=(view)?view.get("frame"):null,width=(f)?f.width:0,height=(f)?f.height:0,dim=this.get("frame"),viewportHeight,elem;this._scroll_contentWidth=width;this._scroll_contentHeight=height;if(this.get("hasVerticalScroller")&&(view=this.get("verticalScrollerView"))&&(view2=this.get("verticalScrollerView2"))){height-=1;if(this.get("autohidesVerticalScroller")){this.set("isVerticalScrollerVisible",height>dim.height)}height-=this.get("verticalScrollerBottom");viewportHeight=0;elem=this.containerView.$()[0];if(elem){viewportHeight=elem.offsetHeight}height=height-viewportHeight;view.setIfChanged("maximum",height);view2.setIfChanged("maximum",height)}},_scroll_horizontalScrollOffsetDidChange:function(){},_scroll_verticalScrollOffsetDidChange:function(){var offset=this.get("verticalScrollOffset");var contentView=this.get("contentView");if(contentView){contentView.adjust("top",0-offset)}}.observes("verticalScrollOffset")});sc_require("views/button");SC.PopupButtonView=SC.ButtonView.extend({keyEquivalent:null,classNames:["sc-popup-button"],preferMatrix:null,acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")}else{return NO}}.property("isEnabled"),isSelected:NO,performKeyEquivalent:function(charCode,evt){if(!this.get("isEnabled")){return NO}var menu=this.get("menu");return(!!menu&&menu.performKeyEquivalent(charCode,evt))},menu:null,isSelectedBinding:"*menu.isVisibleInWindow",action:function(evt){var menu=this.get("menu");if(!menu){return NO}menu.popup(this,this.preferMatrix);return YES},mouseDown:function(evt){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;this._action();return YES}});SC.ProgressView=SC.View.extend(SC.Control,{value:0.5,valueBindingDefault:SC.Binding.single().notEmpty(),minimum:0,minimumBindingDefault:SC.Binding.single().notEmpty(),contentMinimumKey:null,maximum:1,maximumBindingDefault:SC.Binding.single().notEmpty(),offsetRange:24,contentMaximumKey:null,isIndeterminate:NO,isIndeterminateBindingDefault:SC.Binding.bool(),isRunning:NO,isRunningBindingDefault:SC.Binding.bool(),animatedBackgroundMatrix:[],contentIsIndeterminateKey:null,classNames:"sc-progress-view",_backgroundOffset:0,_currentBackground:1,_nextBackground:1,init:function(){arguments.callee.base.apply(this,arguments);this.animateProgressBar()},animateProgressBar:function(){if(this.get("isRunning")&&this.get("isVisibleInWindow")){this._animateProgressBar(500)}}.observes("isRunning","isVisibleInWindow"),_animateProgressBar:function(delay){if(delay===0){delay=1000/30}if(this.get("isRunning")&&this.get("isVisibleInWindow")){this.displayDidChange();this.invokeLater(this._animateProgressBar,delay,30)}},displayProperties:"value minimum maximum isIndeterminate".w(),render:function(context,firstTime){var inner,animatedBackground,value,cssString,backPosition,isIndeterminate=this.get("isIndeterminate"),isRunning=this.get("isRunning"),isEnabled=this.get("isEnabled"),offsetRange=this.get("offsetRange"),offset=(isIndeterminate&&isRunning)?(Math.floor(Date.now()/75)%offsetRange-offsetRange):0;if(!isEnabled){value="0%"}else{if(isIndeterminate){value="120%"}else{var minimum=this.get("minimum")||0;var maximum=this.get("maximum")||1;value=this.get("value")||0;value=(value-minimum)/(maximum-minimum);if(value>1){value=1}if(isNaN(value)){value=0}if(value<minimum){value=0}if(value>maximum){value=1}value=(value*100)+"%"}}var classNames={"sc-indeterminate":isIndeterminate,"sc-empty":(value<=0),"sc-complete":(value>=100)};if(firstTime){var classString=this._createClassNameString(classNames);context.push('<div class="sc-inner ',classString,'" style="width: ',value,";left: ",offset,'px;">','<div class="sc-inner-head">',"</div>",'<div class="sc-inner-tail"></div></div>','<div class="sc-outer-head"></div>','<div class="sc-outer-tail"></div>')}else{context.setClass(classNames);inner=this.$(".sc-inner");animatedBackground=this.get("animatedBackgroundMatrix");cssString="width: "+value+"; ";cssString=cssString+"left: "+offset+"px; ";if(animatedBackground.length===3){inner.css("backgroundPosition","0px -"+(animatedBackground[0]+animatedBackground[1]*this._currentBackground)+"px");if(this._currentBackground===animatedBackground[2]-1||this._currentBackground===0){this._nextBackground*=-1}this._currentBackground+=this._nextBackground;cssString=cssString+"backgroundPosition: "+backPosition+"px; ";inner.attr("style",cssString)}else{inner.attr("style",cssString)}}},contentPropertyDidChange:function(target,key){var content=this.get("content");this.beginPropertyChanges().updatePropertyFromContent("value",key,"contentValueKey",content).updatePropertyFromContent("minimum",key,"contentMinimumKey",content).updatePropertyFromContent("maximum",key,"contentMaximumKey",content).updatePropertyFromContent("isIndeterminate",key,"contentIsIndeterminateKey",content).endPropertyChanges()},_createClassNameString:function(classNames){var classNameArray=[],key;for(key in classNames){if(!classNames.hasOwnProperty(key)){continue}if(classNames[key]){classNameArray.push(key)}}return classNameArray.join(" ")}});SC.RadioView=SC.View.extend(SC.Control,{classNames:["sc-radio-view"],value:null,layoutDirection:SC.LAYOUT_VERTICAL,escapeHTML:YES,items:[],itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,routeTouch:YES,itemsDidChange:function(){if(this._items){this._items.removeObserver("[]",this,this.itemContentDidChange)}this._items=this.get("items");if(this._items){this._items.addObserver("[]",this,this.itemContentDidChange)}this.itemContentDidChange()}.observes("items"),itemContentDidChange:function(){this.notifyPropertyChange("_displayItems")},displayProperties:["value","_displayItems"],render:function(context,firstTime){var item,idx,icon,name,itemsLength,url,className,disabled,sel,labelText,selectionState,selectionStateClassNames,items=this.get("_displayItems"),value=this.get("value"),isArray=SC.isArray(value);context.addClass(this.get("layoutDirection"));if(isArray&&value.length<=0){value=value[0];isArray=NO}if(firstTime){context.attr("role","radiogroup");name=SC.guidFor(this);itemsLength=items.length;for(idx=0;idx<itemsLength;idx++){item=items[idx];icon=item[3];if(icon){url=(icon.indexOf("/")>=0)?icon:SC.BLANK_IMAGE_URL;className=(url===icon)?"":icon;icon='<img src="'+url+'" class="icon '+className+'" alt="" />'}else{icon=""}if(item){sel=(isArray)?(value.indexOf(item[1])>=0):(value===item[1])}else{sel=NO}selectionStateClassNames=this._getSelectionStateClassNames(item,sel,value,isArray,false);labelText=this.escapeHTML?SC.RenderContext.escapeHTML(item[0]):item[0];context.push('<div class="sc-radio-button ',selectionStateClassNames,'" ','aria-checked="',sel?"true":"false",'" ','role="radio"',' index="',idx,'">','<span class="button"></span>','<span class="sc-button-label">',icon,labelText,"</span></div>")}}else{this.$(".sc-radio-button").forEach(function(button){button=this.$(button);idx=parseInt(button.attr("index"),0);item=(idx>=0)?items[idx]:null;if(item){sel=(isArray)?(value.indexOf(item[1])>=0):(value===item[1])}else{sel=NO}selectionState=this._getSelectionStateClassNames(item,sel,value,isArray,true);button.attr("aria-checked",sel?"true":"false");button.setClass(selectionState);idx=selectionState=null},this)}},_displayItems:function(){var items=this.get("items"),loc=this.get("localize"),titleKey=this.get("itemTitleKey"),valueKey=this.get("itemValueKey"),isEnabledKey=this.get("itemIsEnabledKey"),iconKey=this.get("itemIconKey"),ret=[],max=(items)?items.get("length"):0,item,title,value,idx,isArray,isEnabled,icon;for(idx=0;idx<max;idx++){item=items.objectAt(idx);if(SC.typeOf(item)===SC.T_ARRAY){title=item[0];value=item[1]}else{if(item){if(titleKey){title=item.get?item.get(titleKey):item[titleKey]}else{title=(item.toString)?item.toString():null}if(valueKey){value=item.get?item.get(valueKey):item[valueKey]}else{value=item}if(isEnabledKey){isEnabled=item.get?item.get(isEnabledKey):item[isEnabledKey]}else{isEnabled=YES}if(iconKey){icon=item.get?item.get(iconKey):item[iconKey]}else{icon=null}}else{title=value=icon=null;isEnabled=NO}}if(loc){title=title.loc()}ret.push([title,value,isEnabled,icon])}return ret}.property("items","itemTitleKey","itemValueKey","itemIsEnabledKey","localize","itemIconKey").cacheable(),_getSelectionStateClassNames:function(item,sel,value,isArray,shouldReturnObject){var classNames,key;classNames={sel:(sel&&!isArray),mixed:(sel&&isArray),disabled:(!item[2])};if(shouldReturnObject){return classNames}else{var classNameArray=[];for(key in classNames){if(!classNames.hasOwnProperty(key)){continue}if(classNames[key]){classNameArray.push(key)}}return classNameArray.join(" ")}},mouseDown:function(evt){if(!this.get("isEnabled")){return YES}var target=evt.target;while(target){if(target.className&&target.className.indexOf("sc-radio-button")>-1){break}target=target.parentNode}if(!target){return NO}target=this.$(target);if(target.hasClass("disabled")){return YES}target.addClass("active");this._activeRadioButton=target;return YES},mouseUp:function(evt){if(!this.get("isEnabled")){return YES}var active=this._activeRadioButton,target=evt.target,items=this.get("_displayItems"),index,item;if(active){active.removeClass("active");this._activeRadioButton=null}else{return YES}while(target){if(target.className&&target.className.indexOf("sc-radio-button")>-1){break}target=target.parentNode}target=this.$(target);if(target[0]!==active[0]||target.hasClass("disabled")){return YES}index=parseInt(target.attr("index"),0);item=items[index];this.set("value",item[1])}});SC.SceneView=SC.ContainerView.extend({scenes:["master","detail"],nowShowing:null,transitionDuration:200,_state:"NO_VIEW",replaceContent:function(content){if(content&&this._state===this.READY){this.animateScene(content)}else{this.replaceScene(content)}return this},replaceScene:function(newContent){var oldContent=this._targetView,layout=this.STANDARD_LAYOUT,scenes=this.get("scenes"),idx=scenes?scenes.indexOf(this.get("nowShowing")):-1;this._targetView=newContent;this._targetIndex=idx;if(this._timer){this._timer.invalidate()}this._leftView=this._rightView=this._start=this._end=null;this._timer=null;this.removeAllChildren();if(oldContent){oldContent.set("layout",layout)}if(newContent){newContent.set("layout",layout)}if(newContent){this.appendChild(newContent)}this._state=newContent?this.READY:this.NO_VIEW},animateScene:function(newContent){var oldContent=this._targetView,outIdx=this._targetIndex,scenes=this.get("scenes"),inIdx=scenes?scenes.indexOf(this.get("nowShowing")):-1,layout;if(outIdx<0||inIdx<0||outIdx===inIdx){return this.replaceScene(newContent)}this._targetView=newContent;this._targetIndex=inIdx;if(inIdx>outIdx){this._leftView=oldContent;this._rightView=newContent;this._target=-1}else{this._leftView=newContent;this._rightView=oldContent;this._target=1}this.removeAllChildren();if(oldContent){this.appendChild(oldContent)}if(newContent){this.appendChild(newContent)}this._start=Date.now();this._end=this._start+this.get("transitionDuration");this._state=this.ANIMATING;this.tick()},tick:function(){this._timer=null;var now=Date.now(),pct=(now-this._start)/(this._end-this._start),target=this._target,left=this._leftView,right=this._rightView,layout,adjust;if(pct<0){pct=0}if(!this.get("isVisibleInWindow")||(pct>=1)){return this.replaceScene(this._targetView)}layout=SC.clone(this.get("frame"));adjust=Math.floor(layout.width*pct);if(target>0){layout.left=0-(layout.width-adjust);left.set("layout",layout);layout=SC.clone(layout);layout.left=adjust;right.set("layout",layout)}else{layout.left=0-adjust;left.set("layout",layout);layout=SC.clone(layout);layout.left=layout.width-adjust;right.set("layout",layout)}this._timer=this.invokeLater(this.tick,20);return this},NO_VIEW:"NO_VIEW",ANIMATING:"ANIMATING",READY:"READY",STANDARD_LAYOUT:{top:0,left:0,bottom:0,right:0}});SC.SegmentedView=SC.View.extend(SC.Control,{classNames:["sc-segmented-view"],theme:"square",value:null,isEnabled:YES,allowsEmptySelection:NO,allowsMultipleSelection:NO,localize:YES,align:SC.ALIGN_CENTER,layoutDirection:SC.LAYOUT_HORIZONTAL,items:[],itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemActionKey:null,itemTargetKey:null,itemKeyEquivalentKey:null,itemKeys:"itemTitleKey itemValueKey itemIsEnabledKey itemIconKey itemWidthKey itemToolTipKey".w(),displayItems:function(){var items=this.get("items"),loc=this.get("localize"),keys=null,itemType,cur,ret=[],max=items.get("length"),idx,item,fetchKeys=SC._segmented_fetchKeys,fetchItem=SC._segmented_fetchItem;for(idx=0;idx<max;idx++){item=items.objectAt(idx);if(SC.none(item)){continue}itemType=SC.typeOf(item);if(itemType===SC.T_STRING){cur=[item.humanize().titleize(),item,YES,null,null,null,idx]}else{if(itemType!==SC.T_ARRAY){if(keys===null){keys=this.itemKeys.map(fetchKeys,this)}cur=keys.map(fetchItem,item);cur[cur.length]=idx;if(!keys[0]&&item.toString){cur[0]=item.toString()}if(!keys[1]){cur[1]=item}if(!keys[2]){cur[2]=YES}}}if(loc&&cur[0]){cur[0]=cur[0].loc()}if(loc&&cur[5]&&SC.typeOf(cur[5])===SC.T_STRING){cur[5]=cur[5].loc()}ret[ret.length]=cur}return ret}.property("items","itemTitleKey","itemValueKey","itemIsEnabledKey","localize","itemIconKey","itemWidthKey","itemToolTipKey"),itemsDidChange:function(){if(this._items){this._items.removeObserver("[]",this,this.itemContentDidChange)}this._items=this.get("items");if(this._items){this._items.addObserver("[]",this,this.itemContentDidChange)}this.itemContentDidChange()}.observes("items"),itemContentDidChange:function(){this.notifyPropertyChange("displayItems")},init:function(){arguments.callee.base.apply(this,arguments);this.itemsDidChange()},displayProperties:["displayItems","value","activeIndex"],render:function(context,firstTime){var items=this.get("displayItems");var last=this._seg_displayItems,theme=this.get("theme");if(theme){context.addClass(theme)}if(firstTime||(items!==last)){this._seg_displayItems=items;this.renderDisplayItems(context,items);context.addStyle("text-align",this.get("align"))}else{var activeIndex=this.get("activeIndex");var value=this.get("value");var isArray=SC.isArray(value);if(isArray&&value.get("length")===1){value=value.objectAt(0);isArray=NO}var names={};var loc=items.length,cq=this.$(".sc-segment"),item;while(--loc>=0){item=items[loc];names.sel=isArray?(value.indexOf(item[1])>=0):(item[1]===value);names.active=(activeIndex===loc);names.disabled=!item[2];SC.$(cq[loc]).setClass(names)}names=items=value=items=null}},renderDisplayItems:function(context,items){var value=this.get("value"),isArray=SC.isArray(value),activeIndex=this.get("activeIndex"),len=items.length,title,icon,url,className,ic,item,toolTip,width,i,stylesHash,classArray;for(i=0;i<len;i++){ic=context.begin("a").attr("role","button");item=items[i];title=item[0];icon=item[3];toolTip=item[5];stylesHash={};classArray=[];if(this.get("layoutDirection")==SC.LAYOUT_HORIZONTAL){stylesHash.display="inline-block"}classArray.push("sc-segment");if(!item[2]){classArray.push("disabled")}if(i===0){classArray.push("sc-first-segment")}if(i===(len-1)){classArray.push("sc-last-segment")}if(i!==0&&i!==(len-1)){classArray.push("sc-middle-segment")}if(isArray?(value.indexOf(item[1])>=0):(item[1]===value)){classArray.push("sel")}if(activeIndex===i){classArray.push("active")}if(item[4]){width=item[4];stylesHash.width=width+"px"}ic.addClass(classArray);ic.addStyle(stylesHash);if(toolTip){ic.attr("title",toolTip)}if(icon){url=(icon.indexOf("/")>=0)?icon:SC.BLANK_IMAGE_URL;className=(url===icon)?"":icon;icon='<img src="'+url+'" alt="" class="icon '+className+'" />'}else{icon=""}ic.push('<span class="sc-button-inner"><label class="sc-button-label">',icon+title,"</label></span>");ic.end()}},displayItemIndexForEvent:function(evt){var elem=SC.$(evt.target);if(!elem||elem===document){return -1}var root=this.$(),match=null;while(!match&&(elem.length>0)&&(elem[0]!==root[0])){if(elem.hasClass("sc-segment")){match=elem}else{elem=elem.parent()}}elem=root=null;return(match)?this.$(".sc-segment").index(match):-1},keyDown:function(evt){var i,item,items,len,value,isArray;if(evt.which===9){var view=evt.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(view){view.becomeFirstResponder()}else{evt.allowDefault()}return YES}if(!this.get("allowsMultipleSelection")&&!this.get("allowsEmptySelection")){items=this.get("displayItems");len=items.length;value=this.get("value");isArray=SC.isArray(value);if(evt.which===39||evt.which===40){for(i=0;i<len-1;i++){item=items[i];if(isArray?(value.indexOf(item[1])>=0):(item[1]===value)){this.triggerItemAtIndex(i+1)}}return YES}else{if(evt.which===37||evt.which===38){for(i=1;i<len;i++){item=items[i];if(isArray?(value.indexOf(item[1])>=0):(item[1]===value)){this.triggerItemAtIndex(i-1)}}return YES}}}return YES},mouseDown:function(evt){if(!this.get("isEnabled")){return YES}var idx=this.displayItemIndexForEvent(evt);if(idx>=0){this._isMouseDown=YES;this.set("activeIndex",idx)}return YES},mouseUp:function(evt){var idx=this.displayItemIndexForEvent(evt);if(this._isMouseDown&&(idx>=0)){this.triggerItemAtIndex(idx)}this._isMouseDown=NO;this.set("activeIndex",-1);return YES},mouseMoved:function(evt){var idx=this.displayItemIndexForEvent(evt);if(this._isMouseDown){this.set("activeIndex",idx)}return YES},mouseOver:function(evt){var idx=this.displayItemIndexForEvent(evt);if(this._isMouseDown){this.set("activeIndex",idx)}return YES},mouseOut:function(evt){if(this._isMouseDown){this.set("activeIndex",-1)}return YES},triggerItemAtIndex:function(idx){var items=this.get("displayItems"),item=items.objectAt(idx),sel,value,val,empty,mult;if(!item[2]){return this}empty=this.get("allowsEmptySelection");mult=this.get("allowsMultipleSelection");sel=item[1];value=val=this.get("value");if(!SC.isArray(value)){value=[value]}if(!mult){if(empty&&(value.get("length")===1)&&(value.objectAt(0)===sel)){value=[]}else{value=[sel]}}else{if(value.indexOf(sel)>=0){if(value.get("length")>1||(value.objectAt(0)!==sel)||empty){value=value.without(sel)}}else{value=value.concat([sel])}}switch(value.get("length")){case 0:value=null;break;case 1:value=value.objectAt(0);break;default:break}var actionKey=this.get("itemActionKey");var targetKey=this.get("itemTargetKey");var action,target=null;var resp=this.getPath("pane.rootResponder");if(actionKey&&(item=this.get("items").objectAt(item[6]))){action=item.get?item.get(actionKey):item[actionKey];if(targetKey){target=item.get?item.get(targetKey):item[targetKey]}if(resp){resp.sendAction(action,target,this,this.get("pane"))}}if(!action&&val!==undefined){this.set("value",value)}action=this.get("action");if(action&&resp){resp.sendAction(action,this.get("target"),this,this.get("pane"))}},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")}else{return NO}}.property("isEnabled"),willBecomeKeyResponderFrom:function(keyView){if(!this._isFocused){this._isFocused=YES;this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$()[0].focus()}}},willLoseKeyResponderTo:function(responder){if(this._isFocused){this._isFocused=NO}}});SC._segmented_fetchKeys=function(k){return this.get(k)};SC._segmented_fetchItem=function(k){if(!k){return null}return this.get?this.get(k):this[k]};sc_require("views/button");SC.SelectView=SC.ButtonView.extend({items:[],itemsBindingDefault:SC.Binding.multiple(),itemTitleKey:null,itemSortKey:null,itemValueKey:null,itemIconKey:null,itemSeparatorKey:"separator",localize:YES,disableSort:YES,classNames:["sc-select-view"],_itemList:[],_currentSelItem:null,_itemIdx:null,value:null,showCheckbox:YES,_defaultVal:null,_defaultTitle:null,_defaultIcon:null,theme:"popup",displayProperties:["icon","value","controlSize","items"],preferMatrix:null,CUSTOM_MENU_ITEM_HEIGHT:20,isSelectedBinding:"*menu.isVisibleInWindow",positionMenuBelow:NO,lastMenuWidth:null,exampleView:null,customViewMenuOffsetWidth:0,needsEllipsis:YES,menuPaneHeightPadding:0,menuItemPadding:35,leftAlign:function(){var val=0,controlSize=this.get("controlSize");if(controlSize===SC.SMALL_CONTROL_SIZE){val=-14}if(controlSize===SC.REGULAR_CONTROL_SIZE){val=-16}return val}.property("controlSize"),sortObjects:function(objects){if(!this.get("disableSort")){var nameKey=this.get("itemSortKey")||this.get("itemTitleKey");objects=objects.sort(function(a,b){if(nameKey){a=a.get?a.get(nameKey):a[nameKey];b=b.get?b.get(nameKey):b[nameKey]}return(a<b)?-1:((a>b)?1:0)})}return objects},render:function(context,firstTime){arguments.callee.base.apply(this,arguments);var layoutWidth,items,len,nameKey,iconKey,valueKey,separatorKey,showCheckbox,currentSelectedVal,shouldLocalize,isSeparator,itemList,isChecked,idx,name,icon,value,item;items=this.get("items");items=this.sortObjects(items);len=items.length;nameKey=this.get("itemTitleKey");iconKey=this.get("itemIconKey");valueKey=this.get("itemValueKey");separatorKey=this.get("itemSeparatorKey");showCheckbox=this.get("showCheckbox");currentSelectedVal=this.get("value");shouldLocalize=this.get("localize");itemList=[];isChecked=YES;idx=0;items.forEach(function(object){if(object){name=nameKey?(object.get?object.get(nameKey):object[nameKey]):object.toString();name=shouldLocalize?name.loc():name;icon=iconKey?(object.get?object.get(iconKey):object[iconKey]):null;if(SC.none(object[iconKey])){icon=null}value=(valueKey)?(object.get?object.get(valueKey):object[valueKey]):object;if(!SC.none(currentSelectedVal)&&!SC.none(value)){if(currentSelectedVal===value){this.set("title",name);this.set("icon",icon)}}if(value===this.get("value")){this.set("_itemIdx",idx);isChecked=!showCheckbox?NO:YES}else{isChecked=NO}isSeparator=separatorKey?(object.get?object.get(separatorKey):object[separatorKey]):NO;if(idx===0){this._defaultVal=value;this._defaultTitle=name;this._defaultIcon=icon}var item=SC.Object.create({separator:isSeparator,title:name,icon:icon,value:value,isEnabled:YES,checkbox:isChecked,action:this.displaySelectedItem});itemList.push(item)}idx+=1;this.set("_itemList",itemList)},this);if(firstTime){this.invokeLast(function(){var value=this.get("value");if(SC.none(value)){this.set("value",this._defaultVal);this.set("title",this._defaultTitle);this.set("icon",this._defaultIcon)}})}this.changeSelectButtonPreferMatrix(this._itemIdx)},_action:function(evt){var buttonLabel,menuWidth,scrollWidth,lastMenuWidth,offsetWidth,items,elementOffsetWidth,largestMenuWidth,item,element,idx,currSel,itemList,menuControlSize,menuHeightPadding,customView,customMenuView,menu,itemsLength;buttonLabel=this.$(".sc-button-label")[0];menuWidth=this.get("layer").offsetWidth;scrollWidth=buttonLabel.scrollWidth;lastMenuWidth=this.get("lastMenuWidth");if(scrollWidth){offsetWidth=buttonLabel.offsetWidth;if(scrollWidth&&offsetWidth){menuWidth=menuWidth+scrollWidth-offsetWidth}}if(!lastMenuWidth||(menuWidth>lastMenuWidth)){lastMenuWidth=menuWidth}items=this.get("_itemList");var customViewClassName=this.get("customViewClassName");var customViewMenuOffsetWidth=this.get("customViewMenuOffsetWidth");var className="sc-view sc-pane sc-panel sc-palette sc-picker sc-menu select-button sc-scroll-view sc-menu-scroll-view sc-container-view menuContainer sc-button-view sc-menu-item sc-regular-size";className=customViewClassName?(className+" "+customViewClassName):className;SC.prepareStringMeasurement("",className);for(idx=0,itemsLength=items.length;idx<itemsLength;++idx){item=items.objectAt(idx);elementOffsetWidth=SC.measureString(item.title).width;if(!largestMenuWidth||(elementOffsetWidth>largestMenuWidth)){largestMenuWidth=elementOffsetWidth}}SC.teardownStringMeasurement();lastMenuWidth=(largestMenuWidth+this.menuItemPadding>lastMenuWidth)?largestMenuWidth+this.menuItemPadding:lastMenuWidth;var maxWidth=SC.RootResponder.responder.get("currentWindowSize").width;if(lastMenuWidth>maxWidth){lastMenuWidth=(maxWidth-25)}this.set("lastMenuWidth",lastMenuWidth);currSel=this.get("_currentSelItem");itemList=this.get("_itemList");menuControlSize=this.get("controlSize");menuHeightPadding=this.get("menuPaneHeightPadding");customView=this.get("exampleView");customMenuView=customView?customView:SC.MenuItemView;menu=SC.MenuPane.create({classNames:["select-button"],items:itemList,exampleView:customMenuView,isEnabled:YES,menuHeightPadding:menuHeightPadding,preferType:SC.PICKER_MENU,itemHeightKey:"height",layout:{width:lastMenuWidth},controlSize:menuControlSize,itemWidth:lastMenuWidth,contentView:SC.View.extend({})});if(!menu){return NO}menu.popup(this,this.preferMatrix);menu.set("currentSelectedMenuItem",currSel);return YES},displaySelectedItem:function(){var menuView,currSel,itemViews,title,val,itemIdx=0,button,object,len,found=null,objTmp;menuView=this.parentMenu();currSel=menuView.get("currentSelectedMenuItem");itemViews=menuView.menuItemViews;if(currSel&&itemViews){itemIdx=itemViews.indexOf(currSel)}button=menuView.get("anchor");object=menuView.get("items");len=object.length;while(!found&&(--len>=0)){objTmp=object[len];title=!SC.none(objTmp.title)?objTmp.title:object.toString();val=!SC.none(objTmp.value)?objTmp.value:title;if(title===this.get("value")&&(itemIdx===len)){found=object;button.set("value",val);button.set("title",title)}}button.set("icon",this.get("icon")).set("_currentSelItem",currSel).set("_itemIdx",itemIdx)},changeSelectButtonPreferMatrix:function(){var preferMatrixAttributeTop=0,itemIdx=this.get("_itemIdx"),leftAlign=this.get("leftAlign"),defPreferMatrix,tempPreferMatrix;if(this.get("positionMenuBelow")){defPreferMatrix=[leftAlign,4,3];this.set("preferMatrix",defPreferMatrix)}else{if(itemIdx){preferMatrixAttributeTop=itemIdx*this.CUSTOM_MENU_ITEM_HEIGHT}tempPreferMatrix=[leftAlign,-preferMatrixAttributeTop,2];this.set("preferMatrix",tempPreferMatrix)}},mouseDown:function(evt){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;this.becomeFirstResponder();this._action();return YES},keyDown:function(event){if(this.interpretKeyEvents(event)){return YES}else{arguments.callee.base.apply(this,arguments)}},interpretKeyEvents:function(event){if(event){if((event.keyCode===38||event.keyCode===40)){this._action()}else{if(event.keyCode===27){this.resignFirstResponder()}}}return arguments.callee.base.apply(this,arguments)}});SC.SelectFieldView=SC.FieldView.extend({tagName:"select",classNames:["sc-select-field-view"],objects:[],objectsBindingDefault:SC.Binding.multiple(),nameKey:null,sortKey:null,valueKey:null,emptyName:null,localize:false,cpDidChange:YES,disableSort:NO,validateMenuItem:function(itemValue,itemName){return true},sortObjects:function(objects){if(!this.get("disableSort")){var nameKey=this.get("sortKey")||this.get("nameKey");objects=objects.sort(function(a,b){if(nameKey){a=a.get?a.get(nameKey):a[nameKey];b=b.get?b.get(nameKey):b[nameKey]}return(a<b)?-1:((a>b)?1:0)})}return objects},render:function(context,firstTime){if(this.get("cpDidChange")){this.set("cpDidChange",NO);var nameKey=this.get("nameKey");var valueKey=this.get("valueKey");var objects=this.get("objects");var fieldValue=this.get("value");var el,selectElement;var shouldLocalize=this.get("localize");if(!valueKey&&fieldValue){fieldValue=SC.guidFor(fieldValue)}if((fieldValue===null)||(fieldValue==="")){fieldValue="***"}if(objects){objects=this.sortObjects(objects);if(!firstTime){selectElement=this.$input()[0];selectElement.innerHTML=""}var emptyName=this.get("emptyName");if(emptyName){if(shouldLocalize){emptyName=emptyName.loc()}if(firstTime){context.push('<option value="***">'+emptyName+"</option>",'<option disabled="disabled"></option>')}else{el=document.createElement("option");el.value="***";el.innerHTML=emptyName;selectElement.appendChild(el);el=document.createElement("option");el.disabled="disabled";selectElement.appendChild(el)}}objects.forEach(function(object){if(object){var name=nameKey?(object.get?object.get(nameKey):object[nameKey]):object.toString();if(shouldLocalize){name=name.loc()}var value=(valueKey)?(object.get?object.get(valueKey):object[valueKey]):object;if(value){value=(SC.guidFor(value))?SC.guidFor(value):value.toString()}var disable=(this.validateMenuItem&&this.validateMenuItem(value,name))?"":'disabled="disabled" ';if(firstTime){context.push("<option "+disable+'value="'+value+'">'+name+"</option>")}else{el=document.createElement("option");el.value=value;el.innerHTML=name;if(disable.length>0){el.disable="disabled"}selectElement.appendChild(el)}}else{if(firstTime){context.push('<option disabled="disabled"></option>')}else{el=document.createElement("option");el.disabled="disabled";selectElement.appendChild(el)}}},this);this.setFieldValue(fieldValue)}else{this.set("value",null)}}},displayProperties:["objects","nameKey","valueKey"],_objectsObserver:function(){this.set("cpDidChange",YES)}.observes("objects"),_nameKeyObserver:function(){this.set("cpDidChange",YES)}.observes("nameKey"),_valueKeyObserver:function(){this.set("cpDidChange",YES)}.observes("valueKey"),$input:function(){return this.$()},mouseDown:function(evt){if(!this.get("isEnabled")){evt.stop();return YES}else{return arguments.callee.base.apply(this,arguments)}},getFieldValue:function(){var value=arguments.callee.base.apply(this,arguments);var valueKey=this.get("valueKey");var objects=this.get("objects");var found,object;if(value=="***"){value=null}else{if(value&&objects){var loc=(SC.typeOf(objects.length)===SC.T_FUNCTION)?objects.length():objects.length;found=null;while(!found&&(--loc>=0)){object=objects.objectAt?objects.objectAt(loc):objects[loc];if(valueKey){object=(object.get)?object.get(valueKey):object[valueKey]}var ov=(object)?(SC.guidFor(object)?SC.guidFor(object):object.toString()):null;if(value==ov){found=object}}}}return(valueKey||found)?found:value},setFieldValue:function(newValue){if(SC.none(newValue)){newValue=""}else{newValue=((newValue)?(SC.guidFor(newValue)?SC.guidFor(newValue):newValue.toString()):null)}this.$input().val(newValue);return this},fieldDidFocus:function(){var isFocused=this.get("isFocused");if(!isFocused){this.set("isFocused",true)}},fieldDidBlur:function(){var isFocused=this.get("isFocused");if(isFocused){this.set("isFocused",false)}},_isFocusedObserver:function(){this.$().setClass("focus",this.get("isFocused"))}.observes("isFocused"),didCreateLayer:function(){var input=this.$input();if(this.get("isEnabled")===false){this.$()[0].disabled=true}SC.Event.add(input,"blur",this,this.fieldDidBlur);SC.Event.add(input,"focus",this,this.fieldDidFocus);return arguments.callee.base.apply(this,arguments)},willDestroyLayer:function(){var input=this.$input();SC.Event.remove(input,"focus",this,this.fieldDidFocus);SC.Event.remove(input,"blur",this,this.fieldDidBlur);return arguments.callee.base.apply(this,arguments)}});SC.SliderView=SC.View.extend(SC.Control,{classNames:"sc-slider-view",handleSelector:"img.sc-handle",value:0.5,valueBindingDefault:SC.Binding.single().notEmpty(),minimum:0,minimumBindingDefault:SC.Binding.single().notEmpty(),contentMinimumKey:null,maximum:1,maximumBindingDefault:SC.Binding.single().notEmpty(),contentMaximumKey:null,step:0.1,displayProperties:"value minimum maximum".w(),render:function(context,firstTime){arguments.callee.base.apply(this,arguments);var min=this.get("minimum"),max=this.get("maximum"),value=this.get("value"),step=this.get("step");value=Math.min(Math.max(value,min),max);if(!SC.none(step)&&step!==0){value=Math.round(value/step)*step}if(value!==0){value=Math.floor((value-min)/(max-min)*100)}if(firstTime){var blankImage=SC.BLANK_IMAGE_URL;context.push('<span class="sc-inner">','<span class="sc-leftcap"></span>','<span class="sc-rightcap"></span>','<img src="',blankImage,'" class="sc-handle" style="left: ',value,'%" />',"</span>")}else{this.$(this.get("handleSelector")).css("left",value+"%")}},_isMouseDown:NO,mouseDown:function(evt){if(!this.get("isEnabled")){return YES}this.set("isActive",YES);this._isMouseDown=YES;return this._triggerHandle(evt)},mouseDragged:function(evt){return this._isMouseDown?this._triggerHandle(evt):YES},mouseUp:function(evt){if(this._isMouseDown){this.set("isActive",NO)}var ret=this._isMouseDown?this._triggerHandle(evt):YES;this._isMouseDown=NO;return ret},_triggerHandle:function(evt){var width=this.get("frame").width,min=this.get("minimum"),max=this.get("maximum"),step=this.get("step"),v=this.get("value"),loc;loc=this.convertFrameFromView({x:evt.pageX}).x;loc=Math.max(Math.min(loc,width-8),8)-8;width-=16;loc=loc/width;loc=min+((max-min)*loc);if(step!==0){loc=Math.round(loc/step)*step}if(Math.abs(v-loc)>=0.01){this.set("value",loc)}return YES},acceptsFirstResponder:function(){if(!SC.SAFARI_FOCUS_BEHAVIOR){return this.get("isEnabled")}else{return NO}}.property("isEnabled"),willBecomeKeyResponderFrom:function(keyView){if(!this._isFocused){this._isFocused=YES;this.becomeFirstResponder();if(this.get("isVisibleInWindow")){this.$()[0].focus()}}},willLoseKeyResponderTo:function(responder){if(this._isFocused){this._isFocused=NO}},keyDown:function(evt){if(evt.which===9){var view=evt.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");if(view){view.becomeFirstResponder()}else{evt.allowDefault()}return YES}if(evt.which===37||evt.which===38||evt.which===39||evt.which===40){var min=this.get("minimum"),max=this.get("maximum"),step=this.get("step"),size=max-min,val=0,calculateStep;if(evt.which===37||evt.which===38){if(step===0){if(size<100){val=this.get("value")-1}else{calculateStep=Math.abs(size/100);if(calculateStep<2){calculateStep=2}val=this.get("value")-Math.abs(size/100)}}else{val=this.get("value")-step}}if(evt.which===39||evt.which===40){if(step===0){if(size<100){val=this.get("value")+2}else{calculateStep=Math.abs(size/100);if(calculateStep<2){calculateStep=2}val=this.get("value")+calculateStep}}else{val=this.get("value")+step}}if(val>=min&&val<=max){this.set("value",val)}}SC.RunLoop.begin().end();return YES},contentPropertyDidChange:function(target,key){var content=this.get("content");this.beginPropertyChanges().updatePropertyFromContent("value",key,"contentValueKey",content).updatePropertyFromContent("minimum",key,"contentMinimumKey",content).updatePropertyFromContent("maximum",key,"contentMaximumKey",content).updatePropertyFromContent("isIndeterminate",key,"contentIsIndeterminateKey",content).endPropertyChanges()}});sc_require("mixins/collection_group");sc_require("views/disclosure");SC.SourceListGroupView=SC.View.extend(SC.Control,SC.CollectionGroup,{classNames:["sc-source-list-group"],content:null,isGroupVisible:YES,hasGroupTitle:YES,groupTitleKey:null,groupVisibleKey:null,render:function(context,firstTime){context.push('<div role="button" class="sc-source-list-label sc-disclosure-view sc-button-view button disclosure no-disclosure">','<img src="'+SC.BLANK_IMAGE_URL+'" class="button" />','<span class="label"></span></div>')},createChildViews:function(){},contentPropertyDidChange:function(target,key){var content=this.get("content");var labelView=this.outlet("labelView");if(content===null){labelView.setIfChanged("isVisible",NO);this.setIfChanged("hasGroupTitle",NO);return}else{labelView.setIfChanged("isVisible",YES);this.setIfChanged("hasGroupTitle",YES)}var groupTitleKey=this.getDelegateProperty("groupTitleKey",this.displayDelegate);if((key=="*")||(groupTitleKey&&(key==groupTitleKey))){var title=(content&&content.get&&groupTitleKey)?content.get(groupTitleKey):content;if(title!=this._title){this._title=title;if(title){title=title.capitalize()}labelView.set("title",title)}}var groupVisibleKey=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);if((key=="*")||(groupVisibleKey&&(key==groupVisibleKey))){if(groupVisibleKey){labelView.removeClassName("no-disclosure");var isVisible=(content&&content.get)?!!content.get(groupVisibleKey):YES;if(isVisible!=this.get("isGroupVisible")){this.set("isGroupVisible",isVisible);labelView.set("value",isVisible)}}else{labelView.addClassName("no-disclosure")}}},disclosureValueDidChange:function(newValue){if(newValue==this.get("isGroupVisible")){return}var group=this.get("content");var groupVisibleKey=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);if(group&&group.set&&groupVisibleKey){group.set(groupVisibleKey,newValue)}this.set("isGroupVisible",newValue);if(this.owner&&this.owner.updateChildren){this.owner.updateChildren(true)}},labelView:SC.DisclosureView.extend({value:YES,_valueObserver:function(){if(this.owner){this.owner.disclosureValueDidChange(this.get("value"))}}.observes("value")})});sc_require("views/list");sc_require("views/source_list_group");SC.BENCHMARK_SOURCE_LIST_VIEW=YES;SC.SourceListView=SC.ListView.extend({classNames:["sc-source-list"],rowHeight:32,selectOnMouseDown:NO,actOnSelect:YES});sc_require("views/split");SC.SplitDividerView=SC.View.extend({classNames:["sc-split-divider-view"],prepareContext:function(context,firstTime){var splitView=this.get("splitView");if(splitView){this.set("cursor",splitView.get("thumbViewCursor"))}return arguments.callee.base.apply(this,arguments)},mouseDown:function(evt){var splitView=this.get("splitView");return(splitView)?splitView.mouseDownInThumbView(evt,this):arguments.callee.base.apply(this,arguments)},doubleClick:function(evt){var splitView=this.get("splitView");return(splitView)?splitView.doubleClickInThumbView(evt,this):arguments.callee.base.apply(this,arguments)}});sc_require("views/split_divider");SC.RESIZE_BOTH="resize-both";SC.RESIZE_TOP_LEFT="resize-top-left";SC.RESIZE_BOTTOM_RIGHT="resize-bottom-right";SC.SplitView=SC.View.extend({classNames:["sc-split-view"],displayProperties:["layoutDirection"],delegate:null,layoutDirection:SC.LAYOUT_HORIZONTAL,canCollapseViews:YES,autoresizeBehavior:SC.RESIZE_BOTTOM_RIGHT,defaultThickness:0.5,isSplitView:YES,topLeftView:SC.View,dividerView:SC.SplitDividerView,bottomRightView:SC.View,topLeftThickness:function(){var view=this.get("topLeftView");return view?this.thicknessForView(view):0}.property("topLeftView").cacheable(),bottomRightThickness:function(){var view=this.get("bottomRightView");return view?this.thicknessForView(view):0}.property("bottomRightView").cacheable(),thumbViewCursor:null,canCollapseView:function(view){return this.invokeDelegateMethod(this.delegate,"splitViewCanCollapse",this,view)},thicknessForView:function(view){var direction=this.get("layoutDirection"),ret=view.get("frame");return(direction===SC.LAYOUT_HORIZONTAL)?ret.width:ret.height},createChildViews:function(){var childViews=[],viewAry=["topLeftView","dividerView","bottomRightView"],view,idx,len;for(idx=0,len=viewAry.length;idx<len;++idx){if(view=this.get(viewAry[idx])){view=this[viewAry[idx]]=this.createChildView(view,{layoutView:this,rootElementPath:[idx]});childViews.push(view)}}this.set("childViews",childViews);return this},updateChildLayout:function(){var topLeftView=this.get("topLeftView"),bottomRightView=this.get("bottomRightView"),dividerView=this.get("dividerView"),direction=this.get("layoutDirection"),topLeftThickness=this._desiredTopLeftThickness;var dividerThickness=this.get("dividerThickness");dividerThickness=(!SC.none(dividerThickness))?dividerThickness:7;var splitViewThickness=(direction===SC.LAYOUT_HORIZONTAL)?this.get("frame").width:this.get("frame").height,bottomRightThickness=splitViewThickness-dividerThickness-topLeftThickness,autoresizeBehavior=this.get("autoresizeBehavior"),layout,isCollapsed;isCollapsed=topLeftView.get("isCollapsed")||NO;topLeftView.setIfChanged("isVisible",!isCollapsed);layout=SC.clone(topLeftView.get("layout"));if(direction===SC.LAYOUT_HORIZONTAL){layout.top=0;layout.left=0;layout.bottom=0;switch(autoresizeBehavior){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:layout.right=bottomRightThickness+dividerThickness;delete layout.width;break;case SC.RESIZE_BOTTOM_RIGHT:delete layout.right;delete layout.height;layout.width=topLeftThickness;break}}else{layout.top=0;layout.left=0;layout.right=0;switch(autoresizeBehavior){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:layout.bottom=bottomRightThickness+dividerThickness;delete layout.height;break;case SC.RESIZE_BOTTOM_RIGHT:delete layout.bottom;delete layout.width;layout.height=topLeftThickness;break}}topLeftView.set("layout",layout);if(dividerView){layout=SC.clone(dividerView.get("layout"));if(direction===SC.LAYOUT_HORIZONTAL){layout.width=dividerThickness;delete layout.height;layout.top=0;layout.bottom=0;switch(autoresizeBehavior){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:delete layout.left;layout.right=bottomRightThickness;delete layout.centerX;delete layout.centerY;break;case SC.RESIZE_BOTTOM_RIGHT:layout.left=topLeftThickness;delete layout.right;delete layout.centerX;delete layout.centerY;break}}else{delete layout.width;layout.height=dividerThickness;layout.left=0;layout.right=0;switch(autoresizeBehavior){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_TOP_LEFT:delete layout.top;layout.bottom=bottomRightThickness;delete layout.centerX;delete layout.centerY;break;case SC.RESIZE_BOTTOM_RIGHT:layout.top=topLeftThickness;delete layout.bottom;delete layout.centerX;delete layout.centerY;break}}dividerView.set("layout",layout)}isCollapsed=bottomRightView.get("isCollapsed")||NO;bottomRightView.setIfChanged("isVisible",!isCollapsed);layout=SC.clone(bottomRightView.get("layout"));if(direction===SC.LAYOUT_HORIZONTAL){layout.top=0;layout.bottom=0;layout.right=0;switch(autoresizeBehavior){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_BOTTOM_RIGHT:layout.left=topLeftThickness+dividerThickness;delete layout.width;break;case SC.RESIZE_TOP_LEFT:delete layout.left;layout.width=bottomRightThickness;break}}else{layout.left=0;layout.right=0;layout.bottom=0;switch(autoresizeBehavior){case SC.RESIZE_BOTH:throw"SC.RESIZE_BOTH is currently unsupported.";case SC.RESIZE_BOTTOM_RIGHT:layout.top=topLeftThickness+dividerThickness;delete layout.height;break;case SC.RESIZE_TOP_LEFT:delete layout.top;layout.height=bottomRightThickness;break}}bottomRightView.set("layout",layout);this.notifyPropertyChange("topLeftThickness").notifyPropertyChange("bottomRightThickness")},renderLayout:function(context,firstTime){if(firstTime||this._recalculateDivider){if(!this.get("thumbViewCursor")){this.set("thumbViewCursor",SC.Cursor.create())}var layoutDirection=this.get("layoutDirection"),fr=this.get("frame"),splitViewThickness,elemRendered=this.$(),desiredThickness=this.get("defaultThickness"),autoResizeBehavior=this.get("autoresizeBehavior");var dividerThickness=this.get("dividerThickness");dividerThickness=(!SC.none(dividerThickness))?dividerThickness:7;if(this._recalculateDivider===undefined&&desiredThickness<1){this._recalculateDivider=YES}else{if(this._recalculateDivider){this._recalculateDivider=NO}}if(elemRendered[0]){splitViewThickness=(layoutDirection===SC.LAYOUT_HORIZONTAL)?elemRendered[0].offsetWidth:elemRendered[0].offsetHeight}else{splitViewThickness=(layoutDirection===SC.LAYOUT_HORIZONTAL)?fr.width:fr.height}if(SC.none(desiredThickness)||(desiredThickness>0&&desiredThickness<1)){desiredThickness=Math.floor((splitViewThickness-(dividerThickness))*(desiredThickness||0.5))}if(autoResizeBehavior===SC.RESIZE_BOTTOM_RIGHT){this._desiredTopLeftThickness=desiredThickness}else{this._desiredTopLeftThickness=splitViewThickness-dividerThickness-desiredThickness}this._topLeftView=this.get("topLeftView");this._bottomRightView=this.get("bottomRightView");this._topLeftViewThickness=this.thicknessForView(this.get("topLeftView"));this._bottomRightThickness=this.thicknessForView(this.get("bottomRightView"));this._dividerThickness=this.get("dividerThickness");this._layoutDirection=this.get("layoutDirection");this._updateTopLeftThickness(0);this._setCursorStyle();this.updateChildLayout()}arguments.callee.base.apply(this,arguments)},render:function(context,firstTime){arguments.callee.base.apply(this,arguments);if(this._inLiveResize){this._setCursorStyle()}var dir=this.get("layoutDirection");if(dir===SC.LAYOUT_HORIZONTAL){context.addClass("sc-horizontal")}else{context.addClass("sc-vertical")}},mouseDownInThumbView:function(evt,thumbView){var responder=this.getPath("pane.rootResponder");if(!responder){return NO}responder.dragDidStart(this);this._mouseDownX=evt.pageX;this._mouseDownY=evt.pageY;this._thumbView=thumbView;this._topLeftView=this.get("topLeftView");this._bottomRightView=this.get("bottomRightView");this._topLeftViewThickness=this.thicknessForView(this.get("topLeftView"));this._bottomRightThickness=this.thicknessForView(this.get("bottomRightView"));this._dividerThickness=this.get("dividerThickness");this._layoutDirection=this.get("layoutDirection");this.beginLiveResize();this._inLiveResize=YES;return YES},mouseDragged:function(evt){var offset=(this._layoutDirection===SC.LAYOUT_HORIZONTAL)?evt.pageX-this._mouseDownX:evt.pageY-this._mouseDownY;this._updateTopLeftThickness(offset);return YES},mouseUp:function(evt){if(this._inLiveResize===YES){this._thumbView=null;this._inLiveResize=NO;this.endLiveResize();return YES}return NO},doubleClickInThumbView:function(evt,thumbView){var view=this._topLeftView,isCollapsed=view.get("isCollapsed")||NO;if(!isCollapsed&&!this.canCollapseView(view)){view=this._bottomRightView;isCollapsed=view.get("isCollapsed")||NO;if(!isCollapsed&&!this.canCollapseView(view)){return NO}}if(!isCollapsed){this._uncollapsedThickness=this.thicknessForView(view);if(view===this._topLeftView){this._updateTopLeftThickness(this.topLeftThickness()*-1)}else{this._updateBottomRightThickness(this.bottomRightThickness()*-1)}if(!view.get("isCollapsed")){this._uncollapsedThickness=null}}else{if(view===this._topLeftView){this._updateTopLeftThickness(this._uncollapsedThickness)}else{this._updateBottomRightThickness(this._uncollapsedThickness)}view._uncollapsedThickness=null}this._setCursorStyle();return true},_updateTopLeftThickness:function(offset){var topLeftView=this._topLeftView,bottomRightView=this._bottomRightView,topLeftViewThickness=this.thicknessForView(topLeftView),bottomRightViewThickness=this.thicknessForView(bottomRightView),minAvailable=this._dividerThickness,maxAvailable=0,proposedThickness=this._topLeftViewThickness+offset,direction=this._layoutDirection,bottomRightCanCollapse=this.canCollapseView(bottomRightView),thickness=proposedThickness,max=this.get("topLeftMaxThickness"),min=this.get("topLeftMinThickness"),bottomRightThickness,tlCollapseAtThickness,brCollapseAtThickness;if(!topLeftView.get("isCollapsed")){maxAvailable+=topLeftViewThickness}if(!bottomRightView.get("isCollapsed")){maxAvailable+=bottomRightViewThickness}if(!SC.none(max)){thickness=Math.min(max,thickness)}if(!SC.none(min)){thickness=Math.max(min,thickness)}max=this.get("bottomRightMaxThickness");min=this.get("bottomRightMinThickness");bottomRightThickness=maxAvailable-thickness;if(!SC.none(max)){bottomRightThickness=Math.min(max,bottomRightThickness)}if(!SC.none(min)){bottomRightThickness=Math.max(min,bottomRightThickness)}thickness=maxAvailable-bottomRightThickness;thickness=this.invokeDelegateMethod(this.delegate,"splitViewConstrainThickness",this,topLeftView,thickness);thickness=Math.min(thickness,maxAvailable);thickness=Math.max(0,thickness);tlCollapseAtThickness=topLeftView.get("collapseAtThickness");if(!tlCollapseAtThickness){tlCollapseAtThickness=0}brCollapseAtThickness=bottomRightView.get("collapseAtThickness");brCollapseAtThickness=SC.none(brCollapseAtThickness)?maxAvailable:(maxAvailable-brCollapseAtThickness);if((proposedThickness<=tlCollapseAtThickness)&&this.canCollapseView(topLeftView)){max=bottomRightView.get("maxThickness");if(!max||(minAvailable+maxAvailable)<=max){thickness=0}}else{if(proposedThickness>=brCollapseAtThickness&&this.canCollapseView(bottomRightView)){max=topLeftView.get("maxThickness");if(!max||(minAvailable+maxAvailable)<=max){thickness=maxAvailable}}}if(thickness!=this.thicknessForView(topLeftView)){this._desiredTopLeftThickness=thickness;topLeftView.set("isCollapsed",thickness===0);bottomRightView.set("isCollapsed",thickness>=maxAvailable);this.updateChildLayout();this.displayDidChange()}},_updateBottomRightThickness:function(offset){var topLeftView=this._topLeftView,bottomRightView=this._bottomRightView,topLeftViewThickness=this.thicknessForView(topLeftView),bottomRightViewThickness=this.thicknessForView(bottomRightView),minAvailable=this._dividerThickness,maxAvailable=0,proposedThickness=this._topLeftViewThickness+offset,direction=this._layoutDirection,bottomRightCanCollapse=this.canCollapseView(bottomRightView),thickness=proposedThickness,max=this.get("topLeftMaxThickness"),min=this.get("topLeftMinThickness"),bottomRightThickness,tlCollapseAtThickness,brCollapseAtThickness;if(!topLeftView.get("isCollapsed")){maxAvailable+=topLeftViewThickness}if(!bottomRightView.get("isCollapsed")){maxAvailable+=bottomRightViewThickness}if(!SC.none(max)){thickness=Math.min(max,thickness)}if(!SC.none(min)){thickness=Math.max(min,thickness)}max=this.get("bottomRightMaxThickness");min=this.get("bottomRightMinThickness");bottomRightThickness=maxAvailable-thickness;if(!SC.none(max)){bottomRightThickness=Math.min(max,bottomRightThickness)}if(!SC.none(min)){bottomRightThickness=Math.max(min,bottomRightThickness)}thickness=maxAvailable-bottomRightThickness;thickness=this.invokeDelegateMethod(this.delegate,"splitViewConstrainThickness",this,topLeftView,thickness);thickness=Math.min(thickness,maxAvailable);thickness=Math.max(0,thickness);tlCollapseAtThickness=topLeftView.get("collapseAtThickness");if(!tlCollapseAtThickness){tlCollapseAtThickness=0}brCollapseAtThickness=bottomRightView.get("collapseAtThickness");brCollapseAtThickness=SC.none(brCollapseAtThickness)?maxAvailable:(maxAvailable-brCollapseAtThickness);if((proposedThickness<=tlCollapseAtThickness)&&this.canCollapseView(topLeftView)){max=bottomRightView.get("maxThickness");if(!max||(minAvailable+maxAvailable)<=max){thickness=0}}else{if(proposedThickness>=brCollapseAtThickness&&this.canCollapseView(bottomRightView)){max=topLeftView.get("maxThickness");if(!max||(minAvailable+maxAvailable)<=max){thickness=maxAvailable}}}if(thickness!=this.thicknessForView(topLeftView)){this._desiredTopLeftThickness=thickness;topLeftView.set("isCollapsed",thickness===0);bottomRightView.set("isCollapsed",thickness>=maxAvailable);this.updateChildLayout();this.displayDidChange()}},_setCursorStyle:function(){var topLeftView=this._topLeftView,bottomRightView=this._bottomRightView,thumbViewCursor=this.get("thumbViewCursor"),tlThickness=this.thicknessForView(topLeftView),brThickness=this.thicknessForView(bottomRightView);this._layoutDirection=this.get("layoutDirection");if(topLeftView.get("isCollapsed")||tlThickness===this.get("topLeftMinThickness")||brThickness==this.get("bottomRightMaxThickness")){thumbViewCursor.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"e-resize":"s-resize")}else{if(bottomRightView.get("isCollapsed")||tlThickness===this.get("topLeftMaxThickness")||brThickness==this.get("bottomRightMinThickness")){thumbViewCursor.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"w-resize":"n-resize")}else{if(SC.browser.msie){thumbViewCursor.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"e-resize":"n-resize")}else{thumbViewCursor.set("cursorStyle",this._layoutDirection===SC.LAYOUT_HORIZONTAL?"ew-resize":"ns-resize")}}}}.observes("layoutDirection"),splitViewCanCollapse:function(splitView,view){if(splitView.get("canCollapseViews")===NO){return NO}if(view.get("canCollapse")===NO){return NO}return YES},splitViewConstrainThickness:function(splitView,view,proposedThickness){return proposedThickness},_forceSplitCalculation:function(){this.updateLayout()}.observes("*pane.isPaneAttached"),viewDidResize:function(){arguments.callee.base.apply(this,arguments);this.notifyPropertyChange("topLeftThickness").notifyPropertyChange("bottomRightThickness")}.observes("layout")});sc_require("views/collection");SC.StackedView=SC.CollectionView.extend({classNames:["sc-stacked-view"],layout:{top:0,left:0,right:0,height:1},computeNowShowing:function(rect){return this.get("allContentIndexes")},updateHeight:function(immediately){if(immediately){this._updateHeight()}else{this.invokeLast(this._updateHeight)}return this},_updateHeight:function(){var childViews=this.get("childViews"),len=childViews.get("length"),view,layer,height;if(len===0){height=1}else{view=childViews.objectAt(len-1);layer=view?view.get("layer"):null;height=layer?(layer.offsetTop+layer.offsetHeight):1;layer=null}this.adjust("height",height)},didReload:function(set){return this.updateHeight()},didCreateLayer:function(){return this.updateHeight()}});sc_require("views/segmented");SC.TOP_LOCATION="top";SC.TOP_TOOLBAR_LOCATION="top-toolbar";SC.BOTTOM_LOCATION="bottom";SC.TabView=SC.View.extend({classNames:["sc-tab-view"],displayProperties:["nowShowing"],nowShowing:null,items:[],isEnabled:YES,itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemToolTipKey:null,tabHeight:SC.REGULAR_BUTTON_HEIGHT,tabLocation:SC.TOP_LOCATION,userDefaultKey:null,_tab_nowShowingDidChange:function(){var v=this.get("nowShowing");this.get("containerView").set("nowShowing",v);this.get("segmentedView").set("value",v);return this}.observes("nowShowing"),_tab_saveUserDefault:function(){var v=this.get("nowShowing");var defaultKey=this.get("userDefaultKey");if(defaultKey){SC.userDefaults.set([defaultKey,"nowShowing"].join(":"),v)}}.observes("nowShowing"),_tab_itemsDidChange:function(){this.get("segmentedView").set("items",this.get("items"));return this}.observes("items"),init:function(){arguments.callee.base.apply(this,arguments);this._tab_nowShowingDidChange()._tab_itemsDidChange()},awake:function(){arguments.callee.base.apply(this,arguments);var defaultKey=this.get("userDefaultKey");if(defaultKey){defaultKey=[defaultKey,"nowShowing"].join(":");var nowShowing=SC.userDefaults.get(defaultKey);if(!SC.none(nowShowing)){this.set("nowShowing",nowShowing)}}},createChildViews:function(){var childViews=[],view,containerView,layout,tabLocation=this.get("tabLocation"),tabHeight=this.get("tabHeight");layout=(tabLocation===SC.TOP_LOCATION)?{top:tabHeight/2+1,left:0,right:0,bottom:0}:(tabLocation===SC.TOP_TOOLBAR_LOCATION)?{top:tabHeight+1,left:0,right:0,bottom:0}:{top:0,left:0,right:0,bottom:tabHeight-1};containerView=this.containerView.extend(SC.Border,{layout:layout,borderStyle:SC.BORDER_BLACK});view=this.containerView=this.createChildView(containerView);childViews.push(view);layout=(tabLocation===SC.TOP_LOCATION||tabLocation===SC.TOP_TOOLBAR_LOCATION)?{height:tabHeight,left:0,right:0,top:0}:{height:tabHeight,left:0,right:0,bottom:0};this.segmentedView=this.get("segmentedView").extend({layout:layout,_sc_tab_segmented_valueDidChange:function(){var pv=this.get("parentView");if(pv){pv.set("nowShowing",this.get("value"))}this.set("layerNeedsUpdate",YES);this.invokeOnce(this.updateLayerIfNeeded)}.observes("value"),init:function(){var pv=this.get("parentView");if(pv){SC._TAB_ITEM_KEYS.forEach(function(k){this[k]=pv.get(k)},this)}return arguments.callee.base.apply(this,arguments)}});view=this.segmentedView=this.createChildView(this.segmentedView);childViews.push(view);this.set("childViews",childViews);return this},containerView:SC.ContainerView,segmentedView:SC.SegmentedView});SC._TAB_ITEM_KEYS="itemTitleKey itemValueKey itemIsEnabledKey itemIconKey itemWidthKey itemToolTipKey".w();SC.ThumbView=SC.View.extend({classNames:["sc-thumb-view"],isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),prepareContext:function(context,firstTime){var splitView=this.get("splitView");if(splitView){this.set("cursor",splitView.get("thumbViewCursor"))}return arguments.callee.base.apply(this,arguments)},mouseDown:function(evt){if(!this.get("isEnabled")){return NO}var splitView=this.get("splitView");return(splitView)?splitView.mouseDownInThumbView(evt,this):arguments.callee.base.apply(this,arguments)}});SC.ToolbarView=SC.View.extend({classNames:["sc-toolbar-view"],anchorLocation:null,layout:{left:0,height:32,right:0},init:function(){if(this.anchorLocation){this.layout=SC.merge(this.layout,this.anchorLocation)}arguments.callee.base.apply(this,arguments)}});SC.WebView=SC.View.extend(SC.Control,{classNames:"sc-web-view",displayProperties:["value","shouldAutoResize"],shouldAutoResize:NO,render:function(context,firstTime){var src=this.get("value");if(firstTime){context.push('<iframe src="'+src+'" style="position: absolute; width: 100%; height: 100%; border: 0px; margin: 0px; padding: 0p;"></iframe>')}else{var iframe=this.$("iframe");iframe.attr("src","javascript:;");iframe.attr("src",src)}},didCreateLayer:function(){var f=this.$("iframe");SC.Event.add(f,"load",this,this.iframeDidLoad)},iframeDidLoad:function(){if(this.get("shouldAutoResize")===YES){var contentWindow;var iframeElt=this.$("iframe")[0];if(iframeElt&&iframeElt.contentWindow){contentWindow=iframeElt.contentWindow;if(contentWindow&&contentWindow.document&&contentWindow.document.documentElement){var docElement=contentWindow.document.documentElement;if(!SC.browser.isIE){this.$().width(docElement.scrollWidth);this.$().height(docElement.scrollHeight)}else{this.$().width(docElement.scrollWidth+12);this.$().height(docElement.scrollHeight+5)}}}}}});SC.WELL_CONTAINER_PADDING=15;SC.WellView=SC.ContainerView.extend({classNames:"sc-well-view",contentLayout:{top:SC.WELL_CONTAINER_PADDING,bottom:SC.WELL_CONTAINER_PADDING,left:SC.WELL_CONTAINER_PADDING,right:SC.WELL_CONTAINER_PADDING},createChildViews:function(){var view=this.get("contentView");if(view){view=this.contentView=this.createChildView(view);view.set("layout",this.contentLayout);this.childViews=[view]}},render:function(context,firstTime){if(firstTime){context.push("<div class='top-left-edge'></div>","<div class='top-edge'></div>","<div class='top-right-edge'></div>","<div class='right-edge'></div>","<div class='bottom-right-edge'></div>","<div class='bottom-edge'></div>","<div class='bottom-left-edge'></div>","<div class='left-edge'></div>","<div class='content-background'></div>")}arguments.callee.base.apply(this,arguments)},contentViewDidChange:function(){var view=this.get("contentView");view.set("layout",this.contentLayout);this.replaceContent(view)}.observes("contentView")});tiki.script("sproutcore/desktop:en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/javascript.js");tiki.register("sproutcore/empty_theme",{scripts:[{url:"/static/sproutcore/empty_theme/en/21c3b7b16d7ef39d60d2651975590828812f3ad9/javascript.js",id:"sproutcore/empty_theme:en/21c3b7b16d7ef39d60d2651975590828812f3ad9/javascript.js"}]});tiki.module("sproutcore/empty_theme:index",function(require,exports,module){var m});tiki.script("sproutcore/empty_theme:en/21c3b7b16d7ef39d60d2651975590828812f3ad9/javascript.js");tiki.register("sproutcore",{packages:{"sproutcore/runtime":{scripts:[{url:"/static/sproutcore/runtime/en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js",id:"sproutcore/runtime:en/4e45a795ad83e4f4a267451bf706cc3fc2658096/javascript.js"}]},"sproutcore/datastore":{scripts:[{url:"/static/sproutcore/datastore/en/eb43c56c9a551db9bba1cd04f29ca1dfb2e47e4c/javascript.js",id:"sproutcore/datastore:en/eb43c56c9a551db9bba1cd04f29ca1dfb2e47e4c/javascript.js"}]},"sproutcore/foundation":{stylesheets:[{url:"/static/sproutcore/foundation/en/a04970954a917ede9918ca06897bc0e1406986d5/stylesheet.css",id:"sproutcore/foundation:en/a04970954a917ede9918ca06897bc0e1406986d5/stylesheet.css"}],scripts:[{url:"/static/sproutcore/foundation/en/a04970954a917ede9918ca06897bc0e1406986d5/javascript.js",id:"sproutcore/foundation:en/a04970954a917ede9918ca06897bc0e1406986d5/javascript.js"}]},"sproutcore/desktop":{stylesheets:[{url:"/static/sproutcore/desktop/en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/stylesheet.css",id:"sproutcore/desktop:en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/stylesheet.css"}],scripts:[{url:"/static/sproutcore/desktop/en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/javascript.js",id:"sproutcore/desktop:en/ecf7ecda0e8421fbcfcc4ebb8aafd0ff1cc97343/javascript.js"}]},tiki:{scripts:[{url:"/static/tiki/en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js",id:"tiki:en/f190e4e36f88857b033c419907d4b704109b7815/javascript.js"}]}},depends:["tiki","sproutcore/runtime","sproutcore/datastore","sproutcore/foundation","sproutcore/desktop"],scripts:[{url:"/static/sproutcore/en/b787d076ea5a03a72f4c0bdc1d1b432a40401c0b/javascript.js",id:"sproutcore:en/b787d076ea5a03a72f4c0bdc1d1b432a40401c0b/javascript.js"}]});tiki.module("sproutcore:index",function(require,exports,module,tiki){exports=module.exports=require("sproutcore/runtime");require("sproutcore/datastore")});tiki.module("sproutcore:license",function(require,exports,module,tiki){
/* @license
==========================================================================
SproutCore -- JavaScript Application Framework
copyright 2006-2009, Sprout Systems Inc., Apple Inc. and contributors.

Permission is hereby granted, free of charge, to any person obtaining a 
copy of this software and associated documentation files (the "Software"), 
to deal in the Software without restriction, including without limitation 
the rights to use, copy, modify, merge, publish, distribute, sublicense, 
and/or sell copies of the Software, and to permit persons to whom the 
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in 
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
DEALINGS IN THE SOFTWARE.

SproutCore and the SproutCore logo are trademarks of Sprout Systems, Inc.

For more information about SproutCore, visit http://www.sproutcore.com

==========================================================================
@license */
});tiki.script("sproutcore:en/b787d076ea5a03a72f4c0bdc1d1b432a40401c0b/javascript.js");tiki.register("bespin",{});tiki.module("bespin:builtins",function(require,exports,module){exports.metadata={bespin:{provides:[{ep:"extensionpoint",name:"extensionpoint",description:"Use the 'extensionpoint' extension point to define new extension points. You can provide an 'indexOn' property to name a property of extensions through which you'd like to be able to easily look up the extension. You can also provide a 'register' and 'unregister' properties which are pointers to functions that are called whenever a new extension is discovered or removed, respectively. 'register' and 'unregister' should be used sparingly, because your plugin will be loaded whenever a matching plugin is available."},{ep:"extensionpoint",name:"extensionhandler",description:"extensionhandlers are able to have 'register' and 'unregister' pointers to functions that are called with each extension as it is discovered or unregistered. Use 'register' sparingly as your plugin will be loaded automatically if there is a matching extension (and not just when your extension's functionality is required)."},{ep:"extensionpoint",name:"startup",description:"A function that should be called at startup. This should be used sparingly, as these plugins will be eagerly loaded at the beginning. All that's needed for this extension point is a pointer to a function that takes no arguments.",register:"plugins#startupHandler"},{ep:"extensionpoint",name:"factory",description:"Provides a factory for singleton components. Each extension needs to provide a name, a pointer and an action. The action can be 'call' (if the pointer refers to a function), 'create' (if the pointer refers to an SC.Object), 'new' (if the pointer refers to a traditional JS object) or 'value' (if the pointer refers to the object itself that is the component).",indexOn:"name"},{ep:"factory",name:"hub",action:"create",pointer:"util/hub#Hub"},{ep:"extensionpoint",name:"command",description:"Editor commands/actions. TODO: list parameters here."}]}}});tiki.module("bespin:console",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var names=["log","debug","info","warn","error","assert","dir","dirxml","trace","group","groupCollapsed","groupEnd","time","timeEnd","profile","profileEnd","count"];var dict={_error:function(){}};function stub(){this._error(arguments)}function redirect(name){return function(){window.console[name].apply(window.console,arguments)}}if(window.console){names.forEach(function(name){if(window.console[name]){dict[name]=redirect(name)}})}names.forEach(function(name){if(!dict[name]){dict[name]=stub}});if(!window.console){window.console=exports.console}exports.console=SC.Object.create(dict)});tiki.module("bespin:globals",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var installGlobals=function(){if(!Array.isArray){Array.isArray=function(data){return(data&&Object.prototype.toString.call(data)=="[object Array]")}}if(!Function.prototype.bind){Function.prototype.bind=function(){var args=Array.prototype.slice.call(arguments);var self=this;var bound=function(){return self.call.apply(self,args.concat(Array.prototype.slice.call(arguments)))};bound.name=this.name;bound.displayName=this.displayName;bound.length=this.length;bound.unbound=self;return bound}}SC.Object.prototype.sc_super=function super_name(){super_name.caller.base.apply(this,super_name.caller.arguments)};SC.objectForPropertyPathOriginal=SC.objectForPropertyPath;SC.objectForPropertyPath=function(path,root,stopAt){stopAt=(stopAt==undefined)?path.length:stopAt;var hashed=path.split("#");if(hashed.length==1){return SC.objectForPropertyPathOriginal(path,root,stopAt)}var module=require(hashed[0]);if(module===undefined){return undefined}stopAt=stopAt-hashed[0].length;return SC.objectForPropertyPathOriginal(hashed[1],module,stopAt)}};installGlobals()});tiki.module("bespin:plugins",function(require,exports,module){var SC=require("sproutcore/runtime").SC;require("globals");var Promise=require("promise").Promise;var builtins=require("builtins");var console=require("console").console;var r=require;var tiki=require.loader;var object_keys=Object.keys;if(!object_keys){object_keys=function(obj){var k,ret=[];for(k in obj){if(obj.hasOwnProperty(k)){ret.push(k)}}return ret}}var _splitPointer=function(pluginName,pointer){if(!pointer){return undefined}var parts=pointer.split("#");var modName;if(parts[0]){modName=pluginName+":"+parts[0]}else{modName=pluginName}return{modName:modName,objName:parts[1]}};var _retrieveObject=function(pointerObj){var module=r(pointerObj.modName);if(pointerObj.objName){return module[pointerObj.objName]}return module};exports.Extension=SC.Object.extend({_getPointer:function(property){property=property||"pointer";return _splitPointer(this._pluginName,this.get(property))},init:function(){this._observers=[]},load:function(callback,property){var pointer=this._getPointer(property);if(!pointer){console.error("Extension cannot be loaded because it has no 'pointer'");console.log(this);return null}var promise=new Promise();tiki.async(this._pluginName).then(function(){SC.run(function(){var module=r(pointer.modName);var data;if(pointer.objName){data=module[pointer.objName]}else{data=module}if(callback){callback(data)}promise.resolve(data)})});return promise},observe:function(observingPlugin,callback,property){this._observers.push({plugin:observingPlugin,callback:callback,property:property});this.load(callback,property)},getPluginName:function(){return this._pluginName},_getLoaded:function(property){var pointer=this._getPointer(property);return _retrieveObject(pointer)}});exports.ExtensionPoint=SC.Object.extend({init:function(){this.extensions=[];this.handlers=[]},getByKey:function(key){var indexOn=this.get("indexOn");if(!indexOn){return undefined}for(var i=0;i<this.extensions.length;i++){if(this.extensions[i][indexOn]==key){return this.extensions[i]}}return undefined},register:function(extension){this.extensions.push(extension);this.handlers.forEach(function(handler){if(handler.register){handler.load(function(register){register(extension)},"register")}})},unregister:function(extension){this.extensions.removeObject(extension);this.handlers.forEach(function(handler){if(handler.unregister){handler.load(function(unregister){unregister(extension)},"unregister")}})}});exports.Plugin=SC.Object.extend({register:function(){var provides=this.provides;var self=this;this.provides.forEach(function(extension){var ep=self.get("catalog").getExtensionPoint(extension.ep);ep.register(extension)})},unregister:function(){var provides=this.provides;var self=this;this.provides.forEach(function(extension){var ep=self.get("catalog").getExtensionPoint(extension.ep);ep.unregister(extension)})},_getObservers:function(){var result={};this.provides.forEach(function(extension){console.log("ep: ",extension.ep);console.log(extension._observers);result[extension.ep]=extension._observers});return result},_findDependents:function(pluginList,dependents){var pluginName=this.name;var self=this;pluginList.forEach(function(testPluginName){if(testPluginName==pluginName){return}var plugin=self.catalog.plugins[testPluginName];if(plugin&&plugin.dependencies){for(dependName in plugin.dependencies){if(dependName==pluginName&&!dependents[testPluginName]){dependents[testPluginName]={keepModule:false};plugin._findDependents(pluginList,dependents)}}}})},_cleanup:function(){var pluginName=this.get("name");var nameMatch=new RegExp("^"+pluginName+":");_removeFromList(nameMatch,tiki.scripts);_removeFromList(nameMatch,tiki.modules,function(module){delete tiki._factories[module]});_removeFromList(nameMatch,tiki.stylesheets);_removeFromList(new RegExp("^"+pluginName+"$"),tiki.packages);var promises=tiki._promises;delete promises.catalog[pluginName];delete promises.loads[pluginName];_removeFromObject(nameMatch,promises.modules);_removeFromObject(nameMatch,promises.scripts);_removeFromObject(nameMatch,promises.stylesheets);delete tiki._catalog[pluginName]},reload:function(callback){var func,dependName;if(!this.get("reloadURL")){return}var pluginName=this.name;var reloadPointer=this.get("reloadPointer");if(reloadPointer){var pointer=_splitPointer(pluginName,reloadPointer);func=_retrieveObject(pointer);if(func){func()}else{console.error("Reload function could not be loaded. Aborting reload.");return}}var dependents={};var self=this;var pluginList=object_keys(this.catalog.plugins);this._findDependents(pluginList,dependents);var reloadDescription={pluginName:pluginName,dependents:dependents};for(dependName in dependents){var plugin=this.catalog.plugins[dependName];if(plugin.preRefresh){var parts=_splitPointer(dependName,plugin.preRefresh);func=_retrieveObject(parts);if(func){dependents[dependName]=func(reloadDescription)}}}this.unregister();for(dependName in dependents){this.catalog.plugins[dependName].unregister()}this._cleanup(pluginName);var fullModList=[];var sandbox=tiki.sandbox;var i=sandbox.modules.length;var dependRegexes=[];for(dependName in dependents){if(!dependents[dependName].keepModule){dependRegexes.push(new RegExp("^"+dependName+":"))}}var nameMatch=new RegExp("^"+pluginName+":");while(--i>=0){var item=sandbox.modules[i];if(nameMatch.exec(item)){fullModList.push(item)}else{var j=dependRegexes.length;while(--j>=0){if(dependRegexes[j].exec(item)){fullModList.push(item);break}}}}if(fullModList.length>0){sandbox.clear.apply(sandbox,fullModList)}this.catalog.loadMetadata(this.reloadURL).then(function(){tiki.async(pluginName).then(function(){SC.run(function(){for(dependName in dependents){self.catalog.plugins[dependName].register()}for(dependName in dependents){if(dependents[dependName].callPointer){var parts=_splitPointer(dependName,dependents[dependName].callPointer);func=_retrieveObject(parts);if(func){func(reloadDescription)}}}if(callback){callback()}})})})}});exports.Catalog=SC.Object.extend({init:function(){this.points={};this.plugins={};var ep=this.getExtensionPoint("extensionpoint");ep.set("indexOn","name");this.load(builtins.metadata)},getObject:function(name){var ext=this.getExtensionByKey("factory",name);if(ext===undefined){return undefined}var obj=ext.get("instance");if(obj){return obj}var exported=ext._getLoaded();var action=ext.action;if(action=="call"){obj=exported()}else{if(action=="create"){obj=exported.create()}else{if(action=="new"){obj=new exported()}else{if(action=="value"){obj=exported}else{throw new Error("Create action must be call|create|new|value. Found"+action)}}}}ext.set("instance",obj);return obj},getExtensionPoint:function(name){if(this.points[name]===undefined){this.points[name]=exports.ExtensionPoint.create({name:name,catalog:this})}return this.points[name]},getExtensions:function(name){var ep=this.getExtensionPoint(name);if(ep===undefined){return[]}return ep.extensions},getExtensionByKey:function(name,key){var ep=this.getExtensionPoint(name);if(ep===undefined){return undefined}return ep.getByKey(key)},_registerExtensionPoint:function(extension){var ep=this.getExtensionPoint(extension.name);ep.handlers.push(extension);if(extension.indexOn){ep.set("indexOn",extension.indexOn)}},_registerExtensionHandler:function(extension){var ep=this.getExtensionPoint(extension.name);ep.handlers.push(extension);if(extension.register){extension.load(function(register){if(!register){throw extension.name+" is not ready"}ep.extensions.forEach(function(ext){register(ext)})},"register")}},_toposort:function(metadata){var sorted=[];var visited={};var visit=function(key){if(key in visited||!(key in metadata)){return}visited[key]=true;var depends=metadata[key].dependencies;if(!SC.none(depends)){for(var dependName in depends){visit(dependName)}}sorted.push(key)};for(var key in metadata){visit(key)}return sorted},load:function(metadata){this._toposort(metadata).forEach(function(name){var md=metadata[name];md.catalog=this;if(md.provides){var provides=md.provides;for(var i=0;i<provides.length;i++){var extension=exports.Extension.create(provides[i]);extension._pluginName=name;provides[i]=extension;var epname=extension.ep;if(epname=="extensionpoint"){this._registerExtensionPoint(extension)}else{if(epname=="extensionhandler"){this._registerExtensionHandler(extension)}}var ep=this.getExtensionPoint(extension.ep);ep.register(extension)}}else{md.provides=[]}md.name=name;var plugin=exports.Plugin.create(md);this.plugins[name]=plugin},this)},loadPlugin:function(pluginName,callback){var p=tiki.async(pluginName);if(callback){p.then(callback,function(reason){console.error("Plugin loading canceled: ",reason)})}},loadMetadata:function(url){var pr=new Promise();SC.Request.create({address:url}).notify(0,this,this._metadataFinishedLoading,{callback:function(catalog,response){pr.resolve({catalog:catalog,response:response})}}).send("");return pr},removePlugin:function(pluginName){var plugins=this.get("plugins");var plugin=plugins[pluginName];if(plugin==undefined){throw new Error("Attempted to remove plugin "+pluginName+" which does not exist.")}plugin.unregister();plugin._cleanup();delete plugins[pluginName]},getResourceURL:function(pluginName){var plugin=this.plugins[pluginName];if(plugin==undefined){return undefined}return plugin.resourceURL},_metadataFinishedLoading:function(response,params){var pluginName;if(!response.isError){var body=response.body();var data=JSON.parse(body);for(pluginName in data){var md=data[pluginName];if(md.errors){console.error("Plugin ",pluginName," has errors:");md.errors.forEach(function(error){console.error(error)});delete data[pluginName];continue}if(md.dependencies){md.depends=object_keys(md.dependencies)}tiki.register(pluginName,md)}this.load(data);var plugins=this.plugins;for(pluginName in data){this._checkLoops(pluginName,plugins,[])}}if(params.callback){params.callback(this,response)}},_checkLoops:function(pluginName,data,trail){var circular=false;trail.forEach(function(node){if(pluginName===node){console.error("Circular dependency",pluginName,trail);circular=true}});if(circular){return}trail.push(pluginName);if(!data[pluginName]){console.error("Missing metadata for ",pluginName)}else{if(data[pluginName].dependencies){for(var dependency in data[pluginName].dependencies){var trailClone=trail.slice();this._checkLoops(dependency,data,trailClone)}}}},getPlugins:function(opts){var result=[];var onlyType=opts.onlyType;var plugins=this.get("plugins");for(var key in plugins){var plugin=plugins[key];if((onlyType&&plugin.type&&plugin.type!=onlyType)||plugin.name=="bespin"){continue}result.push(plugin)}var sortBy=opts.sortBy;if(!sortBy){sortBy=["name"]}var sortfunc=function(a,b){for(var i=0;i<sortBy.length;i++){var key=sortBy[i];if(a[key]<b[key]){return -1}else{if(b[key]<a[key]){return 1}}}return 0};result.sort(sortfunc);return result},loadObjectForPropertyPath:function(path,context){var promise=new Promise();var parts=/^([^:]+):([^#]+)#(.*)$/.exec(path);if(parts===null){throw new Error("loadObjectForPropertyPath: malformed path: '"+path+"'")}var pluginName=parts[1];if(pluginName===""){if(SC.none(context)){throw new Error("loadObjectForPropertyPath: no plugin name supplied and no context is present")}pluginName=context}tiki.async(pluginName).then(function(){promise.resolve(SC.objectForPropertyPath(path))});return promise}});var _removeFromList=function(regex,array,matchFunc){var i=0;while(i<array.length){if(regex.exec(array[i])){var item=array.splice(i,1);if(matchFunc){matchFunc(item)}continue}i++}};var _removeFromObject=function(regex,obj){var keys=object_keys(obj);var i=keys.length;while(--i>0){if(regex.exec(keys[i])){delete obj[keys[i]]}}};exports.catalog=exports.Catalog.create();exports.startupHandler=function(ep){ep.load(function(func){func()})};exports.getUserPlugins=function(){return exports.catalog.getPlugins({onlyType:"user"})}});tiki.module("bespin:promise",function(require,exports,module){var console=require("console").console;var printStackTrace=require("bespin:util/stacktrace").printStackTrace;try{var enqueue=require("event-queue").enqueue}catch(e){}if(!enqueue){enqueue=function(func){func()}}var Promise=function(canceller){};Promise.prototype.then=function(resolvedCallback,errorCallback,progressCallback){throw new TypeError("The Promise base class is abstract, this function must be implemented by the Promise implementation")};Promise.prototype.get=function(propertyName){return this.then(function(value){return value[propertyName]})};Promise.prototype.put=function(propertyName,value){return this.then(function(object){return object[propertyName]=value})};Promise.prototype.call=function(functionName){return this.then(function(value){return value[propertyName].apply(value,Array.prototype.slice.call(arguments,1))})};Promise.prototype.addCallback=function(callback){return this.then(callback)};Promise.prototype.addErrback=function(errback){return this.then(function(){},errback)};Promise.prototype.addBoth=function(callback){return this.then(callback,callback)};Promise.prototype.addCallbacks=function(callback,errback){return this.then(callback,errback)};Promise.prototype.wait=function(){return exports.wait(this)};Deferred.prototype=Promise.prototype;exports.Promise=exports.Deferred=exports.defer=defer;function defer(){return new Deferred()}var contextHandler=exports.contextHandler={};function Deferred(canceller,rejectImmediately){var result,finished,isError,waiting=[],handled;var promise=this.promise=new Promise();var currentContextHandler=contextHandler.getHandler&&contextHandler.getHandler();function notifyAll(value){if(finished){throw new Error("This deferred has already been resolved")}result=value;finished=true;if(rejectImmediately&&isError&&waiting.length===0){throw result}for(var i=0;i<waiting.length;i++){notify(waiting[i])}}function notify(listener){var func=(isError?listener.error:listener.resolved);if(func){handled=true;enqueue(function(){if(currentContextHandler){currentContextHandler.resume()}try{var newResult=func(result);if(newResult&&typeof newResult.then==="function"){newResult.then(listener.deferred.resolve,listener.deferred.reject);return}listener.deferred.resolve(newResult)}catch(e){listener.deferred.reject(e)}finally{if(currentContextHandler){currentContextHandler.suspend()}}})}else{listener.deferred[isError?"reject":"resolve"](result)}}this.resolve=this.callback=this.emitSuccess=function(value){notifyAll(value)};var reject=function(error){isError=true;notifyAll(error)};this.reject=this.errback=this.emitError=rejectImmediately?reject:function(error){return enqueue(function(){reject(error)})};this.progress=function(update){for(var i=0;i<waiting.length;i++){var progress=waiting[i].progress;progress&&progress(update)}};this.then=promise.then=function(resolvedCallback,errorCallback,progressCallback){var returnDeferred=new Deferred(promise.cancel,true);var listener={resolved:resolvedCallback,error:errorCallback,progress:progressCallback,deferred:returnDeferred};if(finished){notify(listener)}else{waiting.push(listener)}return returnDeferred.promise};if(canceller){this.cancel=promise.cancel=function(){var error=canceller();if(!(error instanceof Error)){error=new Error(error)}reject(error)}}this.valueIfResolved=function(){return finished?result:null}}function perform(value,async,sync){try{if(value&&typeof value.then==="function"){value=async(value)}else{value=sync(value)}if(value&&typeof value.then==="function"){return value}var deferred=new Deferred();deferred.resolve(value);return deferred.promise}catch(e){console.error("promise caught exception: ",e);console.log(printStackTrace({e:e}));var deferred=new Deferred();deferred.reject(e);return deferred.promise}}exports.whenPromise=function(value,resolvedCallback,rejectCallback,progressCallback){return perform(value,function(value){return value.then(resolvedCallback,rejectCallback,progressCallback)},function(value){return resolvedCallback(value)})};exports.when=function(value,resolvedCallback,rejectCallback,progressCallback){if(value&&typeof value.then==="function"){return exports.whenPromise(value,resolvedCallback,rejectCallback,progressCallback)}return resolvedCallback(value)};exports.get=function(target,property){return perform(target,function(target){return target.get(property)},function(target){return target[property]})};exports.post=function(target,methodName,args){return perform(target,function(target){return target.call(property,args)},function(target){return target[methodName].apply(target,args)})};exports.put=function(target,property,value){return perform(target,function(target){return target.put(property,value)},function(target){return target[property]=value})};exports.wait=function(target){if(!queue){throw new Error("Can not wait, the event-queue module is not available")}if(target&&typeof target.then==="function"){var isFinished,isError,result;target.then(function(value){isFinished=true;result=value},function(error){isFinished=true;isError=true;result=error});while(!isFinished){queue.processNextEvent(true)}if(isError){throw result}return result}else{return target}};exports.group=function(group){var deferred=defer();if(!(group instanceof Array)){group=Array.prototype.slice.call(arguments)}var fulfilled=0;var length=group.length;if(!length){deferred.resolve([]);return deferred.promise}var results=[];group.forEach(function(promise,index){exports.when(promise,function(value){results[index]=value;fulfilled++;if(fulfilled===length){deferred.resolve(results)}},deferred.reject)});return deferred.promise}});tiki.module("bespin:theme",function(require,exports,module){var SC=require("sproutcore/runtime").SC;exports.coffee={backgroundStyle:"#2A211C",gutterStyle:"#4c4a41",lineNumberColor:"#e5c138",lineNumberFont:"10pt Monaco, Lucida Console, monospace",lineMarkerErrorColor:"#CC4444",lineMarkerWarningColor:"#B8860B",lineMarkerMessageColor:"green",zebraStripeColor:"#2A211C",highlightCurrentLineColor:"#3a312b",editorTextFont:"10pt Monaco, Lucida Console, monospace",editorTextColor:"rgb(230, 230, 230)",editorSelectedTextColor:"rgb(240, 240, 240)",editorSelectedTextBackground:"#526DA5",cursorStyle:"#879aff",cursorType:"ibeam",unfocusedCursorStrokeStyle:"#FF0033",unfocusedCursorFillStyle:"#73171E",partialNibStyle:"rgba(100, 100, 100, 0.3)",partialNibArrowStyle:"rgba(255, 255, 255, 0.3)",partialNibStrokeStyle:"rgba(150, 150, 150, 0.3)",fullNibStyle:"rgb(100, 100, 100)",fullNibArrowStyle:"rgb(255, 255, 255)",fullNibStrokeStyle:"rgb(150, 150, 150)",scrollTrackFillStyle:"rgba(50, 50, 50, 0.8)",scrollTrackStrokeStyle:"rgb(150, 150, 150)",scrollBarFillStyle:"rgba(0, 0, 0, %a)",scrollBarFillGradientTopStart:"rgba(90, 90, 90, %a)",scrollBarFillGradientTopStop:"rgba(40, 40, 40, %a)",scrollBarFillGradientBottomStart:"rgba(22, 22, 22, %a)",scrollBarFillGradientBottomStop:"rgba(44, 44, 44, %a)",tabSpace:"#392A25",searchHighlight:"#B55C00",searchHighlightSelected:"#FF9A00",plain:"#bdae9d",keyword:"#42a8ed",string:"#039a0a",comment:"#666666","c-comment":"#666666",punctuation:"#888888",attribute:"#BF9464",test:"rgb(255,0,0)",cdata:"#bdae9d","attribute-value":"#039a0a",tag:"#46a8ed",color:"#c4646b","tag-name":"#46a8ed",value:"#039a0a",important:"#990000",sizes:"#990000",cssclass:"#BF9464",cssid:"#46a8ed",atom:"#aa4444",variable:"#000000",variabledef:"#000000",localvariable:"#000000",property:"#66bb33",operator:"#88bbff",error:"#FF0000",pjsconstants:"#cc6600",pjsfunctions:"#cc6600"};exports.coffeezebra={};SC.mixin(exports.coffeezebra,exports.coffee);exports.coffeezebra.zebraStripeColor="#FFFFFF";exports["default"]=exports.coffee});tiki.module("bespin:util/cookie",function(require,exports,module){var escapeString=function(str,except){return str.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(ch){if(except&&except.indexOf(ch)!=-1){return ch}return"\\"+ch})};exports.get=function(name){var matcher=new RegExp("(?:^|; )"+escapeString(name)+"=([^;]*)");var matches=document.cookie.match(matcher);return matches?decodeURIComponent(matches[1]):undefined};exports.set=function(name,value,props){props=props||{};if(typeof props.expires=="number"){var date=new Date();date.setTime(date.getTime()+props.expires*24*60*60*1000);props.expires=date}if(props.expires&&props.expires.toUTCString){props.expires=props.expires.toUTCString()}value=encodeURIComponent(value);var updatedCookie=name+"="+value,propName;for(propName in props){updatedCookie+="; "+propName;var propValue=props[propName];if(propValue!==true){updatedCookie+="="+propValue}}document.cookie=updatedCookie};exports.remove=function(name){exports.set(name,"",{expires:-1})};exports.isSupported=function(){if(!("cookieEnabled" in navigator)){exports.set("__djCookieTest__","CookiesAllowed");navigator.cookieEnabled=exports.get("__djCookieTest__")=="CookiesAllowed";if(navigator.cookieEnabled){exports.remove("__djCookieTest__")}}return navigator.cookieEnabled}});tiki.module("bespin:util/scratchcanvas",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var ScratchCanvas=SC.Object.extend({getContext:function(){return document.getElementById("bespin-scratch-canvas").getContext("2d")},init:function(){if(!SC.none(document.getElementById("bespin-scratch-canvas"))){return}var element=document.createElement("canvas");element.id="bespin-scratch-canvas";element.style.position="absolute";element.style.top="-10000px";element.style.left="-10000px";document.body.appendChild(element)},measureStringWidth:function(font,str){if(SC.none(str)){str="M"}var context=this.getContext();context.save();context.font=font;var width=context.measureText(str).width;context.restore();return width}});var singleton=null;exports.get=function(){if(singleton===null){singleton=ScratchCanvas.create()}return singleton}});tiki.module("bespin:util/stacktrace",function(require,exports,module){var util=require("bespin:util/util");var mode=(function(){if(util.isMozilla){return"firefox"}else{if(util.isOpera){return"opera"}else{if(util.isSafari){return"other"}}}try{(0)()}catch(e){if(e.arguments){return"chrome"}if(e.stack){return"firefox"}if(window.opera&&!("stacktrace" in e)){return"opera"}}return"other"})();function stringifyArguments(args){for(var i=0;i<args.length;++i){var argument=args[i];if(typeof argument=="object"){args[i]="#object"}else{if(typeof argument=="function"){args[i]="#function"}else{if(typeof argument=="string"){args[i]='"'+argument+'"'}}}}return args.join(",")}var decoders={chrome:function(e){return e.stack.replace(/^.*?\n/,"").replace(/^.*?\n/,"").replace(/^.*?\n/,"").replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n")},firefox:function(e){var stack=e.stack;if(!stack){console.log(e);return[]}stack=stack.replace(/(?:\n@:0)?\s+$/m,"");stack=stack.replace(/^\(/gm,"{anonymous}(");return stack.split("\n")},opera:function(e){var lines=e.message.split("\n"),ANON="{anonymous}",lineRE=/Line\s+(\d+).*?script\s+(http\S+)(?:.*?in\s+function\s+(\S+))?/i,i,j,len;for(i=4,j=0,len=lines.length;i<len;i+=2){if(lineRE.test(lines[i])){lines[j++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:ANON+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+lines[i+1].replace(/^\s+/,"")}}lines.splice(j,lines.length-j);return lines},other:function(curr){var ANON="{anonymous}",fnRE=/function\s*([\w\-$]+)?\s*\(/i,stack=[],j=0,fn,args;var maxStackSize=10;while(curr&&stack.length<maxStackSize){fn=fnRE.test(curr.toString())?RegExp.$1||ANON:ANON;args=Array.prototype.slice.call(curr["arguments"]);stack[j++]=fn+"("+stringifyArguments(args)+")";if(curr===curr.caller&&window.opera){break}curr=curr.caller}return stack}};function NameGuesser(){}NameGuesser.prototype={sourceCache:{},ajax:function(url){var req=this.createXMLHTTPObject();if(!req){return}req.open("GET",url,false);req.setRequestHeader("User-Agent","XMLHTTP/1.0");req.send("");return req.responseText},createXMLHTTPObject:function(){var xmlhttp,XMLHttpFactories=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]();this.createXMLHTTPObject=XMLHttpFactories[i];return xmlhttp}catch(e){}}},getSource:function(url){if(!(url in this.sourceCache)){this.sourceCache[url]=this.ajax(url).split("\n")}return this.sourceCache[url]},guessFunctions:function(stack){for(var i=0;i<stack.length;++i){var reStack=/{anonymous}\(.*\)@(\w+:\/\/([-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/;var frame=stack[i],m=reStack.exec(frame);if(m){var file=m[1],lineno=m[4];if(file&&lineno){var functionName=this.guessFunctionName(file,lineno);stack[i]=frame.replace("{anonymous}",functionName)}}}return stack},guessFunctionName:function(url,lineNo){try{return this.guessFunctionNameFromLines(lineNo,this.getSource(url))}catch(e){return"getSource failed with url: "+url+", exception: "+e.toString()}},guessFunctionNameFromLines:function(lineNo,source){var reFunctionArgNames=/function ([^(]*)\(([^)]*)\)/;var reGuessFunction=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(function|eval|new Function)/;var line="",maxLines=10;for(var i=0;i<maxLines;++i){line=source[lineNo-i]+line;if(line!==undefined){var m=reGuessFunction.exec(line);if(m){return m[1]}else{m=reFunctionArgNames.exec(line)}if(m&&m[1]){return m[1]}}}return"(?)"}};var guesser=new NameGuesser();var frameIgnorePatterns=[/http:\/\/localhost:4020\/sproutcore.js:/];exports.ignoreFramesMatching=function(regex){frameIgnorePatterns.push(regex)};exports.Trace=function Trace(ex,guess){this._ex=ex;this._stack=decoders[mode](ex);if(guess){this._stack=guesser.guessFunctions(this._stack)}};exports.Trace.prototype.log=function(lines){if(lines<=0){lines=999999999}var printed=0;for(var i=0;i<this._stack.length&&printed<lines;i++){var frame=this._stack[i];var display=true;frameIgnorePatterns.forEach(function(regex){if(regex.test(frame)){display=false}});if(display){console.debug(frame);printed++}}}});tiki.module("bespin:util/util",function(require,exports,module){exports.queryToObject=function(str,seperator){var ret={};var qp=str.split(seperator||"&");var dec=decodeURIComponent;qp.forEach(function(item){if(item.length){var parts=item.split("=");var name=dec(parts.shift());var val=dec(parts.join("="));if(exports.isString(ret[name])){ret[name]=[ret[name]]}if(Array.isArray(ret[name])){ret[name].push(val)}else{ret[name]=val}}});return ret};exports.objectToQuery=function(map){var enc=encodeURIComponent;var pairs=[];var backstop={};for(var name in map){var value=map[name];if(value!=backstop[name]){var assign=enc(name)+"=";if(value.isArray){for(var i=0;i<value.length;i++){pairs.push(assign+enc(value[i]))}}else{pairs.push(assign+enc(value))}}}return pairs.join("&")};var nextRateLimitId=0;var rateLimitTimeouts={};exports.rateLimit=function(maxRate,scope,func){if(maxRate){var rateLimitId=nextRateLimitId++;return function(){if(rateLimitTimeouts[rateLimitId]){clearTimeout(rateLimitTimeouts[rateLimitId])}rateLimitTimeouts[rateLimitId]=setTimeout(function(){func.apply(scope,arguments);delete rateLimitTimeouts[rateLimitId]},maxRate)}}};exports.isString=function(it){return(typeof it=="string"||it instanceof String)};exports.isObject=function(it){return it!==undefined&&(it===null||typeof it=="object"||Array.isArray(it)||exports.isFunction(it))};exports.isFunction=(function(){var _isFunction=function(it){var t=typeof it;return it&&(t=="function"||it instanceof Function)&&!it.nodeType};return exports.isSafari?function(it){if(typeof it=="function"&&it=="[object NodeList]"){return false}return _isFunction(it)}:_isFunction})();exports.endsWith=function(str,end){if(!str){return false}return str.match(new RegExp(end+"$"))};exports.include=function(array,item){return array.indexOf(item)>-1};exports.indexOfProperty=function(array,propertyName,item){for(var i=0;i<array.length;i++){if(array[i][propertyName]==item){return i}}return null};exports.last=function(array){if(Array.isArray(array)){return array[array.length-1]}};exports.shrinkArray=function(array){var newArray=[];var stillAtBeginning=true;array.reverse().forEach(function(item){if(stillAtBeginning&&item===undefined){return}stillAtBeginning=false;newArray.push(item)});return newArray.reverse()};exports.makeArray=function(number,character){if(number<1){return[]}if(!character){character=" "}var newArray=[];for(var i=0;i<number;i++){newArray.push(character)}return newArray};exports.repeatString=function(string,repeat){var newstring="";for(var i=0;i<repeat;i++){newstring+=string}return newstring};exports.leadingSpaces=function(row){var numspaces=0;for(var i=0;i<row.length;i++){if(row[i]==" "||row[i]==""||row[i]===undefined){numspaces++}else{return numspaces}}return numspaces};exports.leadingTabs=function(row){var numtabs=0;for(var i=0;i<row.length;i++){if(row[i]=="\t"||row[i]==""||row[i]===undefined){numtabs++}else{return numtabs}}return numtabs};exports.leadingWhitespace=function(row){var leading=[];for(var i=0;i<row.length;i++){if(row[i]==" "||row[i]=="\t"||row[i]==""||row[i]===undefined){leading.push(row[i])}else{return leading}}return leading};exports.englishFromCamel=function(camel){camel.replace(/([A-Z])/g,function(str){return" "+str.toLowerCase()}).trim()};exports.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"};var ua=navigator.userAgent;var av=navigator.appVersion;exports.isLinux=av.indexOf("Linux")>=0;exports.isWindows=av.indexOf("Win")>=0;exports.isWebKit=parseFloat(ua.split("WebKit/")[1])||undefined;exports.isChrome=parseFloat(ua.split("Chrome/")[1])||undefined;exports.isMac=av.indexOf("Macintosh")>=0;if(ua.indexOf("AdobeAIR")>=0){exports.isAIR=1}var index=Math.max(av.indexOf("WebKit"),av.indexOf("Safari"),0);if(index&&!exports.isChrome){exports.isSafari=parseFloat(av.split("Version/")[1]);if(!exports.isSafari||parseFloat(av.substr(index+7))<=419.3){exports.isSafari=2}}if(ua.indexOf("Gecko")>=0&&!exports.isWebKit){exports.isMozilla=parseFloat(av)}exports.getOS=function(){if(exports.isMac){return exports.OS.MAC}else{if(exports.isLinux){return exports.OS.LINUX}else{return exports.OS.WINDOWS}}};exports.contains=document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)&16}:function(a,b){return a!==b&&(a.contains?a.contains(b):true)};exports.stopEvent=function(ev){ev.preventDefault();ev.stopPropagation()};exports.randomPassword=function(length){length=length||16;var chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";var pass="";for(var x=0;x<length;x++){var charIndex=Math.floor(Math.random()*chars.length);pass+=chars.charAt(charIndex)}return pass};exports.isEmpty=function(object){for(var x in object){if(object.hasOwnProperty(x)){return false}}return true};exports.isMyProject=function(project){return project.indexOf("+")==-1};exports.formatDate=function(date){if(!date){return"Unknown"}return date.getDate()+" "+exports.formatDate.shortMonths[date.getMonth()]+" "+date.getFullYear()};exports.formatDate.shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});tiki.module("bespin:index",function(require,exports,module){});tiki.register("types",{});tiki.module("types:basic",function(require,exports,module){var catalog=require("bespin:plugins").catalog;var console=require("bespin:console").console;var Promise=require("bespin:promise").Promise;var r=require;exports.text={isValid:function(value,typeExt){return typeof value=="string"},toString:function(value,typeExt){return value},fromString:function(value,typeExt){return value}};exports.number={isValid:function(value,typeExt){if(isNaN(value)){return false}if(value===null){return false}if(value===undefined){return false}if(value===Infinity){return false}return typeof value=="number"},toString:function(value,typeExt){if(!value){return null}return""+value},fromString:function(value,typeExt){if(!value){return null}var reply=parseInt(value,10);if(isNaN(reply)){throw new Error("Can't convert '"+value+"' to a number.")}return reply}};exports.bool={isValid:function(value,typeExt){return typeof value=="boolean"},toString:function(value,typeExt){return""+value},fromString:function(value,typeExt){if(value===null){return null}if(!value.toLowerCase){return !!value}var lower=value.toLowerCase();if(lower=="true"){return true}else{if(lower=="false"){return false}}return !!value}};exports.object={isValid:function(value,typeExt){return typeof value=="object"},toString:function(value,typeExt){return JSON.stringify(value)},fromString:function(value,typeExt){return JSON.parse(value)}};exports.selection={isValid:function(value,typeExt){if(typeof value!="string"){return false}if(!typeExt.data){console.error("Missing data on selection type extension. Skipping");return true}var match=false;typeExt.data.forEach(function(option){if(value==option){match=true}});return match},toString:function(value,typeExt){return value},fromString:function(value,typeExt){return value},resolveTypeSpec:function(extension,typeSpec){var promise=new Promise();if(typeSpec.data){extension.data=typeSpec.data;promise.resolve()}else{if(typeSpec.pointer){catalog.loadObjectForPropertyPath(typeSpec.pointer).then(function(obj){var reply=obj(typeSpec);if(typeof reply.then==="function"){reply.then(function(data){extension.data=data;promise.resolve()})}else{extension.data=reply;promise.resolve()}},function(ex){promise.reject(ex)})}else{console.warn("Missing data/pointer for selection",typeSpec);promise.resolve()}}return promise}}});tiki.module("types:types",function(require,exports,module){var catalog=require("bespin:plugins").catalog;var console=require("bespin:console").console;var Promise=require("bespin:promise").Promise;exports.getSimpleName=function(typeSpec){if(!typeSpec){throw new Error("null|undefined is not a valid typeSpec")}if(typeof typeSpec=="string"){return typeSpec}if(typeof typeSpec=="object"){if(!typeSpec.name){throw new Error("Missing name member to typeSpec")}return typeSpec.name}throw new Error("Not a typeSpec: "+typeSpec)};exports.equals=function(typeSpec1,typeSpec2){return exports.getSimpleName(typeSpec1)==exports.getSimpleName(typeSpec2)};exports.undeferTypeSpec=function(typeSpec){var promise=new Promise();if(!typeSpec.pointer){promise.reject(new Error("Missing deferred pointer"));return promise}catalog.loadObjectForPropertyPath(typeSpec.pointer).then(function(obj){var reply=obj(typeSpec);if(typeof reply.then==="function"){reply.then(function(newTypeSpec){promise.resolve(newTypeSpec)},function(ex){promise.reject(ex)})}else{promise.resolve(reply)}},function(ex){promise.reject(ex)});return promise};function resolveObjectType(typeSpec){var promise=new Promise();var ext=catalog.getExtensionByKey("type",typeSpec.name);if(ext){promise.resolve({ext:ext,typeSpec:typeSpec})}else{promise.reject(new Error("Unknown type: "+typeSpec.name))}return promise}function resolveTypeExt(typeSpec){if(typeof typeSpec==="string"){return resolveObjectType({name:typeSpec})}if(typeof typeSpec==="object"){if(typeSpec.name==="deferred"){var promise=new Promise();exports.undeferTypeSpec(typeSpec).then(function(newTypeSpec){resolveTypeExt(newTypeSpec).then(function(reply){promise.resolve(reply)},function(ex){promise.reject(ex)})});return promise}else{return resolveObjectType(typeSpec)}}throw new Error("Unknown typeSpec type: "+typeof typeSpec)}exports.resolveType=function(typeSpec){var promise=new Promise();resolveTypeExt(typeSpec).then(function(data){data.ext.load(function(type){if(typeof type.resolveTypeSpec==="function"){type.resolveTypeSpec(data.ext,data.typeSpec).then(function(){promise.resolve({type:type,ext:data.ext})},function(ex){promise.reject(ex)})}else{promise.resolve({type:type,ext:data.ext})}})},function(ex){promise.reject(ex)});return promise};exports.fromString=function(stringVersion,typeSpec){var promise=new Promise();exports.resolveType(typeSpec).then(function(typeData){promise.resolve(typeData.type.fromString(stringVersion,typeData.ext))});return promise};exports.toString=function(objectVersion,typeSpec){var promise=new Promise();exports.resolveType(typeSpec).then(function(typeData){promise.resolve(typeData.type.toString(objectVersion,typeData.ext))});return promise};exports.isValid=function(originalVersion,typeSpec){var promise=new Promise();exports.resolveType(typeSpec).then(function(typeData){promise.resolve(typeData.type.isValid(originalVersion,typeData.ext))});return promise}});tiki.module("types:index",function(require,exports,module){});tiki.register("settings",{});tiki.module("settings:commands",function(require,exports,module){var catalog=require("bespin:plugins").catalog;var settings=require("settings").settings;exports.setCommand=function(env,args,request){var html;if(!args.setting){var settingsList=settings._list();html="";settingsList.sort(function(a,b){if(a.key<b.key){return -1}else{if(a.key==b.key){return 0}else{return 1}}});settingsList.forEach(function(setting){html+="<a class='setting' href='https://wiki.mozilla.org/Labs/Bespin/Settings#"+setting.key+"' title='View external documentation on setting: "+setting.key+"' target='_blank'>"+setting.key+"</a> = "+setting.value+"<br/>"})}else{if(args.value===undefined){html="<strong>"+args.setting+"</strong> = "+settings.get(args.setting)}else{html="Setting: <strong>"+args.setting+"</strong> = "+args.value;settings.set(args.setting,args.value)}}request.done(html)};exports.unsetCommand=function(env,args,request){settings.resetValue(args.setting);request.done("Reset "+args.setting+" to default: "+settings.get(args.setting))}});tiki.module("settings:cookie",function(require,exports,module){var cookie=require("bespin:util/cookie");exports.CookiePersister=SC.Object.create({loadInitialValues:function(settings){settings._loadDefaultValues().then(function(){var data=cookie.get("settings");settings._loadFromObject(JSON.parse(data))}.bind(this))},persistValue:function(settings,key,value){try{var data={};settings._getSettingNames().forEach(function(key){data[key]=settings.get(key)});var stringData=JSON.stringify(data);cookie.set("settings",stringData)}catch(ex){console.error("Unable to JSONify the settings! "+ex);return}}})});tiki.module("settings:index",function(require,exports,module){var MemorySettings=require("memory").MemorySettings;exports.settings=MemorySettings.create()});tiki.module("settings:memory",function(require,exports,module){var catalog=require("bespin:plugins").catalog;var console=require("bespin:console").console;var Promise=require("bespin:promise").Promise;var groupPromises=require("bespin:promise").group;var SC=require("sproutcore/runtime").SC;var types=require("types:types");exports.addSetting=function(settingExt){require("settings").settings.addSetting(settingExt)};exports.getSettings=function(){return catalog.getExtensions("setting")};exports.getTypeSpecFromAssignment=function(typeSpec){var assignments=typeSpec.assignments;var replacement="text";if(assignments){var settingAssignment=null;assignments.forEach(function(assignment){if(assignment.param.name==="setting"){settingAssignment=assignment}});if(settingAssignment){var settingName=settingAssignment.value;if(settingName&&settingName!==""){var settingExt=catalog.getExtensionByKey("setting",settingName);if(settingExt){replacement=settingExt.type}}}}return replacement};exports.MemorySettings=SC.Object.extend({setPersister:function(persister){this._persister=persister;if(persister){persister.loadInitialValues(this)}},set:function(key,value){var settingExt=catalog.getExtensionByKey("setting",key);if(!settingExt){throw new Error("Unknown setting: ",key,value)}if(typeof value=="string"&&settingExt.type=="string"){return this.superclass(key,value)}else{var superSet=arguments.callee.base;var inline=false;types.fromString(value,settingExt.type).then(function(converted){inline=true;superSet.apply(this,[key,converted])}.bind(this),function(ex){console.error("Error setting",key,": ",ex)});if(!inline){console.warn("About to set string version of ",key,"delaying typed set.");this.superclass(key,value)}}return this},addSetting:function(settingExt){if(!settingExt.name){console.error("Setting.name == undefined. Ignoring.",settingExt);return}if(!settingExt.defaultValue===undefined){console.error("Setting.defaultValue == undefined",settingExt)}types.isValid(settingExt.defaultValue,settingExt.type).then(function(valid){if(!valid){console.warn("!Setting.isValid(Setting.defaultValue)",settingExt)}this.set(settingExt.name,settingExt.defaultValue);this.addObserver(settingExt.name,this,function(){this._persistValue(settingExt.name,this.get(settingExt.name))}.bind(this))}.bind(this),function(ex){console.error("Type error ",ex," ignoring setting ",settingExt)})},resetValue:function(key){var settingExt=catalog.getExtensionByKey("setting",key);if(settingExt){this.set(key,settingExt.defaultValue)}else{console.log("ignore resetValue on ",key)}},_getSettingNames:function(){var typeNames=[];catalog.getExtensions("setting").forEach(function(settingExt){typeNames.push(settingExt.name)});return typeNames},_list:function(){var reply=[];this._getSettingNames().forEach(function(setting){reply.push({key:setting,value:this.get(setting)})}.bind(this));return reply},_persistValue:function(key,value){var persister=this._persister;if(persister){persister.persistValue(this,key,value)}},_loadInitialValues:function(){var persister=this._persister;if(persister){persister.loadInitialValues(this)}else{this._loadDefaultValues()}},_loadDefaultValues:function(){return this._loadFromObject(this._defaultValues())},_loadFromObject:function(data){var promises=[];var setterFactory=function(keyName){return function(value){this.set(keyName,value)}};for(var key in data){if(data.hasOwnProperty(key)){var valueStr=data[key];var settingExt=catalog.getExtensionByKey("setting",key);if(settingExt){var promise=types.fromString(valueStr,settingExt.type);var setter=setterFactory(key);promise.then(setter);promises.push(promise)}}}var replyPromise=new Promise();groupPromises(promises).then(function(){replyPromise.resolve()});return replyPromise},_saveToObject:function(){var promises=[];var reply={};this._getSettingNames().forEach(function(key){var value=this.get(key);var settingExt=catalog.getExtensionByKey("setting",key);if(settingExt){var promise=types.toString(value,settingExt.type);promise.then(function(value){reply[key]=value});promises.push(promise)}}.bind(this));var replyPromise=new Promise();groupPromises(promises).then(function(){replyPromise.resolve(reply)});return replyPromise},_defaultValues:function(){var defaultValues={};catalog.getExtensions("setting").forEach(function(settingExt){defaultValues[settingExt.name]=settingExt.defaultValue});return defaultValues}})});tiki.register("canon",{});tiki.module("canon:environment",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var catalog=require("bespin:plugins").catalog;var console=require("bespin:console").console;exports.Environment=SC.Object.extend({session:function(){return catalog.getObject("session")}.property(),view:function(){var session=this.get("session");if(!session){return null}return session.get("currentView")}.property(),model:function(){var session=this.get("session");if(!session){console.error("command attempted to get model but there's no session");return undefined}var buffer=session.get("currentBuffer");if(!buffer){console.error("Session has no current buffer");return undefined}return buffer.get("model")}.property(),contexts:function(){var textView=this.get("view");if(!textView){return[]}var syntaxManager=textView.getPath("layoutManager.syntaxManager");var pos=textView.getSelectedRange().start;return syntaxManager.contextsAtPosition(pos)}.property(),file:function(){var session=this.get("session");if(!session){console.error("command attempted to get file but there's no session");return undefined}var buffer=session.get("currentBuffer");if(!buffer){console.error("Session has no current buffer");return undefined}return buffer.get("file")}.property(),buffer:function(){var session=this.get("session");if(!session){console.error("command attempted to get buffer but there's no session");return undefined}return session.get("currentBuffer")}.property(),files:function(){return catalog.getObject("files")}.property().cacheable()});exports.global=exports.Environment.create()});tiki.module("canon:keyboard",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var catalog=require("bespin:plugins").catalog;var console=require("bespin:console").console;var settings=require("settings").settings;var Request=require("canon:request").Request;var environment=require("canon:environment");var Trace=require("bespin:util/stacktrace").Trace;exports.buildFlags=function(env,flags){flags.context=env.get("contexts")[0];return flags};var KeyboardManager=SC.Object.extend({_customKeymappingCache:{},_commandCodes:function(){var orgEvt=this.originalEvent;var allowShift=true;var code=this.keyCode,ret=null,key=null,modifiers="",lowercase;if(this.keyCode===0&&this.which===0){return false}if(code){ret=SC.FUNCTION_KEYS[code];if(!ret&&(orgEvt.altKey||orgEvt.ctrlKey||orgEvt.metaKey)){ret=SC.PRINTABLE_KEYS[code];if(code>47&&code<58){allowShift=orgEvt.altKey}}if(ret){if(orgEvt.altKey){modifiers+="alt_"}if(orgEvt.ctrlKey){modifiers+="ctrl_"}if(orgEvt.metaKey){modifiers+="meta_"}}else{if(orgEvt.ctrlKey||orgEvt.metaKey){return false}}}if(!ret){code=this.which;key=ret=String.fromCharCode(code);lowercase=ret.toLowerCase();if(orgEvt.metaKey){modifiers="meta_";ret=lowercase}else{ret=null}}if(this.shiftKey&&ret&&allowShift){modifiers+="shift_"}if(ret){ret=modifiers+ret}return[ret,key]},processKeyEvent:function(evt,sender,flags){var symbolicName=this._commandCodes.call(evt)[0];if(SC.none(symbolicName)){return false}exports.buildFlags(environment.global,flags);flags.isCommandKey=true;return this._matchCommand(symbolicName,sender,flags)},processKeyInput:function(text,sender,flags){flags.isCommandKey=false;return this._matchCommand(text,sender,flags)},_matchCommand:function(symbolicName,sender,flags){var match=this._findCommandExtension(symbolicName,sender,flags);if(match&&match.commandExt!=="no command"){if(flags.isTextView){sender.resetKeyBuffers()}var commandExt=match.commandExt;commandExt.load(function(command){var request=Request.create({command:command,commandExt:commandExt});try{command(environment.global,match.args,request);return true}catch(ex){var trace=new Trace(ex,true);console.group("Error calling command");console.log("command=",commandExt);console.log("args=",match.args);console.error(ex);trace.log(3);console.groupEnd();return false}});return true}if(match&&match.commandExt==="no command"){return true}else{return false}},_buildBindingsRegex:function(bindings){bindings.forEach(function(binding){if(!SC.none(binding.key)){binding.key=new RegExp("^"+binding.key+"$")}else{if(SC.isArray(binding.regex)){binding.key=new RegExp("^"+binding.regex[1]+"$");binding.regex=new RegExp(binding.regex.join("")+"$")}else{binding.regex=new RegExp(binding.regex+"$")}}})},_buildKeymappingRegex:function(keymapping){for(state in keymapping.states){this._buildBindingsRegex(keymapping.states[state])}keymapping._convertedRegExp=true},_findCommandExtension:function(symbolicName,sender,flags){if(flags.isTextView){var currentState=sender._keyState;var allKeymappings=[];var keymappingName=settings.get("keymapping");if(!SC.none(keymappingName)&&keymappingName!=="standard"){var keymapping=null;catalog.getExtensions("keymapping").some(function(map){if(map.name==keymappingName){if(SC.none(map._convertedRegExp)){this._buildKeymappingRegex(map)}keymapping=map;return true}return false}.bind(this));if(SC.none(keymapping)){throw new Error("There is no keymapping named "+keymappingName)}}if(!flags.isCommandKey||symbolicName.indexOf("alt_")===-1){sender._keyBuffer+=symbolicName.replace(/ctrl_meta|meta/,"ctrl");sender._keyMetaBuffer+=symbolicName}var ckmap=this._customKeymappingCache;if(ckmap[keymappingName]&&ckmap[keymappingName].states&&ckmap[keymappingName].states[currentState]){allKeymappings.push(ckmap[keymappingName])}if(keymapping&&keymapping.states[currentState]){allKeymappings.push(keymapping)}for(var i=0;i<allKeymappings.length;i++){var result=this._bindingsMatch(symbolicName,flags,sender,allKeymappings[i]);if(!SC.none(result)){return result}}}var commandExts=catalog.getExtensions("command");var reply=null;var args={};symbolicName=symbolicName.replace(/ctrl_meta|meta/,"ctrl");commandExts.some(function(commandExt){if(this._commandMatches(commandExt,symbolicName,flags)){reply=commandExt;return true}return false}.bind(this));return SC.none(reply)?null:{commandExt:reply,args:args}},_bindingsMatch:function(symbolicName,flags,sender,keymapping){var match;var commandExt=null;var args={};var bufferToUse;if(!SC.none(keymapping.hasMetaKey)){bufferToUse=sender._keyBuffer}else{bufferToUse=sender._keyMetaBuffer}if(symbolicName.indexOf("alt_")===0&&flags.isCommandKey){bufferToUse+=symbolicName}keymapping.states[sender._keyState].some(function(binding){if(binding.key&&!binding.key.test(symbolicName)){return false}if(binding.regex&&!(match=binding.regex.exec(bufferToUse))){return false}if(binding.disallowMatches){for(var i=0;i<binding.disallowMatches.length;i++){if(!!match[binding.disallowMatches[i]]){return true}}}if(!exports.flagsMatch(binding.predicates,flags)){return false}if(binding.exec){commandExt=catalog.getExtensionByKey("command",binding.exec);if(SC.none(commandExt)){throw new Error("Can't find command "+binding.exec+" in state="+sender._keyState+", symbolicName="+symbolicName)}if(binding.params){var value;binding.params.forEach(function(param){if(!SC.none(param.match)){value=match[param.match]||param.defaultValue}else{value=param.defaultValue}if(param.type==="number"){value=parseInt(value)}args[param.name]=value})}sender.resetKeyBuffers()}if(binding.then){sender._keyState=binding.then;sender.resetKeyBuffers()}if(SC.none(commandExt)){commandExt="no command"}return true});if(SC.none(commandExt)){return null}return{commandExt:commandExt,args:args}},_commandMatches:function(commandExt,symbolicName,flags){if(!exports.flagsMatch(commandExt.predicates,flags)){return false}var mappedKeys=commandExt.key;if(!mappedKeys){return false}if(typeof(mappedKeys)==="string"){if(mappedKeys!=symbolicName){return false}return true}if(!mappedKeys.isArray){mappedKeys=[mappedKeys];commandExt.key=mappedKeys}for(var i=0;i<mappedKeys.length;i++){var keymap=mappedKeys[i];if(typeof(keymap)==="string"){if(keymap==symbolicName){return true}continue}if(keymap.key!=symbolicName){continue}return exports.flagsMatch(keymap.predicates,flags)}return false},_customKeymappingChanged:function(){var ckc=this._customKeymappingCache=JSON.parse(settings.get("customKeymapping"));for(mapping in ckc){for(state in ckc[mapping].states){this._buildBindingsRegex(ckc[mapping].states[state])}}}.observes("settings:index#settings.customKeymapping")});exports.flagsMatch=function(predicates,flags){if(SC.none(predicates)){return true}if(!flags){return false}for(var flagName in predicates){if(flags[flagName]!==predicates[flagName]){return false}}return true};exports.keyboardManager=KeyboardManager.create()});tiki.module("canon:request",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var settings=require("settings").settings;exports.history=SC.Object.create({requests:[],trim:function(){var historyLength=settings.get("historyLength");while(this.requests.length>historyLength){this.requests.shiftObject()}}.observes(".requests")});exports.Request=SC.Object.extend({command:undefined,commandExt:undefined,args:undefined,typed:undefined,outputs:undefined,start:undefined,end:undefined,duration:undefined,completed:undefined,error:undefined,_inited:undefined,_init:function(){this.set("_inited",true);this.outputs=[];this.start=new Date();this.completed=false;this.error=false;exports.history.requests.pushObject(this)},doneWithError:function(content){this.set("error",true).done(content)},async:function(){if(!this.get("_inited")){this._init()}},output:function(content){if(!this.get("_inited")){this._init()}this.outputs.pushObject(content);return this},done:function(content){if(content){this.output(content)}this.set("completed",true);this.set("end",new Date());this.set("duration",this.get("end").getTime()-this.get("start").getTime())}})});tiki.module("canon:index",function(require,exports,module){});tiki.register("appsupport",{});tiki.module("appsupport:controllers/undomanager",function(require,exports,module){var SC=require("sproutcore/runtime").SC;exports.undoManager=SC.Object.create({_redoStack:null,_undoStack:null,_undoOrRedo:function(method,stack,otherStack){if(stack.length===0){return false}var record=stack.pop();if(!record.target[method](record.context)){this._redoStack=[];this._undoStack=[];return false}otherStack.push(record);return true},init:function(){this._redoStack=[];this._undoStack=[]},redo:function(){return this._undoOrRedo("redo",this._redoStack,this._undoStack)},registerUndo:function(target,context){this._redoStack=[];this._undoStack.push({target:target,context:context})},undo:function(){return this._undoOrRedo("undo",this._undoStack,this._redoStack)}});exports.undoManagerCommand=function(env,args,request){exports.undoManager[request.commandExt.name]()}});tiki.module("appsupport:views/keylistener",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var keyboardManager=require("canon:keyboard").keyboardManager;exports.KeyListener=SC.Responder.extend({performKeyEquivalent:function(key,evt){keyboardManager.processKeyEvent(evt,this,{isApplication:true})}})});tiki.module("appsupport:index",function(require,exports,module){});tiki.register("delegate_support",{});tiki.module("delegate_support:index",function(require,exports,module){({description:"Simple support for multiple delegates on an object"});"end";var SC=require("sproutcore/runtime").SC;exports.MultiDelegateSupport={delegates:[],addDelegate:function(delegate){this.set("delegates",this.get("delegates").concat(delegate))},notifyDelegates:function(method){var args=[this];for(var i=1;i<arguments.length;i++){args.push(arguments[i])}this.get("delegates").forEach(function(delegate){if(delegate.respondsTo(method)){delegate[method].apply(delegate,args)}})}}});tiki.register("rangeutils",{});tiki.module("rangeutils:utils/range",function(require,exports,module){var SC=require("sproutcore/runtime").SC;exports.addPositions=function(a,b){return{row:a.row+b.row,column:a.column+b.column}};exports.comparePositions=function(positionA,positionB){var rowDiff=positionA.row-positionB.row;return rowDiff===0?positionA.column-positionB.column:rowDiff};exports.equal=function(rangeA,rangeB){return(exports.comparePositions(rangeA.start,rangeB.start)===0&&exports.comparePositions(rangeA.end,rangeB.end)===0)};exports.extendRange=function(range,delta){var end=range.end;return{start:range.start,end:{row:end.row+delta.row,column:end.column+delta.column}}};exports.intersectRangeSets=function(setA,setB){var stackA=SC.clone(setA),stackB=SC.clone(setB);var result=[];while(stackA.length>0&&stackB.length>0){var rangeA=stackA.shift(),rangeB=stackB.shift();var startDiff=exports.comparePositions(rangeA.start,rangeB.start);var endDiff=exports.comparePositions(rangeA.end,rangeB.end);if(exports.comparePositions(rangeA.end,rangeB.start)<0){result.push(rangeA);stackB.unshift(rangeB)}else{if(exports.comparePositions(rangeB.end,rangeA.start)<0){result.push(rangeB);stackA.unshift(rangeA)}else{if(startDiff<0){result.push({start:rangeA.start,end:rangeB.start});stackA.unshift({start:rangeB.start,end:rangeA.end});stackB.unshift(rangeB)}else{if(startDiff===0){if(endDiff<0){stackB.unshift({start:rangeA.end,end:rangeB.end})}else{if(endDiff>0){stackA.unshift({start:rangeB.end,end:rangeA.end})}}}else{if(startDiff>0){result.push({start:rangeB.start,end:rangeA.start});stackA.unshift(rangeA);stackB.unshift({start:rangeA.start,end:rangeB.end})}}}}}}return result.concat(stackA,stackB)};exports.isZeroLength=function(range){return range.start.row===range.end.row&&range.start.column===range.end.column};exports.maxPosition=function(a,b){return exports.comparePositions(a,b)>0?a:b};exports.normalizeRange=function(range){return this.comparePositions(range.start,range.end)<0?range:{start:range.end,end:range.start}};exports.rangeSetBoundaries=function(rangeSet){return{start:rangeSet[0].start,end:rangeSet[rangeSet.length-1].end}};exports.toString=function(range){var start=range.start,end=range.end;return"[ %@,%@ %@,%@ ]".fmt(start.row,start.column,end.row,end.column)};exports.unionRanges=function(a,b){return{start:a.start.row<b.start.row||(a.start.row===b.start.row&&a.start.column<b.start.column)?a.start:b.start,end:a.end.row>b.end.row||(a.end.row===b.end.row&&a.end.column>b.end.column)?a.end:b.end}}});tiki.module("rangeutils:index",function(require,exports,module){});tiki.register("syntax_manager",{});tiki.module("syntax_manager:controllers/standardsyntax",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var Promise=require("bespin:promise").Promise;exports.StandardSyntax=SC.Object.extend({_stickySupported:null,_parseActions:function(actions){if(SC.none(actions)){return[]}return actions.split(" ").map(function(action){var parts=action.split(":");return parts.length===1?["transition",parts[0]]:parts})},_transition:function(range,state){var newState=state;range.actions.forEach(function(action){if(action[0]==="transition"){newState=action[1]}});return newState},states:null,init:function(){var stickySupported=null;var states=this.get("states");var stateCount=states.length;for(var i=0;i<stateCount;i++){var alternations=states[i];var alternationCount=alternations.length;for(var j=0;j<alternationCount;j++){var alternation=alternations[j];var regex=alternation.regex;if(stickySupported===null){stickySupported=regex.sticky!==undefined}if(stickySupported){regex.sticky=true}}}this._stickySupported=stickySupported},syntaxInfoForLineFragment:function(context,state,line,start,end){var promise=new Promise();var attrs=[];var stickySupported=this._stickySupported;var lineLength=line.length;var states=this.get("states");if(end!==null&&end<line.length){line=line.substring(0,end)}var endColumn=line.length;var column=start;while(column!==endColumn){var str=stickySupported?line:line.substring(column);if(states[state]===undefined){throw new Error("StandardSyntax: no such states '%@'".fmt(state))}var range={start:column,state:state};var newState;var alternations=states[state];var alternationCount=alternations.length;for(var i=0;i<alternationCount;i++){var alt=alternations[i];var regex=alt.regex;if(stickySupported){regex.lastIndex=column}var result=regex.exec(str);if(result===null){continue}var resultLength=result[0].length;range.end=column+resultLength;range.tag=alt.tag;range.actions=this._parseActions(alt.then);newState=this._transition(range,state);if(resultLength===0&&newState===state){throw new Error("Syntax regex matches the empty string and the state didn't change: "+regex.toSource())}state=newState;break}if(range.tag===undefined){range.end=column+1;range.tag="plain";range.actions=[]}if(column!==range.end){attrs.push(range)}column=range.end}if(end===null){attrs.push({start:column,end:null,state:state,tag:"plain",actions:[]})}var next={context:context,state:state};promise.resolve({attrs:attrs,next:next});return promise}})});tiki.module("syntax_manager:controllers/syntaxdirectory",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var Promise=require("bespin:promise").Promise;exports.discoveredNewSyntax=function(syntaxExtension){exports.syntaxDirectory.registerExtension(syntaxExtension)};var SyntaxInfo=SC.Object.extend({extension:null,name:null,init:function(){this.set("name",this.get("extension").name)}});exports.syntaxDirectory=SC.Object.create({_syntaxInfo:{},loadSyntax:function(name){var syntaxInfo=this._syntaxInfo[name];if(syntaxInfo===undefined){return null}var promise=new Promise();syntaxInfo.get("extension").load(function(pointer){promise.resolve(pointer)});return promise},registerExtension:function(extension){var syntaxInfo=SyntaxInfo.create({extension:extension});this._syntaxInfo[syntaxInfo.get("name")]=syntaxInfo}})});tiki.module("syntax_manager:controllers/syntaxmanager",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var m_promise=require("bespin:promise");var ArrayUtils=require("utils/array");var MultiDelegateSupport=require("delegate_support").MultiDelegateSupport;var Promise=m_promise.Promise;var Range=require("rangeutils:utils/range");var Yield=require("utils/yield");var catalog=require("bespin:plugins").catalog;var console=require("bespin:console").console;var syntaxDirectory=require("controllers/syntaxdirectory").syntaxDirectory;exports.SyntaxManager=SC.Object.extend(MultiDelegateSupport,{_invalidRows:[],_lineAttrInfo:null,_adjustInvalidRowsForDeletion:function(startRow,endRow){var newInvalidRows=[];this._invalidRows.forEach(function(invalidRow){if(invalidRow<=startRow){newInvalidRows.push(invalidRow);return}if(invalidRow>startRow||invalidRow<endRow){return}if(invalidRow>=endRow){newInvalidRows.push(invalidRow-(endRow-startRow))}});this._invalidRows=newInvalidRows},_adjustInvalidRowsForInsertion:function(startRow,endRow){this._invalidRows=this._invalidRows.map(function(invalidRow){return invalidRow<startRow?invalidRow:invalidRow+endRow-startRow})},_attrIndexForColumn:function(attrs,column){var attrIndex=ArrayUtils.binarySearch(attrs,column,function(column,range){if(column<range.start){return -1}var end=range.end;if(end!==null&&column>=end){return 1}return 0});if(attrIndex===null){console.error("position not found",position)}return attrIndex},_attrsToString:function(attrs){return attrs.map(function(range){return"%@.%@.%@@%@-%@".fmt(range.context,range.state,range.tag,range.start,range.end)}.bind(this)).join(", ")},_clearAttrsAtRow:function(row){var attrs=[];for(var i=0;i<2;i++){attrs.push(this._defaultAttrs())}this._lineAttrInfo[row].attrs=attrs},_deepSyntaxInfoForLine:function(snapshot,line){var promise=new Promise();var outerContextAndState=snapshot[0];var outerContext=outerContextAndState.context;var outerState=outerContextAndState.state;this._shallowSyntaxInfoForLineFragment(outerContext,outerState,line,0,null).then(function(outerShallowSyntaxInfo){var outerAttrs=outerShallowSyntaxInfo.attrs;outerAttrs.forEach(function(outerAttrRange){outerAttrRange.context=outerContext});var deepAttrs=[{attrs:outerAttrs,next:outerShallowSyntaxInfo.next}];var innerRanges=this._innerRangesFromAttrs(outerAttrs,snapshot[1]);if(innerRanges.length===0){deepAttrs.push({attrs:[{context:null,start:0,end:null}],next:{context:null}});promise.resolve(deepAttrs);return}var promises=innerRanges.map(function(ir){return this._shallowSyntaxInfoForLineFragment(ir.context,ir.state,line,ir.start,ir.end)}.bind(this));m_promise.group(promises).then(function(innerShallowSyntaxInfos){var innerAttrGroups=innerShallowSyntaxInfos.map(function(issi){return issi.attrs});for(var i=0;i<innerAttrGroups.length;i++){var innerContext=innerRanges[i].context;innerAttrGroups[i].forEach(function(ir){ir.context=innerContext})}var innerAttrs=this._flattenAttrGroups(innerAttrGroups);var lastInnerAttrGroup=innerAttrGroups[innerAttrGroups.length-1];var lastInnerAttrRange=lastInnerAttrGroup[lastInnerAttrGroup.length-1];var innerNext;if(lastInnerAttrRange.end===null){innerNext={context:lastInnerAttrRange.context,state:lastInnerAttrRange.state}}else{innerNext={context:null}}deepAttrs.push({attrs:innerAttrs,next:innerNext});promise.resolve(deepAttrs)}.bind(this))}.bind(this));return promise},_defaultAttrs:function(){return[{start:0,end:null,tag:"plain",actions:[]}]},_deleteAttrsInRange:function(range){var startRow=range.start.row,endRow=range.end.row;this._clearAttrsAtRow(startRow);this._lineAttrInfo.splice(startRow+1,endRow-startRow)},_deleteRange:function(oldRange){if(Range.isZeroLength(oldRange)){return}this._deleteAttrsInRange(oldRange);var oldStartRow=oldRange.start.row,oldEndRow=oldRange.end.row;this._adjustInvalidRowsForDeletion(oldStartRow,oldEndRow);this._invalidateRow(oldStartRow)},_flattenAttrGroups:function(attrGroups){var flattenedAttrs=[];var position=0;attrGroups.forEach(function(attrs){var start=attrs[0].start;if(position!==start){flattenedAttrs.push({start:position,end:start,context:null})}flattenedAttrs.pushObjects(attrs);position=attrs[attrs.length-1].end});if(position!==null){flattenedAttrs.push({start:position,end:null,context:null})}return flattenedAttrs},_initialContextChanged:function(){this._reset();this.notifyDelegates("syntaxManagerInvalidatedSyntax")}.observes("initialContext"),_innerRangesFromAttrs:function(outerAttrs,innerContextAndState){var currentContext=innerContextAndState.context;var currentState=innerContextAndState.state;var contextStart=0;var innerRanges=[];outerAttrs.forEach(function(outerAttrRange){outerAttrRange.actions.forEach(function(action){switch(action[0]){case"start":if(currentContext!==null){break}currentContext=action[1];currentState="start";contextStart=outerAttrRange.end;break;case"stop":if(currentContext!==action[1]){break}var end=outerAttrRange.start;if(contextStart!==end){innerRanges.push({context:currentContext,state:currentState,start:contextStart,end:end})}currentContext=null;break}})});if(currentContext!==null){innerRanges.push({context:currentContext,state:currentState,start:contextStart,end:null})}return innerRanges},_insertAttrsIntoRange:function(range){var start=range.start;var startRow=start.row,endRow=range.end.row;this._clearAttrsAtRow(startRow);var lineAttrInfo=this._lineAttrInfo;var newRowCount=endRow-startRow;for(var i=0;i<newRowCount;i++){var snapshot=[],attrs=[];for(var j=0;j<2;j++){snapshot.push({context:null});attrs.push(this._defaultAttrs())}lineAttrInfo.splice(startRow+1,0,{snapshot:snapshot,attrs:attrs})}},_insertRange:function(newRange){if(Range.isZeroLength(newRange)){return}this._insertAttrsIntoRange(newRange);var newStartRow=newRange.start.row,newEndRow=newRange.end.row;this._adjustInvalidRowsForInsertion(newStartRow,newEndRow);this._invalidateRow(newStartRow)},_invalidateRow:function(row){var invalidRows=this._invalidRows;invalidRows.push(row);invalidRows.sort(function(a,b){return a-b});this._invalidRows=invalidRows.uniq()},_mergeAttrGroups:function(attrGroups){var mergedGroups=[];var outerGroup=attrGroups[0],innerGroup=attrGroups[1];var outerIndex=0,innerIndex=0;var pos=0;while(pos!==null){var outerRange=outerGroup[outerIndex];var innerRange=innerGroup[innerIndex];if(innerRange.context!==null){mergedGroups.push(innerRange);pos=innerRange.end;innerIndex++;if(outerRange.end===pos){outerIndex++}}else{mergedGroups.push(outerRange);pos=outerRange.end;outerIndex++;if(innerRange.end===pos){innerIndex++}}}return mergedGroups},_recomputeAttrInfoForRows:function(startRow,endRow,depth){var promise=new Promise();var lineAttrInfo=this._lineAttrInfo;if(startRow===endRow){var result=startRow===lineAttrInfo.length?startRow:false;promise.resolve(result);return promise}if(SC.none(depth)){depth=0}var thisLineAttrInfo=lineAttrInfo[startRow];var line=this.getPath("textStorage.lines")[startRow];this._deepSyntaxInfoForLine(thisLineAttrInfo.snapshot,line).then(function(deepSyntaxInfo){thisLineAttrInfo.attrs=deepSyntaxInfo.map(function(dsi){return dsi.attrs});if(startRow!==lineAttrInfo.length-1){var nextLineAttrInfo=lineAttrInfo[startRow+1];var oldSnapshot=nextLineAttrInfo.snapshot;var newSnapshot=deepSyntaxInfo.map(function(dsi){return dsi.next});if(this._snapshotsEqual(oldSnapshot,newSnapshot)){promise.resolve(startRow+1);return}nextLineAttrInfo.snapshot=newSnapshot}if(depth===50){window.setTimeout(function(){SC.run(function(){this._recomputeAttrInfoForRows(startRow+1,endRow,0).then(function(lastRow){promise.resolve(lastRow)})}.bind(this))}.bind(this),0)}else{this._recomputeAttrInfoForRows(startRow+1,endRow,depth+1).then(function(lastRow){promise.resolve(lastRow)})}}.bind(this));return promise},_reset:function(){var lineAttrInfo=[];var lineCount=this.getPath("textStorage.lines").length;var initialContext=this.get("initialContext");for(var i=0;i<lineCount;i++){var firstContext;if(i===0){firstContext={context:initialContext,state:"start"}}else{firstContext={context:null}}lineAttrInfo.push({snapshot:[firstContext,{context:null}],attrs:[this._defaultAttrs(),[{context:null,start:0,end:null}]]})}this._invalidRows=[0];this._lineAttrInfo=lineAttrInfo},_shallowSyntaxInfoForLineFragment:function(context,state,line,start,end){var promise=new Promise();if(context==="plain"){promise.resolve({attrs:this._defaultAttrs(),next:{context:"plain",state:"start"}})}else{syntaxDirectory.loadSyntax(context).then(function(syntax){try{syntax.syntaxInfoForLineFragment(context,state,line,start,end).then(function(result){promise.resolve(result)})}catch(e){console.log("Syntax highlighter ",context," caused an exception:",e);promise.resolve({attrs:this._defaultAttrs(),next:{context:"plain",state:"start"}})}}.bind(this))}return promise},_snapshotsEqual:function(snapshotA,snapshotB){if(snapshotA.length!==snapshotB.length){return false}for(var i=0;i<snapshotA.length;i++){var casA=snapshotA[i],casB=snapshotB[i];if(casA.context!==casB.context||casA.state!==casB.state){return false}}return true},initialContext:"plain",textStorage:null,attrsForRows:function(startRow,endRow){return this._lineAttrInfo.slice(startRow,endRow).map(function(lai){return this._mergeAttrGroups(lai.attrs)},this)},contextsAtPosition:function(pos){var attrGroups=this._lineAttrInfo[pos.row].attrs;var contexts=[];attrGroups.forEach(function(attrs){var index=this._attrIndexForColumn(attrs,pos.column);var context=attrs[index].context;if(context!==null){contexts.push(context)}},this);return contexts},init:function(){this._reset()},layoutManagerReplacedText:function(oldRange,newRange){this._deleteRange(oldRange);this._insertRange(newRange)},setInitialContextFromExt:function(fileExt){fileExt=fileExt.toLowerCase();var extension=catalog.getExtensionByKey("fileextension",fileExt);var syntax;if(SC.none(extension)||SC.none(extension.syntax)){syntax="plain"}else{syntax=extension.syntax}this.set("initialContext",syntax)},toString:function(){return"{ lineAttrInfo: [ %@ ], invalidRows: [ %@ ] }".fmt(this._lineAttrInfo.map(function(info){return"{ (%@) -> (%@) }".fmt(info.snapshot.map(function(cas){return cas.context+": "+cas.state}).join(", "),info.attrs.map(this._attrsToString.bind(this)).join(", "))}.bind(this)).join(", "),this._invalidRows.join(", "))},updateSyntaxForRows:function(startRow,endRow){var invalidRows=this._invalidRows;var invalidRowCount=invalidRows.length;var index;for(index=0;index<invalidRowCount;index++){var invalidRow=invalidRows[index];if(invalidRow<endRow){break}}var promise=new Promise();if(index===invalidRowCount){promise.resolve({startRow:startRow,endRow:startRow})}else{var invalidRow=invalidRows[index];while(index<invalidRows.length&&invalidRows[index]<endRow){invalidRows.splice(index,1)}this._recomputeAttrInfoForRows(invalidRow,endRow).then(function(firstUnchangedRow){if(firstUnchangedRow===false){this._invalidateRow(endRow);firstUnchangedRow=endRow}promise.resolve({startRow:startRow,endRow:firstUnchangedRow})}.bind(this))}return promise}})});tiki.module("syntax_manager:utils/array",function(require,exports,module){var SC=require("sproutcore/runtime").SC;exports.binarySearch=function(list,value,compare){var low=0,high=list.length;while(low<high){var index=low+(high-low)/2>>0;var result=compare(value,list[index]);if(result<0){high=index}else{if(result>0){low=index+1}else{return index}}}return null}});tiki.module("syntax_manager:utils/yield",function(require,exports,module){require("sproutcore/runtime").SC;var Promise=require("bespin:promise").Promise;exports.loop=function(cond,exec,next){var loopPromise=new Promise();while(cond(loopPromise)){var execPromise=exec();var execValue=execPromise.valueIfResolved();if(execValue===null){execPromise.then(function(execValue){if(next(execValue,loopPromise)){exports.loop(cond,exec,next).then(function(loopValue){loopPromise.resolve(loopValue)})}});return loopPromise}if(!next(execValue,loopPromise)){return loopPromise}}return loopPromise}});tiki.module("syntax_manager:index",function(require,exports,module){});tiki.register("text_editor",{});tiki.module("text_editor:commands/editing",function(require,exports,module){var settings=require("settings").settings;var m_range=require("rangeutils:utils/range");exports.backspace=function(env,args,request){var view=env.get("view");view.performBackspaceOrDelete(true)};exports.deleteCommand=function(env,args,request){var view=env.get("view");view.performBackspaceOrDelete(false)};exports.deleteLines=function(env,args,request){var view=env.get("view");var range=view.getSelectedRange();view.groupChanges(function(){var startPos={column:0,row:range.start.row};view.replaceCharacters({start:startPos,end:{column:0,row:range.end.row+1}},"");view.moveCursorTo(startPos)})};var newline=function(model,view){var selection=view.getSelectedRange();var position=selection.start;var row=position.row,col=position.column;var lines=model.get("lines");var prefix=lines[row].substring(0,col);var spaces=/^\s*/.exec(prefix);view.insertText("\n"+spaces)};exports.insertText=function(env,args,request){var view=env.get("view");var text=args.text;view.insertText(text)};exports.newline=function(env,args,request){var model=env.get("model"),view=env.get("view");newline(model,view)};exports.openLine=function(env,args,request){var model=env.get("model"),view=env.get("view");var selection=view.getSelectedRange();var row=selection.end.row;var lines=model.get("lines");view.moveCursorTo({row:row,column:lines[row].length});newline(model,view)};exports.tab=function(env,args,request){var view=env.get("view");var tabstop=settings.get("tabstop");var selection=view.getSelectedRange();var count=tabstop-selection.start.column%tabstop;var str="";for(var i=0;i<count;i++){str+=" "}view.insertText(str)}});tiki.module("text_editor:commands/editor",function(require,exports,module){var catalog=require("bespin:plugins").catalog;var settings=require("settings").settings;exports.findCommand=function(env,args,request){if(!("value" in args)){var cliController=catalog.getObject("clicontroller");if(!SC.none(cliController)){cliController.prompt("find ")}return}var view=env.get("view"),search=view.get("searchController");var sel=view.getSelectedRange();var output="";search.setSearchText(args.value,false);var match=search.findNext(sel.end,true);if(match){view.setSelection(match,true);view.focus()}else{output+="<i>No matches found</i><br>"}output+='Searching for "'+args.value+'"';request.done(output)};exports.findNextCommand=function(env,args,request){var view=env.get("view"),search=view.get("searchController");var sel=view.getSelectedRange();var match=search.findNext(sel.end,true);if(match){view.setSelection(match,true);view.focus()}};exports.findPrevCommand=function(env,args,request){var view=env.get("view"),search=view.get("searchController");var sel=view.getSelectedRange();var match=search.findPrevious(sel.start,true);if(match){view.setSelection(match,true);view.focus()}};exports.gotoCommand=function(env,args,request){if(!("line" in args)){var cliController=catalog.getObject("clicontroller");if(!SC.none(cliController)){cliController.prompt("goto ")}return}var view=env.get("view");view.moveCursorTo({row:args.line-1,column:0});view.focus()};var withSelection=function(env,action){var view=env.get("view");var selection=view.getSelectedCharacters();var replacement=action(selection);var range=view.getSelectedRange();var model=env.get("model");model.replaceCharacters(range,replacement)};exports.replaceCommand=function(env,args,request){withSelection(env,function(selected){return selected.replace(args.search+"/g",args.replace)})};exports.entabCommand=function(env,args,request){tabstop=settings.get("tabstop");withSelection(env,function(selected){return selected.replace(" {"+tabstop+"}","\t")})};exports.detabCommand=function(env,args,request){tabstop=settings.get("tabstop");withSelection(env,function(selected){return selected.replace("\t",new Array(tabstop+1).join(" "))})};exports.trimCommand=function(env,args,request){withSelection(env,function(selected){var lines=selected.split("\n");lines=lines.map(function(line){if(args.side==="left"||args.side==="both"){line=line.replace(/^\s+/,"")}if(args.side==="right"||args.side==="both"){line=line.replace(/\s+$/,"")}return line});return lines.join("\n")})};exports.ucCommand=function(env,args,request){withSelection(env,function(selected){return selected.toUpperCase()})};exports.lcCommand=function(env,args,request){withSelection(env,function(selected){return selected.toLowerCase()})}});tiki.module("text_editor:commands/movement",function(require,exports,module){var Range=require("rangeutils:utils/range");exports.moveDown=function(env,args,request){var view=env.get("view");view.moveDown()};exports.moveLeft=function(env,args,request){var view=env.get("view");view.moveLeft()};exports.moveRight=function(env,args,request){var view=env.get("view");view.moveRight()};exports.moveUp=function(env,args,request){var view=env.get("view");view.moveUp()};exports.selectDown=function(env,args,request){var view=env.get("view");view.selectDown()};exports.selectLeft=function(env,args,request){var view=env.get("view");view.selectLeft()};exports.selectRight=function(env,args,request){var view=env.get("view");view.selectRight()};exports.selectUp=function(env,args,request){var view=env.get("view");view.selectUp()};var moveOrSelectEnd=function(env,shift,inLine){var view=env.get("view"),model=env.get("model");var lines=model.get("lines");var selectedRange=view.getSelectedRange();var row=inLine?selectedRange.end.row:lines.length-1;view.moveCursorTo({row:row,column:lines[row].length},shift)};exports.moveLineEnd=function(env,args,request){moveOrSelectEnd(env,false,true)};exports.selectLineEnd=function(env,args,request){moveOrSelectEnd(env,true,true)};exports.moveDocEnd=function(env,args,request){moveOrSelectEnd(env,false,false)};exports.selectDocEnd=function(env,args,request){moveOrSelectEnd(env,true,false)};var moveOrSelectStart=function(env,shift,inLine){var view=env.get("view");var range=view.getSelectedRange();var row=inLine?range.end.row:0;var position={row:row,column:0};view.moveCursorTo(position,shift)};exports.moveLineStart=function(env,args,request){moveOrSelectStart(env,false,true)};exports.selectLineStart=function(env,args,request){moveOrSelectStart(env,true,true)};exports.moveDocStart=function(env,args,request){moveOrSelectStart(env,false,false)};exports.selectDocStart=function(env,args,request){moveOrSelectStart(env,true,false)};var seekNextStop=function(view,text,column,dir,rowChanged){var isDelim;var countDelim=0;var wasOverNonDelim=false;if(dir<0){column--;if(rowChanged){countDelim=1}}while(column<text.length&&column>-1){isDelim=view.isDelimiter(text[column]);if(isDelim){countDelim++}else{wasOverNonDelim=true}if((isDelim||countDelim>1)&&wasOverNonDelim){break}column+=dir}if(dir<0){column++}return column};var moveOrSelectNextWord=function(env,shiftDown){var view=env.get("view"),model=env.get("model");var lines=model.get("lines");var selectedRange=view.getSelectedRange(true);var end=selectedRange.end;var row=end.row,column=end.column;var currentLine=lines[row];var changedRow=false;if(column>=currentLine.length){row++;changedRow=true;if(row<lines.length){column=0;currentLine=lines[row]}else{currentLine=""}}column=seekNextStop(view,currentLine,column,1,changedRow);view.moveCursorTo({row:row,column:column},shiftDown)};var moveOrSelectPreviousWord=function(env,shiftDown){var view=env.get("view"),model=env.get("model");var lines=model.get("lines");var selectedRange=view.getSelectedRange(true);var end=selectedRange.end;var row=end.row,column=end.column;var currentLine=lines[row];var changedRow=false;if(column>currentLine.length){column=currentLine.length}else{if(column==0){row--;changedRow=true;if(row>-1){currentLine=lines[row];column=currentLine.length}else{currentLine=""}}}column=seekNextStop(view,currentLine,column,-1,changedRow);view.moveCursorTo({row:row,column:column},shiftDown)};exports.moveNextWord=function(env,args,request){moveOrSelectNextWord(env,false)};exports.selectNextWord=function(env,args,request){moveOrSelectNextWord(env,true)};exports.movePreviousWord=function(env,args,request){moveOrSelectPreviousWord(env,false)};exports.selectPreviousWord=function(env,args,request){moveOrSelectPreviousWord(env,true)};exports.selectAll=function(env,args,request){var view=env.get("view");view.selectAll()}});tiki.module("text_editor:commands/scrolling",function(require,exports,module){exports.scrollDocStart=function(env,args,request){env.get("view").scrollToPosition({column:0,row:0})};exports.scrollDocEnd=function(env,args,request){env.get("view").scrollToPosition(env.get("model").range().end)};exports.scrollPageDown=function(env,args,request){env.get("view").scrollPageDown()};exports.scrollPageUp=function(env,args,request){env.get("view").scrollPageUp()}});tiki.module("text_editor:controllers/layoutmanager",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var MultiDelegateSupport=require("delegate_support").MultiDelegateSupport;var Range=require("rangeutils:utils/range");var SyntaxManager=require("syntax_manager:controllers/syntaxmanager").SyntaxManager;var TextStorage=require("models/textstorage").TextStorage;var catalog=require("bespin:plugins").catalog;exports.LayoutManager=SC.Object.extend(MultiDelegateSupport,{_maximumWidth:0,characterWidth:8,lineAscent:16,lineHeight:20,margin:{left:5,bottom:6,top:0,right:12},pluginCatalog:catalog,syntaxManager:SyntaxManager,textLines:null,textStorage:TextStorage,theme:{editorTextColor:"rgb(230, 230, 230)",editorTextColor_comment:"rgb(126,126,126)",editorTextColor_directive:"rgb(153, 153, 153)",editorTextColor_error:"rgb(255, 0, 0)",editorTextColor_identifier:"rgb(0,0,0)",editorTextColor_keyword:"rgb(66, 168, 237)",editorTextColor_operator:"rgb(0,0,0)",editorTextColor_plain:"rgb(0,0,0)",editorTextColor_string:"rgb(0, 102, 153)",editorTextColor_pjsfunctions:"rgb(204, 102, 0)",editorTextColor_pjsconstants:"rgb(0, 102, 153)"},_computeInvalidRects:function(oldRange,newRange){var startRect=this.characterRectForPosition(oldRange.start);var lineRect={x:startRect.x,y:startRect.y,width:Number.MAX_VALUE,height:startRect.height};return oldRange.end.row===newRange.end.row?[lineRect]:[lineRect,{x:0,y:startRect.y+this.get("lineHeight"),width:Number.MAX_VALUE,height:Number.MAX_VALUE}]},_lastCharacterPosition:function(){return{row:this.get("textLines").length-1,column:this._maximumWidth}},_recalculateMaximumWidth:function(){var textLines=this.get("textLines");var max=0;textLines.forEach(function(line){var width=line.characters.length;if(max<width){max=width}});this._maximumWidth=max},_recomputeEntireLayout:function(){var entireRange=this.get("textStorage").range();this._recomputeLayoutForRanges(entireRange,entireRange)},_recomputeLayoutForRanges:function(oldRange,newRange){var oldStartRow=oldRange.start.row,oldEndRow=oldRange.end.row;var newEndRow=newRange.end.row;var newRowCount=newEndRow-oldStartRow+1;var lines=this.getPath("textStorage.lines");var theme=this.get("theme");var plainColor=theme.editorTextColor_plain;var newTextLines=[];for(var i=0;i<newRowCount;i++){var line=lines[oldStartRow+i];newTextLines[i]={characters:line,colors:[{start:0,end:null,color:plainColor}]}}this.textLines.replace(oldStartRow,oldEndRow-oldStartRow+1,newTextLines);this._recalculateMaximumWidth();this.updateTextRows(oldStartRow,newEndRow+1);this.notifyDelegates("layoutManagerChangedTextAtRow",oldStartRow);var invalidRects=this._computeInvalidRects(oldRange,newRange);this.notifyDelegates("layoutManagerInvalidatedRects",invalidRects)},boundingRect:function(){return this.rectsForRange({start:{row:0,column:0},end:{row:this.get("textLines").length-1,column:this._maximumWidth}})[0]},characterAtPoint:function(point){var margin=this.get("margin");var x=point.x-margin.left,y=point.y-margin.top;var characterWidth=this.get("characterWidth");var textStorage=this.get("textStorage");var clampedPosition=textStorage.clampPosition({row:Math.floor(y/this.get("lineHeight")),column:Math.floor(x/characterWidth)});var lineLength=textStorage.get("lines")[clampedPosition.row].length;return SC.mixin(clampedPosition,{partialFraction:x<0||clampedPosition.column===lineLength?0:x%characterWidth/characterWidth})},characterRangeForBoundingRect:function(rect){var lineHeight=this.get("lineHeight");var characterWidth=this.get("characterWidth");var margin=this.get("margin");var x=rect.x-margin.left,y=rect.y-margin.top;return{start:{row:Math.max(Math.floor(y/lineHeight),0),column:Math.max(Math.floor(x/characterWidth),0)},end:{row:Math.floor((y+rect.height-1)/lineHeight),column:Math.floor((x+rect.width-1)/characterWidth)+1}}},characterRectForPosition:function(position){return this.rectsForRange({start:position,end:{row:position.row,column:position.column+1}})[0]},createSyntaxManager:function(){this.set("syntaxManager",this.get("syntaxManager").create({delegates:[this],textStorage:this.get("textStorage")}))},createTextStorage:function(){this.set("textStorage",this.get("textStorage").create())},init:function(){this.set("textLines",[{characters:"",colors:[{start:0,end:0,color:this.get("theme").editorTextColor}]}]);this.createTextStorage();this.get("textStorage").addDelegate(this);this.createSyntaxManager();this._recomputeEntireLayout()},lineRectForRow:function(row){return this.rectsForRange({start:{row:row,column:0},end:{row:row,column:this._maximumWidth}})[0]},rectForPosition:function(position){var margin=this.get("margin");var characterWidth=this.get("characterWidth");var lineHeight=this.get("lineHeight");return{x:margin.left+characterWidth*position.column,y:margin.top+lineHeight*position.row,width:characterWidth,height:lineHeight}},rectsForRange:function(range){var characterWidth=this.get("characterWidth");var lineHeight=this.get("lineHeight");var maximumWidth=this._maximumWidth;var margin=this.get("margin");var start=range.start,end=range.end;var startRow=start.row,startColumn=start.column;var endRow=end.row,endColumn=end.column;if(startRow===endRow){return[{x:margin.left+characterWidth*startColumn,y:margin.top+lineHeight*startRow,width:characterWidth*(endColumn-startColumn),height:lineHeight}]}var rects=[];var middleStartRow;if(startColumn===0){middleStartRow=startRow}else{middleStartRow=startRow+1;rects.push({x:margin.left+characterWidth*startColumn,y:margin.top+lineHeight*startRow,width:characterWidth*(maximumWidth-startColumn),height:lineHeight})}var middleEndRow;if(endColumn===0){middleEndRow=endRow-1}else{if(endColumn===maximumWidth){middleEndRow=endRow}else{middleEndRow=endRow-1;rects.push({x:margin.left,y:margin.top+lineHeight*endRow,width:characterWidth*endColumn,height:lineHeight})}}rects.push({x:margin.left,y:margin.top+lineHeight*middleStartRow,width:characterWidth*maximumWidth,height:lineHeight*(middleEndRow-middleStartRow+1)});return rects},syntaxManagerInvalidatedSyntax:function(sender){this._recomputeEntireLayout()},textStorageEdited:function(sender,oldRange,newRange){this.get("syntaxManager").layoutManagerReplacedText(oldRange,newRange);this._recomputeLayoutForRanges(oldRange,newRange)},updateTextRows:function(startRow,endRow){var textLines=this.get("textLines");var attrs=this.get("syntaxManager").attrsForRows(startRow,endRow);var theme=this.get("theme");for(var i=0;i<attrs.length;i++){textLines[startRow+i].colors=attrs[i].map(function(range){var color=theme["editorTextColor_"+range.tag];if(SC.none(color)){color=theme.editorTextColor_plain}return{start:range.start,end:range.end,color:color}})}}})});tiki.module("text_editor:controllers/search",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var Range=require("rangeutils:utils/range");var console=require("bespin:console").console;exports.EditorSearchController=SC.Object.extend({_escapeString:/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,_findMatchesInString:function(str){var result=[];var searchRegExp=this.get("searchRegExp");var searchResult;var endIndex;searchRegExp.lastIndex=0;while(true){searchResult=searchRegExp.exec(str);if(searchResult===null){break}result.push(searchResult);var index=searchResult.index;searchRegExp.lastIndex=index+searchResult[0].length}return result},_makeRange:function(searchResult,row){return{start:{row:row,column:searchResult.index},end:{row:row,column:searchResult.index+searchResult[0].length}}},isRegExp:null,searchRegExp:null,searchText:null,textView:null,setSearchText:function(text,isRegExp){var regExp;if(!isRegExp){regExp=new RegExp(text.replace(this._escapeString,"\\$1"),"gi")}else{regExp=new RegExp(text)}this.set("searchRegExp",regExp);this.set("isRegExp",isRegExp);this.set("searchText",text)},findNext:function(startPos,allowFromStart){var searchRegExp=this.get("searchRegExp");if(SC.none(searchRegExp)){return null}var textView=this.get("textView");startPos=startPos||textView.getSelectedRange().end;var lines=textView.getPath("layoutManager.textStorage.lines");var searchResult;searchRegExp.lastIndex=startPos.column;var row;for(row=startPos.row;row<lines.length;row++){searchResult=searchRegExp.exec(lines[row]);if(!SC.none(searchResult)){return this._makeRange(searchResult,row)}}if(!allowFromStart){return null}for(row=0;row<=startPos.row;row++){searchResult=searchRegExp.exec(lines[row]);if(!SC.none(searchResult)){return this._makeRange(searchResult,row)}}return null},findPrevious:function(startPos,allowFromEnd){var searchRegExp=this.get("searchRegExp");if(SC.none(searchRegExp)){return null}var textView=this.get("textView");startPos=startPos||textView.getSelectedRange().start;var lines=textView.getPath("layoutManager.textStorage.lines");var searchResults;var firstLine=lines[startPos.row].substring(0,startPos.column);searchResults=this._findMatchesInString(firstLine);if(searchResults.length!==0){return this._makeRange(searchResults[searchResults.length-1],startPos.row)}var row;for(row=startPos.row-1;row!==-1;row--){searchResults=this._findMatchesInString(lines[row]);if(searchResults.length!==0){return this._makeRange(searchResults[searchResults.length-1],row)}}if(!allowFromEnd){return null}for(row=lines.length-1;row>=startPos.row;row--){searchResults=this._findMatchesInString(lines[row]);if(searchResults.length!==0){return this._makeRange(searchResults[searchResults.length-1],row)}}return null}})});tiki.module("text_editor:controllers/undo",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var console=require("bespin:console").console;var undoManager=require("appsupport:controllers/undomanager").undoManager;exports.EditorUndoController=SC.Object.extend({_inTransaction:false,_record:null,textView:null,_beginTransaction:function(){if(this._inTransaction){console.trace();throw new Error("UndoController._beginTransaction() called with a transaction already in place")}this._inTransaction=true;this._record={patches:[]}},_endTransaction:function(){if(!this._inTransaction){throw new Error("UndoController._endTransaction() called without a transaction in place")}undoManager.registerUndo(this,this._record);this._record=null;this._inTransaction=false},_tryApplyingPatches:function(patches){var textStorage=this.getPath("textView.layoutManager.textStorage");patches.forEach(function(patch){textStorage.replaceCharacters(patch.oldRange,patch.newCharacters)});return true},_undoOrRedo:function(patches,selection){if(this._inTransaction){throw new Error("UndoController._undoOrRedo() called while in a transaction")}if(!this._tryApplyingPatches(patches)){return false}this.get("textView").setSelection(selection,true);return true},init:function(){this._redoStack=[];this._undoStack=[];this.get("textView").addDelegate(this)},redo:function(record){var patches=record.patches.concat();patches.reverse();return this._undoOrRedo(patches,record.selectionAfter)},textViewBeganChangeGroup:function(sender,selection){this._beginTransaction();this._record.selectionBefore=selection},textViewEndedChangeGroup:function(sender,selection){this._record.selectionAfter=selection;this._endTransaction()},textViewReplacedCharacters:function(sender,oldRange,characters){if(!this._inTransaction){throw new Error("UndoController.textViewReplacedCharacters() called outside a transaction")}this._record.patches.push({oldCharacters:this._deletedCharacters,oldRange:oldRange,newCharacters:characters,newRange:this.getPath("textView.layoutManager.textStorage").resultingRangeForReplacement(oldRange,characters.split("\n"))});this._deletedCharacters=null},textViewWillReplaceRange:function(sender,oldRange){if(!this._inTransaction){throw new Error("UndoController.textViewWillReplaceRange() called outside a transaction")}this._deletedCharacters=this.getPath("textView.layoutManager.textStorage").getCharacters(oldRange)},undo:function(record){return this._undoOrRedo(record.patches.map(function(patch){return{oldCharacters:patch.newCharacters,oldRange:patch.newRange,newCharacters:patch.oldCharacters,newRange:patch.oldRange}}),record.selectionBefore)}})});tiki.module("text_editor:mixins/textbuffer",function(require,exports,module){var SC=require("sproutcore/runtime").SC;exports.TextBuffer={deleteCharacters:function(range){this.replaceCharacters(range,"")},insertCharacters:function(position,characters){this.replaceCharacters({start:position,end:position},characters)},resultingRangeForReplacement:function(range,lines){var lineCount=lines.length;var lastLineLength=lines[lineCount-1].length;var start=range.start;return{start:start,end:{row:start.row+lineCount-1,column:(lineCount===1?start.column:0)+lastLineLength}}}}});tiki.module("text_editor:mixins/textinput",function(require,exports,module){var SC=require("sproutcore/runtime").SC;exports.TextInput={_TextInput_composing:false,_TextInput_ignore:false,_TextInput_ignoreBlur:false,_TextInput_textFieldId:undefined,_TextInput_textFieldDom:undefined,_TextInput_wantsFocus:false,_isChrome:!!parseFloat(navigator.userAgent.split("Chrome/")[1]),_TextInput_textFieldChanged:function(){if(this._TextInput_composing||this._TextInput_ignore){return}var textField=this._TextInput_textFieldDom;var text=textField.value;if(text==""){return}textField.value="";this._TextInput_textInserted(text)},_TextInput_copy:function(){var copyData=false;if(this.respondsTo("copy")){SC.RunLoop.begin();copyData=this.copy();SC.RunLoop.end()}return copyData},_TextInput_cut:function(){var cutData=false;if(this.respondsTo("cut")){SC.RunLoop.begin();cutData=this.cut();SC.RunLoop.end()}return cutData},_TextInput_textInserted:function(text){if(this.respondsTo("textInserted")){SC.RunLoop.begin();this.textInserted(text);SC.RunLoop.end()}},_TextInput_setValueAndSelect:function(text){var textField=this._TextInput_textFieldDom;textField.value=text;textField.select()},focusTextInput:function(){if(SC.none(this._TextInput_textFieldDom)){this._TextInput_wantsFocus=true}else{this._TextInput_textFieldDom.focus()}},unfocusTextInput:function(){this._TextInput_textFieldDom.blur()},render:function(context,firstTime){arguments.callee.base.apply(this,arguments);if(firstTime){var frame=this.get("frame");var textFieldContext=context.begin("textarea");this._TextInput_textFieldId=SC.guidFor(textFieldContext);textFieldContext.id(this._TextInput_textFieldId);textFieldContext.attr("style","position: absolute; z-index: -99999; top: 0px; left: 0px; width: 0px; height: 0px");textFieldContext.end()}},didCreateLayer:function(){arguments.callee.base.apply(this,arguments);var textField=this.$("#"+this._TextInput_textFieldId)[0];this._TextInput_textFieldDom=textField;var self=this;if(this._TextInput_wantsFocus){window.setTimeout(this.becomeFirstResponder.bind(this),0)}if(SC.browser.safari){if(!this._isChrome){textField.addEventListener("compositionend",function(evt){self._TextInput_textInserted(evt.data)},false)}textField.addEventListener("textInput",function(evt){self._TextInput_textInserted(evt.data)},false);textField.addEventListener("paste",function(evt){self._TextInput_textInserted(evt.clipboardData.getData("text/plain"));evt.preventDefault()},false)}else{var textFieldChangedFn=function(evt){self._TextInput_textFieldChanged()};var textFieldChangedLater=function(){window.setTimeout(function(){SC.run(textFieldChangedFn)},0)};textField.addEventListener("keydown",textFieldChangedLater,false);textField.addEventListener("keypress",textFieldChangedFn,false);textField.addEventListener("keyup",textFieldChangedFn,false);textField.addEventListener("compositionstart",function(evt){self._TextInput_composing=true},false);textField.addEventListener("compositionend",function(evt){self._TextInput_composing=false;self._TextInput_textFieldChanged()},false);textField.addEventListener("paste",function(evt){self._TextInput_setValueAndSelect("");window.setTimeout(function(){self._TextInput_textFieldChanged()},0)},false)}var copyCutBaseFn=function(evt){var copyCutData=evt.type.indexOf("copy")!=-1?self._TextInput_copy():self._TextInput_cut();self._TextInput_setValueAndSelect(copyCutData)};if(!(SC.browser.isSafari&&!this._isChrome&&SC.browser.isMac)){var copyCutMozillaFn=false;if(SC.browser.isMozilla){copyCutMozillaFn=function(evt){copyCutBaseFn(evt);if(SC.browser.isMozilla){self._TextInput_ignore=true;window.setTimeout(function(){self._TextInput_setValueAndSelect("");self._TextInput_ignore=false},0)}}}textField.addEventListener("copy",copyCutMozillaFn||copyCutBaseFn,false);textField.addEventListener("cut",copyCutMozillaFn||copyCutBaseFn,false)}else{var lastCutCall=new Date().getTime();var copyCutSafariMacFn=function(evt){var doCut=evt.type.indexOf("cut")!=-1;if(doCut&&new Date().getTime()-lastCutCall<10){return}copyCutBaseFn(evt);if(doCut){lastCutCall=new Date().getTime()}};textField.addEventListener("beforecopy",copyCutSafariMacFn,false);textField.addEventListener("beforecut",copyCutSafariMacFn,false)}textField.addEventListener("blur",function(evt){SC.run(function(){self._TextInput_ignoreBlur=true;self.resignFirstResponder();self._TextInput_ignoreBlur=false})},false);textField.addEventListener("focus",function(evt){SC.run(function(){self.becomeFirstResponder()})},false)},mouseDown:function(evt){arguments.callee.base.apply(this,arguments);window.setTimeout(this.becomeFirstResponder.bind(this),0);return true},willBecomeKeyResponderFrom:function(responder){arguments.callee.base.apply(this,arguments);this.focusTextInput()},willLoseKeyResponderTo:function(responder){arguments.callee.base.apply(this,arguments);if(!this._TextInput_ignoreBlur){this.unfocusTextInput()}}}});tiki.module("text_editor:models/textstorage",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var MultiDelegateSupport=require("delegate_support").MultiDelegateSupport;var TextBuffer=require("mixins/textbuffer").TextBuffer;exports.TextStorage=SC.Object.extend(MultiDelegateSupport,TextBuffer,{lines:null,value:function(key,value){if(value!==undefined){this.replaceCharacters(this.range(),value)}return this.get("lines").join("\n")}.property("lines.[]"),clampPosition:function(position){var lines=this.get("lines");var row=position.row;if(row<0){return{row:0,column:0}}else{if(row>=lines.length){return this.range().end}}return{row:row,column:Math.max(0,Math.min(position.column,lines[row].length))}},clampRange:function(range){return{start:this.clampPosition(range.start),end:this.clampPosition(range.end)}},displacePosition:function(pos,count){var forward=count>0;var lines=this.get("lines");var lineCount=lines.length;for(var i=Math.abs(count);i!==0;i--){if(forward){var rowLength=lines[pos.row].length;if(pos.row===lineCount-1&&pos.column===rowLength){return pos}pos=pos.column===rowLength?{row:pos.row+1,column:0}:{row:pos.row,column:pos.column+1}}else{if(pos.row===0&&pos.column==0){return pos}if(pos.column===0){var lines=this.get("lines");pos={row:pos.row-1,column:lines[pos.row-1].length}}else{pos={row:pos.row,column:pos.column-1}}}}return pos},getCharacters:function(range){var lines=this.get("lines");var start=range.start,end=range.end;var startRow=start.row,endRow=end.row;var startColumn=start.column,endColumn=end.column;if(startRow===endRow){return lines[startRow].substring(startColumn,endColumn)}return[lines[startRow].substring(startColumn)].concat(lines.slice(startRow+1,endRow),lines[endRow].substring(0,endColumn)).join("\n")},init:function(){this.superclass();this.set("delegates",[]);this.set("lines",[""])},range:function(){var lines=this.get("lines");return{start:{row:0,column:0},end:{row:lines.length-1,column:lines[lines.length-1].length}}},replaceCharacters:function(oldRange,characters){var addedLines=characters.split("\n");var addedLineCount=addedLines.length;var newRange=this.resultingRangeForReplacement(oldRange,addedLines);var oldStart=oldRange.start,oldEnd=oldRange.end;var oldStartRow=oldStart.row,oldEndRow=oldEnd.row;var oldStartColumn=oldStart.column;var lines=this.get("lines");addedLines[0]=lines[oldStartRow].substring(0,oldStartColumn)+addedLines[0];addedLines[addedLineCount-1]+=lines[oldEndRow].substring(oldEnd.column);lines.replace(oldStartRow,oldEndRow-oldStartRow+1,addedLines);this.notifyDelegates("textStorageEdited",oldRange,newRange)}})});tiki.module("text_editor:utils/rect",function(require,exports,module){var SC=require("sproutcore/runtime").SC;exports._distanceFromBounds=function(value,low,high){if(value<low){return value-low}if(value>=high){return value-high}return 0};exports.merge=function(set){var modified;do{modified=false;var newSet=[];for(var i=0;i<set.length;i++){var rectA=set[i];newSet.push(rectA);for(var j=i+1;j<set.length;j++){var rectB=set[j];if(exports.rectsSideBySide(rectA,rectB)||exports.rectsIntersect(rectA,rectB)){set.removeAt(j,1);newSet[newSet.length-1]=SC.unionRects(rectA,rectB);modified=true;break}}}set=newSet}while(modified);return set},exports.offsetFromRect=function(rect,point){return{x:exports._distanceFromBounds(point.x,rect.x,SC.maxX(rect)),y:exports._distanceFromBounds(point.y,rect.y,SC.maxY(rect))}};exports.rectsIntersect=function(a,b){var intersection=SC.intersectRects(a,b);return intersection.width!==0&&intersection.height!==0};exports.rectsSideBySide=function(a,b){if(a.x==b.x&&a.width==b.width){if(a.y<b.y){return(a.y+a.height)==b.y}else{return(b.y+b.height)==a.y}}else{if(a.y==b.y&&a.height==b.height){if(a.x<b.x){return(a.x+a.width)==b.x}else{return(b.x+b.width)==a.x}}}return false}});tiki.module("text_editor:views/canvas",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var Rect=require("utils/rect");exports.CanvasView=SC.View.extend({_cvCanvasContext:null,_cvCanvasDom:null,_cvCanvasId:null,_cvInvalidRects:null,_cvLastRedrawTime:null,_cvPreviousClippingFrame:null,_cvRedrawTimer:null,_cvClippingFrameChanged:function(){var previousClippingFrame=this._cvPreviousClippingFrame;var clippingFrame=this.get("clippingFrame");if(previousClippingFrame===null||!SC.rectsEqual(clippingFrame,previousClippingFrame)){this._cvPreviousClippingFrame=clippingFrame;this.clippingFrameChanged()}}.observes("clippingFrame"),_cvGetContext:function(){if(this._cvCanvasContext===null){this._cvCanvasContext=this._cvCanvasDom.getContext("2d")}return this._cvCanvasContext},_cvResizeCanvas:function(){var parentFrame=this.getPath("parentView.frame");var canvas=this._cvCanvasDom;if(SC.none(canvas)){return}var widthChanged=canvas.width<parentFrame.width;var heightChanged=canvas.height<parentFrame.height;if(widthChanged){canvas.width=parentFrame.width}if(heightChanged){canvas.height=parentFrame.height}if(widthChanged||heightChanged){this.setNeedsDisplay()}},layoutStyle:{left:"0px",top:"0px"},minimumRedrawDelay:1000/30,clippingFrameChanged:function(){this.setNeedsDisplay()},didCreateLayer:function(){arguments.callee.base.apply(this,arguments);this._cvCanvasDom=this.$("#"+this._cvCanvasId)[0];this.redraw()},drawRect:function(rect,context){},init:function(){arguments.callee.base.apply(this,arguments);this._cvInvalidRects=[];this.get("parentView").addObserver("frame",this,this.parentViewFrameChanged)},parentViewFrameChanged:function(){this._cvResizeCanvas()},redraw:function(){var frame=this.get("frame");if(frame.x<0){this.computeFrameWithParentFrame(null)}var context=this._cvGetContext();context.save();context.translate(Math.round(frame.x),Math.round(frame.y));var clippingFrame=this.get("clippingFrame");clippingFrame={x:Math.round(clippingFrame.x),y:Math.round(clippingFrame.y),width:clippingFrame.width,height:clippingFrame.height};var invalidRects=this._cvInvalidRects;if(invalidRects==="all"){this.drawRect(clippingFrame,context)}else{Rect.merge(invalidRects).forEach(function(rect){context.save();rect=SC.intersectRects(rect,clippingFrame);if(rect.width!==0&&rect.height!==0){var x=rect.x,y=rect.y;var width=rect.width,height=rect.height;context.beginPath();context.moveTo(x,y);context.lineTo(x+width,y);context.lineTo(x+width,y+height);context.lineTo(x,y+height);context.closePath();context.clip();this.drawRect(rect,context)}context.restore()},this)}context.restore();this._cvInvalidRects=[];this._cvLastRedrawTime=new Date().getTime();return true},render:function(context,firstTime){arguments.callee.base.apply(this,arguments);if(firstTime){var parentFrame=this.getPath("parentView.frame");var canvasContext=context.begin("canvas");this._cvCanvasId=SC.guidFor(canvasContext);canvasContext.id(this._cvCanvasId);canvasContext.attr("width",""+parentFrame.width);canvasContext.attr("height",""+parentFrame.height);canvasContext.push("canvas tag not supported by your browser");canvasContext.end();return}this.invokeLater(this.tryRedraw,0)},renderLayout:function(context,firstTime){arguments.callee.base.apply(this,arguments);var parentFrame=this.getPath("parentView.frame");if(firstTime){context.attr("width",parentFrame.width);context.attr("height",parentFrame.height);return}},setNeedsDisplay:function(rect){this._cvInvalidRects="all";this.set("layerNeedsUpdate",true)},setNeedsDisplayInRect:function(rect){var invalidRects=this._cvInvalidRects;if(invalidRects!=="all"){invalidRects.push(rect)}this.set("layerNeedsUpdate",true)},tryRedraw:function(context,firstTime){var now=new Date().getTime();var lastRedrawTime=this._cvLastRedrawTime;var minimumRedrawDelay=this.get("minimumRedrawDelay");if(lastRedrawTime===null||now-lastRedrawTime>=minimumRedrawDelay){this.redraw();return}var redrawTimer=this._cvRedrawTimer;if(redrawTimer!==null&&redrawTimer.get("isValid")){return}this._cvRedrawTimer=SC.Timer.schedule({target:this,action:this.redraw,interval:minimumRedrawDelay,repeats:false})}})});tiki.module("text_editor:views/editor",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var GutterView=require("views/gutter").GutterView;var LayoutManager=require("controllers/layoutmanager").LayoutManager;var ScrollView=require("views/scroll").ScrollView;var SyntaxManager=require("syntax_manager:controllers/syntaxmanager").SyntaxManager;var TextView=require("views/text").TextView;var EditorUndoController=require("controllers/undo").EditorUndoController;var EditorSearchController=require("controllers/search").EditorSearchController;var settings=require("settings").settings;var m_scratchcanvas=require("bespin:util/scratchcanvas");exports.EditorView=SC.View.extend(SC.Border,{_fontChanged:function(){var fontSize=settings.get("fontsize");var canvas=m_scratchcanvas.get();var layoutManager=this.layoutManager;var str="";for(var i=0;i<100;i++){str+="M"}var width=canvas.measureStringWidth(this.font,str)/100;layoutManager.set("characterWidth",width);layoutManager.set("lineHeight",Math.floor(fontSize*1.6));layoutManager.set("lineAscent",Math.floor(fontSize*1.3));this.layoutManager._recomputeEntireLayout();this.gutterView._recomputeLayout();this.textView.setNeedsDisplay()}.observes("font"),_fontSizeChanged:function(){var fontSize=settings.get("fontsize");var fontFace=settings.get("fontface");var font=fontSize+"px "+fontFace;this.set("font",font)}.observes("settings:index#settings.fontsize","settings:index#settings.fontface"),borderStyle:SC.BORDER_GRAY,font:"10pt Monaco, Lucida Console, monospace",gutterView:GutterView,layoutManager:LayoutManager,scrollView:ScrollView,searchController:EditorSearchController,syntaxManager:SyntaxManager,textView:TextView,undoController:EditorUndoController,_gutterViewFrameChanged:function(){this.get("scrollView").adjust({left:this.getPath("gutterView.frame").width})},_scrollViewVerticalScrollOffsetChanged:function(){this.setPath("gutterView.verticalScrollOffset",this.getPath("scrollView.verticalScrollOffset"))},createChildViews:function(){var layoutManager=this.get("layoutManager");var scrollViewClass=this.get("scrollView");var gutterView=this.createChildView(this.get("gutterView"),{editor:this,layoutManager:layoutManager});this.set("gutterView",gutterView);gutterView.addObserver("frame",this,this._gutterViewFrameChanged);var textViewClass=this.get("textView");var scrollView=this.createChildView(scrollViewClass,{containerView:SC.ContainerView.extend({hasCustomScrolling:true}),contentView:textViewClass.extend({editor:this,layoutManager:layoutManager,searchController:this.get("searchController")}),layout:{left:gutterView.get("frame").width,bottom:0,top:0,right:0}});this.set("scrollView",scrollView);scrollView.addObserver("verticalScrollOffset",this,this._scrollViewVerticalScrollOffsetChanged);var textView=scrollView.get("contentView");this.set("textView",textView);this.set("undoController",this.get("undoController").create({textView:textView}));this.get("searchController").set("textView",textView);this.set("childViews",[gutterView,scrollView])},init:function(){this.set("layoutManager",this.get("layoutManager").create());this.set("searchController",this.get("searchController").create());return arguments.callee.base.apply(this,arguments)}})});tiki.module("text_editor:views/gutter",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var CanvasView=require("views/canvas").CanvasView;var m_scratchcanvas=require("bespin:util/scratchcanvas");var InteriorGutterView=CanvasView.extend({theme:{gutterStyle:"#4c4a41",lineNumberColor:"#e5c138",lineNumberFont:"10pt Monaco, Lucida Console, monospace",editorTextFont:"10pt Monaco, Lucida Console, monospace"},_frameChanged:function(){this.setNeedsDisplay()}.observes("frame"),drawRect:function(rect,context){var theme=this.get("theme");context.fillStyle=theme.gutterStyle;context.fillRect(rect.x,rect.y,rect.width,rect.height);context.save();var parentView=this.get("parentView");var padding=parentView.get("padding");context.translate(padding.left,0);var layoutManager=parentView.get("layoutManager");var range=layoutManager.characterRangeForBoundingRect(rect);var endRow=Math.min(range.end.row,layoutManager.get("textLines").length-1);var lineAscent=layoutManager.get("lineAscent");context.fillStyle=theme.lineNumberColor;context.font=parentView.get("editor").font;for(var row=range.start.row;row<=endRow;row++){context.fillText(""+(row+1),-0.5,layoutManager.lineRectForRow(row).y+lineAscent-0.5)}context.restore()}});exports.GutterView=SC.View.extend({_interiorView:null,_computeWidth:function(){var padding=this.get("padding");var paddingWidth=padding.left+padding.right;var lineNumberFont=this.get("theme").lineNumberFont;var layoutManager=this.get("layoutManager");var lineCount=layoutManager.get("textLines").length;var lineCountStr=""+lineCount;var characterWidth=layoutManager.get("characterWidth");var strWidth=characterWidth*lineCountStr.length;return strWidth+paddingWidth},_frameChanged:function(){this._recomputeLayout()}.observes("frame"),_recomputeLayout:function(){var layoutManager=this.get("layoutManager");var padding=this.get("padding");var width=this._computeWidth();var layout=SC.clone(this.get("layout"));if(layout.width!==width){layout.width=width;this.set("layout",layout);return}var frame=this.get("frame");this._interiorView.set("layout",{left:0,top:-this.get("verticalScrollOffset"),width:width,height:Math.max(frame.height,layoutManager.boundingRect().height+padding.bottom)})},_verticalScrollOffsetChanged:function(){this._recomputeLayout()}.observes("verticalScrollOffset"),layout:{left:0,top:0,bottom:0,width:32},layoutManager:null,padding:{bottom:30,left:5,right:10},theme:{lineNumberFont:"10pt Monaco, Lucida Console, monospace"},verticalScrollOffset:0,createChildViews:function(){var interiorView=this.createChildView(InteriorGutterView);this._interiorView=interiorView;var frame=this.get("frame");this._recomputeLayout();this.set("childViews",[interiorView])},init:function(){arguments.callee.base.apply(this,arguments);this.get("layoutManager").addDelegate(this)},layoutManagerInvalidatedRects:function(sender,rects){this._recomputeLayout()}})});tiki.module("text_editor:views/scroll",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var BespinScrollerView=require("views/scroller").BespinScrollerView;exports.ScrollView=SC.ScrollView.extend({_containerViewLaidOut:false,autohidesHorizontalScroller:false,autohidesVerticalScroller:false,borderStyle:SC.BORDER_NONE,hasHorizontalScroller:true,hasVerticalScroller:true,horizontalScrollerThickness:24,horizontalScrollerView:BespinScrollerView,verticalScrollerThickness:24,verticalScrollerView:BespinScrollerView,tile:function(){if(!this._containerViewLaidOut){var containerView=this.get("containerView");containerView.adjust({left:0,bottom:0,top:0,right:0});containerView.updateLayout();this._containerViewLaidOut=true}var hScroller=this.get("horizontalScrollerView");var vScroller=this.get("verticalScrollerView");var hScrollerVisible=this.get("isHorizontalScrollerVisible");var vScrollerVisible=this.get("isVerticalScrollerVisible");var hScrollerThickness=this.get("horizontalScrollerThickness");var vScrollerThickness=this.get("verticalScrollerThickness");if(hScrollerVisible){hScroller=this.get("horizontalScrollerView");hScroller.set("scrollerThickness",hScrollerThickness);hScroller.set("padding",{top:0,bottom:6,left:6,right:6+vScrollerThickness});hScroller.set("layout",{left:0,bottom:0,right:0,height:hScrollerThickness})}if(vScrollerVisible){vScroller=this.get("verticalScrollerView");vScroller.set("scrollerThickness",vScrollerThickness);vScroller.set("padding",{left:0,right:6,top:6,bottom:6+hScrollerThickness});vScroller.set("layout",{top:0,right:0,bottom:0,width:vScrollerThickness})}var contentView=this.get("contentView");if(contentView.get("hasPadding")===true){this.get("contentView").set("padding",{bottom:hScrollerThickness+6,right:vScrollerThickness+6})}}})});tiki.module("text_editor:views/scroller",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var CanvasView=require("views/canvas").CanvasView;var console=require("bespin:console").console;var LINE_HEIGHT=15;var MINIMUM_HANDLE_SIZE=20;var NIB_ARROW_PADDING_BEFORE=3;var NIB_ARROW_PADDING_AFTER=5;var NIB_LENGTH=15;var NIB_PADDING=8;var ScrollerCanvasView=CanvasView.extend({classNames:["bespin-scroller-view"],lineHeight:20,_mouseDownScreenPoint:null,_mouseDownValue:null,_isMouseOver:false,_scrollTimer:null,_mouseEventPosition:null,_mouseOverHandle:false,theme:{backgroundStyle:"#2A211C",partialNibStyle:"rgba(100, 100, 100, 0.3)",partialNibArrowStyle:"rgba(255, 255, 255, 0.3)",partialNibStrokeStyle:"rgba(150, 150, 150, 0.3)",fullNibStyle:"rgb(100, 100, 100)",fullNibArrowStyle:"rgb(255, 255, 255)",fullNibStrokeStyle:"rgb(150, 150, 150)",scrollTrackFillStyle:"rgba(50, 50, 50, 0.8)",scrollTrackStrokeStyle:"rgb(150, 150, 150)",scrollBarFillStyle:"rgba(0, 0, 0, %a)",scrollBarFillGradientTopStart:"rgba(90, 90, 90, %a)",scrollBarFillGradientTopStop:"rgba(40, 40, 40, %a)",scrollBarFillGradientBottomStart:"rgba(22, 22, 22, %a)",scrollBarFillGradientBottomStop:"rgba(44, 44, 44, %a)"},_drawNib:function(ctx){var theme=this.get("theme");var fillStyle,arrowStyle,strokeStyle;if(this._isHighlighted()){fillStyle=theme.fullNibStyle;arrowStyle=theme.fullNibArrowStyle;strokeStyle=theme.fullNibStrokeStyle}else{fillStyle=theme.partialNibStyle;arrowStyle=theme.partialNibArrowStyle;strokeStyle=theme.partialNibStrokeStyle}var midpoint=Math.floor(NIB_LENGTH/2);ctx.fillStyle=fillStyle;ctx.beginPath();ctx.arc(0,0,Math.floor(NIB_LENGTH/2),0,Math.PI*2,true);ctx.closePath();ctx.fill();ctx.strokeStyle=strokeStyle;ctx.stroke();ctx.fillStyle=arrowStyle;ctx.beginPath();ctx.moveTo(0,-midpoint+NIB_ARROW_PADDING_BEFORE);ctx.lineTo(-midpoint+NIB_ARROW_PADDING_BEFORE,midpoint-NIB_ARROW_PADDING_AFTER);ctx.lineTo(midpoint-NIB_ARROW_PADDING_BEFORE,midpoint-NIB_ARROW_PADDING_AFTER);ctx.closePath();ctx.fill()},_drawNibs:function(ctx){var thickness=this._getClientThickness();var parentView=this.get("parentView");var value=parentView.get("value");var maximum=parentView.get("maximum");var highlighted=this._isHighlighted();if(highlighted||value!==0){ctx.save();ctx.translate(NIB_PADDING,thickness/2);ctx.rotate(Math.PI*1.5);ctx.moveTo(0,0);this._drawNib(ctx);ctx.restore()}if(highlighted||value!==maximum){ctx.save();ctx.translate(this._getClientLength()-NIB_PADDING,thickness/2);ctx.rotate(Math.PI*0.5);ctx.moveTo(0,0);this._drawNib(ctx);ctx.restore()}},_getClientFrame:function(){var frame=this.get("frame");var padding=this.getPath("parentView.padding");return{x:padding.left,y:padding.top,width:frame.width-(padding.left+padding.right),height:frame.height-(padding.top+padding.bottom)}},_getClientLength:function(){var clientFrame=this._getClientFrame();switch(this.getPath("parentView.layoutDirection")){case SC.LAYOUT_HORIZONTAL:return clientFrame.width;case SC.LAYOUT_VERTICAL:return clientFrame.height;default:console.error("unknown layout direction");return null}},_getClientThickness:function(){var parentView=this.get("parentView");var padding=parentView.get("padding");var scrollerThickness=parentView.get("scrollerThickness");switch(parentView.get("layoutDirection")){case SC.LAYOUT_VERTICAL:return scrollerThickness-(padding.left+padding.right);case SC.LAYOUT_HORIZONTAL:return scrollerThickness-(padding.top+padding.bottom);default:console.error("unknown layout direction");return null}}.property(),_getFrameLength:function(){var frame=this.get("frame");switch(this.getPath("parentView.layoutDirection")){case SC.LAYOUT_HORIZONTAL:return frame.width;case SC.LAYOUT_VERTICAL:return frame.height;default:console.error("unknown layout direction");return null}},_getGutterFrame:function(){var clientFrame=this._getClientFrame();var thickness=this._getClientThickness();switch(this.getPath("parentView.layoutDirection")){case SC.LAYOUT_VERTICAL:return{x:clientFrame.x,y:clientFrame.y+NIB_LENGTH,width:thickness,height:Math.max(0,clientFrame.height-2*NIB_LENGTH)};case SC.LAYOUT_HORIZONTAL:return{x:clientFrame.x+NIB_LENGTH,y:clientFrame.y,width:Math.max(0,clientFrame.width-2*NIB_LENGTH),height:thickness};default:console.error("unknown layout direction");return null}},_getGutterLength:function(){var gutterFrame=this._getGutterFrame();var gutterLength;switch(this.getPath("parentView.layoutDirection")){case SC.LAYOUT_HORIZONTAL:gutterLength=gutterFrame.width;break;case SC.LAYOUT_VERTICAL:gutterLength=gutterFrame.height;break;default:console.error("unknown layout direction");break}return gutterLength},_getHandleFrame:function(){var gutterFrame=this._getGutterFrame();var handleOffset=this._getHandleOffset();var handleLength=this._getHandleLength();switch(this.getPath("parentView.layoutDirection")){case SC.LAYOUT_VERTICAL:return{x:gutterFrame.x,y:gutterFrame.y+handleOffset,width:gutterFrame.width,height:handleLength};case SC.LAYOUT_HORIZONTAL:return{x:gutterFrame.x+handleOffset,y:gutterFrame.y,width:handleLength,height:gutterFrame.height}}},_getHandleLength:function(){var gutterLength=this._getGutterLength();var proportion=this.getPath("parentView.proportion");return Math.max(gutterLength*proportion,MINIMUM_HANDLE_SIZE)},_getHandleOffset:function(){var parentView=this.get("parentView");var maximum=parentView.get("maximum");if(maximum===0){return 0}var gutterLength=this._getGutterLength();var handleLength=this._getHandleLength();var emptyGutterLength=gutterLength-handleLength;var value=parentView.get("value");return emptyGutterLength*value/maximum},_isHighlighted:function(){return this._isMouseOver===true||this._mouseDownScreenPoint!==null},_segmentForMouseEvent:function(evt){var point=this.convertFrameFromView({x:evt.pageX,y:evt.pageY});var clientFrame=this._getClientFrame();var padding=this.getPath("parentView.padding");if(!SC.pointInRect(point,clientFrame)){return null}var layoutDirection=this.getPath("parentView.layoutDirection");switch(layoutDirection){case SC.LAYOUT_HORIZONTAL:if((point.x-padding.left)<NIB_LENGTH){return"nib-start"}else{if(point.x>=clientFrame.width-NIB_LENGTH){return"nib-end"}}break;case SC.LAYOUT_VERTICAL:if((point.y-padding.top)<NIB_LENGTH){return"nib-start"}else{if(point.y>=clientFrame.height-NIB_LENGTH){return"nib-end"}}break;default:console.error("unknown layout direction");break}var handleFrame=this._getHandleFrame();if(SC.pointInRect(point,handleFrame)){return"handle"}switch(layoutDirection){case SC.LAYOUT_HORIZONTAL:if(point.x<handleFrame.x){return"gutter-before"}else{if(point.x>=handleFrame.x+handleFrame.width){return"gutter-after"}}break;case SC.LAYOUT_VERTICAL:if(point.y<handleFrame.y){return"gutter-before"}else{if(point.y>=handleFrame.y+handleFrame.height){return"gutter-after"}}break;default:console.error("unknown layout direction");break}console.error("_segmentForMouseEvent: point ",point," outside view with handle frame ",handleFrame," and client frame ",clientFrame);return null},adjustFrame:function(){var parentFrame=this.getPath("parentView.frame");this.set("layout",{left:0,top:0,width:parentFrame.width,height:parentFrame.height})},drawRect:function(rect,ctx){var alpha=(ctx.globalAlpha)?ctx.globalAlpha:1;var theme=this.get("theme");var highlighted=this._isHighlighted();var frame=this.get("frame");ctx.clearRect(0,0,frame.width,frame.height);ctx.save();var parentView=this.get("parentView");var padding=parentView.get("padding");ctx.translate(padding.left,padding.top);var handleFrame=this._getHandleFrame();var gutterLength=this._getGutterLength();var thickness=this._getClientThickness();var halfThickness=thickness/2;var layoutDirection=parentView.get("layoutDirection");var handleOffset=this._getHandleOffset()+NIB_LENGTH;var handleLength=this._getHandleLength();if(layoutDirection===SC.LAYOUT_VERTICAL){ctx.translate(thickness+1,0);ctx.rotate(Math.PI*0.5)}if(gutterLength<=handleLength){return}if(!highlighted){ctx.globalAlpha=0.3}else{var clientLength=this._getClientLength();ctx.fillStyle=theme.scrollTrackFillStyle;ctx.fillRect(NIB_PADDING+0.5,0.5,clientLength-2*NIB_PADDING,thickness-1);ctx.strokeStyle=theme.scrollTrackStrokeStyle;ctx.strokeRect(NIB_PADDING+0.5,0.5,clientLength-2*NIB_PADDING,thickness-1)}var buildHandlePath=function(){ctx.beginPath();ctx.arc(handleOffset+halfThickness+0.5,halfThickness,halfThickness-0.5,Math.PI/2,3*Math.PI/2,false);ctx.arc(handleOffset+handleLength-halfThickness-0.5,halfThickness,halfThickness-0.5,3*Math.PI/2,Math.PI/2,false);ctx.lineTo(handleOffset+halfThickness+0.5,thickness-0.5);ctx.closePath()};buildHandlePath();var gradient=ctx.createLinearGradient(handleOffset,0,handleOffset,thickness);gradient.addColorStop(0,theme.scrollBarFillGradientTopStart.replace(/%a/,alpha));gradient.addColorStop(0.4,theme.scrollBarFillGradientTopStop.replace(/%a/,alpha));gradient.addColorStop(0.41,theme.scrollBarFillStyle.replace(/%a/,alpha));gradient.addColorStop(0.8,theme.scrollBarFillGradientBottomStart.replace(/%a/,alpha));gradient.addColorStop(1,theme.scrollBarFillGradientBottomStop.replace(/%a/,alpha));ctx.fillStyle=gradient;ctx.fill();ctx.save();ctx.clip();ctx.fillStyle=theme.scrollBarFillStyle.replace(/%a/,alpha);ctx.beginPath();ctx.moveTo(handleOffset+halfThickness*0.4,halfThickness*0.6);ctx.lineTo(handleOffset+halfThickness*0.9,thickness*0.4);ctx.lineTo(handleOffset,thickness*0.4);ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(handleOffset+handleLength-(halfThickness*0.4),0+(halfThickness*0.6));ctx.lineTo(handleOffset+handleLength-(halfThickness*0.9),0+(thickness*0.4));ctx.lineTo(handleOffset+handleLength,0+(thickness*0.4));ctx.closePath();ctx.fill();ctx.restore();ctx.save();buildHandlePath();ctx.strokeStyle=theme.scrollTrackStrokeStyle;ctx.stroke();ctx.restore();if(!highlighted){ctx.globalAlpha=1}this._drawNibs(ctx);ctx.restore()},_repeatAction:function(method,interval){var repeat=method();if(repeat!==false){this._scrollTimer=SC.Timer.schedule({target:this,action:function(){this._repeatAction(method,100)},interval:interval})}},_scrollByDelta:function(delta){var parentView=this.get("parentView");var value=parentView.get("value");parentView.set("value",value+delta)},_scrollUpOneLine:function(){this._scrollByDelta(-this.get("lineHeight"));return true},_scrollDownOneLine:function(){this._scrollByDelta(this.get("lineHeight"));return true},_scrollPage:function(){switch(this._segmentForMouseEvent(this._mouseEventPosition)){case"gutter-before":this._scrollByDelta(this._getGutterLength()*-1);break;case"gutter-after":this._scrollByDelta(this._getGutterLength());break;case null:break;default:return false;break}return true},mouseDown:function(evt){this._mouseEventPosition=evt;this._mouseOverHandle=false;var parentView=this.get("parentView");var value=parentView.get("value");var gutterLength=this._getGutterLength();switch(this._segmentForMouseEvent(evt)){case"nib-start":this._repeatAction(this._scrollUpOneLine.bind(this),500);break;case"nib-end":this._repeatAction(this._scrollDownOneLine.bind(this),500);break;case"gutter-before":this._repeatAction(this._scrollPage.bind(this),500);break;case"gutter-after":this._repeatAction(this._scrollPage.bind(this),500);break;case"handle":break;default:console.error("_segmentForMouseEvent returned an unknown value");break}switch(parentView.get("layoutDirection")){case SC.LAYOUT_HORIZONTAL:this._mouseDownScreenPoint=evt.pageX;break;case SC.LAYOUT_VERTICAL:this._mouseDownScreenPoint=evt.pageY;break;default:console.error("unknown layout direction");break}},mouseDragged:function(evt){var parentView=this.get("parentView");var segment=this._segmentForMouseEvent(evt);if(segment=="handle"||this._mouseOverHandle===true){this._mouseOverHandle=true;if(this._scrollTimer!==null){this._scrollTimer.invalidate();this._scrollTimer=null}var eventDistance;switch(parentView.get("layoutDirection")){case SC.LAYOUT_HORIZONTAL:eventDistance=evt.pageX;break;case SC.LAYOUT_VERTICAL:eventDistance=evt.pageY;break;default:console.error("unknown layout direction");break}var eventDelta=eventDistance-this._mouseDownScreenPoint;var maximum=parentView.get("maximum");var oldValue=parentView.get("value");var gutterLength=this._getGutterLength();var handleLength=this._getHandleLength();var emptyGutterLength=gutterLength-handleLength;var valueDelta=maximum*eventDelta/emptyGutterLength;parentView.set("value",oldValue+valueDelta);this._mouseDownScreenPoint=eventDistance}this._mouseEventPosition=evt},mouseEntered:function(evt){this._isMouseOver=true;this.setNeedsDisplay()},mouseExited:function(evt){this._isMouseOver=false;this.setNeedsDisplay()},mouseUp:function(evt){this._mouseDownScreenPoint=null;this._mouseDownValue=null;if(this._scrollTimer){this._scrollTimer.invalidate();this._scrollTimer=null}this.setNeedsDisplay()},mouseWheel:function(evt){var parentView=this.get("parentView");var delta;switch(parentView.get("layoutDirection")){case SC.LAYOUT_HORIZONTAL:delta=evt.wheelDeltaX;break;case SC.LAYOUT_VERTICAL:delta=evt.wheelDeltaY;break;default:console.error("unknown layout direction");return}parentView.set("value",parentView.get("value")+2*delta)}});exports.BespinScrollerView=SC.View.extend({_scrollerCanvasView:null,_frameChanged:function(){this._scrollerCanvasView.adjustFrame()}.observes("frame"),_maximumChanged:function(){this._scrollerCanvasView.adjustFrame()}.observes("maximum"),_valueChanged:function(){var scrollerCanvasView=this._scrollerCanvasView;var maximumValue=this.get("maximum");var value=this.get("value");if(value<0){this.set("value",0)}else{if(value>maximumValue){this.set("value",maximumValue)}}scrollerCanvasView.setNeedsDisplay()}.observes("value"),layoutDirection:SC.LAYOUT_VERTICAL,maximum:0,padding:{left:0,bottom:0,top:0,right:0},scrollerThickness:SC.NATURAL_SCROLLER_THICKNESS,value:0,createChildViews:function(){var scrollerCanvasView=this.createChildView(ScrollerCanvasView);scrollerCanvasView.adjustFrame();this._scrollerCanvasView=scrollerCanvasView;this.set("childViews",[scrollerCanvasView])}})});tiki.module("text_editor:views/text",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var CanvasView=require("views/canvas").CanvasView;var LayoutManager=require("controllers/layoutmanager").LayoutManager;var MultiDelegateSupport=require("delegate_support").MultiDelegateSupport;var Range=require("rangeutils:utils/range");var Rect=require("utils/rect");var TextInput=require("mixins/textinput").TextInput;var keyboardManager=require("canon:keyboard").keyboardManager;var settings=require("settings").settings;var DEBUG_TEXT_RANGES=false;exports.TextView=CanvasView.extend(MultiDelegateSupport,TextInput,{_dragPoint:null,_dragTimer:null,_inChangeGroup:false,_insertionPointBlinkTimer:null,_insertionPointVisible:true,_keyBuffer:"",_keyMetaBuffer:"",_keyState:"start",_lineAscent:16,_selectedRange:null,_selectedRangeEndVirtual:null,_drag:function(){var point=this.convertFrameFromView(this._dragPoint);var offset=Rect.offsetFromRect(this.get("clippingFrame"),point);this.moveCursorTo(this._selectionPositionForPoint({x:point.x-offset.x,y:point.y-offset.y}),true);this.becomeFirstResponder()},_drawInsertionPoint:function(rect,context){if(!this._insertionPointVisible){return}var range=this._selectedRange;var characterRect=this.get("layoutManager").characterRectForPosition(range.start);var x=Math.floor(characterRect.x),y=characterRect.y;var width=Math.ceil(characterRect.width);var height=characterRect.height;context.save();var theme=this.get("theme");if(this.get("isFirstResponder")){context.strokeStyle=theme.cursorStyle;context.beginPath();context.moveTo(x+0.5,y);context.lineTo(x+0.5,y+height);context.closePath();context.stroke()}else{context.fillStyle=theme.unfocusedCursorFillStyle;context.fillRect(x+0.5,y,width,height);context.strokeStyle=theme.unfocusedCursorStrokeStyle;context.strokeRect(x+0.5,y+0.5,width-1,height-1)}context.restore()},_drawLines:function(rect,context){var layoutManager=this.get("layoutManager");var textLines=layoutManager.get("textLines");var lineAscent=layoutManager.get("lineAscent");var theme=this.get("theme");context.save();context.font=this.getPath("editor.font");var range=layoutManager.characterRangeForBoundingRect(rect);var rangeStart=range.start,rangeEnd=range.end;var startRow=rangeStart.row,endRow=rangeEnd.row;for(var row=startRow;row<=endRow;row++){var textLine=textLines[row];if(SC.none(textLine)){continue}var characters=textLine.characters;var length=characters.length;var endColumn=Math.min(rangeEnd.column,length);var startColumn=rangeStart.column;if(startColumn>=length){continue}var colorRanges=textLine.colors;var colorIndex=0;while(startColumn<colorRanges[colorIndex].start){colorIndex++}var column=colorRanges[colorIndex].start;while(column!==null&&column<endColumn){var colorRange=colorRanges[colorIndex];var colorRangeEnd=colorRange.end;context.fillStyle=colorRange.color;var characterRect=layoutManager.characterRectForPosition({row:row,column:column});var snippet=colorRangeEnd===null?characters.substring(column):characters.substring(column,colorRangeEnd);context.fillText(snippet,characterRect.x,characterRect.y+lineAscent);if(DEBUG_TEXT_RANGES){context.strokeStyle=colorRange.color;context.strokeRect(characterRect.x+0.5,characterRect.y+0.5,characterRect.width*snippet.length-1,characterRect.height-1)}column=colorRangeEnd;colorIndex++}}context.restore()},_drawSelectionHighlight:function(rect,context){var theme=this.get("theme");var fillStyle=this.get("isFirstResponder")?theme.editorSelectedTextBackground:theme.unfocusedCursorFillStyle;var layoutManager=this.get("layoutManager");context.save();var range=Range.normalizeRange(this._selectedRange);context.fillStyle=fillStyle;layoutManager.rectsForRange(range).forEach(function(rect){context.fillRect(rect.x,rect.y,rect.width,rect.height)});context.restore()},_drawSelection:function(rect,context){if(this._rangeIsInsertionPoint(this._selectedRange)){this._drawInsertionPoint(rect,context)}else{this._drawSelectionHighlight(rect,context)}},_getVirtualSelection:function(startPropertyAsWell){return{start:startPropertyAsWell&&this._selectedRangeEndVirtual?this._selectedRangeEndVirtual:this._selectedRange.start,end:this._selectedRangeEndVirtual||this._selectedRange.end}},_invalidateSelection:function(){var adjustRect=function(rect){return{x:rect.x-1,y:rect.y,width:rect.width+2,height:rect.height}};var layoutManager=this.get("layoutManager");var range=Range.normalizeRange(this._selectedRange);if(!this._rangeIsInsertionPoint(range)){var rects=layoutManager.rectsForRange(range);rects.forEach(function(rect){this.setNeedsDisplayInRect(adjustRect(rect))},this);return}var rect=layoutManager.characterRectForPosition(range.start);this.setNeedsDisplayInRect(adjustRect(rect))},_keymappingChanged:function(){this._keyBuffer="";this._keyState="start"},_performVerticalKeyboardSelection:function(offset){var textStorage=this.getPath("layoutManager.textStorage");var oldPosition=this._selectedRangeEndVirtual!==null?this._selectedRangeEndVirtual:this._selectedRange.end;var newPosition=Range.addPositions(oldPosition,{row:offset,column:0});this.moveCursorTo(newPosition,true,true)},_rangeIsInsertionPoint:function(range){return Range.isZeroLength(range)},_rearmInsertionPointBlinkTimer:function(){if(!this._insertionPointVisible){this.blinkInsertionPoint()}if(this._insertionPointBlinkTimer!==null){this._insertionPointBlinkTimer.invalidate()}this._insertionPointBlinkTimer=SC.Timer.schedule({target:this,action:"blinkInsertionPoint",interval:750,repeats:true})},_repositionSelection:function(){var textLines=this.getPath("layoutManager.textLines");var textLineLength=textLines.length;var range=this._selectedRange;var newStartRow=Math.min(range.start.row,textLineLength-1);var newEndRow=Math.min(range.end.row,textLineLength-1);var startLine=textLines[newStartRow];var endLine=textLines[newEndRow];this.setSelection({start:{row:newStartRow,column:Math.min(range.start.column,startLine.characters.length)},end:{row:newEndRow,column:Math.min(range.end.column,endLine.characters.length)}})},_resize:function(){var boundingRect=this.get("layoutManager").boundingRect();var padding=this.get("padding");var parentFrame=this.getPath("parentView.frame");this.set("layout",SC.mixin(SC.clone(this.get("layout")),{width:Math.max(parentFrame.width,boundingRect.width+padding.right),height:Math.max(parentFrame.height,boundingRect.height+padding.bottom)}))},_scrollPage:function(scrollUp){var scrollable=this._scrollView();var visibleFrame=this.get("clippingFrame");scrollable.scrollTo(visibleFrame.x,visibleFrame.y+(visibleFrame.height+this._lineAscent)*(scrollUp?-1:1))},_scrollView:function(){var view=this.get("parentView");while(!SC.none(view)&&!view.get("isScrollable")){view=view.get("parentView")}return view},_scrollWhileDragging:function(){var scrollView=this._scrollView();if(SC.none(scrollView)){return}var offset=Rect.offsetFromRect(this.get("clippingFrame"),this.convertFrameFromView(this._dragPoint));if(offset.x===0&&offset.y===0){return}scrollView.scrollBy(offset.x,offset.y);this._drag()},_selectionPositionForPoint:function(point){var position=this.get("layoutManager").characterAtPoint(point);return position.partialFraction<0.5?position:Range.addPositions(position,{row:0,column:1})},_syntaxManagerUpdatedSyntaxForRows:function(startRow,endRow){if(startRow===endRow){return}var layoutManager=this.get("layoutManager");layoutManager.updateTextRows(startRow,endRow);layoutManager.rectsForRange({start:{row:startRow,column:0},end:{row:endRow,column:0}}).forEach(this.setNeedsDisplayInRect,this)},_updateSyntax:function(row){var layoutManager=this.get("layoutManager");var visibleRange=layoutManager.characterRangeForBoundingRect(this.get("clippingFrame"));var startRow=visibleRange.start.row,endRow=visibleRange.end.row;if(row!==null){if(row<startRow||row>endRow){return}startRow=row}var self=this;var lines=layoutManager.getPath("textStorage.lines");var syntaxManager=layoutManager.get("syntaxManager");var lastRow=Math.min(lines.length,endRow+1);syntaxManager.updateSyntaxForRows(startRow,lastRow).then(function(result){self._syntaxManagerUpdatedSyntaxForRows(result.startRow,result.endRow)})},acceptsFirstResponder:true,hasPadding:true,layoutManager:null,padding:{bottom:0,right:0},theme:{backgroundStyle:"#fff",cursorStyle:"#879aff",editorSelectedTextColor:"rgb(240, 240, 240)",editorSelectedTextBackground:"#ffcc00",unfocusedCursorStrokeStyle:"#ff0033",unfocusedCursorFillStyle:"#73171e"},blinkInsertionPoint:function(){this._insertionPointVisible=!this._insertionPointVisible;this._invalidateSelection()},clippingFrameChanged:function(){arguments.callee.base.apply(this,arguments);this._updateSyntax(null)},copy:function(){return this.getSelectedCharacters()},cut:function(){var cutData=this.getSelectedCharacters();if(cutData!=""){this.performBackspaceOrDelete(false)}return cutData},drawRect:function(rect,context){context.fillStyle=this.get("theme").backgroundStyle;context.fillRect(rect.x,rect.y,rect.width,rect.height);this._drawSelection(rect,context);this._drawLines(rect,context)},focus:function(){this.focusTextInput()},getSelectedCharacters:function(){return this._rangeIsInsertionPoint(this._selectedRange)?"":this.getPath("layoutManager.textStorage").getCharacters(Range.normalizeRange(this._selectedRange))},getSelectedRange:function(raw){if(!raw){return Range.normalizeRange(this._selectedRange)}else{return this._selectedRange}},groupChanges:function(performChanges){if(this._inChangeGroup){performChanges();return}this._inChangeGroup=true;this.notifyDelegates("textViewBeganChangeGroup",this._selectedRange);try{performChanges()}finally{this._inChangeGroup=false;this.notifyDelegates("textViewEndedChangeGroup",this._selectedRange)}},init:function(){arguments.callee.base.apply(this,arguments);this._invalidRange=null;this._selectedRange={start:{row:0,column:0},end:{row:0,column:0}};this.set("padding",SC.clone(this.get("padding")));this.get("layoutManager").addDelegate(this);this._resize()},insertText:function(text){this.groupChanges(function(){var textStorage=this.getPath("layoutManager.textStorage");var range=Range.normalizeRange(this._selectedRange);this.replaceCharacters(range,text);var lines=text.split("\n");var destPosition;if(lines.length>1){destPosition={row:range.start.row+lines.length-1,column:lines[lines.length-1].length}}else{destPosition=Range.addPositions(range.start,{row:0,column:text.length})}this.moveCursorTo(destPosition)}.bind(this))},isDelimiter:function(character){return"\"',;.!~@#$%^&*?[]<>:/\\-+ \t".indexOf(character)!==-1},keyDown:function(evt){if(evt.charCode===0){return keyboardManager.processKeyEvent(evt,this,{isTextView:true})}else{if(evt.keyCode===9){evt.preventDefault()}else{return false}}},layoutManagerChangedTextAtRow:function(sender,row){this._updateSyntax(row);this._repositionSelection()},layoutManagerInvalidatedRects:function(sender,rects){rects.forEach(this.setNeedsDisplayInRect,this);this._resize()},mouseDown:function(evt){arguments.callee.base.apply(this,arguments);var point={x:evt.pageX,y:evt.pageY};switch(evt.clickCount){case 1:var pos=this._selectionPositionForPoint(this.convertFrameFromView(point));this.moveCursorTo(pos,evt.shiftKey);break;case 2:var pos=this._selectionPositionForPoint(this.convertFrameFromView(point));var line=this.getPath("layoutManager.textStorage").lines[pos.row];if(line.length===0){return true}pos.column-=(pos.column==line.length?1:0);var skipOnDelimiter=!this.isDelimiter(line[pos.column]);var thisTextView=this;var searchForDelimiter=function(pos,dir){for(pos;pos>-1&&pos<line.length;pos+=dir){if(thisTextView.isDelimiter(line[pos])===skipOnDelimiter){break}}return pos+(dir==1?0:1)};var columnFrom=searchForDelimiter(pos.column,-1);var columnTo=searchForDelimiter(pos.column,1);this.moveCursorTo({row:pos.row,column:columnFrom});this.moveCursorTo({row:pos.row,column:columnTo},true);break;case 3:var lines=this.getPath("layoutManager.textStorage").lines;var pos=this._selectionPositionForPoint(this.convertFrameFromView(point));this.setSelection({start:{row:pos.row,column:0},end:{row:pos.row,column:lines[pos.row].length}});break}this._dragPoint=point;this._dragTimer=SC.Timer.schedule({target:this,action:"_scrollWhileDragging",interval:100,repeats:true});return true},mouseDragged:function(evt){this._dragPoint={x:evt.pageX,y:evt.pageY};this._drag();return true},mouseUp:function(evt){if(this._dragTimer!==null){this._dragTimer.invalidate()}},moveCursorTo:function(position,select,virtual){var textStorage=this.getPath("layoutManager.textStorage");var positionToUse=textStorage.clampPosition(position);this.setSelection({start:select?this._selectedRange.start:positionToUse,end:positionToUse});if(virtual){var lineCount=textStorage.get("lines").length;var row=position.row,column=position.column;if(row>0&&row<lineCount){this._selectedRangeEndVirtual=position}else{this._selectedRangeEndVirtual={row:row<1?0:lineCount-1,column:column}}}else{this._selectedRangeEndVirtual=null}this.scrollToPosition(this._selectedRange.end)},moveDown:function(){var selection=this._getVirtualSelection();var range=Range.normalizeRange(selection);var position;if(this._rangeIsInsertionPoint(this._selectedRange)){position=range.end}else{position={row:range.end.row,column:range.start.column}}position=Range.addPositions(position,{row:1,column:0});this.moveCursorTo(position,false,true)},moveLeft:function(){var range=Range.normalizeRange(this._selectedRange);if(this._rangeIsInsertionPoint(range)){this.moveCursorTo(this.getPath("layoutManager.textStorage").displacePosition(range.start,-1))}else{this.moveCursorTo(range.start)}},moveRight:function(){var range=Range.normalizeRange(this._selectedRange);if(this._rangeIsInsertionPoint(range)){this.moveCursorTo(this.getPath("layoutManager.textStorage").displacePosition(range.end,1))}else{this.moveCursorTo(range.end)}},moveUp:function(){var range=Range.normalizeRange(this._getVirtualSelection(true));position=Range.addPositions({row:range.start.row,column:this._getVirtualSelection().end.column},{row:-1,column:0});this.moveCursorTo(position,false,true)},parentViewFrameChanged:function(){arguments.callee.base.apply(this,arguments);this._resize()},replaceCharacters:function(oldRange,characters){this.groupChanges(function(){oldRange=Range.normalizeRange(oldRange);this.notifyDelegates("textViewWillReplaceRange",oldRange);var textStorage=this.getPath("layoutManager.textStorage");textStorage.replaceCharacters(oldRange,characters);this.notifyDelegates("textViewReplacedCharacters",oldRange,characters)}.bind(this))},performBackspaceOrDelete:function(isBackspace){var model=this.getPath("layoutManager.textStorage");var lines=model.get("lines");var range=this.getSelectedRange();if(Range.isZeroLength(range)){if(isBackspace){var start=range.start;var tabstop=settings.get("tabstop");var row=start.row,column=start.column;var line=lines[row];if(column>0&&column%tabstop===0&&new RegExp("^\\s{"+column+"}").test(line)){range={start:{row:row,column:column-tabstop},end:range.end}}else{range={start:model.displacePosition(range.start,-1),end:range.end}}}else{range={start:range.start,end:model.displacePosition(range.end,1)}}}this.groupChanges(function(){this.replaceCharacters(range,"");this.moveCursorTo(range.start)}.bind(this))},resetKeyBuffers:function(){this._keyBuffer="";this._keyMetaBuffer=""},scrollPageDown:function(){this._scrollPage(false)},scrollPageUp:function(){this._scrollPage(true)},scrollToPosition:function(position){var scrollable=this._scrollView();if(SC.none(scrollable)){return}var rect=this.get("layoutManager").characterRectForPosition(position);var rectX=rect.x,rectY=rect.y;var rectWidth=rect.width,rectHeight=rect.height;var frame=this.get("clippingFrame");var frameX=frame.x,frameY=frame.y;var padding=this.get("padding");var width=frame.width-padding.right;var height=frame.height-padding.bottom;scrollable.scrollTo(rectX>=frameX&&rectX+rectWidth<frameX+width?frameX:rectX-width/2+rectWidth/2,rectY>=frameY&&rectY+rectHeight<frameY+height?frameY:rectY-height/2+rectHeight/2)},selectAll:function(){var lines=this.getPath("layoutManager.textStorage.lines");var lastRow=lines.length-1;this.setSelection({start:{row:0,column:0},end:{row:lastRow,column:lines[lastRow].length}})},selectDown:function(){this._performVerticalKeyboardSelection(1)},selectLeft:function(){this.moveCursorTo((this.getPath("layoutManager.textStorage").displacePosition(this._selectedRange.end,-1)),true)},selectRight:function(){this.moveCursorTo((this.getPath("layoutManager.textStorage").displacePosition(this._selectedRange.end,1)),true)},selectUp:function(){this._performVerticalKeyboardSelection(-1)},setSelection:function(newRange,ensureVisible){var textStorage=this.getPath("layoutManager.textStorage");newRange=textStorage.clampRange(newRange);if(Range.equal(newRange,this._selectedRange)){return}this._invalidateSelection();this._selectedRange=textStorage.clampRange(newRange);this._invalidateSelection();this._rearmInsertionPointBlinkTimer();if(ensureVisible){this.scrollToPosition(this._selectedRange.end)}},textInserted:function(text){if(!keyboardManager.processKeyInput(text,this,{isTextView:true,isCommandKey:false})){this.insertText(text);this.resetKeyBuffers()}},willBecomeKeyResponderFrom:function(){arguments.callee.base.apply(this,arguments);this._invalidateSelection();this._rearmInsertionPointBlinkTimer()},willLoseKeyResponderTo:function(){arguments.callee.base.apply(this,arguments);this._invalidateSelection();this._insertionPointBlinkTimer.invalidate();this._insertionPointVisible=true}})});tiki.module("text_editor:index",function(require,exports,module){});tiki.register("dock_view",{});tiki.module("dock_view:index",function(require,exports,module){({description:"A view that supports docked panels on the sides"});"end";var SC=require("sproutcore/runtime").SC;exports.DOCK_LEFT="left";exports.DOCK_BOTTOM="bottom";exports.DOCK_TOP="top";exports.DOCK_RIGHT="right";exports.DockView=SC.View.extend({classNames:["bespin-dock-view"],centerView:SC.View,dockedViews:[],addDockedView:function(viewClass,position){var dockedViews=this.get("dockedViews");var index=dockedViews.length;if(SC.none(position)){position=exports.DOCK_BOTTOM}var thisDockView=this;var dockedView=this.createChildView(viewClass,{dock:position,layoutView:this,rootElementPath:[index],_bespin_dockView_frameDidChange:function(){thisDockView._updateChildLayout()}.observes("frame")});dockedViews[index]=dockedView;return dockedView},removeDockedView:function(view){var dockedViews=this.get("dockedViews");dockedViews.removeObject(view);this.removeChild(view);this._updateChildLayout()},createChildViews:function(){var centerView=this.createChildView(this.get("centerView"),{layoutView:this});this.set("centerView",centerView);var childViews=[centerView];var dockedViews=this.get("dockedViews");for(var i=0;i<dockedViews.length;i++){childViews.push(this.addDockedView(dockedViews[i],i))}this.set("childViews",childViews);return this},_updateChildLayout:function(){var left=0,bottom=0,top=0,right=0;this.get("dockedViews").forEach(function(item){var frame=item.get("frame");var dock=item.get("dock");switch(dock){case exports.DOCK_LEFT:left+=frame.width;item.adjust("top",top);item.adjust("bottom",bottom);break;case exports.DOCK_BOTTOM:bottom+=frame.height;item.adjust("left",left);item.adjust("right",right);break;case exports.DOCK_TOP:top+=frame.height;item.adjust("left",left);item.adjust("right",right);break;case exports.DOCK_RIGHT:right+=frame.width;item.adjust("top",top);item.adjust("bottom",bottom);break;default:throw new Error("invalid 'dock' property: "+dock);break}});var layout={left:left,bottom:bottom,top:top,right:right};this.get("centerView").adjust(layout)},renderLayout:function(context,firstTime){this._updateChildLayout();arguments.callee.base.apply(this,arguments)}})});tiki.register("filesystem",{});tiki.module("filesystem:index",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var console=require("bespin:console").console;var util=require("bespin:util/util");var m_promise=require("bespin:promise");var pathUtil=require("filesystem:path");var Promise=m_promise.Promise;exports._prefixSearch=function(arr,find){var low=0;var high=arr.length-1;var findlength=find.length;var i;var lowmark=null;var sub;while(low<=high){i=parseInt((low+high)/2,10);sub=arr[i].substring(0,findlength);if(i==lowmark){return i}if(sub==find){lowmark=i;high=i-1}else{if(sub<find){low=i+1}else{high=i-1}}}return lowmark};exports._binarySearch=function(arr,find){var low=0;var high=arr.length-1;var i;var current;while(low<=high){i=parseInt((low+high)/2,10);current=arr[i];if(current<find){low=i+1}else{if(current>find){high=i-1}else{return i}}}return null};exports.NEW={name:"NEW"};exports.LOADING={name:"LOADING"};exports.READY={name:"READY"};exports.Filesystem=SC.Object.extend({source:null,_files:null,status:exports.NEW,_loadingPromises:null,init:function(){var source=this.get("source");if(typeof(source)=="string"){this.set("source",SC.objectForPropertyPath(source))}if(!this.get("source")){throw new Error("Directory must have a source.")}this._loadingPromises=[]},_load:function(){var pr=new Promise();if(this.status===exports.READY){pr.resolve()}else{if(this.status===exports.LOADING){this._loadingPromises.push(pr)}else{this.set("status",exports.LOADING);this._loadingPromises.push(pr);this.get("source").loadAll().then(this._fileListReceived.bind(this))}}return pr},_fileListReceived:function(filelist){filelist.sort();this._files=filelist;this.set("status",exports.READY);var lp=this._loadingPromises;while(lp.length>0){var pr=lp.pop();pr.resolve()}},invalidate:function(){this._files=[];this.set("status",exports.NEW)},listAll:function(){return this._load().then(function(){return this._files}.bind(this))},loadContents:function(path){path=pathUtil.trimLeadingSlash(path);var source=this.get("source");return source.loadContents(path)},saveContents:function(path,contents){var pr=new Promise();path=pathUtil.trimLeadingSlash(path);var source=this.get("source");var self=this;source.saveContents(path,contents).then(function(){self.exists(path).then(function(exists){if(!exists){self._files.push(path);self._files.sort()}pr.resolve()})});return pr},getFile:function(path){return new exports.File(this,path)},exists:function(path){path=pathUtil.trimLeadingSlash(path);var pr=new Promise();this._load().then(function(){var result=exports._binarySearch(this._files,path);pr.resolve(result!==null)}.bind(this));return pr},remove:function(path){path=pathUtil.trimLeadingSlash(path);var pr=new Promise();var self=this;var source=this.get("source");source.remove(path).then(function(){self._load().then(function(){var position=exports._binarySearch(self._files,path);if(position===null){pr.reject(new Error("Cannot find path "+path+" to remove"));return}self._files.splice(position,1);pr.resolve()},function(error){pr.reject(error)})},function(error){pr.reject(error)});return pr},listDirectory:function(path){path=pathUtil.trimLeadingSlash(path);var pr=new Promise();this._load().then(function(){var files=this._files;var index=exports._prefixSearch(files,path);if(index===null){pr.reject(new Error("Path "+path+" not found."));return}var result=[];var numfiles=files.length;var pathlength=path.length;var lastSegment=null;for(var i=index;i<numfiles;i++){var file=files[i];if(file.substring(0,pathlength)!=path){break}var segmentEnd=file.indexOf("/",pathlength)+1;if(segmentEnd==0){segmentEnd=file.length}var segment=file.substring(pathlength,segmentEnd);if(segment==""){continue}if(segment!=lastSegment){lastSegment=segment;result.push(segment)}}pr.resolve(result)}.bind(this));return pr},makeDirectory:function(path){path=pathUtil.trimLeadingSlash(path);if(!pathUtil.isDir(path)){path+="/"}var self=this;var pr=new Promise();this._load().then(function(){var source=self.get("source");source.makeDirectory(path).then(function(){self._files.push(path);self._files.sort();pr.resolve()})});return pr}});exports.File=function(fs,path){this.fs=fs;this.path=path};exports.File.prototype={parentdir:function(){return pathUtil.parentdir(this.path)},loadContents:function(){return this.fs.loadContents(this.path)},saveContents:function(contents){return this.fs.saveContents(this.path,contents)},exists:function(){return this.fs.exists(this.path)},remove:function(){return this.fs.remove(this.path)},extension:function(){return pathUtil.fileType(this.path)}}});tiki.module("filesystem:path",function(require,exports,module){var util=require("bespin:util/util");exports.combine=function(){var args=Array.prototype.slice.call(arguments);var path=args.join("/");path=path.replace(/\/\/+/g,"/");path=path.replace(/^\s+|\s+$/g,"");return path};exports.directory=function(path){var match=/^(.*?\/)[^\/]*$/.exec(path);return match===null?"":match[1]};exports.makeDirectory=function(path){if(!(/\/$/).test(path)){path+="/"}return path};exports.combineAsDirectory=function(){return this.makeDirectory(this.combine.apply(this,arguments))};exports.escape=function(){return escape(this.combine.apply(this,arguments))};exports.trimLeadingSlash=function(path){if(path.indexOf("/")==0){path=path.substring(1,path.length)}return path};exports.hasLeadingSlash=function(path){return path.indexOf("/")==0};exports.fileType=function(path){if(path.indexOf(".")>=0){var split=path.split(".");if(split.length>1){return split[split.length-1]}}return null};exports.isDir=function(path){return util.endsWith(path,"/")};exports.basename=function(path){var lastSlash=path.lastIndexOf("/");if(lastSlash==-1){return path}var afterSlash=path.substring(lastSlash+1);return afterSlash};exports.splitext=function(path){var lastDot=path.lastIndexOf(".");if(lastDot==-1){return[path,""]}var before=path.substring(0,lastDot);var after=path.substring(lastDot+1);return[before,after]};exports.parentdir=function(path){if(path==""||path=="/"){return""}if(exports.isDir(path)){path=path.substring(0,path.length-1)}slash=path.lastIndexOf("/");path=path.substring(0,slash+1);return path}});tiki.module("filesystem:types",function(require,exports,module){exports.existingFile={isValid:function(value,typeExt){return true},toString:function(value,typeExt){return value},fromString:function(value,typeExt){return value}}});tiki.register("edit_session",{});tiki.module("edit_session:history",function(require,exports,module){var SC=require("sproutcore/runtime").SC;exports.History=SC.Object.extend({storage:window.localStorage,addPath:function(path){var storage=this.get("storage");var historyStr=storage.history;var history=SC.none(historyStr)?[]:JSON.parse(historyStr);history.push(path);storage.history=JSON.stringify(history)},getRecent:function(max){var historyStr=this.get("storage").history;var history=SC.none(historyStr)?[]:JSON.parse(historyStr);var historyLength=history.length;var seen={},result=[],count=0;for(var i=historyLength-1;i>=0;i--){var path=history[i];if(!(path in seen)){seen[path]=true;result.push(path);count++;if(count===max){break}}}return result}})});tiki.module("edit_session:index",function(require,exports,module){var SC=require("sproutcore/runtime").SC;var File=require("filesystem:index").File;var History=require("edit_session:history").History;var MultiDelegateSupport=require("delegate_support").MultiDelegateSupport;var TextStorage=require("text_editor:models/textstorage").TextStorage;var catalog=require("bespin:plugins").catalog;var m_path=require("filesystem:path");exports.Buffer=SC.Object.extend(MultiDelegateSupport,{_file:null,_fileChanged:function(){this._refreshSyntaxManager();this.notifyDelegates("bufferFileChanged",this._file)}.observes("file"),_refreshSyntaxManager:function(){var syntaxManager=this.get("syntaxManager");if(SC.none(syntaxManager)){return}var file=this._file;if(SC.none(file)){return}var ext=file.extension();if(ext===null){ext=""}syntaxManager.setInitialContextFromExt(ext)},model:null,syntaxManager:null,file:function(key,newFile){var self=this;if(newFile!==undefined){this._file=newFile;if(SC.none(newFile)){var model=self.get("model");model.replaceCharacters(model.range(),"")}else{newFile.loadContents().then(function(contents){console.log("SET FILE CONTENTS: ",contents);SC.run(function(){var model=self.get("model");model.replaceCharacters(model.range(),contents)})})}}return this._file}.property(),init:function(){var model=this.get("model");if(model==null){this.set("model",TextStorage.create())}this._refreshSyntaxManager()},changeFile:function(newFile){var self=this;this.changeFileOnly(newFile);if(SC.none(newFile)){var model=self.get("model");model.replaceCharacters(model.range(),"");var pr=new Promise();pr.resolve(this);return pr}return newFile.loadContents().then(function(contents){SC.run(function(){var model=self.get("model");model.replaceCharacters(model.range(),contents)});return self})},changeFileOnly:function(newFile){this._file=newFile;this.propertyDidChange("file")},reload:function(){var file=this.get("file");var self=this;return file.loadContents().then(function(contents){var model=self.get("model");model.replaceCharacters(model.range(),contents)})},save:function(){return this._file.saveContents(this.getPath("model.value"))},saveAs:function(newFile){var promise=new Promise();newFile.saveContents(this.getPath("model.value")).then(function(){this.changeFileOnly(newFile);promise.resolve()}.bind(this),function(error){promise.reject(error)});return promise},untitled:function(){return SC.none(this._file)}});exports.EditSession=SC.Object.extend({_currentBufferChanged:function(){this.get("currentBuffer").addDelegate(this)}.observes("currentBuffer"),currentView:null,currentBuffer:null,currentUser:null,history:null,bufferFileChanged:function(sender,file){if(!SC.none(file)){this.get("history").addPath(file.path)}catalog.getExtensions("bufferFileChanged").forEach(function(ext){ext.load(function(f){f(file)})})},getCompletePath:function(path){if(path==null){path=""}if(path==null||path.substring(0,1)!="/"){var buffer=this.get("currentBuffer");var file;if(buffer){file=buffer.get("file")}if(!file){path="/"+path}else{path=file.parentdir()+path}}return path},loadMostRecentOrNew:function(){var recent=this.get("history").getRecent(1);if(recent.length===0){return}var files=catalog.getObject("files");var file=files.getFile(recent[0]);this.get("currentBuffer").changeFile(file)},init:function(){this.set("history",History.create())}})});tiki.register("embedded",{});tiki.module("embedded:index",function(require,exports,module){({dependencies:{appsupport:"0.0",dock_view:"0.0",edit_session:"0.0",text_editor:"0.0",settings:"0.0"},provides:[{ep:"factory",name:"session",pointer:"#session",action:"value"}]});"end";var SC=require("sproutcore/runtime").SC;var DockView=require("dock_view").DockView;var EditorView=require("text_editor:views/editor").EditorView;var KeyListener=require("appsupport:views/keylistener").KeyListener;var bespin=require("bespin:index");var edit_session=require("edit_session");var settings=require("settings").settings;var util=require("bespin:util/util");var embeddedEditorInstantiated=false;exports.EmbeddedEditor=SC.Object.extend({_editorView:null,_focused:false,_attachPane:function(){if(typeof(this.get("element"))==="string"){this.set("element",document.getElementById("element"))}var element=this.get("element");if(SC.none("element")){throw new Error("No element was specified to attach Bespin Embedded to")}var options=this.get("options");if(SC.none(options.initialContent)){options.initialContent=element.innerHTML}SC.$(element).css("position","relative");element.innerHTML="";this.get("pane").appendTo(element)},_computeLayout:function(){var element=this.get("element");var layout={top:0,left:0,width:element.clientWidth,height:element.clientHeight};while(!SC.none(element)){layout.top+=element.offsetTop+element.clientTop;layout.left+=element.offsetLeft+element.clientLeft;element=element.offsetParent}return layout},_createValueProperty:function(){this.__defineGetter__("value",function(){return this._editorView.getPath("layoutManager.textStorage.value")});this.__defineSetter__("value",function(v){SC.run(function(){this._editorView.setPath("layoutManager.textStorage.value",v)}.bind(this))})},_hookWindowResizeEvent:function(){window.addEventListener("resize",this.dimensionsChanged.bind(this),false)},_setOptions:function(){var editorView=this._editorView;var layoutManager=editorView.get("layoutManager");var options=this.get("options");var initialContent=options.initialContent;if(!SC.none(initialContent)){layoutManager.setPath("textStorage.value",initialContent)}var noAutoresize=options.noAutoresize;if(SC.none(noAutoresize)){noAutoresize=options.dontHookWindowResizeEvent}if(SC.none(noAutoresize)||!noAutoresize){this._hookWindowResizeEvent()}var userSettings=options.settings;if(!SC.none(userSettings)){for(key in userSettings){settings.set(key,userSettings[key])}}var stealFocus=options.stealFocus;if(!SC.none(stealFocus)&&stealFocus){window.setTimeout(function(){this.setFocus(true)}.bind(this),1)}var syntaxManager=layoutManager.get("syntaxManager");var syntax=options.syntax;if(!SC.none(syntax)){syntaxManager.set("initialContext",syntax)}},element:null,options:null,pane:SC.Pane.extend({_layoutChanged:function(){this._recomputeLayoutStyle()}.observes("layout"),_recomputeLayoutStyle:function(){var layout=this.get("layout");this.set("layoutStyle",{width:"%@px".fmt(layout.width),height:"%@px".fmt(layout.height)})},applicationView:DockView.extend({centerView:EditorView.extend(),dockedViews:[]}),childViews:"applicationView".w(),layoutStyle:{},init:function(){arguments.callee.base.apply(this,arguments);this.set("defaultResponder",KeyListener.create());this._recomputeLayoutStyle()}}),dimensionsChanged:function(){SC.run(function(){var pane=this.get("pane");var oldLayout=pane.get("layout");var newLayout=this._computeLayout(this.get("element"));if(!SC.rectsEqual(oldLayout,newLayout)){pane.adjust(newLayout);pane.updateLayout()}}.bind(this))},init:function(){if(embeddedEditorInstantiated===true){throw new Error("Attempt to instantiate multiple instances of Bespin")}embeddedEditorInstantiated=true;var session=edit_session.EditSession.create();exports.session=session;var pane=this.get("pane").create({layout:this._computeLayout()});this.set("pane",pane);this._attachPane();var editorView=pane.getPath("applicationView.centerView");this._editorView=editorView;var textStorage=editorView.getPath("layoutManager.textStorage");var textView=editorView.get("textView");exports.model=textStorage;exports.view=textView;var buffer=edit_session.Buffer.create({model:textStorage});session.set("currentBuffer",buffer);session.set("currentView",textView);SC.run(function(){this._createValueProperty();this._setOptions()}.bind(this))},setFocus:function(makeFocused){var pane=this.get("pane");if(this._focused===makeFocused){return}this._focused=makeFocused;if(makeFocused){pane.becomeKeyPane();this._editorView.get("textView").focus()}else{pane.resignKeyPane()}},setLineNumber:function(line){SC.RunLoop.begin();var textView=this.getPath("pane.editorView.textView");var point={row:line-1,column:0,partialFraction:0};textView.setSelection([{start:point,end:point}]);SC.RunLoop.end()},setSetting:function(key,value){if(SC.none(key)){throw new Error("setSetting: key must be supplied")}if(SC.none(value)){throw new Error("setSetting: value must be supplied")}SC.run(function(){settings.set(key,value)})},setSyntax:function(syntax){if(SC.none(syntax)){throw new Error("setSyntax: syntax must be supplied")}SC.run(function(){this._editorView.setPath("layoutManager.syntaxManager.initialContext",syntax)}.bind(this))}});exports.session=null;exports.useBespin=function(element,options){return exports.EmbeddedEditor.create({element:element,options:SC.none(options)?{}:options})}});tiki.register("html",{});tiki.module("html:index",function(require,exports,module){({description:"HTML syntax highlighter",dependencies:{syntax_manager:"0.0"},provides:[{ep:"fileextension",name:"htm",syntax:"html"},{ep:"fileextension",name:"html",syntax:"html"},{ep:"syntax",name:"html",pointer:"#HTMLSyntax"}]});"end";require("sproutcore/runtime").SC;var StandardSyntax=require("syntax_manager:controllers/standardsyntax").StandardSyntax;var states={};var createTagStates=function(prefix,interiorActions){states[prefix+"_beforeAttrName"]=[{regex:/^\s+/,tag:"plain"},{regex:/^\//,tag:"operator",then:prefix+"_selfClosingStartTag"},{regex:/^>/,tag:"operator",then:interiorActions},{regex:/^./,tag:"keyword",then:prefix+"_attrName"}];states[prefix+"_attrName"]=[{regex:/^\s+/,tag:"plain",then:prefix+"_afterAttrName"},{regex:/^\//,tag:"operator",then:prefix+"_selfClosingStartTag"},{regex:/^=/,tag:"operator",then:prefix+"_beforeAttrValue"},{regex:/^>/,tag:"operator",then:interiorActions},{regex:/^["'<]+/,tag:"error"},{regex:/^[^ \t\n\/=>"'<]+/,tag:"keyword"}];states[prefix+"_afterAttrName"]=[{regex:/^\s+/,tag:"plain"},{regex:/^\//,tag:"operator",then:prefix+"_selfClosingStartTag"},{regex:/^=/,tag:"operator",then:prefix+"_beforeAttrValue"},{regex:/^>/,tag:"operator",then:interiorActions},{regex:/^./,tag:"keyword",then:prefix+"_attrName"}];states[prefix+"_beforeAttrValue"]=[{regex:/^\s+/,tag:"plain"},{regex:/^"/,tag:"string",then:prefix+"_attrValueQQ"},{regex:/^(?=&)/,tag:"plain",then:prefix+"_attrValueU"},{regex:/^'/,tag:"string",then:prefix+"_attrValueQ"},{regex:/^>/,tag:"error",then:interiorActions},{regex:/^./,tag:"string",then:prefix+"_attrValueU"}];states[prefix+"_attrValueQQ"]=[{regex:/^"/,tag:"string",then:prefix+"_afterAttrValueQ"},{regex:/^[^"]+/,tag:"string"}];states[prefix+"_attrValueQ"]=[{regex:/^'/,tag:"string",then:prefix+"_afterAttrValueQ"},{regex:/^[^']+/,tag:"string"}];states[prefix+"_attrValueU"]=[{regex:/^\s/,tag:"string",then:prefix+"_beforeAttrName"},{regex:/^>/,tag:"operator",then:interiorActions},{regex:/[^ \t\n>]+/,tag:"string"}];states[prefix+"_afterAttrValueQ"]=[{regex:/^\s/,tag:"plain",then:prefix+"_beforeAttrName"},{regex:/^\//,tag:"operator",then:prefix+"_selfClosingStartTag"},{regex:/^>/,tag:"operator",then:interiorActions},{regex:/^(?=.)/,tag:"operator",then:prefix+"_beforeAttrName"}];states[prefix+"_selfClosingStartTag"]=[{regex:/^>/,tag:"operator",then:"start"},{regex:/^./,tag:"error",then:prefix+"_beforeAttrName"}]};states={start:[{regex:/^[^<]+/,tag:"plain"},{regex:/^<!--/,tag:"comment",then:"commentStart"},{regex:/^<!/,tag:"directive",then:"markupDeclarationOpen"},{regex:/^<\?/,tag:"comment",then:"bogusComment"},{regex:/^</,tag:"operator",then:"tagOpen"}],tagOpen:[{regex:/^\//,tag:"operator",then:"endTagOpen"},{regex:/^script/i,tag:"keyword",then:"script_beforeAttrName"},{regex:/^[a-zA-Z]/,tag:"keyword",then:"tagName"},{regex:/^(?=.)/,tag:"plain",then:"start"}],scriptData:[{regex:/^<(?=\/script>)/i,tag:"operator",then:"tagOpen stop:js"},{regex:/^[^<]+/,tag:"plain"}],endTagOpen:[{regex:/^[a-zA-Z]/,tag:"keyword",then:"tagName"},{regex:/^>/,tag:"error",then:"start"},{regex:/^./,tag:"error",then:"bogusComment"}],tagName:[{regex:/^\s+/,tag:"plain",then:"normal_beforeAttrName"},{regex:/^\//,tag:"operator",then:"normal_selfClosingStartTag"},{regex:/^>/,tag:"operator",then:"start"},{regex:/^[^ \t\n\/>]+/,tag:"keyword"}],bogusComment:[{regex:/^[^>]+/,tag:"comment"},{regex:/^>/,tag:"comment",then:"start"}],markupDeclarationOpen:[{regex:/^doctype/i,tag:"directive",then:"doctype"},{regex:/^(?=.)/,tag:"comment",then:"bogusComment"}],commentStart:[{regex:/^-->/,tag:"comment",then:"start"},{regex:/^[^-]+/,tag:"comment"}],doctype:[{regex:/^\s/,tag:"plain",then:"beforeDoctypeName"},{regex:/^./,tag:"error",then:"beforeDoctypeName"}],beforeDoctypeName:[{regex:/^\s+/,tag:"plain"},{regex:/^>/,tag:"error",then:"start"},{regex:/^./,tag:"directive",then:"doctypeName"}],doctypeName:[{regex:/^\s/,tag:"plain",then:"afterDoctypeName"},{regex:/^>/,tag:"directive",then:"start"},{regex:/^[^ \t\n>]+/,tag:"directive"}],afterDoctypeName:[{regex:/^\s+/,tag:"directive"},{regex:/^>/,tag:"directive",then:"start"},{regex:/^public/i,tag:"directive",then:"afterDoctypePublicKeyword"},{regex:/^system/i,tag:"directive",then:"afterDoctypeSystemKeyword"},{regex:/^./,tag:"error",then:"bogusDoctype"}],afterDoctypePublicKeyword:[{regex:/^\s+/,tag:"plain",then:"beforeDoctypePublicId"},{regex:/^"/,tag:"error",then:"doctypePublicIdQQ"},{regex:/^'/,tag:"error",then:"doctypePublicIdQ"},{regex:/^>/,tag:"error",then:"start"},{regex:/^./,tag:"error",then:"bogusDoctype"}],beforeDoctypePublicId:[{regex:/^\s+/,tag:"plain"},{regex:/^"/,tag:"string",then:"doctypePublicIdQQ"},{regex:/^'/,tag:"string",then:"doctypePublicIdQ"},{regex:/^>/,tag:"error",then:"start"},{regex:/^./,tag:"error",then:"bogusDoctype"}],doctypePublicIdQQ:[{regex:/^"/,tag:"string",then:"afterDoctypePublicId"},{regex:/^>/,tag:"error",then:"start"},{regex:/^[^>"]+/,tag:"string"}],doctypePublicIdQ:[{regex:/^'/,tag:"string",then:"afterDoctypePublicId"},{regex:/^>/,tag:"error",then:"start"},{regex:/^[^>']+/,tag:"string"}],afterDoctypePublicId:[{regex:/^\s/,tag:"plain",then:"betweenDoctypePublicAndSystemIds"},{regex:/^>/,tag:"directive",then:"start"},{regex:/^"/,tag:"error",then:"doctypeSystemIdQQ"},{regex:/^'/,tag:"error",then:"doctypeSystemIdQ"},{regex:/^./,tag:"error",then:"bogusDoctype"}],betweenDoctypePublicAndSystemIds:[{regex:/^\s+/,tag:"plain",then:"betweenDoctypePublicAndSystemIds"},{regex:/^>/,tag:"directive",then:"start"},{regex:/^"/,tag:"string",then:"doctypeSystemIdQQ"},{regex:/^'/,tag:"string",then:"doctypeSystemIdQ"},{regex:/^./,tag:"error",then:"bogusDoctype"}],afterDoctypeSystemKeyword:[{regex:/^\s/,tag:"plain",then:"beforeDoctypeSystemId"},{regex:/^"/,tag:"error",then:"doctypeSystemIdQQ"},{regex:/^'/,tag:"error",then:"doctypeSystemIdQ"},{regex:/^>/,tag:"error",then:"start"},{regex:/^./,tag:"error",then:"bogusDoctype"}],beforeDoctypeSystemId:[{regex:/^\s+/,tag:"plain",then:"beforeDoctypeSystemId"},{regex:/^"/,tag:"string",then:"doctypeSystemIdQQ"},{regex:/^'/,tag:"string",then:"doctypeSystemIdQ"},{regex:/^>/,tag:"error",then:"start"},{regex:/./,tag:"error",then:"bogusDoctype"}],doctypeSystemIdQQ:[{regex:/^"/,tag:"string",then:"afterDoctypeSystemId"},{regex:/^>/,tag:"error",then:"start"},{regex:/^[^">]+/,tag:"string"}],doctypeSystemIdQ:[{regex:/^'/,tag:"string",then:"afterDoctypeSystemId"},{regex:/^>/,tag:"error",then:"start"},{regex:/^[^'>]+/,tag:"string"}],afterDoctypeSystemId:[{regex:/^\s+/,tag:"plain"},{regex:/^>/,tag:"directive",then:"start"},{regex:/^./,tag:"error",then:"bogusDoctype"}],bogusDoctype:[{regex:/^>/,tag:"directive",then:"start"},{regex:/^[^>]+/,tag:"directive"}]};createTagStates("normal","start");createTagStates("script","scriptData start:js");exports.HTMLSyntax=StandardSyntax.create({states:states})});tiki.register("javascript",{});tiki.module("javascript:index",function(require,exports,module){({description:"JavaScript syntax highlighter",dependencies:{syntax_manager:"0.0"},provides:[{ep:"fileextension",name:"js",syntax:"js"},{ep:"syntax",name:"js",pointer:"#JSSyntax"}]});"end";var SC=require("sproutcore/runtime").SC;var Promise=require("bespin:promise").Promise;var StandardSyntax=require("syntax_manager:controllers/standardsyntax").StandardSyntax;exports.JSSyntax=StandardSyntax.create({states:{start:[{regex:/^(?:PVector|PMatrix2D|PFont|PMatrix3D|split|void|draw|setup|splitTokens|append|concat|sort|splice|subset|join|shorten|expand|arrayCopy|ArrayList|reverse|HashMap|mix|peg|modes|color|red|green|blue|alpha|lerpColor|defaultColor|colorMode|blendColor|printMatrix|translate|scale|pushMatrix|popMatrix|resetMatrix|applyMatrix|rotateX|rotateZ|rotateY|rotate|pushStyle|popStyle|year|month|day|hour|minute|second|millis|noLoop|redraw|loop|frameRate|exit|cursor|noCursor|link|beginDraw|endDraw|Import|disableContextMenu|enableContextMenu|binary|unbinary|nfs|nfp|nfc|hex|unhex|loadStrings|loadBytes|nf|matchAll|match|console|println|print|str|trim|abs|ceil|constrain|dist|exp|floor|lerp|log|mag|map|max|min|norm|pow|round|sq|sqrt|acos|asin|atan|atan2|cos|degrees|radians|sin|tan|Random|random|noise|size|ambientLight|directionalLight|lightFalloff|lightSpecular|lights|pointLight|noLights|spotLight|beginCamera|endCamera|camera|perspective|frustum|ortho|printProjection|printCamera|box|sphereDetail|sphere|modelX|modelY|modelZ|ambient|emissive|shininess|specular|fill|noFill|stroke|noStroke|strokeWeight|strokeCap|strokeJoin|smooth|noSmooth|Point|point|beginShape|endShape|vertex|curveVertex|curveVertexSegment|curve|curveTightness|curveDetail|bezierVertex|rectMode|imageMode|ellipseMode|arc|line|bezier|bezierPoint|bezierTangent|curvePoint|curveTangent|triangle|quad|rect|ellipse|normal|save|PImage|createImage|loadImage|requestImage|get|createGraphics|set|loadPixels|updatePixels|background|image|clear|tint|noTint|copy|blend|shared|intersect|loadFont|createFont|textFont|textSize|textAlign|glyphLook|text|loadGlyphs|extendClass|addMethod|init)(?![a-zA-Z0-9_])/,tag:"pjsfunctions"},{regex:/^(?:break|case|catch|continue|default|delete|do|else|false|finally|for|function|if|in|instanceof|let|new|null|return|switch|this|throw|true|try|typeof|var|void|while|with)(?![a-zA-Z0-9_])/,tag:"keyword"},{regex:/^(?:use3DContext|canvas|name|PI|TWO_PI|HALF_PI|SINCOS_LENGTH|MAX_FLOAT|MIN_FLOAT|MAX_INT|MIN_INT|CORNER|RADIUS|CENTER_RADIUS|CENTER|POLYGON|QUADS|TRIANGLES|POINTS|LINES|TRIANGLE_STRIP|TRIANGLE_FAN|QUAD_STRIP|CORNERS|CLOSE|RGB|ARGB|HSB|ALPHA|CMYK|OPENGL|P3D|FRAME_RATE|focused|ARROW|CROSS|HAND|MOVE|TEXT|WAIT|NOCURSOR|ALPHA_MASK|RED_MASK|GREEN_MASK|BLUE_MASK|REPLACE|BLEND|ADD|SUBTRACT|LIGHTEST|DARKEST|DIFFERENCE|EXCLUSION|MULTIPLY|SCREEN|OVERLAY|HARD_LIGHT|SOFT_LIGHT|DODGE|BURN|PRECISIONB|PRECISIONF|PREC_MAXVAL|PREC_ALPHA_SHIFT|PREC_RED_SHIFT|ROUND|SQUARE|PROJECT|MITER|BEVEL|CENTER|NORMAL_MODE_AUTO|NORMAL_MODE_SHAPE|NORMAL_MODE_VERTEX|MAX_LIGHTS|BACKSPACE|TAB|ENTER|RETURN|ESC|DELETE|CODED|SHIFT|CONTROL|ALT|UP|RIGHT|DOWN|LEFT|glyphTable|pmouseX|pmouseY|mouseX|mouseY|mouseButton|mouseDown|mouseScroll|mouseClicked|mouseDragged|mouseMoved|mousePressed|mouseReleased|mouseScrolled|keyPressed|keyReleased|draw|setup|width|height|frameCount)(?![a-zA-Z0-9_\.])/,tag:"pjsconstants"},{regex:/^[A-Za-z_][A-Za-z0-9_]*/,tag:"identifier"},{regex:/^[^'"\/ \tA-Za-z0-9_]+/,tag:"plain"},{regex:/^[ \t]+/,tag:"plain"},{regex:/^'/,tag:"string",then:"qstring"},{regex:/^"/,tag:"string",then:"qqstring"},{regex:/^\/\/.*/,tag:"comment"},{regex:/^\/\*/,tag:"comment",then:"comment"},{regex:/^./,tag:"plain"}],qstring:[{regex:/^'/,tag:"string",then:"start"},{regex:/^(?:\\.|[^'\\])+/,tag:"string"}],qqstring:[{regex:/^"/,tag:"string",then:"start"},{regex:/^(?:\\.|[^"\\])+/,tag:"string"}],comment:[{regex:/^[^*\/]+/,tag:"comment"},{regex:/^\*\//,tag:"comment",then:"start"},{regex:/^[*\/]/,tag:"comment"}]}})});tiki.require("bespin:plugins").catalog.load({text_editor:{resourceURL:"resources/text_editor/",description:"Canvas-based text editor component and many common editing commands",dependencies:{delegate_support:"0.0",settings:"0.0",canon:"0.0",rangeutils:"0.0",appsupport:"0.0",syntax_manager:"0.0"},testmodules:[],provides:[{predicates:{isTextView:true},pointer:"commands/editing#backspace",ep:"command",key:"backspace",name:"backspace"},{predicates:{isTextView:true},pointer:"commands/editing#deleteCommand",ep:"command",key:"delete",name:"delete"},{description:"Delete all lines currently selected",key:"ctrl_d",predicates:{isTextView:true},pointer:"commands/editing#deleteLines",ep:"command",name:"deletelines"},{description:"Create a new, empty line below the current one",key:"ctrl_return",predicates:{isTextView:true},pointer:"commands/editing#openLine",ep:"command",name:"openline"},{params:[{defaultValue:"",type:"text",name:"text",description:"The text to insert"}],pointer:"commands/editing#insertText",ep:"command",name:"insertText"},{predicates:{isTextView:true},pointer:"commands/editing#newline",ep:"command",key:"return",name:"newline"},{predicates:{isTextView:true},pointer:"commands/editing#tab",ep:"command",key:"tab",name:"tab"},{predicates:{isTextView:true},ep:"command",name:"move"},{description:"Search for text within this buffer",params:[{type:"text",name:"value",description:"string to search for"}],key:"ctrl_f",pointer:"commands/editor#findCommand",ep:"command",name:"find"},{description:"Repeat the last search (forward)",pointer:"commands/editor#findNextCommand",ep:"command",key:"ctrl_g",name:"findnext"},{description:"Repeat the last search (backward)",pointer:"commands/editor#findPrevCommand",ep:"command",key:"ctrl_shift_g",name:"findprev"},{predicates:{isTextView:true},pointer:"commands/movement#moveDown",ep:"command",key:"down",name:"move down"},{predicates:{isTextView:true},pointer:"commands/movement#moveLeft",ep:"command",key:"left",name:"move left"},{predicates:{isTextView:true},pointer:"commands/movement#moveRight",ep:"command",key:"right",name:"move right"},{predicates:{isTextView:true},pointer:"commands/movement#moveUp",ep:"command",key:"up",name:"move up"},{predicates:{isTextView:true},ep:"command",name:"select"},{predicates:{isTextView:true},pointer:"commands/movement#selectDown",ep:"command",key:"shift_down",name:"select down"},{predicates:{isTextView:true},pointer:"commands/movement#selectLeft",ep:"command",key:"shift_left",name:"select left"},{predicates:{isTextView:true},pointer:"commands/movement#selectRight",ep:"command",key:"shift_right",name:"select right"},{predicates:{isTextView:true},pointer:"commands/movement#selectUp",ep:"command",key:"shift_up",name:"select up"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineEnd",ep:"command",key:["end","ctrl_right"],name:"move lineend"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineEnd",ep:"command",key:["shift_end","ctrl_shift_right"],name:"select lineend"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocEnd",ep:"command",key:"ctrl_down",name:"move docend"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocEnd",ep:"command",key:"ctrl_shift_down",name:"select docend"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineStart",ep:"command",key:["home","ctrl_left"],name:"move linestart"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineStart",ep:"command",key:["shift_home","ctrl_shift_left"],name:"select linestart"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocStart",ep:"command",key:"ctrl_up",name:"move docstart"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocStart",ep:"command",key:"ctrl_shift_up",name:"select docstart"},{predicates:{isTextView:true},pointer:"commands/movement#moveNextWord",ep:"command",key:["alt_right"],name:"move nextword"},{predicates:{isTextView:true},pointer:"commands/movement#selectNextWord",ep:"command",key:["alt_shift_right"],name:"select nextword"},{predicates:{isTextView:true},pointer:"commands/movement#movePreviousWord",ep:"command",key:["alt_left"],name:"move prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectPreviousWord",ep:"command",key:["alt_shift_left"],name:"select prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectAll",ep:"command",key:["ctrl_a","meta_a"],name:"select all"},{predicates:{isTextView:true},ep:"command",name:"scroll"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollDocStart",ep:"command",key:"ctrl_home",name:"scroll start"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollDocEnd",ep:"command",key:"ctrl_end",name:"scroll end"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageDown",ep:"command",key:"pagedown",name:"scroll down"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageUp",ep:"command",key:"pageup",name:"scroll up"},{pointer:"commands/editor#lcCommand",description:"Change all selected text to lowercase",withKey:"CMD SHIFT L",ep:"command",name:"lc"},{pointer:"commands/editor#detabCommand",description:"Convert tabs to spaces.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"detab"},{pointer:"commands/editor#entabCommand",description:"Convert spaces to tabs.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"entab"},{description:"move it! make the editor head to a line number.",params:[{type:"text",name:"line",description:"add the line number to move to in the file"}],key:"ctrl_l",pointer:"commands/editor#gotoCommand",ep:"command",name:"goto"},{pointer:"commands/editor#trimCommand",description:"trim trailing or leading whitespace from each line in selection",params:[{defaultValue:"both",type:{data:[{name:"left"},{name:"right"},{name:"both"}],name:"selection"},name:"side",description:"Do we trim from the left, right or both"}],ep:"command",name:"trim"},{pointer:"commands/editor#ucCommand",description:"Change all selected text to uppercase",withKey:"CMD SHIFT U",ep:"command",name:"uc"},{description:"The distance in characters between each tab",defaultValue:8,type:"number",ep:"setting",name:"tabstop"},{description:"Customize the keymapping",defaultValue:"{}",type:"text",ep:"setting",name:"customKeymapping"},{description:"The keymapping to use",defaultValue:"standard",type:"text",ep:"setting",name:"keymapping"},{description:"The editor font size in pixels",defaultValue:14,type:"number",ep:"setting",name:"fontsize"},{description:"The editor font face",defaultValue:"Monaco, Lucida Console, monospace",type:"text",ep:"setting",name:"fontface"}],type:"plugins/supported",name:"text_editor"},delegate_support:{testmodules:[],type:"plugins/supported",resourceURL:"resources/delegate_support/",description:"Simple support for multiple delegates on an object",name:"delegate_support"},embedded:{resourceURL:"resources/embedded/",name:"embedded",dependencies:{appsupport:"0.0",text_editor:"0.0",dock_view:"0.0",edit_session:"0.0",settings:"0.0"},testmodules:[],provides:[{action:"value",pointer:"#session",ep:"factory",name:"session"}],type:"plugins/embedded"},settings:{resourceURL:"resources/settings/",description:"Infrastructure and commands for managing user preferences",dependencies:{types:"0.0"},testmodules:[],provides:[{indexOn:"name",register:"memory#addSetting",ep:"extensionpoint",name:"setting",description:"A Choice is something that the application offers as a way to customize how it works"},{description:"A test setting",defaultValue:"bb",type:{data:["aa","bb","cc"],name:"selection"},ep:"setting",name:"test"},{pointer:"commands#setCommand",description:"define and show settings",params:[{defaultValue:null,type:{pointer:"settings:memory#getSettings",name:"selection"},name:"setting",description:"The name of the setting to display or alter"},{defaultValue:null,type:{pointer:"settings:memory#getTypeSpecFromAssignment",name:"deferred"},name:"value",description:"The new value for the chosen setting"}],ep:"command",name:"set"},{pointer:"commands#unsetCommand",description:"unset a setting entirely",params:[{type:{pointer:"settings:memory#getSettings",name:"selection"},name:"setting",description:"The name of the setting to return to defaults"}],ep:"command",name:"unset"}],type:"plugins/supported",name:"settings"},javascript:{resourceURL:"resources/javascript/",description:"JavaScript syntax highlighter",dependencies:{syntax_manager:"0.0"},testmodules:[],provides:[{syntax:"js",ep:"fileextension",name:"js"},{pointer:"#JSSyntax",ep:"syntax",name:"js"}],type:"plugins/supported",name:"javascript"},canon:{resourceURL:"resources/canon/",description:"Manages commands and their keyboard shortcuts",dependencies:{types:"0.0",settings:"0.0"},testmodules:["tests/testKeyboard"],provides:[{indexOn:"name",description:"A command is a bit of functionality with optional typed arguments which can do something small like moving the cursor around the screen, or large like cloning a project from VCS.",ep:"extensionpoint",name:"command"},{description:"How many typed commands do we recall for reference?",defaultValue:50,type:"number",ep:"setting",name:"historyLength"}],type:"plugins/supported",name:"canon"},rangeutils:{testmodules:[],type:"plugins/supported",resourceURL:"resources/rangeutils/",description:"Utility functions for dealing with ranges of text",name:"rangeutils"},dock_view:{testmodules:[],type:"plugins/supported",resourceURL:"resources/dock_view/",description:"A view that supports docked panels on the sides",name:"dock_view"},html:{resourceURL:"resources/html/",description:"HTML syntax highlighter",dependencies:{syntax_manager:"0.0"},testmodules:[],provides:[{syntax:"html",ep:"fileextension",name:"htm"},{syntax:"html",ep:"fileextension",name:"html"},{pointer:"#HTMLSyntax",ep:"syntax",name:"html"}],type:"plugins/supported",name:"html"},filesystem:{resourceURL:"resources/filesystem/",description:"Provides the file and directory model used within Bespin",dependencies:{types:"0.0"},testmodules:["tests/testFileManagement","tests/testPathUtils"],provides:[{description:"A pointer to a file which we believe to already exist",pointer:"types#existingFile",ep:"type",name:"existingFile"}],type:"plugins/supported",name:"filesystem"},appsupport:{resourceURL:"resources/appsupport/",description:"Common services used in the editor application",dependencies:{canon:"0.0"},testmodules:[],provides:[{pointer:"controllers/undomanager#undoManagerCommand",ep:"command",key:["ctrl_shift_z"],name:"redo"},{pointer:"controllers/undomanager#undoManagerCommand",ep:"command",key:["ctrl_z"],name:"undo"}],type:"plugins/supported",name:"appsupport"},edit_session:{resourceURL:"resources/edit_session/",description:"Ties together the files being edited with the views on screen",dependencies:{text_editor:"0.0",delegate_support:"0.0",filesystem:"0.0"},testmodules:["tests/testHistory","tests/testSession"],provides:[{ep:"extensionpoint",name:"bufferFileChanged",description:"Notifies that the current file is changed."}],type:"plugins/supported",name:"edit_session"},types:{resourceURL:"resources/types/",description:"Defines parameter types for commands",testmodules:["tests/testBasic","tests/testTypes"],provides:[{indexOn:"name",description:"Commands can accept various arguments that the user enters or that are automatically supplied by the environment. Those arguments have types that define how they are supplied or completed. The pointer points to an object with methods convert(str value) and getDefault(). Both functions have `this` set to the command's `takes` parameter. If getDefault is not defined, the default on the command's `takes` is used, if there is one. The object can have a noInput property that is set to true to reflect that this type is provided directly by the system. getDefault must be defined in that case.",ep:"extensionpoint",name:"type"},{description:"Text that the user needs to enter.",pointer:"basic#text",ep:"type",name:"text"},{description:"A JavaScript number",pointer:"basic#number",ep:"type",name:"number"},{description:"A true/false value",pointer:"basic#bool",ep:"type",name:"boolean"},{description:"An object that converts via JavaScript",pointer:"basic#object",ep:"type",name:"object"},{description:"A string that is constrained to be one of a number of pre-defined values",pointer:"basic#selection",ep:"type",name:"selection"},{description:"A type which we don't understand from the outset, but which we hope context can help us with",ep:"type",name:"deferred"}],type:"plugins/supported",name:"types"},syntax_manager:{resourceURL:"resources/syntax_manager/",description:"Provides syntax highlighting services for the editor",dependencies:{rangeutils:"0.0",delegate_support:"0.0"},testmodules:[],provides:[{register:"controllers/syntaxdirectory#discoveredNewSyntax",ep:"extensionhandler",name:"syntax"},{indexOn:"name",ep:"extensionpoint",name:"fileextension"}],type:"plugins/supported",name:"syntax_manager"}});SC.ready(function(){var embed=tiki.require("embedded");var nodes=document.querySelectorAll(".bespin");for(var i=0;i<nodes.length;i++){var node=nodes[i];var options=node.getAttribute("data-bespinoptions");node.bespin=embed.useBespin(node,JSON.parse(options))}if(window.onBespinLoad){window.onBespinLoad()}});document.addEventListener("DOMContentLoaded",SC.didLoad,false);window.tiki=tiki;